import{T as F,s as v,d as D,B as V,p as W,c as z,w,C as H,o as q,b,a as t,i as P,j as k,v as _,u as O,n as J,g as X}from"./app-PtKpDxL3.js";import{_ as K}from"./reset-Lslcyg1R.js";import{_ as Q}from"./AdminPanel-Dy3tTlJm.js";import{_ as Z}from"./Main-DKSZb6a-.js";import{T as ee}from"./TableContainer-C1Xzxe5W.js";import{P as $,D as te}from"./dataTables-CPDq8Nfz.js";import{_ as re}from"./SuccessButton-BvucEcGj.js";import{_ as oe}from"./TransparentButton-3KD1yN4Q.js";import{_ as se}from"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-DMiA-fcE.js";import{E as ae}from"./Excel-BaoeE1u5.js";import{S as ne}from"./SearchColored-CyqFvcJS.js";import{E as le}from"./exceljs.min-B_5GxFvE.js";import"./DaisyModal-Dr05Lgmf.js";import"./Modal-B0NwKHOQ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                                   */import"./InputError-dzOUU8D2.js";import"./FormComponent-eogPIn0L.js";import"./RetailGroup-C1sh5lal.js";import"./Logout-ho77fkiB.js";/* empty css                                                             */import"./RetailItems-ozaKlTSo.js";import"./Attendance-CnJEetSN.js";import"./PartyCake143-BMnD1COm.js";const ie={class:"absolute adjust"},ue={class:"flex justify-start items-center"},ce=["value"],de={"date-rangepicker":"",class:"flex items-center"},pe={class:"relative ml-5"},me=["placeholder"],fe={class:"relative"},Ee=["placeholder"],Te={class:"custom-datatable"},ge={props:{orders:{type:Array,required:!0,default:()=>[]}},computed:{flattenedOrders(){return this.calculateFlattenedOrders(this.orders)},grandTotal(){return this.flattenedOrders.reduce((p,I)=>p+(I.TOTAL||0),0)}},methods:{calculateFlattenedOrders(p){if(console.log("Calculating flattenedOrders"),console.log("Input orders:",p),!p||!Array.isArray(p))return console.error("Invalid orders data"),[];function I(u,i){if(!u.STOREID||!i.STOREID)return console.warn("Missing STOREID:",u,i),0;const E=u.STOREID.toString(),s=i.STOREID.toString();return!isNaN(E)&&!isNaN(s)?parseInt(E)-parseInt(s):E.localeCompare(s,void 0,{numeric:!0,sensitivity:"base"})}p.sort(I);const g=p.reduce((u,i)=>{if(i&&typeof i=="object"){const E=`${i.STOREID} - ${i.STORENAME}`,s=i.ITEMNAME||"",a=i.ITEMID||"",d=i.CATEGORY||"",f=i.COUNTED&&parseInt(i.COUNTED.trim())||0;u[s]||(u[s]={ITEMID:a,ITEMNAME:s,CATEGORY:d}),u[s][E]||(u[s][E]=0),u[s][E]+=f}return u},{}),c=Object.values(g).map(u=>{let i=0;const E={};return Object.keys(u).sort((s,a)=>{if(s==="ITEMID"||s==="ITEMNAME"||s==="CATEGORY")return-1;if(a==="ITEMID"||a==="ITEMNAME"||a==="CATEGORY")return 1;const d=s.split(" - ")[0],f=a.split(" - ")[0];return!isNaN(d)&&!isNaN(f)?parseInt(d)-parseInt(f):d.localeCompare(f,void 0,{numeric:!0,sensitivity:"base"})}).forEach(s=>{s!=="ITEMID"&&s!=="ITEMNAME"&&s!=="CATEGORY"&&(i+=u[s]),E[s]=u[s]}),{...E,TOTAL:i}});return console.log("Calculated flattenedOrders:",c),c},async exportToExcel(){console.log("Starting exportToExcel"),console.log("flattenedOrders:",this.flattenedOrders);try{if(!this.flattenedOrders||!Array.isArray(this.flattenedOrders)||this.flattenedOrders.length===0){console.error("No data to export");return}const p=new le.Workbook,I=p.addWorksheet("Flattened Orders"),g=[{header:"ITEMID",key:"ITEMID",width:20},{header:"ITEMNAME",key:"ITEMNAME",width:25},{header:"CATEGORY",key:"CATEGORY",width:20},{header:"TOTAL",key:"TOTAL",width:15}],c=new Set;this.flattenedOrders.forEach(a=>{a&&typeof a=="object"&&Object.keys(a).forEach(d=>{d!=="ITEMID"&&d!=="ITEMNAME"&&d!=="CATEGORY"&&d!=="TOTAL"&&c.add(d)})});const u=Array.from(c).sort((a,d)=>{const f=a.split(" - ")[0],A=d.split(" - ")[0];return!isNaN(f)&&!isNaN(A)?parseInt(f)-parseInt(A):f.localeCompare(A,void 0,{numeric:!0,sensitivity:"base"})});u.forEach(a=>{g.push({header:a,key:a,width:25})}),I.columns=g,this.flattenedOrders.forEach(a=>{if(a&&typeof a=="object"){const d={ITEMID:a.ITEMID||"",ITEMNAME:a.ITEMNAME||"",CATEGORY:a.CATEGORY||"",TOTAL:a.TOTAL||0};u.forEach(f=>{d[f]=a[f]||0}),I.addRow(d)}});const i=new Date,E=`FlattenedOrders_${i.getFullYear()}-${i.getMonth()+1}-${i.getDate()}.xlsx`,s=await p.xlsx.writeBuffer();this.saveExcelFile(s,E)}catch(p){console.error("Error exporting to Excel:",p)}},saveExcelFile(p,I){const g=new Blob([p],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),c=document.createElement("a");c.href=URL.createObjectURL(g),c.download=I,c.click()}}},We=Object.assign(ge,{__name:"receivedwarehouseconso2",props:{orders:{type:Array,required:!0},auth:{type:Object,required:!0},userRole:{type:String,required:!0}},setup(p,{emit:I}){$.use(te);const g=p,c=F({StartDate:"",EndDate:""}),u=()=>{c.get(route("receivedwarehouse.getrange"),{preserveScroll:!0})},i=v(()=>(console.log("userRole value:",g.userRole),console.log("Is Store?:",g.userRole.toUpperCase()==="STORE"),g.userRole.toUpperCase()==="STORE"?Z:Q)),E=v(()=>{const o=g.orders.reduce((r,T)=>{const{STORENAME:m,ITEMID:l,ITEMNAME:h,CATEGORY:y,COUNTED:B,STOREID:U,stocks:he,movementstocks:ve}=T,N=parseInt((B??"").trim(),10)||0;return r[l]||(r[l]={ITEMID:l,ITEMNAME:h,CATEGORY:y,TOTAL:0}),r[l][m]||(r[l][m]={count:0,STOREID:U}),r[l][m].count+=N,r[l].TOTAL+=N,r},{}),e=Object.values(o),n=(r,T)=>{const m=r.ITEMID,l=T.ITEMID;if(m.startsWith("BW")&&l.startsWith("BW")){const h=parseInt(m.slice(2)),y=parseInt(l.slice(2));if(h<=10&&y<=10)return h-y;if(h<=10)return-1;if(y<=10)return 1}return m.localeCompare(l)};return e.sort(n)}),s=v(()=>Object.values(E.value)),a=v(()=>{const o=new Set;return s.value.forEach(e=>{Object.keys(e).forEach(n=>{typeof e[n]=="object"&&e[n]!==null&&"count"in e[n]&&o.add(n)})}),Array.from(o).sort((e,n)=>{const r=e.split(" - ")[0],T=n.split(" - ")[0];return r.localeCompare(T,void 0,{numeric:!0,sensitivity:"base"})})}),d=v(()=>{const o={ITEMID:"Grand Total",ITEMNAME:"Grand Total",CATEGORY:"",movementstocks:0,stocks:0,BalanceCount:0,TOTAL:0};return a.value.forEach(e=>{o[e]=0}),s.value.forEach(e=>{o.TOTAL+=e.TOTAL,o.movementstocks+=e.movementstocks,o.stocks+=e.stocks,o.BalanceCount+=e.BalanceCount,a.value.forEach(n=>{var r;o[n]+=((r=e[n])==null?void 0:r.count)||0})}),o}),f=v(()=>{const o=[{title:"ITEMS",data:"ITEMNAME",className:"frozen-column",footer:()=>"",orderable:!0,width:"200px"},{title:"CATEGORY",data:"CATEGORY",className:"frozen-column",footer:()=>"",width:"120px"},{title:"TOTAL",data:"TOTAL",footer:()=>d.value.TOTAL}],e=[],n=new Set;return s.value.forEach(r=>{Object.entries(r).forEach(([T,m])=>{typeof m=="object"&&m!==null&&"count"in m&&"STOREID"in m&&(n.has(T)||(n.add(T),e.push({title:`${m.STOREID}<br>${T}`,data:T,render:(l,h)=>h==="sort"||h==="type"?(l==null?void 0:l.count)||0:h==="display"?`${(l==null?void 0:l.count)||0}`:(l==null?void 0:l.count)||0,footer:()=>d.value[T]})))})}),e.sort((r,T)=>{const m=r.title.split("<br>")[0],l=T.title.split("<br>")[0];return m.localeCompare(l,void 0,{numeric:!0,sensitivity:"base"})}),[...o,...e]}),A={paging:!1,scrollX:!0,scrollY:"60vh",scrollCollapse:!0,fixedColumns:{start:3},error:function(o,e,n){console.error("DataTables error:",e)},footerCallback:function(o,e,n,r,T){const l=this.api().table().footer().querySelectorAll("th");f.value.forEach((h,y)=>{h.footer&&(l[y].textContent=h.footer())})}},C=D(null),M=v(()=>{if(C.value){const o=new Date(C.value),e=o.getFullYear(),n=String(o.getMonth()+1).padStart(2,"0"),r=String(o.getDate()).padStart(2,"0");return`${e}-${n}-${r}`}return""}),R=D(null),S=v(()=>{if(R.value){const o=new Date(R.value),e=o.getFullYear(),n=String(o.getMonth()+1).padStart(2,"0"),r=String(o.getDate()).padStart(2,"0");return`${e}-${n}-${r}`}return""});v(()=>{const o=new Date,e=o.getFullYear(),n=String(o.getMonth()+1).padStart(2,"0"),r=String(o.getDate()).padStart(2,"0");return`${e}${n}${r}`});const x=D(!1),Y=()=>{x.value=!0},j=()=>{x.value=!1},{user:L}=V(g.auth),G=D(L.value.role);return v(()=>G.value==="ADMIN"),(o,e)=>{const n=W("InputError");return q(),z(H(i.value),{"active-tab":"REPORTS"},{modals:w(()=>[b(K,{"show-modal":x.value,onToggleActive:j},null,8,["show-modal"])]),main:w(()=>[b(ee,null,{default:w(()=>[t("div",ie,[t("div",ue,[t("form",{onSubmit:P(u,["prevent"]),class:"px-2 py-3 max-h-[50vh] lg:max-h-[70vh] overflow-y-auto"},[t("input",{type:"hidden",name:"_token",value:o.$page.props.csrf_token},null,8,ce),t("div",de,[t("div",pe,[e[4]||(e[4]=t("div",{class:"flex absolute inset-y-0 left-0 items-center pl-3 pointer-events-none"},[t("svg",{class:"w-5 h-5 text-gray-500 dark:text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[t("path",{"fill-rule":"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z","clip-rule":"evenodd"})])],-1)),k(t("input",{id:"StartDate",type:"date","onUpdate:modelValue":e[0]||(e[0]=r=>O(c).StartDate=r),onInput:e[1]||(e[1]=(...r)=>M.value&&M.value(...r)),placeholder:M.value,class:"bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",required:""},null,40,me),[[_,O(c).StartDate]]),b(n,{message:O(c).errors.StartDate,class:"mt-2"},null,8,["message"])]),e[6]||(e[6]=t("span",{class:"mx-4 text-gray-500"},"to",-1)),t("div",fe,[e[5]||(e[5]=t("div",{class:"flex absolute inset-y-0 left-0 items-center pl-3 pointer-events-none"},[t("svg",{class:"w-5 h-5 text-gray-500 dark:text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[t("path",{"fill-rule":"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z","clip-rule":"evenodd"})])],-1)),k(t("input",{id:"EndDate",type:"date","onUpdate:modelValue":e[2]||(e[2]=r=>O(c).EndDate=r),onInput:e[3]||(e[3]=(...r)=>S.value&&S.value(...r)),placeholder:S.value,class:"bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",required:""},null,40,Ee),[[_,O(c).EndDate]]),b(n,{message:O(c).errors.EndDate,class:"mt-2"},null,8,["message"])])])],32),b(oe,{type:"submit",onClick:u,disabled:O(c).processing,class:J({"opacity-25":O(c).processing})},{default:w(()=>[b(ne,{class:"h-8"})]),_:1},8,["disabled","class"]),e[8]||(e[8]=t("details",{className:"dropdown"},[t("summary",{className:"btn m-1 !bg-navy !text-white"},"TYPES"),t("ul",{className:"menu dropdown-content !bg-gray-100 rounded-box z-[1] w-52 p-2 shadow"},[t("li",null,[t("a",{href:"/orderingconso"},"BW PRODUCTS")]),t("li",null,[t("a",{href:"/received-warehouse-reports"},"WAREHOUSE")])])],-1)),e[9]||(e[9]=t("details",{className:"dropdown"},[t("summary",{className:"btn m-1 !bg-navy !text-white"},"RECENT"),t("ul",{className:"menu dropdown-content !bg-gray-100 rounded-box z-[1] w-52 p-2 shadow"},[t("li",null,[t("a",{href:"/received-lastmonth"},"Last Month")]),t("li",null,[t("a",{href:"/received-lastweek"},"Last Week")]),t("li",null,[t("a",{href:"/received-yesterday"},"Yesterday")])])],-1)),b(re,{type:"button",onClick:o.exportToExcel,class:"m-6 bg-green"},{default:w(()=>[b(ae,{class:"h-4"})]),_:1},8,["onClick"]),b(se,{type:"button",onClick:Y,class:"m-1 ml-2 !bg-navy p-10"},{default:w(()=>e[7]||(e[7]=[X(" RESET ")])),_:1}),e[10]||(e[10]=t("h6",{class:"ml-2 font-bold"},"WAREHOUSE",-1))])]),t("div",Te,[b(O($),{data:s.value,columns:f.value,class:"w-full relative display",options:A},{action:w(r=>e[11]||(e[11]=[t("div",{class:"flex justify-start"},null,-1)])),_:1},8,["data","columns"])])]),_:1})]),_:1})}}});export{We as default};
