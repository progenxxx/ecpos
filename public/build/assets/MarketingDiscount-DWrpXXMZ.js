import{d as _,s as b,k as q,c as x,w as y,C as E,o as v,a as s,e as g,b as h,f as T,j as w,v as k,u as U}from"./app-CfytZ6uy.js";import{_ as V}from"./AdminPanel-CL6jLfvg.js";import{_ as M}from"./Main-O7zX48KL.js";import{_ as B}from"./MultiSelectDropdown-De5Gxnbp.js";import{T as O}from"./TableContainer-C_tye70S.js";import"./buttons.print-CRuYpU0y.js";import{P as D,D as C}from"./dataTables-BGy9-Y2a.js";import{E as P}from"./exceljs.min-CpKGb2AC.js";import"./RetailGroup-2HMR2ftQ.js";import"./Logout-z3St95b0.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                             */import"./Modal-BPjbBi2X.js";import"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-B1wW2mpq.js";import"./RetailItems-DVr2J4Jb.js";/* empty css                                                                */import"./Attendance-DXy5Tht_.js";import"./PartyCake143-CbFWaXlu.js";const j={class:"mb-4 flex flex-wrap gap-4 p-4 bg-white rounded-lg shadow z-[999]"},I={key:0,class:"flex-1 min-w-[200px]"},L={class:"flex-1 min-w-[200px]"},G={class:"flex-1 min-w-[200px]"},$={class:"flex items-end"},Q={key:1},dt={__name:"MarketingDiscount",props:{ec:{type:Array,required:!0},auth:{type:Object,required:!0},stores:{type:Array,required:!0},userRole:{type:String,required:!0},filters:{type:Object,required:!0,default:()=>({startDate:"",endDate:"",selectedStores:[]})}},setup(c){D.use(C);const r=_([]),n=_(""),u=_(""),d=c,N=b(()=>d.userRole.toUpperCase()==="STORE"?M:V);q(()=>{r.value=d.filters.selectedStores||[],n.value=d.filters.startDate||"",u.value=d.filters.endDate||""});const p=b(()=>{let t=[...d.ec];return r.value.length>0&&(t=t.filter(e=>r.value.includes(e.storename))),n.value&&u.value&&(t=t.filter(e=>{const l=new Date(e.createddate),o=new Date(n.value),m=new Date(u.value);return l>=o&&l<=m})),t}),a=b(()=>p.value.reduce((t,e)=>(t.total_discamount+=parseFloat(e.total_discamount)||0,t.total_costprice+=parseFloat(e.total_costprice)||0,t.total_netamount+=parseFloat(e.total_netamount)||0,t.vatablesales+=parseFloat(e.vatablesales)||0,t.vat+=parseFloat(e.vat)||0,t.total_grossamount+=parseFloat(e.total_grossamount)||0,t.total_costamount+=parseFloat(e.total_costamount)||0,t.total_qty+=Math.round(e.qty||0),t),{total_qty:0,total_discamount:0,total_costprice:0,total_netamount:0,vatablesales:0,vat:0,total_grossamount:0,total_costamount:0})),R=[{data:"discofferid",title:"DISCOUNT NAME",footer:"Grand Total"},{data:"price",title:"Price"},{data:"qty",title:"Qty",render:t=>Math.round(t),footer:()=>Math.round(a.value.total_qty)},{data:"total_costprice",title:"Cost Price",render:t=>(parseFloat(t)||0).toFixed(2),footer:()=>a.value.total_costprice.toFixed(2)},{data:"total_grossamount",title:"Gross Amount",render:t=>(parseFloat(t)||0).toFixed(2),footer:()=>a.value.total_grossamount.toFixed(2)},{data:"total_costamount",title:"Cost Amount",render:t=>(parseFloat(t)||0).toFixed(2),footer:()=>a.value.total_costamount.toFixed(2)},{data:"total_discamount",title:"Discount Amount",render:t=>(parseFloat(t)||0).toFixed(2),footer:()=>a.value.total_discamount.toFixed(2)},{data:"total_netamount",title:"Net Amount",render:t=>(parseFloat(t)||0).toFixed(2),footer:()=>a.value.total_netamount.toFixed(2)},{data:"vatablesales",title:"Vatable Sales",render:t=>(parseFloat(t)||0).toFixed(2),footer:()=>a.value.vatablesales.toFixed(2)},{data:"vat",title:"VAT",render:t=>(parseFloat(t)||0).toFixed(2),footer:()=>a.value.vat.toFixed(2)}],A={responsive:!0,order:[[0,"asc"]],pageLength:25,dom:"Bfrtip",scrollX:!0,scrollY:"50vh",buttons:["copy",{text:"Export Excel",action:function(t,e,l,o){S()}},"pdf","print"],drawCallback:function(t){const l=new C.Api(t).table().footer().querySelectorAll("td, th");["total_qty","total_costprice","total_grossamount","total_costamount","total_discamount","total_netamount","vatablesales","vat"].forEach((m,f)=>{const i=a.value[m],F=l[f+2];F&&typeof i=="number"&&(F.textContent=i.toFixed(2))})}},S=()=>{const t=new P.Workbook,e=t.addWorksheet("Sales Data");e.columns=[{header:"DiscountName",key:"discofferid",width:30},{header:"Price",key:"price",width:15,style:{numFmt:"#,##0.00"}},{header:"Qty",key:"qty",width:10,style:{numFmt:"#,##0"}},{header:"Cost Price",key:"total_costprice",width:15,style:{numFmt:"#,##0.00"}},{header:"Gross Amount",key:"total_grossamount",width:15,style:{numFmt:"#,##0.00"}},{header:"Cost Amount",key:"total_costamount",width:15,style:{numFmt:"#,##0.00"}},{header:"Discount Amount",key:"total_discamount",width:15,style:{numFmt:"#,##0.00"}},{header:"Net Amount",key:"total_netamount",width:15,style:{numFmt:"#,##0.00"}},{header:"Vatable Sales",key:"vatablesales",width:15,style:{numFmt:"#,##0.00"}},{header:"VAT",key:"vat",width:15,style:{numFmt:"#,##0.00"}}],e.getRow(1).font={bold:!0},e.getRow(1).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF343A40"}},e.getRow(1).font={color:{argb:"FFFFFFFF"},bold:!0},p.value.forEach(o=>{e.addRow({discofferid:o.discofferid||"N/A",price:Number(o.price)||0,qty:Math.round(Number(o.qty))||0,total_costprice:Number(o.total_costprice)||0,total_grossamount:Number(o.total_grossamount)||0,total_costamount:Number(o.total_costamount)||0,total_discamount:Number(o.total_discamount)||0,total_netamount:Number(o.total_netamount)||0,vatablesales:Number(o.vatablesales)||0,vat:Number(o.vat)||0})});const l=e.addRow({discofferid:"Grand Total",price:"",qty:a.value.total_qty,total_costprice:a.value.total_costprice,total_grossamount:a.value.total_grossamount,total_costamount:a.value.total_costamount,total_discamount:a.value.total_discamount,total_netamount:a.value.total_netamount,vatablesales:a.value.vatablesales,vat:a.value.vat});l.font={bold:!0},l.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF007BFF"}},l.font={color:{argb:"FFFFFFFF"},bold:!0},e.columns.forEach(o=>{o.width=Math.max(o.width||10,15)}),t.xlsx.writeBuffer().then(o=>{const m=new Blob([o],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),f=window.URL.createObjectURL(m),i=document.createElement("a");i.href=f,i.download=`ItemSales_Report_${new Date().toISOString().split("T")[0]}.xlsx`,i.click(),window.URL.revokeObjectURL(f)})};return(t,e)=>(v(),x(E(N.value),{"active-tab":"REPORTS"},{main:y(()=>[s("div",j,[c.userRole.toUpperCase()==="ADMIN"||c.userRole.toUpperCase()==="SUPERADMIN"?(v(),g("div",I,[h(B,{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=l=>r.value=l),options:c.stores,label:"Stores"},null,8,["modelValue","options"])])):T("",!0),s("div",L,[e[4]||(e[4]=s("label",{class:"block text-sm font-medium text-gray-700"},"Start Date",-1)),w(s("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=l=>n.value=l),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[k,n.value]])]),s("div",G,[e[5]||(e[5]=s("label",{class:"block text-sm font-medium text-gray-700"},"End Date",-1)),w(s("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=l=>u.value=l),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[k,u.value]])]),s("div",$,[s("button",{onClick:e[3]||(e[3]=()=>{r.value=[],n.value="",u.value=""}),class:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-md"}," Clear Filters ")])]),h(O,{class:"overflow-auto"},{default:y(()=>[p.value.length>0?(v(),x(U(D),{key:0,data:p.value,columns:R,class:"w-full relative display",options:A},{action:y(l=>e[6]||(e[6]=[])),_:1},8,["data"])):(v(),g("p",Q,"No data available for the selected filters."))]),_:1})]),_:1}))}};export{dt as default};
