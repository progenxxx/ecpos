import{s as O,d as i,l as _e,G as Xe,k as Ge,c as Y,w as ke,C as Qe,o as a,a as t,e as n,t as r,j as C,v as D,i as Z,F as V,h as B,f as p,g as c,n as P,b as Ye,u as Ze,x as ie,N as et}from"./app-CWbsghfQ.js";import{_ as tt}from"./AdminPanel-CYInrTuX.js";import{_ as st}from"./Main-BMSheg9e.js";import{T as ot}from"./TableContainer-6VgDCbb7.js";import{P as Se,D as lt}from"./dataTables-D5Vo52-h.js";import"./buttons.print-D0689lkb.js";import"./exceljs.min-XdaYbRUU.js";import{M as at,C as nt}from"./Close-B_af654b.js";import"./RetailGroup-BW1tkHLf.js";import"./Logout-BoWuqpqH.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                             */import"./Modal-DTsuLBrX.js";import"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-Bmfe4oq8.js";import"./RetailItems-CtMdT1Ax.js";import"./Attendance-D6oEmBx9.js";import"./PartyCake143-CPKVxRIA.js";const rt={class:"mb-4 flex flex-wrap gap-4 p-4 bg-white rounded-lg shadow z-[999]"},dt={key:0,class:"flex-1 min-w-[200px] store-dropdown-container relative"},it={class:"relative"},ut={key:0,class:"text-gray-500"},ct={key:1},mt={key:2},pt={key:0,class:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto"},vt={class:"p-2 border-b border-gray-200"},gt={class:"max-h-40 overflow-auto"},yt=["checked","onChange"],xt={class:"text-sm"},bt={key:0,class:"p-3 text-sm text-gray-500 text-center"},ft={class:"flex-1 min-w-[200px]"},wt={class:"flex-1 min-w-[200px]"},ht={class:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-md"},_t={class:"text-sm text-blue-800"},kt={key:0},St={class:"mb-4 bg-white rounded-lg shadow",open:""},Ct={class:"p-4"},jt={key:0,class:"flex justify-center items-center py-8"},Tt={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Nt={class:"bg-gray-50 p-4 rounded-lg"},Dt={class:"text-2xl mt-1"},Mt={class:"bg-gray-50 p-4 rounded-lg"},At={class:"text-2xl mt-1"},Et={class:"bg-gray-50 p-4 rounded-lg"},Ft={class:"text-2xl mt-1"},Rt={class:"bg-gray-50 p-4 rounded-lg"},It={class:"flex justify-between mt-1"},Ut={class:"text-lg"},Lt={class:"text-lg"},Ot={class:"bg-gray-50 p-4 rounded-lg"},Vt={class:"text-2xl mt-1"},Bt={class:"bg-gray-50 p-4 rounded-lg"},Pt={class:"text-2xl mt-1"},$t={class:"bg-gray-50 p-4 rounded-lg"},Ht={class:"text-2xl mt-1 font-bold"},zt={class:"bg-gray-50 p-4 rounded-lg col-span-1"},qt={class:"flex justify-between mt-1"},Jt={class:"text-xl text-red-600"},Wt={class:"text-xl text-green-600"},Kt={class:"bg-gray-50 p-4 rounded-lg col-span-full"},Xt={class:"grid grid-cols-2 md:grid-cols-5 gap-4"},Gt={class:"text-lg"},Qt={class:"text-lg"},Yt={class:"text-lg"},Zt={class:"text-lg"},es={class:"text-lg"},ts={class:"bg-white rounded-lg shadow"},ss={key:0,class:"flex justify-center items-center py-12"},os={key:1,class:"overflow-hidden"},ls={class:"max-h-96 overflow-y-auto"},as=["onTouchstart","onTouchend","onMousedown","onMouseup"],ns={class:"space-y-3"},rs={class:"font-medium text-gray-900"},ds={class:"text-sm text-gray-500"},is={class:"grid grid-cols-2 gap-2 text-sm"},us={class:"font-medium ml-1"},cs={class:"font-medium ml-1"},ms={class:"font-medium ml-1"},ps={class:"font-medium ml-1"},vs={class:"font-bold ml-1"},gs={class:"grid grid-cols-3 gap-2 text-xs text-gray-600"},ys={class:"flex justify-end space-x-2 mt-2"},xs=["onClick"],bs=["onClick"],fs={key:0,class:"fixed bottom-6 right-6 z-40"},ws={key:0,class:"absolute bottom-16 right-0 bg-white rounded-lg shadow-lg border border-gray-200 py-2 w-56 transform transition-all duration-200 ease-out"},hs={key:2,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},_s={class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"},ks={class:"mt-3"},Ss={key:0,class:"mb-4 p-3 bg-gray-50 rounded"},Cs={class:"text-sm font-medium"},js={class:"text-sm text-gray-600"},Ts={class:"text-sm text-gray-600"},Ns={class:"text-xs text-gray-500"},Ds={class:"space-y-4"},Ms={class:"block text-sm font-medium text-gray-700"},As={key:0},Es={key:1},Fs={key:2},Rs={key:0,class:"p-3 bg-blue-50 rounded"},Is={class:"text-sm text-blue-700"},Us={key:0},Ls={key:1},Os={class:"flex justify-end space-x-3 mt-6"},Vs=["disabled"],Bs=["disabled"],Ps={key:0},$s={key:1},Hs={key:3,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},zs={class:"relative top-10 mx-auto p-5 border w-4/5 max-w-4xl shadow-lg rounded-md bg-white"},qs={class:"mt-3"},Js={key:0,class:"mb-4 p-3 bg-gray-50 rounded"},Ws={class:"text-sm font-medium"},Ks={class:"text-sm text-gray-600"},Xs={key:1,class:"flex justify-center items-center py-8"},Gs={key:2,class:"text-center py-8 text-gray-500"},Qs={key:3,class:"overflow-x-auto"},Ys={class:"min-w-full divide-y divide-gray-200"},Zs={class:"bg-white divide-y divide-gray-200"},eo={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},to={class:"px-6 py-4 whitespace-nowrap text-sm"},so={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},oo={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},lo={key:0},ao={key:1},no={class:"px-6 py-4 text-sm text-gray-900"},ro=["title"],io={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},uo={key:4,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},co={class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"},mo={class:"mt-3"},po={class:"space-y-4"},vo={key:0},go=["value"],yo={key:1,class:"p-4 bg-gray-50 rounded-lg"},xo={key:0,class:"flex items-center"},bo={key:1,class:"space-y-2 text-sm"},fo={class:"flex justify-between"},wo={class:"flex justify-between"},ho={class:"text-gray-600"},_o={class:"flex justify-between"},ko={class:"text-gray-600"},So={class:"flex justify-between"},Co={class:"text-gray-600"},jo={key:0,class:"mt-3 pt-3 border-t border-gray-200"},To={class:"text-xs text-gray-500"},No={key:1,class:"mt-3 p-2 bg-red-50 rounded text-red-700 text-xs"},Do={class:"flex justify-end space-x-3 mt-6"},Mo=["disabled"],Ao=["disabled"],Eo={key:0},Fo={key:1},Ro={key:5,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},Io={class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"},Uo={class:"mt-3"},Lo={class:"space-y-4"},Oo={key:0},Vo=["value"],Bo={class:"p-4 bg-blue-50 border border-blue-200 rounded-lg"},Po=["disabled"],$o={key:0},Ho={key:1},zo={class:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg"},qo={key:0,class:"mt-2 text-sm text-green-600"},Jo={class:"flex justify-end space-x-3 mt-6"},Wo=["disabled"],Ko=["disabled"],Xo={key:0},Go={key:1},vl={__name:"Inventory",props:{inventory:{type:Array,required:!0,default:()=>[]},stores:{type:Array,required:!0,default:()=>[]},userRole:{type:String,required:!0},filters:{type:Object,required:!0,default:()=>({startDate:"",endDate:"",selectedStores:[]})},url:{type:String,default:()=>route("reports.inventory")}},setup(w){Se.use(lt);const v=w,Ce=O(()=>v.userRole.toUpperCase()==="STORE"?st:tt),x=i(v.filters.selectedStores||[]),_=i(v.filters.startDate||""),k=i(v.filters.endDate||""),j=i(!0),T=i(!1),$=i(!1),H=i(null),E=i(0),F=i(null),M=i(!1),z=i(""),N=i(!1),ee=i(!1),y=i(null),m=i({adjustment_value:"",adjustment_type:"set",remarks:""}),R=i(!1),te=i(!1),q=i([]),se=i(!1),J=i(!1),b=i({sync_date:"",store_name:""}),I=i(!1),f=i(null),oe=i(!1),le=i(!1),u=i({import_date:"",store_name:"",import_file:null}),U=i(!1),W=i(!1),K=O(()=>{let o=[];return Array.isArray(v.stores)&&(o=v.stores.map(e=>{if(typeof e=="object"&&e!==null){if(e.NAME)return e.NAME;if(e.name)return e.name;if(e.storename)return e.storename;if(e.store_name)return e.store_name;const s=JSON.stringify(e),l=s.match(/"NAME"\s*:\s*"([^"]+)"/);return l?l[1]:s.replace(/[{}":]/g,"").replace(/STOREID[^,]*,?\s*/g,"").replace(/NAME/g,"").trim()||"Unknown Store"}return String(e)})),z.value?o.filter(e=>e.toLowerCase().includes(z.value.toLowerCase())):o}),ue=o=>{clearTimeout(H.value),E.value++,E.value===1?H.value=setTimeout(()=>{E.value=0},300):E.value===2&&(clearTimeout(H.value),X(o),E.value=0)},je=(o,e)=>{M.value=!1,F.value=setTimeout(()=>{M.value=!0,L(o),navigator.vibrate&&navigator.vibrate(50)},1e3)},Te=(o,e)=>{clearTimeout(F.value),M.value||ue(o)},Ne=(o,e)=>{e.preventDefault(),M.value=!1,F.value=setTimeout(()=>{M.value=!0,L(o)},1e3)},De=(o,e)=>{clearTimeout(F.value),M.value||ue(o)},ae=()=>{clearTimeout(F.value),clearTimeout(H.value)},Me=()=>{T.value=!T.value},S=()=>{T.value=!1},Ae=o=>{const e=x.value.indexOf(o);e>-1?x.value.splice(e,1):x.value.push(o)},Ee=o=>x.value.includes(o),Fe=()=>{x.value=[],N.value=!1},Re=()=>{const o=v.stores.map(e=>{if(typeof e=="object"&&e!==null){if(e.NAME)return e.NAME;if(e.name)return e.name;if(e.storename)return e.storename;if(e.store_name)return e.store_name;const s=JSON.stringify(e),l=s.match(/"NAME"\s*:\s*"([^"]+)"/);return l?l[1]:s.replace(/[{}":]/g,"").replace(/STOREID[^,]*,?\s*/g,"").replace(/NAME/g,"").trim()||"Unknown Store"}return String(e)});x.value=o,N.value=!1},ne=()=>{$.value=window.innerWidth<768},h=O(()=>{var o;return(o=v.inventory)!=null&&o.length?v.inventory.reduce((e,s)=>{const l=g=>Number(g||0),d=l(s.throw_away)+l(s.early_molds)+l(s.pull_out)+l(s.rat_bites)+l(s.ant_bites);return{beginning:e.beginning+l(s.beginning),receivedDelivery:e.receivedDelivery+l(s.received_delivery),stockTransfer:e.stockTransfer+l(s.stock_transfer),sales:e.sales+l(s.sales),bundleSales:e.bundleSales+l(s.bundle_sales||0),waste:e.waste+d,itemcount:e.itemcount+l(s.item_count),ending:e.ending+l(s.ending),variance:e.variance+l(s.variance),throwAway:e.throwAway+l(s.throw_away),earlyMolds:e.earlyMolds+l(s.early_molds),pullOut:e.pullOut+l(s.pull_out),ratBites:e.ratBites+l(s.rat_bites),antBites:e.antBites+l(s.ant_bites)}},{beginning:0,receivedDelivery:0,stockTransfer:0,sales:0,bundleSales:0,waste:0,itemcount:0,ending:0,variance:0,throwAway:0,earlyMolds:0,pullOut:0,ratBites:0,antBites:0}):{beginning:0,receivedDelivery:0,stockTransfer:0,sales:0,bundleSales:0,waste:0,itemcount:0,ending:0,variance:0,throwAway:0,earlyMolds:0,pullOut:0,ratBites:0,antBites:0}}),Ie=O(()=>{var o;return((o=v.inventory)==null?void 0:o.reduce((e,s)=>{const l=Number(s.variance||0);return l<0?e+l:e},0))||0}),Ue=O(()=>{var o;return((o=v.inventory)==null?void 0:o.reduce((e,s)=>{const l=Number(s.variance||0);return l>0?e+l:e},0))||0}),X=o=>{console.log("Opening adjustment modal for item:",o),y.value=o,m.value={adjustment_value:"",adjustment_type:"set",remarks:""},ee.value=!0,S()},ce=()=>{ee.value=!1,y.value=null,m.value={adjustment_value:"",adjustment_type:"set",remarks:""}},Le=async()=>{var o;if(!m.value.adjustment_value||!m.value.remarks.trim()){alert("Please fill in all required fields");return}if(!y.value||!y.value.id){alert("Item ID is missing. This might be an aggregated record. Please contact support if this persists."),console.error("Missing ID for item:",y.value);return}R.value=!0;try{const e=(o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content");if(!e)throw new Error("CSRF token not found");const s={id:y.value.id,adjustment_value:parseFloat(m.value.adjustment_value),adjustment_type:m.value.adjustment_type,remarks:m.value.remarks.trim()};console.log("Submitting adjustment:",s);const l=await fetch("/inventory/adjust-item-count",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":e,Accept:"application/json"},body:JSON.stringify(s)});if(!l.ok){const g=await l.text();throw console.error("HTTP Error Response:",g),new Error(`HTTP error! status: ${l.status} - ${g}`)}const d=await l.json();console.log("Response:",d),d.success?(alert("Item count adjusted successfully"),ce(),window.location.reload()):(alert(d.message||"Failed to adjust item count"),d.errors&&(console.error("Validation errors:",d.errors),Object.keys(d.errors).forEach(g=>{console.error(`${g}: ${d.errors[g].join(", ")}`)})))}catch(e){console.error("Error adjusting item count:",e),alert("An error occurred while adjusting item count: "+e.message)}finally{R.value=!1}},L=async o=>{var e;y.value=o,te.value=!0,se.value=!0,S();try{const s=(e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.getAttribute("content"),d=await(await fetch("/inventory/adjustment-history",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":s,Accept:"application/json"},body:JSON.stringify({itemid:o.itemid,storename:o.storename})})).json();d.success?q.value=d.data:console.error("Failed to fetch adjustment history:",d.message)}catch(s){console.error("Error fetching adjustment history:",s)}finally{se.value=!1}},Oe=()=>{te.value=!1,y.value=null,q.value=[]},me=()=>{b.value={sync_date:k.value||_.value||new Date().toISOString().split("T")[0],store_name:x.value.length===1?x.value[0]:""},J.value=!0,S(),ve()},pe=()=>{J.value=!1,b.value={sync_date:"",store_name:""},f.value=null},ve=async()=>{var o;if(b.value.sync_date){oe.value=!0;try{const e=(o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"),l=await(await fetch("/inventory/sync-status",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":e,Accept:"application/json"},body:JSON.stringify({sync_date:b.value.sync_date,store_name:b.value.store_name})})).json();l.success?f.value=l.data:console.error("Failed to get sync status:",l.message)}catch(e){console.error("Error getting sync status:",e)}finally{oe.value=!1}}},Ve=async()=>{var o;if(!b.value.sync_date){alert("Please select a sync date");return}if((v.userRole.toUpperCase()==="ADMIN"||v.userRole.toUpperCase()==="SUPERADMIN")&&!b.value.store_name){alert("Please select a store");return}I.value=!0;try{const e=(o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"),l=await(await fetch("/inventory/sync-variance",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":e,Accept:"application/json"},body:JSON.stringify({sync_date:b.value.sync_date,store_name:b.value.store_name})})).json();l.success?(alert(`Sync completed successfully!

Store: ${l.data.store_name}
Date: ${l.data.sync_date}
Records Updated: ${l.data.total_affected_rows}`),pe(),window.location.reload()):alert("Sync failed: "+l.message)}catch(e){console.error("Error performing sync:",e),alert("An error occurred during sync: "+e.message)}finally{I.value=!1}},ge=()=>{u.value={import_date:k.value||_.value||new Date().toISOString().split("T")[0],store_name:x.value.length===1?x.value[0]:"",import_file:null},le.value=!0,S()},ye=()=>{le.value=!1,u.value={import_date:"",store_name:"",import_file:null}},Be=async()=>{var o;if(!u.value.import_date){alert("Please select a date first");return}if((v.userRole.toUpperCase()==="ADMIN"||v.userRole.toUpperCase()==="SUPERADMIN")&&!u.value.store_name){alert("Please select a store first");return}W.value=!0;try{const e=(o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"),s=await fetch("/inventory/download-count-template",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":e,Accept:"application/json"},body:JSON.stringify({import_date:u.value.import_date,store_name:u.value.store_name})});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const l=await s.blob(),d=window.URL.createObjectURL(l),g=document.createElement("a"),G=`count_template_${u.value.store_name||"store"}_${u.value.import_date.replace(/-/g,"")}.xlsx`;g.style.display="none",g.href=d,g.download=G,document.body.appendChild(g),g.click(),window.URL.revokeObjectURL(d),document.body.removeChild(g),alert("Template downloaded successfully!")}catch(e){console.error("Error downloading template:",e),alert("Error downloading template: "+e.message)}finally{W.value=!1}},Pe=o=>{const e=o.target.files[0];if(e){if(!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel","text/csv"].includes(e.type)){alert("Please select a valid Excel (.xlsx, .xls) or CSV file"),o.target.value="";return}u.value.import_file=e}},$e=async()=>{var o;if(!u.value.import_date){alert("Please select an import date");return}if((v.userRole.toUpperCase()==="ADMIN"||v.userRole.toUpperCase()==="SUPERADMIN")&&!u.value.store_name){alert("Please select a store");return}if(!u.value.import_file){alert("Please select a file to import");return}U.value=!0;try{const e=(o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"),s=new FormData;s.append("import_date",u.value.import_date),s.append("store_name",u.value.store_name),s.append("import_file",u.value.import_file);const d=await(await fetch("/inventory/import-count-data",{method:"POST",headers:{"X-CSRF-TOKEN":e,Accept:"application/json"},body:s})).json();d.success?(alert(`Import completed successfully!

Store: ${d.data.store_name}
Date: ${d.data.import_date}
Records Imported: ${d.data.total_imported}
Records Updated: ${d.data.total_updated||0}`),ye(),window.location.reload()):(alert("Import failed: "+d.message),d.errors&&console.error("Import errors:",d.errors))}catch(e){console.error("Error importing count data:",e),alert("An error occurred during import: "+e.message)}finally{U.value=!1}},He=[{data:"itemname",title:"Item Name",className:"min-w-[200px]"},{data:"storename",title:"Store",className:"min-w-[120px]"},{data:"beginning",title:"Beginning",className:"text-right",render:o=>Number(o||0).toFixed(2)},{data:"received_delivery",title:"Received",className:"text-right",render:o=>Number(o||0).toFixed(2)},{data:"stock_transfer",title:"Stock Transfer",className:"text-right",render:o=>Number(o||0).toFixed(2)},{data:"sales",title:"Direct Sales",className:"text-right",render:o=>Number(o||0).toFixed(2)},{data:"bundle_sales",title:"Bundle Sales",className:"text-right",render:(o,e,s)=>Number(s.bundle_sales||0).toFixed(2)},{data:"throw_away",title:"Throw Away",className:"text-right",render:o=>Number(o||0).toFixed(2)},{data:"early_molds",title:"Early Molds",className:"text-right",render:o=>Number(o||0).toFixed(2)},{data:"pull_out",title:"Pull Out",className:"text-right",render:o=>Number(o||0).toFixed(2)},{data:"rat_bites",title:"Rat Bites",className:"text-right",render:o=>Number(o||0).toFixed(2)},{data:"ant_bites",title:"Ant Bites",className:"text-right",render:o=>Number(o||0).toFixed(2)},{data:"item_count",title:"Item Count",className:"text-right",render:(o,e,s)=>{const l=Number(o||0).toFixed(2),d=`adjust-${s.id||Math.random()}`,g=`history-${s.id||Math.random()}`;return`
                <div class="flex items-center justify-between">
                    <span>${l}</span>
                    <div class="flex gap-1 ml-2">
                        <button 
                            id="${d}"
                            class="text-blue-600 hover:text-blue-800 text-xs px-2 py-1 border border-blue-300 rounded adjust-btn"
                            title="Adjust Item Count"
                            data-item='${JSON.stringify(s)}'
                        >
                            Adjust
                        </button>
                        <button 
                            id="${g}"
                            class="text-green-600 hover:text-green-800 text-xs px-2 py-1 border border-green-300 rounded history-btn"
                            title="View History"
                            data-item='${JSON.stringify(s)}'
                        >
                            History
                        </button>
                    </div>
                </div>
            `}},{data:"ending",title:"Ending",className:"text-right font-bold",render:o=>Number(o||0).toFixed(2)},{data:"variance",title:"Variance",className:"text-right",render:(o,e,s)=>{const l=Number(o||0);return`<span class="${l<0?"text-red-600":"text-green-600"} font-bold">${l.toFixed(2)}</span>`}}],xe=()=>{document.removeEventListener("click",re),document.addEventListener("click",re)},re=o=>{if(o.target.classList.contains("adjust-btn")){const e=JSON.parse(o.target.getAttribute("data-item"));X(e)}else if(o.target.classList.contains("history-btn")){const e=JSON.parse(o.target.getAttribute("data-item"));L(e)}},ze={responsive:!0,order:[[0,"asc"]],pageLength:25,dom:"Bfrtip",deferRender:!0,buttons:["copy",{extend:"csv",title:"Inventory Report"},{extend:"excel",title:"Inventory Report"},{extend:"pdf",title:"Inventory Report"},"print"],createdRow:function(o,e,s){let l,d=0,g;o.classList.add("cursor-pointer","hover:bg-gray-50","select-none");const G=A=>{A.preventDefault(),l=setTimeout(()=>{L(e)},1e3)},Q=()=>{clearTimeout(l)},he=A=>{A.target.classList.contains("adjust-btn")||A.target.classList.contains("history-btn")||A.target.closest(".adjust-btn")||A.target.closest(".history-btn")||(clearTimeout(g),d++,d===1?g=setTimeout(()=>{d=0},300):d===2&&(clearTimeout(g),X(e),d=0))};o.addEventListener("mousedown",G),o.addEventListener("mouseup",Q),o.addEventListener("mouseleave",Q),o.addEventListener("click",he),o._cleanupEvents=()=>{o.removeEventListener("mousedown",G),o.removeEventListener("mouseup",Q),o.removeEventListener("mouseleave",Q),o.removeEventListener("click",he),clearTimeout(l),clearTimeout(g)}},drawCallback:function(){j.value=!1,setTimeout(xe,100)}},be=()=>{if(_.value&&k.value){const o=new Date(_.value),e=new Date(k.value);if(o>e){alert("Start date cannot be later than end date");return}}j.value=!0,et.get(route("reports.inventory"),{startDate:_.value,endDate:k.value,stores:x.value},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{j.value=!1},onError:o=>{console.error("Filter update failed:",o),j.value=!1}})},fe=()=>{x.value=[],_.value="",k.value="",be(),S()},qe=()=>{if(window.DataTable){const o=window.DataTable.tables()[0];o&&o.button(".buttons-csv").trigger()}S()},Je=()=>{if(window.DataTable){const o=window.DataTable.tables()[0];o&&o.button(".buttons-excel").trigger()}S()},We=()=>{if(window.DataTable){const o=window.DataTable.tables()[0];o&&o.button(".buttons-pdf").trigger()}S()},Ke=()=>{if(window.DataTable){const o=window.DataTable.tables()[0];o&&o.button(".buttons-print").trigger()}S()},we=o=>{N.value&&!o.target.closest(".store-dropdown-container")&&(N.value=!1)};_e([()=>b.value.sync_date,()=>b.value.store_name],()=>{J.value&&ve()},{deep:!0});let de;return _e([x,_,k],()=>{clearTimeout(de),de=setTimeout(be,500)},{deep:!0}),Xe(()=>{clearTimeout(de),ae(),document.removeEventListener("click",re),document.removeEventListener("click",we),window.removeEventListener("resize",ne)}),Ge(()=>{x.value=v.filters.selectedStores||[],_.value=v.filters.startDate||"",k.value=v.filters.endDate||"",console.log("Inventory data:",v.inventory),xe(),document.addEventListener("click",we),window.addEventListener("resize",ne),ne(),setTimeout(()=>{j.value=!1},500)}),(o,e)=>(a(),Y(Qe(Ce.value),{"active-tab":"REPORTS"},{main:ke(()=>[t("div",rt,[w.userRole.toUpperCase()==="ADMIN"||w.userRole.toUpperCase()==="SUPERADMIN"?(a(),n("div",dt,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Stores",-1)),t("div",it,[t("button",{onClick:e[0]||(e[0]=s=>N.value=!N.value),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-left bg-white"},[x.value.length===0?(a(),n("span",ut,"Select stores...")):x.value.length===1?(a(),n("span",ct,r(x.value[0]),1)):(a(),n("span",mt,r(x.value.length)+" stores selected",1)),e[13]||(e[13]=t("svg",{class:"float-right mt-1 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))]),N.value?(a(),n("div",pt,[t("div",vt,[C(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>z.value=s),type:"text",placeholder:"Search stores...",class:"w-full px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-1 focus:ring-blue-500",onClick:e[2]||(e[2]=Z(()=>{},["stop"]))},null,512),[[D,z.value]])]),t("div",{class:"p-2 border-b border-gray-200 flex gap-2"},[t("button",{onClick:Re,class:"px-3 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600"}," Select All "),t("button",{onClick:Fe,class:"px-3 py-1 bg-gray-500 text-white text-xs rounded hover:bg-gray-600"}," Clear ")]),t("div",gt,[(a(!0),n(V,null,B(K.value,s=>(a(),n("label",{key:s,class:"flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer"},[t("input",{type:"checkbox",checked:Ee(s),onChange:l=>Ae(s),class:"mr-2 form-checkbox h-4 w-4 text-blue-600"},null,40,yt),t("span",xt,r(s),1)]))),128))]),K.value.length===0?(a(),n("div",bt," No stores found ")):p("",!0)])):p("",!0)])])):p("",!0),t("div",ft,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700"},"Start Date",-1)),C(t("input",{type:"date","onUpdate:modelValue":e[3]||(e[3]=s=>_.value=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[D,_.value]])]),t("div",wt,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700"},"End Date",-1)),C(t("input",{type:"date","onUpdate:modelValue":e[4]||(e[4]=s=>k.value=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[D,k.value]])]),t("div",{class:"flex items-end"},[t("button",{onClick:fe,class:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-md mr-2"}," Clear Filters "),t("button",{onClick:ge,class:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md flex items-center gap-2 mr-2"},e[17]||(e[17]=[t("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"})],-1),c(" Import Count ")])),t("button",{onClick:me,class:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md flex items-center gap-2"},e[18]||(e[18]=[t("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),c(" Sync Data ")]))])]),t("div",ht,[t("p",_t,[e[20]||(e[20]=t("strong",null,"Interaction Guide:",-1)),e[21]||(e[21]=t("br",null,null,-1)),e[22]||(e[22]=c(" • ")),e[23]||(e[23]=t("strong",null,"Hold/Long press 1 second:",-1)),e[24]||(e[24]=c(" View adjustment history")),e[25]||(e[25]=t("br",null,null,-1)),e[26]||(e[26]=c(" • ")),e[27]||(e[27]=t("strong",null,"Double click/tap:",-1)),e[28]||(e[28]=c(" Adjust item count")),e[29]||(e[29]=t("br",null,null,-1)),e[30]||(e[30]=c(" • ")),e[31]||(e[31]=t("strong",null,"Single click buttons:",-1)),e[32]||(e[32]=c(" Direct actions")),e[33]||(e[33]=t("br",null,null,-1)),$.value?(a(),n("span",kt,e[19]||(e[19]=[c("• "),t("strong",null,"Use floating menu",-1),c(" for exports and sync")]))):p("",!0)])]),t("details",St,[e[53]||(e[53]=t("summary",{class:"px-4 py-3 text-lg font-medium cursor-pointer"}," Inventory Summary ",-1)),t("div",Ct,[j.value?(a(),n("div",jt,e[34]||(e[34]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"},null,-1),t("span",{class:"ml-3"},"Loading data...",-1)]))):(a(),n("div",Tt,[t("div",Nt,[e[35]||(e[35]=t("h3",{class:"text-sm font-semibold text-gray-600"},"Beginning Balance",-1)),t("p",Dt,r(h.value.beginning.toFixed(2)),1)]),t("div",Mt,[e[36]||(e[36]=t("h3",{class:"text-sm font-semibold text-gray-600"},"Total Received",-1)),t("p",At,r(h.value.receivedDelivery.toFixed(2)),1)]),t("div",Et,[e[37]||(e[37]=t("h3",{class:"text-sm font-semibold text-gray-600"},"Stock Transfer",-1)),t("p",Ft,r(h.value.stockTransfer.toFixed(2)),1)]),t("div",Rt,[e[40]||(e[40]=t("h3",{class:"text-sm font-semibold text-gray-600"},"Total Sales",-1)),t("div",It,[t("div",null,[e[38]||(e[38]=t("span",{class:"text-sm text-gray-500"},"Direct:",-1)),t("p",Ut,r(h.value.sales.toFixed(2)),1)]),t("div",null,[e[39]||(e[39]=t("span",{class:"text-sm text-gray-500"},"Bundle:",-1)),t("p",Lt,r(h.value.bundleSales.toFixed(2)),1)])])]),t("div",Ot,[e[41]||(e[41]=t("h3",{class:"text-sm font-semibold text-gray-600"},"Total Waste",-1)),t("p",Vt,r(h.value.waste.toFixed(2)),1)]),t("div",Bt,[e[42]||(e[42]=t("h3",{class:"text-sm font-semibold text-gray-600"},"Current Count",-1)),t("p",Pt,r(h.value.itemcount.toFixed(2)),1)]),t("div",$t,[e[43]||(e[43]=t("h3",{class:"text-sm font-semibold text-gray-600"},"Ending Balance",-1)),t("p",Ht,r(h.value.ending.toFixed(2)),1)]),t("div",zt,[e[46]||(e[46]=t("h3",{class:"text-sm font-semibold text-gray-600"},"Total Variance",-1)),t("div",qt,[t("div",null,[e[44]||(e[44]=t("span",{class:"text-sm text-gray-500"},"Negative:",-1)),t("p",Jt,r(Ie.value.toFixed(2)),1)]),t("div",null,[e[45]||(e[45]=t("span",{class:"text-sm text-gray-500"},"Positive:",-1)),t("p",Wt,r(Ue.value.toFixed(2)),1)])])]),t("div",Kt,[e[52]||(e[52]=t("h3",{class:"text-sm font-semibold text-gray-600 mb-2"},"Waste Breakdown",-1)),t("div",Xt,[t("div",null,[e[47]||(e[47]=t("p",{class:"text-xs text-gray-500"},"Throw Away",-1)),t("p",Gt,r(h.value.throwAway.toFixed(2)),1)]),t("div",null,[e[48]||(e[48]=t("p",{class:"text-xs text-gray-500"},"Early Molds",-1)),t("p",Qt,r(h.value.earlyMolds.toFixed(2)),1)]),t("div",null,[e[49]||(e[49]=t("p",{class:"text-xs text-gray-500"},"Pull Out",-1)),t("p",Yt,r(h.value.pullOut.toFixed(2)),1)]),t("div",null,[e[50]||(e[50]=t("p",{class:"text-xs text-gray-500"},"Rat Bites",-1)),t("p",Zt,r(h.value.ratBites.toFixed(2)),1)]),t("div",null,[e[51]||(e[51]=t("p",{class:"text-xs text-gray-500"},"Ant Bites",-1)),t("p",es,r(h.value.antBites.toFixed(2)),1)])])])]))])]),t("div",ts,[j.value?(a(),n("div",ss,e[54]||(e[54]=[t("div",{class:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-indigo-500"},null,-1),t("span",{class:"ml-4 text-lg"},"Loading inventory data...",-1)]))):p("",!0),$.value?(a(),n("div",os,[t("div",ls,[(a(!0),n(V,null,B(w.inventory,s=>(a(),n("div",{key:`${s.itemid}-${s.storename}`,class:"border-b border-gray-200 p-4 hover:bg-gray-50 transition-colors select-none cursor-pointer",onTouchstart:l=>je(s,l),onTouchend:l=>Te(s,l),onTouchcancel:ae,onMousedown:l=>Ne(s,l),onMouseup:l=>De(s,l),onMouseleave:ae,onContextmenu:e[5]||(e[5]=Z(()=>{},["prevent"]))},[t("div",ns,[t("div",null,[t("div",rs,r((s==null?void 0:s.itemname)||""),1),t("div",ds,r((s==null?void 0:s.storename)||""),1)]),t("div",is,[t("div",null,[e[55]||(e[55]=t("span",{class:"text-gray-600"},"Beginning:",-1)),t("span",us,r(Number((s==null?void 0:s.beginning)||0).toFixed(2)),1)]),t("div",null,[e[56]||(e[56]=t("span",{class:"text-gray-600"},"Received:",-1)),t("span",cs,r(Number((s==null?void 0:s.received_delivery)||0).toFixed(2)),1)]),t("div",null,[e[57]||(e[57]=t("span",{class:"text-gray-600"},"Sales:",-1)),t("span",ms,r(Number((s==null?void 0:s.sales)||0).toFixed(2)),1)]),t("div",null,[e[58]||(e[58]=t("span",{class:"text-gray-600"},"Item Count:",-1)),t("span",ps,r(Number((s==null?void 0:s.item_count)||0).toFixed(2)),1)]),t("div",null,[e[59]||(e[59]=t("span",{class:"text-gray-600"},"Ending:",-1)),t("span",vs,r(Number((s==null?void 0:s.ending)||0).toFixed(2)),1)]),t("div",null,[e[60]||(e[60]=t("span",{class:"text-gray-600"},"Variance:",-1)),t("span",{class:P(["font-bold ml-1",Number((s==null?void 0:s.variance)||0)<0?"text-red-600":"text-green-600"])},r(Number((s==null?void 0:s.variance)||0).toFixed(2)),3)])]),t("div",gs,[t("div",null,"Throw Away: "+r(Number((s==null?void 0:s.throw_away)||0).toFixed(2)),1),t("div",null,"Early Molds: "+r(Number((s==null?void 0:s.early_molds)||0).toFixed(2)),1),t("div",null,"Pull Out: "+r(Number((s==null?void 0:s.pull_out)||0).toFixed(2)),1)]),t("div",ys,[t("button",{onClick:Z(l=>X(s),["stop"]),class:"text-blue-600 hover:text-blue-900 text-sm px-2 py-1 border border-blue-300 rounded"}," Adjust ",8,xs),t("button",{onClick:Z(l=>L(s),["stop"]),class:"text-green-600 hover:text-green-900 text-sm px-2 py-1 border border-green-300 rounded"}," History ",8,bs)])])],40,as))),128))])])):(a(),Y(ot,{key:2,class:"max-h-[80vh] overflow-x-auto overflow-y-auto"},{default:ke(()=>[e[61]||(e[61]=t("div",{class:"p-4 bg-gray-50 border-b border-gray-200"},[t("p",{class:"text-sm text-gray-600"},[t("strong",null,"Desktop Interactions:"),c(" Hold any row for 1 second to view adjustment history, or double-click to adjust item count. ")])],-1)),Ye(Ze(Se),{data:w.inventory,columns:He,class:"w-full relative display",options:ze},null,8,["data"])]),_:1}))]),$.value?(a(),n("div",fs,[T.value?(a(),n("div",ws,[e[69]||(e[69]=t("div",{class:"px-4 py-2 border-b border-gray-200"},[t("p",{class:"text-sm font-medium text-gray-700"},"Export Data")],-1)),t("button",{onClick:qe,class:"w-full px-4 py-3 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center"},e[62]||(e[62]=[t("svg",{class:"h-4 w-4 mr-3 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),c(" Export CSV ")])),t("button",{onClick:Je,class:"w-full px-4 py-3 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center"},e[63]||(e[63]=[t("svg",{class:"h-4 w-4 mr-3 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),c(" Export Excel ")])),t("button",{onClick:We,class:"w-full px-4 py-3 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center"},e[64]||(e[64]=[t("svg",{class:"h-4 w-4 mr-3 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),c(" Export PDF ")])),t("button",{onClick:Ke,class:"w-full px-4 py-3 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center"},e[65]||(e[65]=[t("svg",{class:"h-4 w-4 mr-3 text-purple-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})],-1),c(" Print Report ")])),e[70]||(e[70]=t("div",{class:"border-t border-gray-200 my-2"},null,-1)),t("button",{onClick:ge,class:"w-full px-4 py-3 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center"},e[66]||(e[66]=[t("svg",{class:"h-4 w-4 mr-3 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"})],-1),c(" Import Count Data ")])),t("button",{onClick:me,class:"w-full px-4 py-3 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center"},e[67]||(e[67]=[t("svg",{class:"h-4 w-4 mr-3 text-indigo-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),c(" Sync Inventory Data ")])),e[71]||(e[71]=t("div",{class:"border-t border-gray-200 my-2"},null,-1)),t("button",{onClick:fe,class:"w-full px-4 py-3 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center"},e[68]||(e[68]=[t("svg",{class:"h-4 w-4 mr-3 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.414A1 1 0 013 6.707V4z"})],-1),c(" Clear All Filters ")]))])):p("",!0),t("button",{onClick:Me,class:P(["bg-blue-600 hover:bg-blue-700 text-white rounded-full p-4 shadow-lg transition-all duration-200 ease-out transform hover:scale-105",{"rotate-45":T.value}])},[T.value?(a(),Y(nt,{key:1,class:"h-6 w-6"})):(a(),Y(at,{key:0,class:"h-6 w-6"}))],2)])):p("",!0),T.value?(a(),n("div",{key:1,onClick:S,class:"fixed inset-0 bg-black bg-opacity-25 z-30"})):p("",!0),ee.value?(a(),n("div",hs,[t("div",_s,[t("div",ks,[e[75]||(e[75]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"}," Adjust Item Count ",-1)),y.value?(a(),n("div",Ss,[t("p",Cs,r(y.value.itemname),1),t("p",js,"Store: "+r(y.value.storename),1),t("p",Ts,"Current Count: "+r(Number(y.value.item_count||0).toFixed(2)),1),t("p",Ns,"ID: "+r(y.value.id||"No ID"),1)])):p("",!0),t("div",Ds,[t("div",null,[e[73]||(e[73]=t("label",{class:"block text-sm font-medium text-gray-700"},"Adjustment Type",-1)),C(t("select",{"onUpdate:modelValue":e[6]||(e[6]=s=>m.value.adjustment_type=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},e[72]||(e[72]=[t("option",{value:"set"},"Set to Value",-1),t("option",{value:"add"},"Add to Current",-1),t("option",{value:"subtract"},"Subtract from Current",-1)]),512),[[ie,m.value.adjustment_type]])]),t("div",null,[t("label",Ms,[m.value.adjustment_type==="set"?(a(),n("span",As,"New Value")):m.value.adjustment_type==="add"?(a(),n("span",Es,"Amount to Add")):(a(),n("span",Fs,"Amount to Subtract"))]),C(t("input",{type:"number",step:"0.01","onUpdate:modelValue":e[7]||(e[7]=s=>m.value.adjustment_value=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Enter value",required:""},null,512),[[D,m.value.adjustment_value]])]),t("div",null,[e[74]||(e[74]=t("label",{class:"block text-sm font-medium text-gray-700"},"Remarks *",-1)),C(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=s=>m.value.remarks=s),rows:"3",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Reason for adjustment (required)",required:""},null,512),[[D,m.value.remarks]])]),m.value.adjustment_type!=="set"&&m.value.adjustment_value&&y.value?(a(),n("div",Rs,[t("p",Is,[m.value.adjustment_type==="add"?(a(),n("span",Us," New value will be: "+r((Number(y.value.item_count||0)+Number(m.value.adjustment_value||0)).toFixed(2)),1)):(a(),n("span",Ls," New value will be: "+r((Number(y.value.item_count||0)-Number(m.value.adjustment_value||0)).toFixed(2)),1))])])):p("",!0)]),t("div",Os,[t("button",{onClick:ce,class:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400",disabled:R.value}," Cancel ",8,Vs),t("button",{onClick:Le,class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-blue-300",disabled:R.value||!m.value.adjustment_value||!m.value.remarks.trim()},[R.value?(a(),n("span",Ps,"Processing...")):(a(),n("span",$s,"Apply Adjustment"))],8,Bs)])])])])):p("",!0),te.value?(a(),n("div",Hs,[t("div",zs,[t("div",qs,[e[78]||(e[78]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"}," Adjustment History ",-1)),y.value?(a(),n("div",Js,[t("p",Ws,r(y.value.itemname),1),t("p",Ks,"Store: "+r(y.value.storename),1)])):p("",!0),se.value?(a(),n("div",Xs,e[76]||(e[76]=[t("div",{class:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-indigo-500"},null,-1),t("span",{class:"ml-3"},"Loading history...",-1)]))):q.value.length===0?(a(),n("div",Gs," No adjustment history found for this item. ")):(a(),n("div",Qs,[t("table",Ys,[e[77]||(e[77]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Date"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Type"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Old Value"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"New Value"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Adjustment"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Remarks"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Adjusted By")])],-1)),t("tbody",Zs,[(a(!0),n(V,null,B(q.value,s=>(a(),n("tr",{key:s.id},[t("td",eo,r(new Date(s.created_at).toLocaleString()),1),t("td",to,[t("span",{class:P(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",{"bg-blue-100 text-blue-800":s.adjustment_type==="set","bg-green-100 text-green-800":s.adjustment_type==="add","bg-red-100 text-red-800":s.adjustment_type==="subtract"}])},r(s.adjustment_type.toUpperCase()),3)]),t("td",so,r(Number(s.old_item_count).toFixed(2)),1),t("td",oo,r(Number(s.new_item_count).toFixed(2)),1),t("td",{class:P(["px-6 py-4 whitespace-nowrap text-sm",{"text-green-600":s.adjustment_type==="add"||s.adjustment_type==="set"&&s.new_item_count>s.old_item_count,"text-red-600":s.adjustment_type==="subtract"||s.adjustment_type==="set"&&s.new_item_count<s.old_item_count}])},[s.adjustment_type==="add"?(a(),n("span",lo,"+")):s.adjustment_type==="subtract"?(a(),n("span",ao,"-")):p("",!0),c(" "+r(Number(s.adjustment_value).toFixed(2)),1)],2),t("td",no,[t("div",{class:"max-w-xs truncate",title:s.remarks},r(s.remarks),9,ro)]),t("td",io,r(s.adjusted_by_name||"Unknown"),1)]))),128))])])])),t("div",{class:"flex justify-end mt-6"},[t("button",{onClick:Oe,class:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400"}," Close ")])])])])):p("",!0),J.value?(a(),n("div",uo,[t("div",co,[t("div",mo,[e[90]||(e[90]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"}," Sync Inventory Variance ",-1)),e[91]||(e[91]=t("div",{class:"mb-4 p-3 bg-blue-50 rounded"},[t("p",{class:"text-sm text-blue-700"}," This will update inventory data by syncing with waste declarations, received orders, and sales data. ")],-1)),t("div",po,[t("div",null,[e[79]||(e[79]=t("label",{class:"block text-sm font-medium text-gray-700"},"Sync Date *",-1)),C(t("input",{type:"date","onUpdate:modelValue":e[9]||(e[9]=s=>b.value.sync_date=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:""},null,512),[[D,b.value.sync_date]])]),w.userRole.toUpperCase()==="ADMIN"||w.userRole.toUpperCase()==="SUPERADMIN"?(a(),n("div",vo,[e[81]||(e[81]=t("label",{class:"block text-sm font-medium text-gray-700"},"Store *",-1)),C(t("select",{"onUpdate:modelValue":e[10]||(e[10]=s=>b.value.store_name=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:""},[e[80]||(e[80]=t("option",{value:""},"Select a store...",-1)),(a(!0),n(V,null,B(K.value,s=>(a(),n("option",{key:s,value:s},r(s),9,go))),128))],512),[[ie,b.value.store_name]])])):p("",!0),f.value?(a(),n("div",yo,[e[88]||(e[88]=t("h4",{class:"text-sm font-medium text-gray-900 mb-2"},"Current Data Status",-1)),oe.value?(a(),n("div",xo,e[82]||(e[82]=[t("div",{class:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-indigo-500"},null,-1),t("span",{class:"ml-2 text-sm"},"Checking status...",-1)]))):(a(),n("div",bo,[t("div",fo,[e[83]||(e[83]=t("span",null,"Inventory Records:",-1)),t("span",{class:P(f.value.status.inventory_records>0?"text-green-600":"text-red-600")},r(f.value.status.inventory_records),3)]),t("div",wo,[e[84]||(e[84]=t("span",null,"Waste Records:",-1)),t("span",ho,r(f.value.status.waste_records),1)]),t("div",_o,[e[85]||(e[85]=t("span",null,"Received Records:",-1)),t("span",ko,r(f.value.status.received_records),1)]),t("div",So,[e[86]||(e[86]=t("span",null,"Sales Records:",-1)),t("span",Co,r(f.value.status.sales_records),1)]),f.value.status.last_sync?(a(),n("div",jo,[t("p",To,[c(" Last sync: "+r(new Date(f.value.status.last_sync.created_at).toLocaleString())+" ",1),e[87]||(e[87]=t("br",null,null,-1)),c(" Affected records: "+r(f.value.status.last_sync.affected_records),1)])])):p("",!0),f.value.status.can_sync?p("",!0):(a(),n("div",No," ⚠️ No inventory records found for this date/store. Cannot perform sync. "))]))])):p("",!0),e[89]||(e[89]=t("div",{class:"p-3 bg-yellow-50 border border-yellow-200 rounded"},[t("div",{class:"flex"},[t("svg",{class:"h-5 w-5 text-yellow-400 mr-2",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),t("div",null,[t("p",{class:"text-yellow-800 text-sm"},[t("strong",null,"Warning:"),c(" This will overwrite existing waste, received, and sales data with values from the source tables. Make sure the source data is accurate before proceeding. ")])])])],-1))]),t("div",Do,[t("button",{onClick:pe,class:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400",disabled:I.value}," Cancel ",8,Mo),t("button",{onClick:Ve,class:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:bg-indigo-300",disabled:I.value||!b.value.sync_date||f.value&&!f.value.status.can_sync},[I.value?(a(),n("span",Eo,"Syncing...")):(a(),n("span",Fo,"Start Sync"))],8,Ao)])])])])):p("",!0),le.value?(a(),n("div",Ro,[t("div",Io,[t("div",Uo,[e[103]||(e[103]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"}," Import Count Data ",-1)),e[104]||(e[104]=t("div",{class:"mb-4 p-3 bg-green-50 rounded"},[t("p",{class:"text-sm text-green-700"}," Import count data from Excel/CSV file. This is an alternative way to input count data when stores haven't inputted counts for the day. ")],-1)),t("div",Lo,[t("div",null,[e[92]||(e[92]=t("label",{class:"block text-sm font-medium text-gray-700"},"Import Date *",-1)),C(t("input",{type:"date","onUpdate:modelValue":e[11]||(e[11]=s=>u.value.import_date=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500",required:""},null,512),[[D,u.value.import_date]])]),w.userRole.toUpperCase()==="ADMIN"||w.userRole.toUpperCase()==="SUPERADMIN"?(a(),n("div",Oo,[e[94]||(e[94]=t("label",{class:"block text-sm font-medium text-gray-700"},"Store *",-1)),C(t("select",{"onUpdate:modelValue":e[12]||(e[12]=s=>u.value.store_name=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500",required:""},[e[93]||(e[93]=t("option",{value:""},"Select a store...",-1)),(a(!0),n(V,null,B(K.value,s=>(a(),n("option",{key:s,value:s},r(s),9,Vo))),128))],512),[[ie,u.value.store_name]])])):p("",!0),t("div",Bo,[e[96]||(e[96]=t("h4",{class:"text-sm font-medium text-blue-900 mb-2"},"Step 1: Download Template",-1)),e[97]||(e[97]=t("p",{class:"text-xs text-blue-700 mb-3"}," Download the Excel template with current inventory items for the selected date and store. ",-1)),t("button",{onClick:Be,disabled:W.value||!u.value.import_date||u.value.store_name===""&&(w.userRole.toUpperCase()==="ADMIN"||w.userRole.toUpperCase()==="SUPERADMIN"),class:"w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md disabled:bg-blue-300 flex items-center justify-center gap-2"},[e[95]||(e[95]=t("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),W.value?(a(),n("span",$o,"Downloading...")):(a(),n("span",Ho,"Download Template"))],8,Po)]),t("div",zo,[e[100]||(e[100]=t("h4",{class:"text-sm font-medium text-yellow-900 mb-2"},"Step 2: Upload Completed File",-1)),e[101]||(e[101]=t("p",{class:"text-xs text-yellow-700 mb-3"}," Fill in the count data in the template and upload the completed file. ",-1)),t("div",null,[e[98]||(e[98]=t("label",{class:"block text-sm font-medium text-gray-700"},"Select File *",-1)),t("input",{type:"file",onChange:Pe,accept:".xlsx,.xls,.csv",class:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-green-50 file:text-green-700 hover:file:bg-green-100",required:""},null,32),e[99]||(e[99]=t("p",{class:"mt-1 text-xs text-gray-500"}," Accepted formats: .xlsx, .xls, .csv ",-1))]),u.value.import_file?(a(),n("div",qo," ✓ Selected: "+r(u.value.import_file.name),1)):p("",!0)]),e[102]||(e[102]=t("div",{class:"p-3 bg-red-50 border border-red-200 rounded"},[t("div",{class:"flex"},[t("svg",{class:"h-5 w-5 text-red-400 mr-2",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),t("div",null,[t("p",{class:"text-red-800 text-sm"},[t("strong",null,"Warning:"),c(" This will update existing count data for the selected date and store. Make sure your data is accurate before importing. ")])])])],-1))]),t("div",Jo,[t("button",{onClick:ye,class:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400",disabled:U.value}," Cancel ",8,Wo),t("button",{onClick:$e,class:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-green-300",disabled:U.value||!u.value.import_date||!u.value.import_file||u.value.store_name===""&&(w.userRole.toUpperCase()==="ADMIN"||w.userRole.toUpperCase()==="SUPERADMIN")},[U.value?(a(),n("span",Xo,"Importing...")):(a(),n("span",Go,"Import Data"))],8,Ko)])])])])):p("",!0)]),_:1}))}};export{vl as default};
