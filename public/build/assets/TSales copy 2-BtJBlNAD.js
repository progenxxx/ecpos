import{d as b,s as _,k as I,c as k,w as x,C as P,o as h,a as l,e as F,b as C,f as q,j as S,v as T,u as U}from"./app-C8JQCepG.js";import{_ as B}from"./AdminPanel-C83M-2eE.js";import{_ as G}from"./Main-BsYVFM_n.js";import{_ as L}from"./MultiSelectDropdown-6wzDlGwr.js";import{T as V}from"./TableContainer-BxS68fI9.js";import"./buttons.print-CySYwi-9.js";import{P as D,D as E}from"./dataTables-BLyeFFVl.js";import{S as f}from"./sweetalert2.esm.all-IRYXxR_Z.js";import{E as $}from"./exceljs.min-7N9mhf2L.js";import"./RetailGroup-DlwVVYvp.js";import"./Logout-aL1qiQHO.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                             */import"./Modal-BiiQ0EAt.js";import"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-KuC_yowt.js";import"./RetailItems-BPv8Qi4G.js";import"./Attendance-C9B-DZaj.js";import"./PartyCake143-_oRfmhRI.js";const j={class:"mb-4 flex flex-wrap gap-4 p-4 bg-white rounded-lg shadow z-[999]"},H={key:0,class:"flex-1 min-w-[200px]"},z={class:"flex-1 min-w-[200px]"},Y={class:"flex-1 min-w-[200px]"},K={class:"flex items-end"},Q=["disabled"],W={key:0},J={key:1},X={key:1},yt={__name:"TSales copy 2",props:{ec:{type:Array,required:!0},auth:{type:Object,required:!0},stores:{type:Array,required:!0},userRole:{type:String,required:!0},filters:{type:Object,required:!0,default:()=>({startDate:"",endDate:"",selectedStores:[]})}},setup(g){D.use(E);const u=b([]),m=b(""),p=b(""),y=b(!1),n=g,N=_(()=>n.userRole.toUpperCase()==="STORE"?G:B);I(()=>{u.value=n.filters.selectedStores||[],m.value=n.filters.startDate||"",p.value=n.filters.endDate||""});const v=_(()=>{let t=[...n.ec];return u.value.length>0&&(t=t.filter(e=>u.value.includes(e.storename))),m.value&&p.value&&(t=t.filter(e=>{const r=new Date(e.createddate),d=new Date(m.value),a=new Date(p.value);return r>=d&&r<=a})),t}),o=_(()=>v.value.reduce((t,e)=>(t.total_discamount+=parseFloat(e.total_discamount)||0,t.total_costprice+=parseFloat(e.total_costprice)||0,t.total_netamount+=parseFloat(e.total_netamount)||0,t.vatablesales+=parseFloat(e.vatablesales)||0,t.vat+=parseFloat(e.vat)||0,t.total_grossamount+=parseFloat(e.total_grossamount)||0,t.total_costamount+=parseFloat(e.total_costamount)||0,t.total_qty+=Math.round(e.qty||0),t.cash+=parseFloat(e.cash)||0,t.charge+=parseFloat(e.charge)||0,t.representation+=parseFloat(e.representation)||0,t.gcash+=parseFloat(e.gcash)||0,t.foodpanda+=parseFloat(e.foodpanda)||0,t.grabfood+=parseFloat(e.grabfood)||0,t.mrktgdisc+=parseFloat(e.mrktgdisc)||0,t.rddisc+=parseFloat(e.rddisc)||0,t.commision+=parseFloat(e.commision)||0,t),{total_qty:0,total_discamount:0,total_costprice:0,total_netamount:0,vatablesales:0,vat:0,total_grossamount:0,total_costamount:0,cash:0,charge:0,representation:0,gcash:0,foodpanda:0,grabfood:0,mrktgdisc:0,rddisc:0,commision:0})),R=[{data:"storename",title:"Store",footer:"Grand Total"},{data:"staff",title:"Staff"},{data:"createddate",title:"Date"},{data:"timeonly",title:"Time"},{data:"transactionid",title:"Transaction ID"},{data:"receiptid",title:"Receipt ID"},{data:"paymentmethod",title:"Payment Method"},{data:"custaccount",title:"Customer"},{data:"itemname",title:"Item Name"},{data:"itemgroup",title:"Item Group"},{data:"qty",title:"Qty",render:t=>Math.round(t),footer:()=>Math.round(o.value.total_qty)},{data:"total_costprice",title:"Cost Price",render:t=>(parseFloat(t)||0).toFixed(2),footer:()=>o.value.total_costprice.toFixed(2)},{data:"total_grossamount",title:"Gross Amount",render:t=>(parseFloat(t)||0).toFixed(2),footer:()=>o.value.total_grossamount.toFixed(2)},{data:"total_costamount",title:"Cost Amount",render:t=>(parseFloat(t)||0).toFixed(2),footer:()=>o.value.total_costamount.toFixed(2)},{data:"total_discamount",title:"Discount Amount",render:t=>(parseFloat(t)||0).toFixed(2),footer:()=>o.value.total_discamount.toFixed(2)},{data:"total_netamount",title:"Net Amount",render:t=>(parseFloat(t)||0).toFixed(2),footer:()=>o.value.total_netamount.toFixed(2)},{data:"vatablesales",title:"Vatable Sales",render:t=>(parseFloat(t)||0).toFixed(2),footer:()=>o.value.vatablesales.toFixed(2)},{data:"vat",title:"VAT",render:t=>(parseFloat(t)||0).toFixed(2),footer:()=>o.value.vat.toFixed(2)},{data:"cash",title:"Cash",render:t=>(parseFloat(t)||0).toFixed(2),footer:()=>o.value.cash.toFixed(2)},{data:"charge",title:"Charge",render:t=>(parseFloat(t)||0).toFixed(2),footer:()=>o.value.charge.toFixed(2)},{data:"representation",title:"Representation",render:t=>(parseFloat(t)||0).toFixed(2),footer:()=>o.value.representation.toFixed(2)},{data:"gcash",title:"GCash",render:t=>(parseFloat(t)||0).toFixed(2),footer:()=>o.value.gcash.toFixed(2)},{data:"foodpanda",title:"FoodPanda",render:t=>(parseFloat(t)||0).toFixed(2),footer:()=>o.value.foodpanda.toFixed(2)},{data:"grabfood",title:"GrabFood",render:t=>(parseFloat(t)||0).toFixed(2),footer:()=>o.value.grabfood.toFixed(2)},{data:"mrktgdisc",title:"Mktg Disc",render:t=>(parseFloat(t)||0).toFixed(2),footer:()=>o.value.mrktgdisc.toFixed(2)},{data:"rddisc",title:"RD Disc",render:t=>(parseFloat(t)||0).toFixed(2),footer:()=>o.value.rddisc.toFixed(2)},{data:"commision",title:"Commission",render:t=>(parseFloat(t)||0).toFixed(2),footer:()=>o.value.commision.toFixed(2)}],A={responsive:!0,order:[[0,"asc"]],pageLength:25,dom:"Bfrtip",scrollX:!0,scrollY:"50vh",buttons:["copy",{text:"Export Excel",action:function(t,e,r,d){w()}},"pdf","print"],drawCallback:function(t){const r=new E.Api(t).table().footer().querySelectorAll("td, th");["total_qty","total_costprice","total_grossamount","total_costamount","total_discamount","total_netamount","vatablesales","vat","cash","charge","representation","gcash","foodpanda","grabfood","mrktgdisc","rddisc","commision"].forEach((a,c)=>{const i=o.value[a],s=r[c+10];s&&typeof i=="number"&&(s.textContent=a.includes("qty")?Math.round(i):i.toFixed(2))})}},w=()=>{const t=new $.Workbook,e=t.addWorksheet("Sales Data");e.columns=[{header:"STORE",key:"storename",width:20},{header:"STAFF",key:"staff",width:15},{header:"DATE",key:"createddate",width:12},{header:"TIME",key:"timeonly",width:10},{header:"TRANSACTION ID",key:"transactionid",width:15},{header:"RECEIPT ID",key:"receiptid",width:15},{header:"PAYMENT METHOD",key:"paymentmethod",width:15},{header:"CUSTOMER",key:"custaccount",width:20},{header:"ITEM NAME",key:"itemname",width:25},{header:"ITEM GROUP",key:"itemgroup",width:15},{header:"QTY",key:"qty",width:10},{header:"COST PRICE",key:"total_costprice",width:12},{header:"GROSS AMOUNT",key:"total_grossamount",width:15},{header:"COST AMOUNT",key:"total_costamount",width:15},{header:"DISCOUNT",key:"total_discamount",width:12},{header:"NET AMOUNT",key:"total_netamount",width:15},{header:"VATABLE SALES",key:"vatablesales",width:15},{header:"VAT",key:"vat",width:12},{header:"CASH",key:"cash",width:12},{header:"CHARGE",key:"charge",width:12},{header:"REPRESENTATION",key:"representation",width:15},{header:"GCASH",key:"gcash",width:12},{header:"FOODPANDA",key:"foodpanda",width:12},{header:"GRABFOOD",key:"grabfood",width:12},{header:"MKTG DISC",key:"mrktgdisc",width:12},{header:"RD DISC",key:"rddisc",width:12},{header:"COMMISSION",key:"commision",width:12}],e.getRow(1).font={bold:!0},e.getRow(1).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF333F4F"}},e.getRow(1).font={color:{argb:"FFFFFFFF"},bold:!0},v.value.forEach(a=>{e.addRow({storename:a.storename||"",staff:a.staff||"",createddate:a.createddate?new Date(a.createddate).toLocaleDateString():"",timeonly:a.timeonly||"",transactionid:a.transactionid||"",receiptid:a.receiptid||"",paymentmethod:a.paymentmethod||"",custaccount:a.custaccount||"",itemname:a.itemname||"",itemgroup:a.itemgroup||"",qty:Math.round(a.qty)||0,total_costprice:Number(a.total_costprice)||0,total_grossamount:Number(a.total_grossamount)||0,total_costamount:Number(a.total_costamount)||0,total_discamount:Number(a.total_discamount)||0,total_netamount:Number(a.total_netamount)||0,vatablesales:Number(a.vatablesales)||0,vat:Number(a.vat)||0,cash:Number(a.cash)||0,charge:Number(a.charge)||0,representation:Number(a.representation)||0,gcash:Number(a.gcash)||0,foodpanda:Number(a.foodpanda)||0,grabfood:Number(a.grabfood)||0,mrktgdisc:Number(a.mrktgdisc)||0,rddisc:Number(a.rddisc)||0,commision:Number(a.commision)||0})});const r=e.addRow({storename:"GRAND TOTAL",staff:"",createddate:"",timeonly:"",transactionid:"",receiptid:"",paymentmethod:"",custaccount:"",itemname:"",itemgroup:"",qty:Math.round(o.value.total_qty),total_costprice:o.value.total_costprice,total_grossamount:o.value.total_grossamount,total_costamount:o.value.total_costamount,total_discamount:o.value.total_discamount,total_netamount:o.value.total_netamount,vatablesales:o.value.vatablesales,vat:o.value.vat,cash:o.value.cash,charge:o.value.charge,representation:o.value.representation,gcash:o.value.gcash,foodpanda:o.value.foodpanda,grabfood:o.value.grabfood,mrktgdisc:o.value.mrktgdisc,rddisc:o.value.rddisc,commision:o.value.commision});r.font={bold:!0},r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE9ECEF"}};const d=Array.from({length:22},(a,c)=>String.fromCharCode(75+c));e.eachRow((a,c)=>{c>1&&d.forEach(i=>{const s=a.getCell(i);s.numFmt="#,##0.00"})}),e.autoFilter={from:{row:1,column:1},to:{row:1,column:e.columns.length}},t.xlsx.writeBuffer().then(a=>{const c=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),i=URL.createObjectURL(c),s=document.createElement("a");s.href=i,s.download=`Sales_Report_${new Date().toISOString().split("T")[0]}.xlsx`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(i)}).catch(a=>{console.error("Error exporting to Excel:",a),alert("Error exporting to Excel. Please try again.")})},O=t=>t.map(e=>{const r={...e,cash:0,charge:0,representation:0,gcash:0,foodpanda:0,grabfood:0},d=e.paymentmethod?e.paymentmethod.toLowerCase():"",a=parseFloat(e.total_grossamount)||0;switch(d){case"cash":r.cash=a;break;case"charge":r.charge=a;break;case"representation":r.representation=a;break;case"gcash":r.gcash=a;break;case"foodpanda":r.foodpanda=a;break;case"grabfood":r.grabfood=a;break;default:console.warn(`Unhandled payment method: ${d}`)}return r}),M=async()=>{y.value=!0;try{const t=f.fire({title:"Syncing Payment Methods",text:"Please wait while we synchronize the payment methods...",allowOutsideClick:!1,didOpen:()=>{f.showLoading()}});n.ec.splice(0,n.ec.length,...O(n.ec)),await new Promise(e=>setTimeout(e,500)),f.close(),f.fire({icon:"success",title:"Sync Successful!",text:"Payment methods have been synchronized and exported to Excel.",timer:3e3,timerProgressBar:!0,showConfirmButton:!1})}catch(t){f.close(),f.fire({icon:"error",title:"Sync Failed",text:`An error occurred while syncing: ${t.message}`,confirmButtonText:"OK"}),console.error("Error syncing payment methods:",t)}finally{y.value=!1}};return(t,e)=>(h(),k(P(N.value),{"active-tab":"REPORTS"},{main:x(()=>[l("div",j,[g.userRole.toUpperCase()==="ADMIN"||g.userRole.toUpperCase()==="SUPERADMIN"?(h(),F("div",H,[C(L,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=r=>u.value=r),options:g.stores,label:"Stores"},null,8,["modelValue","options"])])):q("",!0),l("div",z,[e[4]||(e[4]=l("label",{class:"block text-sm font-medium text-gray-700"},"Start Date",-1)),S(l("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=r=>m.value=r),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[T,m.value]])]),l("div",Y,[e[5]||(e[5]=l("label",{class:"block text-sm font-medium text-gray-700"},"End Date",-1)),S(l("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=r=>p.value=r),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[T,p.value]])]),l("div",K,[l("button",{onClick:e[3]||(e[3]=()=>{u.value=[],m.value="",p.value=""}),class:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-md"}," Clear Filters ")]),l("button",{onClick:M,disabled:y.value,class:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md flex items-center"},[y.value?(h(),F("span",J,"Syncing...")):(h(),F("span",W,"Sync"))],8,Q)]),C(V,{class:"overflow-auto"},{default:x(()=>[v.value.length>0?(h(),k(U(D),{key:0,data:v.value,columns:R,class:"w-full relative display",options:A},{action:x(r=>e[6]||(e[6]=[])),_:1},8,["data"])):(h(),F("p",X,"No data available for the selected filters."))]),_:1})]),_:1}))}};export{yt as default};
