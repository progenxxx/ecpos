import{d as C,T as P,H as W,s as i,D as G,e as S,t as L,f as J,b as l,w as u,F as K,o as x,a as n,g as b,n as X,u as Q}from"./app-C8JQCepG.js";import{_ as Z}from"./CopyFrom-BuUz9hKa.js";import{_ as tt}from"./AdminPanel-C83M-2eE.js";import{T as et}from"./TableContainer-BxS68fI9.js";import{P as R,D as ot}from"./dataTables-BLyeFFVl.js";import{_ as at}from"./SuccessButton-qfxsNTmK.js";import{_ as O}from"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-KuC_yowt.js";import{_ as nt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{E as rt}from"./Excel-D_H_MM39.js";import"./dataTables.fixedColumns-BdH3ZcDY.js";import{E as st}from"./exceljs.min-7N9mhf2L.js";import"./Modal-BiiQ0EAt.js";import"./InputError-BPTEHXXD.js";import"./RetailGroup-DlwVVYvp.js";import"./Logout-aL1qiQHO.js";/* empty css                                                             */import"./RetailItems-BPv8Qi4G.js";import"./Attendance-C9B-DZaj.js";const lt={key:0,class:"fixed top-5 right-5 bg-green-900 text-white border border-gray-300 rounded-lg shadow-lg p-4 z-50"},ut={class:"absolute adjust"},ct={class:"flex justify-start items-center"},dt={class:"ml-2"},it={class:"custom-datatable"},ft={__name:"MGCount copy 4",props:{orders:{type:Array,required:!0},routes:{type:String,required:!0}},setup(D,{emit:pt}){R.use(ot);const F=C(!1),$=D;P({StartDate:"",EndDate:""});const k={paging:!1,scrollX:!0,scrollY:"60vh",scrollCollapse:!0,error:function(t,e,o){console.error("DataTables error:",e)},footerCallback:function(t,e,o,a,s){const h=this.api().table().footer().querySelectorAll("th");c.value.forEach((p,m)=>{p.footer&&(h[m].textContent=p.footer())})}},M=W($.orders.reduce((t,e)=>{const{STORENAME:o,ITEMID:a,ITEMNAME:s,CATEGORY:d,COUNTED:h,MGCOUNT:p}=e,m=parseInt(h)||0,v=parseInt(p)||0;return t[a]||(t[a]={ITEMID:a,ITEMNAME:s,CATEGORY:d,TOTAL:0,MGCount:v,BalanceCount:0}),t[a][o]||(t[a][o]=0),t[a][o]+=m,t[a].TOTAL+=m,t[a].BalanceCount=t[a].MGCount-t[a].TOTAL,t},{})),N=i(()=>Object.values(M)),g=i(()=>{const t=new Set;return N.value.forEach(e=>{Object.keys(e).forEach(o=>{o!=="ITEMID"&&o!=="ITEMNAME"&&o!=="CATEGORY"&&o!=="TOTAL"&&o!=="MGCount"&&o!=="BalanceCount"&&t.add(o)})}),t}),w=i(()=>{const t={ITEMID:"Grand Total",ITEMNAME:"",CATEGORY:"",MGCount:0,BalanceCount:0,TOTAL:0};return g.value.forEach(e=>{t[e]=0}),A.value.forEach(e=>{t.MGCount+=Number(e.MGCount)||0,t.BalanceCount+=Number(e.BalanceCount)||0,t.TOTAL+=Number(e.TOTAL)||0,g.value.forEach(o=>{t[o]+=Number(e[o])||0})}),t}),c=i(()=>[{title:"ITEMID",data:"ITEMID",className:"frozen-column",footer:()=>w.value.ITEMID},{title:"ITEMS",data:"ITEMNAME",className:"frozen-column",footer:()=>""},{title:"CATEGORY",data:"CATEGORY",className:"frozen-column",footer:()=>""},{title:"ACTUAL INV COUNT",data:"MGCount",className:"frozen-column",footer:()=>""},{title:"REMAINING STOCKS",data:"BalanceCount",className:"frozen-column",footer:()=>w.value.BalanceCount},{title:"TOTAL ALLOCATION",data:"TOTAL",className:"frozen-column",footer:()=>w.value.TOTAL},...Array.from(g.value).map(t=>({title:t,data:t,render:(e,o,a)=>o==="display"?`<input type="number" value="${e}" onchange="window.updateCounted('${a.ITEMID}', '${t}', this.value)" />`:e,footer:()=>w.value[t]}))]),B=C(!1),U=C("");window.updateMGCount=function(t,e){const o=M[t];o&&(o.MGCount=parseInt(e,10)||0,o.BalanceCount=o.MGCount-o.TOTAL,G.post("/api/update-mgcount",{itemId:t,mgCount:o.MGCount}).then(a=>{console.log("MGCount update response:",a.data),a.data.success?console.log("MGCount updated successfully"):console.error("Failed to update MGCount:",a.data.message)}).catch(a=>{console.error("Error updating MGCount:",a.response?a.response.data:a)}))},window.updateCounted=function(t,e,o){const a=M[t];a&&(a[e]=parseInt(o,10)||0,a.TOTAL=Array.from(g.value).reduce((s,d)=>s+(a[d]||0),0),a.BalanceCount=a.TOTAL-a.MGCount,G.post("/api/update-counted",{itemId:t,storeName:e,counted:a[e],total:a.TOTAL,balanceCount:a.BalanceCount}).then(s=>{console.log("Counted updated successfully")}).catch(s=>{console.error("Error updating Counted:",s)}))};const A=i(()=>N.value.map(t=>{const e={...t};return c.value.forEach(o=>{e.hasOwnProperty(o.data)||(e[o.data]="0")}),e})),I=C(null);i(()=>{if(I.value){const t=new Date(I.value),e=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${e}-${o}-${a}`}return""});const _=C(null);i(()=>{if(_.value){const t=new Date(_.value),e=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${e}-${o}-${a}`}return""}),i(()=>{const t=new Date,e=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${e}${o}${a}`});async function Y(){try{const t=new st.Workbook,e=t.addWorksheet("Flattened Orders");e.columns=c.value.map(r=>({header:r.title,key:r.data,width:15})),e.addRow(c.value.map(r=>r.title));const o=A.value.filter(r=>Array.from(g.value).map(f=>r[f]||0).some(f=>f>0));o.forEach(r=>{const T=c.value.map(f=>{const E=r[f.data];return E??0});e.addRow(T)});const a=c.value.reduce((r,T)=>(T.footer&&(r[T.data]=o.reduce((f,E)=>f+(Number(E[T.data])||0),0)),r),{}),s=e.addRow(c.value.map(r=>r.footer?a[r.data]||0:""));s.font={bold:!0},s.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF7C0000"}},s.font={color:{argb:"FFDDDDDD"}},e.getRow(1).font={bold:!0},e.getRow(1).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}};const d=new Date,h=`FlattenedOrders_${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}.xlsx`,p=await t.xlsx.writeBuffer(),m=new Blob([p],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),v=document.createElement("a");v.href=URL.createObjectURL(m),v.download=h,v.click()}catch(t){console.error("Error exporting to Excel:",t)}}const z=()=>{window.location.href="/picklist"},H=()=>{window.location.href="/cakepicklist"},j=()=>{window.location.href="/special-orders"},y=C(!1),V=()=>{y.value=!0,console.log(JOURNALID.value)},q=()=>{y.value=!1};return(t,e)=>(x(),S(K,null,[B.value?(x(),S("div",lt,L(U.value),1)):J("",!0),l(tt,{"active-tab":"FGCOUNT"},{modals:u(()=>[l(Z,{"show-modal":y.value,onToggleActive:q},null,8,["show-modal"])]),main:u(()=>[l(et,null,{default:u(()=>[n("div",ut,[n("div",ct,[l(at,{type:"button",onClick:Y,class:"ml-6 bg-green"},{default:u(()=>[l(rt,{class:"h-4"})]),_:1}),l(O,{type:"button",onClick:z,class:"m-1 bg-navy"},{default:u(()=>e[0]||(e[0]=[b(" NEWCOM ")])),_:1}),l(O,{type:"button",onClick:H,class:"m-1 bg-navy"},{default:u(()=>e[1]||(e[1]=[b(" OLDCOM ")])),_:1}),l(O,{type:"button",onClick:j,class:"ml-2 bg-navy"},{default:u(()=>e[2]||(e[2]=[b(" SPECIAL ORDER ")])),_:1}),l(O,{type:"button",onClick:V,class:"m-2 sm:m-6 bg-red-900"},{default:u(()=>e[3]||(e[3]=[b(" ADD DETAILS ")])),_:1}),e[4]||(e[4]=n("details",{className:"dropdown"},[n("summary",{className:"btn m-1"},"Select Route"),n("ul",{className:"menu dropdown-content bg-base-100 rounded-box z-[1] w-52 p-2 shadow"},[n("li",null,[n("a",{href:"/mgcount"},"ALL")]),n("li",null,[n("a",{href:"/south1"},"SOUTH 1")]),n("li",null,[n("a",{href:"/south2"},"SOUTH 2")]),n("li",null,[n("a",{href:"/south3"},"SOUTH 3")]),n("li",null,[n("a",{href:"/north1"},"NORTH 1")]),n("li",null,[n("a",{href:"/north2"},"NORTH 2")]),n("li",null,[n("a",{href:"/central"},"CENTRAL")]),n("li",null,[n("a",{href:"/east"},"EAST")])])],-1)),n("h6",dt,L(D.routes),1)])]),n("div",it,[n("div",{class:X({"blur-overlay":F.value})},[l(Q(R),{data:A.value,columns:c.value,class:"w-full relative display",options:k},{action:u(o=>e[5]||(e[5]=[n("div",{class:"flex justify-start"},null,-1)])),_:1},8,["data","columns"])],2)])]),_:1})]),_:1})],64))}},St=nt(ft,[["__scopeId","data-v-ea057916"]]);export{St as default};
