import{T as H,G as z,q as i,d as g,C as E,p as P,e as O,t as q,f as J,b as s,w as d,F as W,o as _,a as r,i as K,j as A,v as $,u as l,n as X,g as G}from"./app-DJ_ZTFbI.js";import{_ as Q}from"./AdminPanel-DorjMUAR.js";import{T as Z}from"./TableContainer-CTCvRGFw.js";import{P as B,D as ee}from"./dataTables-Dqt6QQHC.js";import{_ as te}from"./SuccessButton-DLHBV4uy.js";import{_ as ae}from"./TransparentButton-G7EMCu8y.js";import{_ as x}from"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-B7C873nC.js";import{E as oe}from"./Excel-DuiaXTmk.js";import{S as re}from"./Save-BpuKOSbe.js";import{S as se}from"./SearchColored-F1cgUrq2.js";import"./dataTables.fixedColumns-KzaORiK6.js";import{E as ne}from"./exceljs.min-DuakHjXl.js";import"./RetailGroup-ReiPV-Rs.js";import"./Logout-CqZ_wKbj.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                             */import"./Modal-CKYSH-Ul.js";import"./RetailItems-BqM3fhIp.js";const le={key:0,class:"fixed top-5 right-5 bg-navy text-white border border-gray-300 rounded-lg shadow-lg p-4 z-50"},ue={class:"absolute adjust"},de={class:"flex justify-start items-center"},ie=["value"],ce={"date-rangepicker":"",class:"flex items-center"},pe={class:"relative ml-5"},me=["placeholder"],fe={class:"relative"},ge=["placeholder"],Be={__name:"MGCount-backup",props:{orders:{type:Array,required:!0}},setup(L,{emit:ve}){B.use(ee);const V=L,n=H({StartDate:"",EndDate:""}),M=()=>{n.get(route("orderingconso.getrange"),{preserveScroll:!0})},N={paging:!1,scrollX:!0,scrollY:"60vh",scrollCollapse:!0,error:function(t,e,o){console.error("DataTables error:",e)}},v=z(V.orders.reduce((t,e)=>{const{STORENAME:o,ITEMID:a,ITEMNAME:u,CATEGORY:m,COUNTED:f,MGCOUNT:c}=e,I=parseInt(f)||0,j=parseInt(c)||0;return t[a]||(t[a]={ITEMID:a,ITEMNAME:u,CATEGORY:m,TOTAL:0,MGCount:j,BalanceCount:0}),t[a][o]||(t[a][o]=0),t[a][o]+=I,t[a].TOTAL+=I,t[a].BalanceCount=t[a].MGCount-t[a].TOTAL,t},{})),h=i(()=>Object.values(v)),b=i(()=>{const t=new Set;return h.value.forEach(e=>{Object.keys(e).forEach(o=>{o!=="ITEMID"&&o!=="ITEMNAME"&&o!=="CATEGORY"&&o!=="TOTAL"&&o!=="MGCount"&&o!=="BalanceCount"&&t.add(o)})}),t}),y=i(()=>[{title:"ITEMID",data:"ITEMID"},{title:"ITEMS",data:"ITEMNAME"},{title:"CATEGORY",data:"CATEGORY"},{title:"ACTUAL INV COUNT",data:"MGCount",render:(t,e,o)=>e==="display"?`<input type="number" value="${t}" onchange="window.updateMGCount('${o.ITEMID}', this.value)" />`:t},{title:"REMAINING STOCKS",data:"BalanceCount"},{title:"TOTAL DISPATCH",data:"TOTAL"},...Array.from(b.value).map(t=>({title:t,data:t,render:(e,o,a)=>o==="display"?`<input type="number" value="${e}" onchange="window.updateCounted('${a.ITEMID}', '${t}', this.value)" />`:e}))]),p=g(!1),C=g(""),R=()=>{const t=h.value.map(e=>{const o={};return Array.from(b.value).forEach(a=>{o[a]=e[a]||0}),{itemId:e.ITEMID,mgCount:e.MGCount,balanceCount:e.BalanceCount,counted:o}});console.log("Data to save:",JSON.stringify(t,null,2)),E.post(route("save.all.data"),{data:t}).then(e=>{console.log("All data saved successfully:",e.data),C.value="Data saved successfully!",p.value=!0,setTimeout(()=>{p.value=!1},3e3)}).catch(e=>{console.error("Error saving data:",e),e.response&&console.error("Error response:",e.response.data),C.value="Error saving data. Please try again.",p.value=!0,setTimeout(()=>{p.value=!1},3e3)})};window.updateMGCount=function(t,e){const o=v[t];o&&(o.MGCount=parseInt(e,10)||0,o.BalanceCount=o.MGCount-o.TOTAL,E.post("/api/update-mgcount",{itemId:t,mgCount:o.MGCount}).then(a=>{console.log("MGCount updated successfully")}).catch(a=>{console.error("Error updating MGCount:",a)}))},window.updateCounted=function(t,e,o){const a=v[t];a&&(a[e]=parseInt(o,10)||0,a.TOTAL=Array.from(b.value).reduce((u,m)=>u+(a[m]||0),0),a.BalanceCount=a.TOTAL-a.MGCount,E.post("/api/update-counted",{itemId:t,storeName:e,counted:a[e],total:a.TOTAL,balanceCount:a.BalanceCount}).then(u=>{console.log("Counted updated successfully")}).catch(u=>{console.error("Error updating Counted:",u)}))};const D=i(()=>h.value.map(t=>{const e={...t};return y.value.forEach(o=>{e.hasOwnProperty(o.data)||(e[o.data]="0")}),e})),k=g(null),T=i(()=>{if(k.value){const t=new Date(k.value),e=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${e}-${o}-${a}`}return""}),S=g(null),w=i(()=>{if(S.value){const t=new Date(S.value),e=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${e}-${o}-${a}`}return""});i(()=>{const t=new Date,e=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${e}${o}${a}`});async function F(){try{const t=new ne.Workbook,e=t.addWorksheet("Flattened Orders");e.columns=y.value.map(c=>({header:c.title,key:c.data,width:15})),D.value.forEach(c=>{e.addRow(c)});const o=new Date,a=`FlattenedOrders_${o.getFullYear()}-${o.getMonth()+1}-${o.getDate()}.xlsx`,u=await t.xlsx.writeBuffer(),m=new Blob([u],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),f=document.createElement("a");f.href=URL.createObjectURL(m),f.download=a,f.click()}catch(t){console.error("Error exporting to Excel:",t)}}const Y=()=>{window.location.href="/picklist"},U=()=>{window.location.href="/cakepicklist"};return(t,e)=>{const o=P("InputError");return _(),O(W,null,[p.value?(_(),O("div",le,q(C.value),1)):J("",!0),s(Q,{"active-tab":"REPORTS"},{main:d(()=>[s(Z,null,{default:d(()=>[r("div",ue,[r("div",de,[r("form",{onSubmit:K(M,["prevent"]),class:"px-2 py-3 max-h-[50vh] lg:max-h-[70vh] overflow-y-auto"},[r("input",{type:"hidden",name:"_token",value:t.$page.props.csrf_token},null,8,ie),r("div",ce,[r("div",pe,[e[4]||(e[4]=r("div",{class:"flex absolute inset-y-0 left-0 items-center pl-3 pointer-events-none"},[r("svg",{class:"w-5 h-5 text-gray-500 dark:text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[r("path",{"fill-rule":"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z","clip-rule":"evenodd"})])],-1)),A(r("input",{id:"StartDate",type:"date","onUpdate:modelValue":e[0]||(e[0]=a=>l(n).StartDate=a),onInput:e[1]||(e[1]=(...a)=>T.value&&T.value(...a)),placeholder:T.value,class:"bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",required:""},null,40,me),[[$,l(n).StartDate]]),s(o,{message:l(n).errors.StartDate,class:"mt-2"},null,8,["message"])]),e[6]||(e[6]=r("span",{class:"mx-4 text-gray-500"},"to",-1)),r("div",fe,[e[5]||(e[5]=r("div",{class:"flex absolute inset-y-0 left-0 items-center pl-3 pointer-events-none"},[r("svg",{class:"w-5 h-5 text-gray-500 dark:text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[r("path",{"fill-rule":"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z","clip-rule":"evenodd"})])],-1)),A(r("input",{id:"EndDate",type:"date","onUpdate:modelValue":e[2]||(e[2]=a=>l(n).EndDate=a),onInput:e[3]||(e[3]=(...a)=>w.value&&w.value(...a)),placeholder:w.value,class:"bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",required:""},null,40,ge),[[$,l(n).EndDate]]),s(o,{message:l(n).errors.EndDate,class:"mt-2"},null,8,["message"])])])],32),s(ae,{type:"submit",onClick:M,disabled:l(n).processing,class:X({"opacity-25":l(n).processing})},{default:d(()=>[s(se,{class:"h-8"})]),_:1},8,["disabled","class"]),s(te,{type:"button",onClick:F,class:"m-6 bg-green"},{default:d(()=>[s(oe,{class:"h-4"})]),_:1}),s(x,{type:"button",onClick:R,class:"m-6"},{default:d(()=>[s(re,{class:"h-4"})]),_:1}),s(x,{type:"button",onClick:Y,class:"m-1 bg-green"},{default:d(()=>e[7]||(e[7]=[G(" Breads ")])),_:1}),s(x,{type:"button",onClick:U,class:"m-1 bg-green"},{default:d(()=>e[8]||(e[8]=[G(" Cakes ")])),_:1})])]),s(l(B),{data:D.value,columns:y.value,class:"w-full relative display",options:N},{action:d(a=>e[9]||(e[9]=[r("div",{class:"flex justify-start"},null,-1)])),_:1},8,["data","columns"])]),_:1})]),_:1})],64)}}};export{Be as default};
