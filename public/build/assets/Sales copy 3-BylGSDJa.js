import{d as x,s as v,k as O,l as A,G as _,c as B,w,C as L,o as S,a as l,e as q,b as y,f as M,j as F,v as R,u as j,N as I}from"./app-DwAHA_Mt.js";import{_ as G}from"./AdminPanel-1DfNN1pO.js";import{_ as P}from"./Main-CQ_whzxT.js";import{_ as $}from"./MultiSelectDropdown-CNaR8hG8.js";import{T as W}from"./TableContainer-PwYTmfDA.js";import"./buttons.print-CPkyJA-Y.js";import{P as D,D as h}from"./dataTables-7Vvj0GSY.js";import{E as z}from"./exceljs.min-Z3crVyW7.js";import"./RetailGroup-ClNQ_vXI.js";import"./Logout-96D5XcFa.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                             */import"./Modal-DosvBnh2.js";import"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-DsXaYi2t.js";import"./RetailItems-i_spRMW5.js";import"./Attendance-CVSU-1NF.js";import"./PartyCake143-DpGG8J3p.js";const J={class:"mb-4 flex flex-wrap gap-4 p-4 bg-white rounded-lg shadow z-[999]"},X={key:0,class:"flex-1 min-w-[200px]"},Y={class:"flex-1 min-w-[200px]"},H={class:"flex-1 min-w-[200px]"},K={class:"flex items-end"},ge={__name:"Sales copy 3",props:{ec:{type:Array,required:!0},auth:{type:Object,required:!0},stores:{type:Array,required:!0},userRole:{type:String,required:!0},filters:{type:Object,required:!0,default:()=>({startDate:"",endDate:"",selectedStores:[]})}},setup(p){D.use(h);const u=x([]),n=x(""),s=x(""),i=p,k=v(()=>(console.log("userRole value:",i.userRole),console.log("Is Store?:",i.userRole.toUpperCase()==="STORE"),i.userRole.toUpperCase()==="STORE"?P:G));O(()=>{u.value=i.filters.selectedStores||[],n.value=i.filters.startDate||"",s.value=i.filters.endDate||""});const f=v(()=>{let t=[...i.ec];return u.value.length>0&&(t=t.filter(e=>u.value.includes(e.storename))),n.value&&s.value&&(t=t.filter(e=>{const o=new Date(e.createddate),m=new Date(n.value),c=new Date(s.value);return o>=m&&o<=c})),t}),g=v(()=>f.value.reduce((t,e)=>({grossamount:t.grossamount+(parseFloat(e.grossamount)||0),discamount:t.discamount+(parseFloat(e.discamount)||0),netamount:t.netamount+(parseFloat(e.netamount)||0)}),{grossamount:0,discamount:0,netamount:0})),E=[{data:"storename",title:"STORE",footer:"Grand Total"},{data:"grossamount",title:"GROSSAMOUNT",render:function(t){return(parseFloat(t)||0).toFixed(2)},footer:function(){return g.value.grossamount.toFixed(2)}},{data:"discamount",title:"DISCOUNT",render:function(t){return(parseFloat(t)||0).toFixed(2)},footer:function(){return g.value.discamount.toFixed(2)}},{data:"netamount",title:"NETSALES",render:function(t){return(parseFloat(t)||0).toFixed(2)},footer:function(){return g.value.netamount.toFixed(2)}}];v(()=>f.value.reduce((t,e)=>({grossamount:t.grossamount+(parseFloat(e.grossamount)||0),discamount:t.discamount+(parseFloat(e.discamount)||0),netamount:t.netamount+(parseFloat(e.netamount)||0),Vat:t.Vat+(parseFloat(e.Vat)||0),Vatablesales:t.Vatablesales+(parseFloat(e.Vatablesales)||0)}),{grossamount:0,discamount:0,netamount:0,Vat:0,Vatablesales:0}));const T={responsive:!0,order:[[0,"asc"]],pageLength:25,dom:"Bfrtip",scrollX:!0,scrollY:"50vh",buttons:["copy",{text:"Export Excel",action:function(t,e,o,m){C()}},"pdf","print"],order:[[2,"asc"]],drawCallback:function(t){const o=new h.Api(t).table().footer().querySelectorAll("td, th");["grossamount","discamount","netamount","Vat","Vatablesales"].forEach((c,a)=>{const d=g.value[c],r=o[a+1];r&&typeof d=="number"&&(r.textContent=d.toFixed(2))})}},C=()=>{const t=new z.Workbook,e=t.addWorksheet("Sales Data");e.columns=[{header:"STORE",key:"storename",width:15},{header:"GROSSAMOUNT",key:"grossamount",width:15},{header:"DISCOUNT",key:"discamount",width:15},{header:"NETSALES",key:"netamount",width:15}],e.getRow(1).font={bold:!0},e.getRow(1).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE0E0E0"}};const o={grossamount:0,discamount:0,netamount:0};f.value.forEach(a=>{e.addRow({storename:a.storename,grossamount:Number(a.grossamount||0),discamount:Number(a.discamount||0),netamount:Number(a.netamount||0)}),o.grossamount+=Number(a.grossamount||0),o.discamount+=Number(a.discamount||0),o.netamount+=Number(a.netamount||0)}),e.addRow([]);const m=e.addRow({storename:"Total",grossamount:o.grossamount,discamount:o.discamount,netamount:o.netamount});m.font={bold:!0},m.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF0F0F0"}};const c=["grossamount","discamount","netamount"];e.eachRow((a,d)=>{c.forEach(r=>{const V=e.getColumn(r),U=a.getCell(V.number);d>1&&(U.numFmt="#,##0.00")})}),t.xlsx.writeBuffer().then(a=>{const d=new Blob([a],{type:"application/octet-stream"}),r=document.createElement("a");r.href=URL.createObjectURL(d),r.download="sales_data.xlsx",r.click(),URL.revokeObjectURL(r.href)})},N=()=>{if(n.value&&s.value&&new Date(n.value)>new Date(s.value)){alert("Start date cannot be later than end date"),n.value="",s.value="";return}I.get(route("reports.sales"),{startDate:n.value,endDate:s.value,stores:u.value},{preserveState:!0,preserveScroll:!0})};let b;return A([u,n,s],()=>{clearTimeout(b),b=setTimeout(N,500)},{deep:!0}),_(()=>{clearTimeout(b)}),(t,e)=>(S(),B(L(k.value),{"active-tab":"REPORTS"},{main:w(()=>[l("div",J,[p.userRole.toUpperCase()==="ADMIN"||p.userRole.toUpperCase()==="SUPERADMIN"?(S(),q("div",X,[y($,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=o=>u.value=o),options:p.stores,label:"Stores"},null,8,["modelValue","options"])])):M("",!0),l("div",Y,[e[4]||(e[4]=l("label",{class:"block text-sm font-medium text-gray-700"},"Start Date",-1)),F(l("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=o=>n.value=o),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[R,n.value]])]),l("div",H,[e[5]||(e[5]=l("label",{class:"block text-sm font-medium text-gray-700"},"End Date",-1)),F(l("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=o=>s.value=o),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[R,s.value]])]),l("div",K,[l("button",{onClick:e[3]||(e[3]=()=>{u.value=[],n.value="",s.value=""}),class:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-md"}," Clear Filters ")])]),y(W,null,{default:w(()=>[y(j(D),{data:f.value,columns:E,class:"w-full relative display",options:T},{action:w(o=>e[6]||(e[6]=[])),_:1},8,["data"])]),_:1})]),_:1}))}};export{ge as default};
