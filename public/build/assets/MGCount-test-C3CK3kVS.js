import{T as S,H as G,s as m,D as b,d as y,c as B,w as l,o as L,b as s,a as r,i as R,j as E,v as x,u,n as V}from"./app-D4KRJyko.js";import{_ as N}from"./AdminPanel-BwjEDCtJ.js";import{T as j}from"./TableContainer-BHVeCArx.js";import{P as M,D as H}from"./dataTables-BXgh5MYr.js";import"./dataTables.fixedColumns-D9A0BWYI.js";import{_ as U}from"./SuccessButton-B5RCiPM3.js";import{_ as Y}from"./TransparentButton-DxOJ-9dG.js";import{_ as C}from"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-5n6bCmaZ.js";import{P}from"./PartyCake143-Cp4Fa7fu.js";import{E as z}from"./Excel-Cx0Q9t9G.js";import{B as F}from"./Bread-DJxNviqK.js";import{S as q}from"./Save-N51M68zo.js";import{S as J}from"./SearchColored-D1hwIAPK.js";import{E as W}from"./exceljs.min-4JhihTCQ.js";import"./RetailGroup-6t20PwtR.js";import"./Logout-8hw4reCp.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                             */import"./Modal-C1bDdoN8.js";import"./RetailItems-Dce1d_bp.js";import"./Attendance-DvpGN19-.js";const K={class:"absolute adjust"},X={class:"flex justify-start items-center"},Q=["value"],Z={"date-rangepicker":"",class:"flex items-center"},tt={class:"relative ml-5"},et={class:"relative"},xt={__name:"MGCount-test",props:{orders:{type:Array,required:!0}},setup(k,{emit:at}){M.use(H);const _=k,d=S({StartDate:"",EndDate:""}),w=()=>{d.get(route("orderingconso.getrange"),{preserveScroll:!0})},O={paging:!1,scrollX:!0,scrollY:"60vh",scrollCollapse:!0,fixedColumns:{left:6},columnDefs:[{width:"5%",targets:0},{width:"5%",targets:1},{width:"5%",targets:2},{width:"8%",targets:3},{width:"8%",targets:4},{width:"8%",targets:5},{width:"8%",targets:"_all"}],error:function(e,t,a){console.error("DataTables error:",t)},initComplete:function(e,t){$(this).closest(".dataTables_wrapper").addClass("custom-datatable")}},f=G(_.orders.reduce((e,t)=>{const{STORENAME:a,ITEMID:o,ITEMNAME:n,CATEGORY:c,COUNTED:p}=t,i=parseInt(p)||0;return e[o]||(e[o]={ITEMID:o,ITEMNAME:n,CATEGORY:c,TOTAL:0,MGCount:0,BalanceCount:0}),e[o][a]||(e[o][a]=0),e[o][a]+=i,e[o].TOTAL+=i,e[o].BalanceCount=e[o].TOTAL-e[o].MGCount,e},{})),g=m(()=>Object.values(f)),h=m(()=>{const e=new Set;return g.value.forEach(t=>{Object.keys(t).forEach(a=>{a!=="ITEMID"&&a!=="ITEMNAME"&&a!=="CATEGORY"&&a!=="TOTAL"&&a!=="MGCount"&&a!=="BalanceCount"&&e.add(a)})}),Array.from(e)}),v=m(()=>[{title:"ITEMID",data:"ITEMID"},{title:"ITEMS",data:"ITEMNAME"},{title:"CATEGORY",data:"CATEGORY"},{title:"ACTUAL INV COUNT",data:"MGCount",render:(e,t,a)=>t==="display"?`<input type="number" value="${e}" onchange="window.updateMGCount('${a.ITEMID}', this.value)" />`:e},{title:"REMAINING STOCKS",data:"BalanceCount"},{title:"TOTAL DISPATCH",data:"TOTAL"},...h.value.map(e=>({title:e,data:e,render:(t,a,o)=>a==="display"?`<input type="number" value="${t}" onchange="window.updateCounted('${o.ITEMID}', '${e}', this.value)" />`:t}))]);window.updateMGCount=function(e,t){const a=f[e];a&&(a.MGCount=parseInt(t,10)||0,a.BalanceCount=a.MGCount-a.TOTAL,b.post("/api/update-mgcount",{itemId:e,mgCount:a.MGCount}).then(o=>{console.log("MGCount updated successfully")}).catch(o=>{console.error("Error updating MGCount:",o)}))},window.updateCounted=function(e,t,a){const o=f[e];o&&(o[t]=parseInt(a,10)||0,o.TOTAL=h.value.reduce((n,c)=>n+(o[c]||0),0),o.BalanceCount=o.TOTAL-o.MGCount,b.post("/api/update-counted",{itemId:e,storeName:t,counted:o[t],total:o.TOTAL,balanceCount:o.BalanceCount}).then(n=>{console.log("Counted updated successfully")}).catch(n=>{console.error("Error updating Counted:",n)}))};const T=m(()=>g.value.map(e=>{const t={...e};return v.value.forEach(a=>{t.hasOwnProperty(a.data)||(t[a.data]="0")}),t}));y(null),y(null),m(()=>{const e=new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}${a}${o}`});const D=()=>{const e=g.value.map(t=>{const a={};return h.value.forEach(o=>{a[o]=t[o]||0}),{itemId:t.ITEMID,mgCount:t.MGCount,balanceCount:t.BalanceCount,counted:a}});console.log("Data to save:",JSON.stringify(e,null,2)),b.post(route("save.all.data"),{data:e}).then(t=>{console.log("All data saved successfully:",t.data)}).catch(t=>{console.error("Error saving data:",t),t.response&&console.error("Error response:",t.response.data)})};async function I(){try{const e=new W.Workbook,t=e.addWorksheet("Flattened Orders");t.columns=v.value.map(i=>({header:i.title,key:i.data,width:15})),T.value.forEach(i=>{t.addRow(i)});const a=new Date,o=`FlattenedOrders_${a.getFullYear()}-${a.getMonth()+1}-${a.getDate()}.xlsx`,n=await e.xlsx.writeBuffer(),c=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),p=document.createElement("a");p.href=URL.createObjectURL(c),p.download=o,p.click()}catch(e){console.error("Error exporting to Excel:",e)}}const A=()=>{window.location.href="/picklist"};return(e,t)=>(L(),B(N,{"active-tab":"REPORTS"},{main:l(()=>[s(j,null,{default:l(()=>[r("div",K,[r("div",X,[r("form",{onSubmit:R(w,["prevent"]),class:"px-2 py-3 max-h-[50vh] lg:max-h-[70vh] overflow-y-auto"},[r("input",{type:"hidden",name:"_token",value:e.$page.props.csrf_token},null,8,Q),r("div",Z,[r("div",tt,[t[2]||(t[2]=r("div",{class:"flex absolute inset-y-0 left-0 items-center pl-3 pointer-events-none"},[r("svg",{class:"w-5 h-5 text-gray-500 dark:text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[r("path",{"fill-rule":"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z","clip-rule":"evenodd"})])],-1)),E(r("input",{id:"StartDate",type:"date","onUpdate:modelValue":t[0]||(t[0]=a=>u(d).StartDate=a),class:"bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:"Select date start",required:""},null,512),[[x,u(d).StartDate]])]),t[4]||(t[4]=r("span",{class:"mx-4 text-gray-500"},"to",-1)),r("div",et,[t[3]||(t[3]=r("div",{class:"flex absolute inset-y-0 left-0 items-center pl-3 pointer-events-none"},[r("svg",{class:"w-5 h-5 text-gray-500 dark:text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[r("path",{"fill-rule":"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z","clip-rule":"evenodd"})])],-1)),E(r("input",{id:"EndDate",type:"date","onUpdate:modelValue":t[1]||(t[1]=a=>u(d).EndDate=a),class:"bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:"Select date end",required:""},null,512),[[x,u(d).EndDate]])])])],32),s(Y,{type:"submit",onClick:w,disabled:u(d).processing,class:V({"opacity-25":u(d).processing})},{default:l(()=>[s(J,{class:"h-8"})]),_:1},8,["disabled","class"]),s(U,{type:"button",onClick:I,class:"m-6 bg-green"},{default:l(()=>[s(z,{class:"h-4"})]),_:1}),s(C,{type:"button",onClick:D,class:"m-6"},{default:l(()=>[s(q,{class:"h-4"})]),_:1}),s(C,{type:"button",onClick:A,class:"m-1 bg-green"},{default:l(()=>[s(F,{class:"h-4"})]),_:1}),s(C,{type:"button",onClick:e.Cake,class:"m-1 bg-green"},{default:l(()=>[s(P,{class:"h-4"})]),_:1},8,["onClick"])])]),s(u(M),{data:T.value,columns:v.value,class:"w-full relative display",options:O},{action:l(a=>t[5]||(t[5]=[r("div",{class:"flex justify-start"},null,-1)])),_:1},8,["data","columns"])]),_:1})]),_:1}))}};export{xt as default};
