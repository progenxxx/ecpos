import{u as se}from"./vue-router-Bl-Oeb3-.js";import{_ as ne}from"./Create-BPw4trKz.js";import{_ as le}from"./Update-OvDB-2kH.js";import{_ as ie}from"./Post-fNfwcKI_.js";import{T as de,k as Y,l as P,o as E,c as ce,w as s,b as t,i as ue,a as r,u as i,n as me,g as D,d,q as pe,E as fe,p as U,e as M,t as ge,f as V,F as ve}from"./app-DJ_ZTFbI.js";import{M as he}from"./DaisyModal-Dd1F1hRq.js";import{_ as S}from"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-B7C873nC.js";import{_ as q,a as W,b as H}from"./InputError-PkxbjC5q.js";import{F as Te}from"./FormComponent-B6ZSceH5.js";import{_ as we}from"./SuccessButton-DLHBV4uy.js";import{_ as Se}from"./Main-mJnHo3lV.js";import"./FileSaver.min-DH4JG1OZ.js";import"./exceljs.min-DuakHjXl.js";import{S as ye}from"./Send-B1PwrTOy.js";import{A as be}from"./Add-Bu2Kywpu.js";import{T as B}from"./TableContainer-CTCvRGFw.js";import{P as $,D as _e}from"./dataTables-Dqt6QQHC.js";import"./Modal-CKYSH-Ul.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                                   */import"./Logout-CqZ_wKbj.js";/* empty css                                                             */import"./PartyCake143-CS_JfOvx.js";const Ee={class:"col-span-6 sm:col-span-4"},De={class:"col-span-6 sm:col-span-4"},je={__name:"Send",props:{journalid:{type:[String,Number],required:!0},description:{type:[String,Number],required:!0},showModal:{type:Boolean,default:!1}},setup(p,{emit:h}){const f=p,a=de({journalid:"",description:""}),g=()=>{a.patch("/order/patch",{preserveScroll:!0})},y=h,b=()=>{y("toggleActive")};return Y(()=>{a.journalid=f.journalid,a.description=f.description,P(()=>f.journalid,m=>{a.journalid=m}),P(()=>f.description,m=>{a.description=m})}),(m,n)=>(E(),ce(he,{title:"Update Form",onToggleActive:b,"show-modal":p.showModal},{content:s(()=>[t(Te,{onSubmit:ue(g,["prevent"])},{default:s(()=>[r("div",Ee,[t(q,{for:"journalid",value:"journalid"}),t(W,{id:"journalid",modelValue:i(a).journalid,"onUpdate:modelValue":n[0]||(n[0]=T=>i(a).journalid=T),type:"text",class:"mt-1 block w-full bg-blue-50","is-error":!!i(a).errors.journalid,disabled:""},null,8,["modelValue","is-error"]),t(H,{message:i(a).errors.journalid,class:"mt-2"},null,8,["message"])]),r("div",De,[t(q,{for:"description",value:"DESCRIPTION",class:"pt-4"}),t(W,{id:"description",modelValue:i(a).description,"onUpdate:modelValue":n[1]||(n[1]=T=>i(a).description=T),"is-error":!!i(a).errors.description,type:"text",class:"mt-1 block w-full"},null,8,["modelValue","is-error"]),t(H,{message:i(a).errors.description,class:"mt-2"},null,8,["message"])])]),_:1})]),buttons:s(()=>[t(S,{type:"submit",onClick:g,disabled:i(a).processing,class:me({"opacity-25":i(a).processing})},{default:s(()=>n[2]||(n[2]=[D(" UPDATE ")])),_:1},8,["disabled","class"])]),_:1},8,["show-modal"]))}},Ce={key:0,class:"fixed inset-0 flex items-center justify-center z-50"},ke={class:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded shadow-lg"},Me={class:"absolute adjust"},$e={class:"flex justify-start items-center"},Oe={class:"flex justify-start"},Ie={class:"absolute adjust"},Ae={class:"flex justify-start items-center"},Ne={key:0,class:"truck-animation"},rt={__name:"Index",props:{inventjournaltables:{type:Array,required:!0},orders:{type:Array,required:!0}},setup(p){$.use(_e);const h=d(""),f=d("");d(""),d("");const a=d(!1),g=d(!1),y=d(!1),b=d(!1),m=d(!1),n=p,T=[{data:"STOREID",title:"STOREID"},{data:"POSTEDDATETIME",title:"POSTEDDATETIME",render:function(o,e,l){return new Date(o).toLocaleDateString()}},{data:"ITEMID",title:"ITEMID"},{data:"COUNTED",title:"COUNTED"}],J=[{data:"posted",title:"POSTED"},{data:"sent",title:"SENT"},{data:"description",title:"TR #"},{data:"qty",title:"QTY"},{data:"createddatetime",title:"DATE"},{data:null,render:"#action",title:"ACTIONS"}],O={paging:!1,scrollX:!0,scrollY:"60vh",scrollCollapse:!0},z=()=>{g.value=!0},L=()=>{a.value=!1},X=()=>{g.value=!1},K=()=>{y.value=!1},G=()=>{b.value=!1},Q=()=>{m.value=!1};se();const Z=o=>{console.log("Redirecting to Item Order Entries for account:",o),window.location.href=`/ItemOrders/${o}`};pe(()=>{const o=new Date,e=o.getFullYear(),l=String(o.getMonth()+1).padStart(2,"0"),v=String(o.getDate()).padStart(2,"0");return`${e}${l}${v}`});const ee=async o=>{try{await j(),location.reload();const e=document.querySelector('meta[name="csrf-token"]');if(!e)throw new Error("CSRF token not found");const l=await fetch("/post-order",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":e.getAttribute("content")},body:JSON.stringify({journalid:o})});alert("Order has been successfully posted!"),location.reload()}catch(e){console.error("Error:",e),alert("Error posting and sending order: "+e.message)}};async function j(){if(!n.orders||n.orders.length===0){alert("No orders available to generate file.");return}const o=n.orders[0].STOREID;if(!o){alert("Store ID is missing from the order data.");return}const e=new Date(n.orders[0].POSTEDDATETIME);if(isNaN(e.getTime())){alert("Invalid posted date in the order data.");return}const l=`${e.getFullYear()}${(e.getMonth()+1).toString().padStart(2,"0")}${e.getDate().toString().padStart(2,"0")}`,v=`${o}${l}.txt`,w=`${o}|${e.toLocaleDateString()}`,_=n.orders.filter(u=>u.COUNTED>0).map(u=>`${u.ITEMID}|${Math.floor(u.COUNTED)}`);if(_.length===0){alert("No items with non-zero counts to report.");return}const oe=[w,..._].join(`
`),ae=l;try{const F=await(await fetch("/save-file",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({content:oe,filename:v,folderName:ae})})).text();console.log("Full server response:",F);let k;try{k=JSON.parse(F)}catch(re){console.error("Error parsing JSON:",re),alert("Error: Server returned an invalid response. Please clear your cache!");return}k.success?(alert("Your order has been successfully sent to the head office!"),location.reload()):alert("Error saving file: "+(k.message||"Unknown error"))}catch(u){console.error("Error:",u),alert("Error saving file: "+u.message)}}const C=d(!1),I=d("");let c;const A=()=>{console.log("Starting warning sound"),c||(c=new Audio("/audio/warning.ogg"),c.loop=!0),c.play().then(()=>{console.log("Audio started playing")}).catch(o=>{console.error("Error playing audio:",o)})},N=()=>{c&&(c.pause(),c.currentTime=0)},x=()=>{const o=new Date,e=o.getHours(),l=o.getMinutes();console.log(`Checking time: ${e}:${l}`),(e===13&&l===32||e===16&&l===40)&&(console.log("Warning condition met!"),C.value=!0,I.value=o.toLocaleTimeString(),A())},te=()=>{C.value=!1,N()};let R;return Y(()=>{c=new Audio("/audio/warning.ogg"),c.loop=!0,R=setInterval(x,6e4),x()}),fe(()=>{clearInterval(R),N()}),(o,e)=>{const l=U("More"),v=U("ExcelIcon");return E(),M(ve,null,[C.value?(E(),M("div",Ce,[r("div",ke,[e[0]||(e[0]=r("p",{class:"font-bold"},"Warning",-1)),r("p",null,"It's "+ge(I.value)+"!",1),r("button",{onClick:te,class:"mt-2 bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded"}," Close ")])])):V("",!0),t(Se,{"active-tab":"ORDER"},{modals:s(()=>[t(ne,{"show-modal":g.value,onToggleActive:X},null,8,["show-modal"]),t(le,{"show-modal":a.value,journalid:h.value,description:f.value,onToggleActive:L},null,8,["show-modal","journalid","description"]),t(je,{"show-modal":y.value,"item-name":"inventjournaltables",journalid:h.value,onToggleActive:K},null,8,["show-modal","journalid"]),t(ie,{"show-modal":m.value,"item-name":"inventjournaltrans",journalid:h.value,onToggleActive:Q},null,8,["show-modal","journalid"]),t(l,{"show-modal":b.value,accountnum:o.accountnum,onToggleActive:G},null,8,["show-modal","accountnum"])]),main:s(()=>[t(B,null,{default:s(()=>[r("div",Me,[r("div",$e,[t(S,{type:"button",onClick:z,class:"m-6 bg-navy"},{default:s(()=>[t(be,{class:"h-4"})]),_:1}),t(S,{class:"ml-5 cursor-pointer bg-navy hidden",onClick:j},{default:s(()=>[t(ye,{class:"h-4"})]),_:1}),r("button",{onClick:A,hidden:""},"Start Warning Sound")])]),t(i($),{data:p.inventjournaltables,columns:J,class:"w-full relative display",options:O},{action:s(w=>[r("div",Oe,[t(S,{class:"cursor-pointer bg-navy",onClick:_=>Z(w.cellData.journalid)},{default:s(()=>e[1]||(e[1]=[D(" ORDER ")])),_:2},1032,["onClick"]),t(S,{class:"ml-5 cursor-pointer bg-red-900",onClick:_=>ee(w.cellData.journalid)},{default:s(()=>e[2]||(e[2]=[D(" POST & SEND ")])),_:2},1032,["onClick"])])]),_:1},8,["data"])]),_:1}),t(B,{class:"hidden"},{default:s(()=>[r("div",Ie,[r("div",Ae,[e[3]||(e[3]=D("           ")),r("button",{onClick:j},"Generate and Download Text File"),t(we,{type:"button",onClick:o.exportToExcel,class:"m-6 bg-green"},{default:s(()=>[t(v,{class:"h-4"})]),_:1},8,["onClick"])])]),t(i($),{data:p.orders,columns:T,class:"w-full relative display",options:O},{action:s(w=>e[4]||(e[4]=[r("div",{class:"flex justify-start"},null,-1)])),_:1},8,["data"])]),_:1}),o.isTruckVisible?(E(),M("div",Ne,e[5]||(e[5]=[r("img",{src:"path/to/truck-image.png",alt:"Truck",class:"truck"},null,-1)]))):V("",!0)]),_:1})],64)}}};export{rt as default};
