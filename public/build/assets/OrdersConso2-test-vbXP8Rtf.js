import{T as A,s as y,d as S,p as R,c as N,w as v,o as Y,b as E,a,i as j,j as C,v as M,u as f,n as G,t as k}from"./app-PtKpDxL3.js";import{_ as L}from"./AdminPanel-Dy3tTlJm.js";import{T as F}from"./TableContainer-C1Xzxe5W.js";import{P as _,D as V}from"./dataTables-CPDq8Nfz.js";import{_ as B}from"./TransparentButton-3KD1yN4Q.js";import{_ as U}from"./SuccessButton-BvucEcGj.js";import{S as z}from"./SearchColored-CyqFvcJS.js";import{E as H}from"./Excel-BaoeE1u5.js";import{E as W}from"./exceljs.min-B_5GxFvE.js";import"./RetailGroup-C1sh5lal.js";import"./Logout-ho77fkiB.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                             */import"./Modal-B0NwKHOQ.js";import"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-DMiA-fcE.js";import"./RetailItems-ozaKlTSo.js";import"./Attendance-CnJEetSN.js";const q={class:"absolute adjust"},P={class:"flex justify-start items-center"},J=["value"],K={"date-rangepicker":"",class:"flex items-center"},X={class:"relative ml-5"},Q=["placeholder"],Z={class:"relative"},tt=["placeholder"],et={class:"font-bold text:navy font-xs"},rt={props:{orders:{type:Array,required:!0}},computed:{flattenedOrders(){return this.calculateFlattenedOrders(this.orders)}},methods:{async exportToExcel(){try{const d=new W.Workbook,h=d.addWorksheet("Flattened Orders"),n=[{header:"ITEMID",key:"ITEMID",width:20},{header:"ITEMNAME",key:"ITEMNAME",width:25},{header:"CATEGORY",key:"CATEGORY",width:20},{header:"TOTAL",key:"TOTAL",width:15}],o=new Map;this.flattenedOrders.forEach(l=>{Object.keys(l).forEach(u=>{if(u.startsWith("STORE_")){const[T,c,D]=u.split("_");o.set(c,D)}})}),Array.from(o).forEach(([l,u])=>{n.push({header:`${l} - ${u}`,key:`STORE_${l}_${u}`,width:20})}),h.columns=n,this.flattenedOrders.forEach(l=>{const u={ITEMID:l.ITEMID,ITEMNAME:l.ITEMNAME,CATEGORY:l.CATEGORY,TOTAL:l.TOTAL};Array.from(o).forEach(([T,c])=>{u[`STORE_${T}_${c}`]=l[`STORE_${T}_${c}`]||0}),h.addRow(u)});const p=new Date,O=`FlattenedOrders_${p.getFullYear()}-${p.getMonth()+1}-${p.getDate()}.xlsx`,g=await d.xlsx.writeBuffer();this.saveExcelFile(g,O)}catch(d){console.error("Error exporting to Excel:",d)}},saveExcelFile(d,h){const n=new Blob([d],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),o=document.createElement("a");o.href=URL.createObjectURL(n),o.download=h,o.click()},calculateFlattenedOrders(d){const h=d.reduce((n,o)=>{const p=o.STOREID,O=o.STORENAME,g=o.ITEMNAME,l=o.ITEMID,u=o.CATEGORY,T=o.COUNTED&&parseInt(o.COUNTED.trim())||0;n[g]||(n[g]={ITEMID:l,ITEMNAME:g,CATEGORY:u});const c=`STORE_${p}_${O}`;return n[g][c]||(n[g][c]=0),n[g][c]+=T,n},{});return Object.values(h).map(n=>{let o=0;return Object.keys(n).forEach(p=>{p.startsWith("STORE_")&&(o+=n[p])}),{...n,TOTAL:o}})}}},yt=Object.assign(rt,{__name:"OrdersConso2-test",props:{orders:{type:Array,required:!0},startDate:String,endDate:String},setup(d,{emit:h}){_.use(V);const n=d,o=A({StartDate:"",EndDate:""}),p=()=>{o.get(route("orderingconso.getrange"),{preserveScroll:!0})},O={paging:!1,scrollX:!0,scrollY:"60vh",scrollCollapse:!0,ordering:!1,columnDefs:[{targets:"_all",className:"dt-body-center"}],rowCallback:function(r,t,s){t.isCategory&&$(r).addClass("category-row").css("background-color","#4299e1")},error:function(r,t,s){console.error("DataTables error:",t)}},g=y(()=>n.orders.reduce((r,t)=>{const{STORENAME:s,ITEMID:e,ITEMNAME:i,CATEGORY:m,COUNTED:b,STOREID:I}=t,w=parseInt((b??"").trim(),10)||0;return r[e]||(r[e]={ITEMID:e,ITEMNAME:i,CATEGORY:m,TOTAL:0}),r[e][s]||(r[e][s]={count:0,STOREID:I}),r[e][s].count+=w,r[e].TOTAL+=w,r},{})),l=y(()=>{const r=[],t=Object.values(g.value).reduce((s,e)=>(s[e.CATEGORY]||(s[e.CATEGORY]=[]),s[e.CATEGORY].push(e),s),{});return Object.entries(t).forEach(([s,e])=>{r.push({isCategory:!0,ITEMNAME:s}),r.push(...e)}),r}),u=y(()=>{const r=[{title:"ITEMS",data:"ITEMNAME",render:(e,i,m)=>m.isCategory?`<strong class="text-lg bg-blue-500 text-white p-2 block">${e}</strong>`:e},{title:"ITEMID",data:"ITEMID",visible:!1},{title:"TOTAL",data:"TOTAL"}],t=[],s=new Set;return l.value.forEach(e=>{e.isCategory||Object.entries(e).forEach(([i,m])=>{typeof m=="object"&&m!==null&&"count"in m&&"STOREID"in m&&(s.has(i)||(s.add(i),t.push({title:`${m.STOREID}<br>${i}`,data:i,render:(b,I,w)=>w.isCategory?"":(b==null?void 0:b.count)||0})))})}),t.sort((e,i)=>{const m=e.title.split("<br>")[0],b=i.title.split("<br>")[0];return m.localeCompare(b,void 0,{numeric:!0,sensitivity:"base"})}),[...r,...t]});y(()=>{const r=l.value.reduce((t,s)=>(t[s.CATEGORY]||(t[s.CATEGORY]=[]),t[s.CATEGORY].push(s),t),{});return Object.entries(r).sort((t,s)=>t[0].localeCompare(s[0]))});const T=S(null),c=y(()=>{const r=f(T);if(r){const t=new Date(r),s=t.getFullYear(),e=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0");return`${s}-${e}-${i}`}return""}),D=S(null),x=y(()=>{const r=f(D);if(r){const t=new Date(r),s=t.getFullYear(),e=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0");return`${s}-${e}-${i}`}return""});return y(()=>{const r=new Date,t=r.getFullYear(),s=String(r.getMonth()+1).padStart(2,"0"),e=String(r.getDate()).padStart(2,"0");return`${t}${s}${e}`}),(r,t)=>{const s=R("InputError");return Y(),N(L,{"active-tab":"REPORTS"},{main:v(()=>[E(F,null,{default:v(()=>[a("div",q,[a("div",P,[a("form",{onSubmit:j(p,["prevent"]),class:"px-2 py-3 max-h-[50vh] lg:max-h-[70vh] overflow-y-auto"},[a("input",{type:"hidden",name:"_token",value:r.$page.props.csrf_token},null,8,J),a("div",K,[a("div",X,[t[4]||(t[4]=a("div",{class:"flex absolute inset-y-0 left-0 items-center pl-3 pointer-events-none"},[a("svg",{class:"w-5 h-5 text-gray-500 dark:text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[a("path",{"fill-rule":"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z","clip-rule":"evenodd"})])],-1)),C(a("input",{id:"StartDate",type:"date","onUpdate:modelValue":t[0]||(t[0]=e=>f(o).StartDate=e),onInput:t[1]||(t[1]=(...e)=>c.value&&c.value(...e)),placeholder:c.value,class:"bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",required:""},null,40,Q),[[M,f(o).StartDate]]),E(s,{message:f(o).errors.StartDate,class:"mt-2"},null,8,["message"])]),t[6]||(t[6]=a("span",{class:"mx-4 text-gray-500"},"to",-1)),a("div",Z,[t[5]||(t[5]=a("div",{class:"flex absolute inset-y-0 left-0 items-center pl-3 pointer-events-none"},[a("svg",{class:"w-5 h-5 text-gray-500 dark:text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[a("path",{"fill-rule":"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z","clip-rule":"evenodd"})])],-1)),C(a("input",{id:"EndDate",type:"date","onUpdate:modelValue":t[2]||(t[2]=e=>f(o).EndDate=e),onInput:t[3]||(t[3]=(...e)=>x.value&&x.value(...e)),placeholder:x.value,class:"bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",required:""},null,40,tt),[[M,f(o).EndDate]]),E(s,{message:f(o).errors.EndDate,class:"mt-2"},null,8,["message"])])])],32),E(B,{type:"submit",onClick:p,disabled:f(o).processing,class:G({"opacity-25":f(o).processing})},{default:v(()=>[E(z,{class:"h-8"})]),_:1},8,["disabled","class"]),t[7]||(t[7]=a("details",{className:"dropdown"},[a("summary",{className:"btn m-1"},"RECENT"),a("ul",{className:"menu dropdown-content bg-base-100 rounded-box z-[1] w-52 p-2 shadow"},[a("li",null,[a("a",{href:"/lastmonth"},"Last Month")]),a("li",null,[a("a",{href:"/lastweek"},"Last Week")]),a("li",null,[a("a",{href:"/yesterday"},"Yesterday")])])],-1)),E(U,{type:"button",onClick:r.exportToExcel,class:"m-6 bg-green"},{default:v(()=>[E(H,{class:"h-4"})]),_:1},8,["onClick"]),a("p",et,k(d.startDate)+" | "+k(d.endDate),1)])]),E(f(_),{data:l.value,columns:u.value,class:"w-full relative display",options:O},{action:v(e=>t[8]||(t[8]=[a("div",{class:"flex justify-start"},null,-1)])),_:1},8,["data","columns"])]),_:1})]),_:1})}}});export{yt as default};
