import{d as w,T as P,H,s as u,D as G,k as J,e as x,t as W,f as K,b as c,w as d,F as $,o as M,a as f,g as k,c as X,u as Q,n as Z}from"./app-D4KRJyko.js";import{_ as tt}from"./AdminPanel-BwjEDCtJ.js";import{T as et}from"./TableContainer-BHVeCArx.js";import{P as F,D as at}from"./dataTables-BXgh5MYr.js";import{_ as ot}from"./SuccessButton-B5RCiPM3.js";import{_ as R}from"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-5n6bCmaZ.js";import{E as rt}from"./Excel-Cx0Q9t9G.js";import{S as nt}from"./Save-N51M68zo.js";import"./dataTables.fixedColumns-D9A0BWYI.js";import{E as st}from"./exceljs.min-4JhihTCQ.js";import"./RetailGroup-6t20PwtR.js";import"./Logout-8hw4reCp.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                             */import"./Modal-C1bDdoN8.js";import"./RetailItems-Dce1d_bp.js";import"./Attendance-DvpGN19-.js";const lt={key:0,class:"fixed top-5 right-5 bg-green-900 text-white border border-gray-300 rounded-lg shadow-lg p-4 z-50"},ut={class:"absolute adjust"},ct={class:"flex justify-start items-center"},It={__name:"MGCount copy 3",props:{orders:{type:Array,required:!0},routes:{type:String,required:!0}},setup(Y,{emit:it}){F.use(at);const C=w(!1),O=Y,_=P({StartDate:"",EndDate:""}),U={paging:!1,scrollX:!0,scrollY:"60vh",scrollCollapse:!0,error:function(e,t,a){console.error("DataTables error:",t)},footerCallback:function(e,t,a,o,n){const y=this.api().table().footer().querySelectorAll("th");s.value.forEach((m,v)=>{m.footer&&(y[v].textContent=m.footer())})}},A=H(O.orders.reduce((e,t)=>{const{STORENAME:a,ITEMID:o,ITEMNAME:n,CATEGORY:l,COUNTED:y,MGCOUNT:m}=t,v=parseInt(y)||0,b=parseInt(m)||0;return e[o]||(e[o]={ITEMID:o,ITEMNAME:n,CATEGORY:l,TOTAL:0,MGCount:b,BalanceCount:0}),e[o][a]||(e[o][a]=0),e[o][a]+=v,e[o].TOTAL+=v,e[o].BalanceCount=e[o].MGCount-e[o].TOTAL,e},{})),D=u(()=>Object.values(A)),p=u(()=>{const e=new Set;return D.value.forEach(t=>{Object.keys(t).forEach(a=>{a!=="ITEMID"&&a!=="ITEMNAME"&&a!=="CATEGORY"&&a!=="TOTAL"&&a!=="MGCount"&&a!=="BalanceCount"&&e.add(a)})}),e}),g=u(()=>{const e={ITEMID:"Grand Total",ITEMNAME:"",CATEGORY:"",MGCount:0,BalanceCount:0,TOTAL:0};return p.value.forEach(t=>{e[t]=0}),S.value.forEach(t=>{e.MGCount+=Number(t.MGCount)||0,e.BalanceCount+=Number(t.BalanceCount)||0,e.TOTAL+=Number(t.TOTAL)||0,p.value.forEach(a=>{e[a]+=Number(t[a])||0})}),e}),s=u(()=>[{title:"ITEMID",data:"ITEMID",footer:()=>g.value.ITEMID},{title:"ITEMS",data:"ITEMNAME",footer:()=>""},{title:"CATEGORY",data:"CATEGORY",footer:()=>""},{title:"ACTUAL INV COUNT",data:"MGCount",render:(e,t,a)=>t==="display"?`<input type="number" value="${e}" onchange="window.updateMGCount('${a.ITEMID}', this.value)" />`:e,footer:()=>g.value.MGCount},{title:"REMAINING STOCKS",data:"BalanceCount",footer:()=>g.value.BalanceCount},{title:"TOTAL ALLOCATION",data:"TOTAL",footer:()=>g.value.TOTAL},...Array.from(p.value).map(e=>({title:e,data:e,render:(t,a,o)=>a==="display"?`<input type="number" value="${t}" onchange="window.updateCounted('${o.ITEMID}', '${e}', this.value)" />`:t,footer:()=>g.value[e]}))]),E=w(!1),I=w(""),V=()=>{C.value=!0,B(!0);const e=D.value.map(t=>{const a={};return Array.from(p.value).forEach(o=>{a[o]=t[o]||0}),{itemId:t.ITEMID,mgCount:t.MGCount,balanceCount:t.BalanceCount,counted:a}});console.log("Data to save:",JSON.stringify(e,null,2)),G.post(route("save.all.data"),{data:e}).then(t=>{console.log("All data saved successfully:",t.data),I.value="Data saved successfully!",E.value=!0,setTimeout(()=>{E.value=!1},3e3)}).catch(t=>{console.error("Error saving data:",t),t.response&&console.error("Error response:",t.response.data),I.value="Error saving data. Please try again.",E.value=!0,setTimeout(()=>{E.value=!1},3e3)}).finally(()=>{C.value=!1,B(!1)})},B=e=>{document.querySelectorAll("input, button").forEach(a=>{a.disabled=e})};window.updateMGCount=function(e,t){const a=A[e];a&&(a.MGCount=parseInt(t,10)||0,a.BalanceCount=a.MGCount-a.TOTAL,G.post("/api/update-mgcount",{itemId:e,mgCount:a.MGCount}).then(o=>{console.log("MGCount updated successfully")}).catch(o=>{console.error("Error updating MGCount:",o)}))},window.updateCounted=function(e,t,a){const o=A[e];o&&(o[t]=parseInt(a,10)||0,o.TOTAL=Array.from(p.value).reduce((n,l)=>n+(o[l]||0),0),o.BalanceCount=o.TOTAL-o.MGCount,G.post("/api/update-counted",{itemId:e,storeName:t,counted:o[t],total:o.TOTAL,balanceCount:o.BalanceCount}).then(n=>{console.log("Counted updated successfully")}).catch(n=>{console.error("Error updating Counted:",n)}))};const S=u(()=>D.value.map(e=>{const t={...e};return s.value.forEach(a=>{t.hasOwnProperty(a.data)||(t[a.data]="0")}),t})),L=w(null);u(()=>{if(L.value){const e=new Date(L.value),t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${o}`}return""});const N=w(null);u(()=>{if(N.value){const e=new Date(N.value),t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${o}`}return""}),u(()=>{const e=new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}${a}${o}`});async function j(){try{const e=new st.Workbook,t=e.addWorksheet("Flattened Orders");t.columns=s.value.map(r=>({header:r.title,key:r.data,width:15})),t.addRow(s.value.map(r=>r.title));const a=S.value.filter(r=>Array.from(p.value).map(i=>r[i]||0).some(i=>i>0));a.forEach(r=>{const T=s.value.map(i=>{const h=r[i.data];return h??0});t.addRow(T)});const o=s.value.reduce((r,T)=>(T.footer&&(r[T.data]=a.reduce((i,h)=>i+(Number(h[T.data])||0),0)),r),{}),n=t.addRow(s.value.map(r=>r.footer?o[r.data]||0:""));n.font={bold:!0},n.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF7C0000"}},n.font={color:{argb:"FFDDDDDD"}},t.getRow(1).font={bold:!0},t.getRow(1).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}};const l=new Date,y=`FlattenedOrders_${l.getFullYear()}-${l.getMonth()+1}-${l.getDate()}.xlsx`,m=await e.xlsx.writeBuffer(),v=new Blob([m],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),b=document.createElement("a");b.href=URL.createObjectURL(v),b.download=y,b.click()}catch(e){console.error("Error exporting to Excel:",e)}}const q=()=>{window.location.href="/picklist"},z=()=>{window.location.href="/cakepicklist"};return J(()=>{_.ROUTES=O.ROUTES,watch(()=>O.ROUTES,e=>{_.ROUTES=e})}),(e,t)=>(M(),x($,null,[E.value?(M(),x("div",lt,W(I.value),1)):K("",!0),c(tt,{"active-tab":"INVENTORY"},{main:d(()=>[c(et,null,{default:d(()=>[f("div",ut,[f("div",ct,[c(ot,{type:"button",onClick:j,class:"m-6 bg-green"},{default:d(()=>[c(rt,{class:"h-4"})]),_:1}),c(R,{type:"button",onClick:V,class:"m-6 bg-navy",disabled:C.value},{default:d(()=>[C.value?(M(),x($,{key:0},[t[0]||(t[0]=f("svg",{class:"animate-spin h-5 w-5 mr-3",viewBox:"0 0 24 24"},[f("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),f("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),t[1]||(t[1]=k(" Â  Saving... "))],64)):(M(),X(nt,{key:1,class:"h-4"}))]),_:1},8,["disabled"]),c(R,{type:"button",onClick:q,class:"m-1 bg-navy"},{default:d(()=>t[2]||(t[2]=[k(" Breads ")])),_:1}),c(R,{type:"button",onClick:z,class:"m-1 bg-navy"},{default:d(()=>t[3]||(t[3]=[k(" Cakes ")])),_:1})])]),f("div",{class:Z({"blur-overlay":C.value})},[c(Q(F),{data:S.value,columns:s.value,class:"w-full relative display custom-datatable",options:U},{action:d(a=>t[4]||(t[4]=[f("div",{class:"flex justify-start"},null,-1)])),_:1},8,["data","columns"])],2)]),_:1})]),_:1})],64))}};export{It as default};
