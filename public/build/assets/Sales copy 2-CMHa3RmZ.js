import{d as b,q as w,k as U,l as O,E as B,c as F,w as _,B as I,o as x,a as s,e as P,b as g,f as V,j as D,v as h,u as q,N as M}from"./app-BNPGhoL2.js";import{_ as j}from"./AdminPanel-C3by1daL.js";import{_ as L}from"./Main-CkYp62E2.js";import{_ as G}from"./MultiSelectDropdown-CM9RFtQU.js";import{T as $}from"./TableContainer-DOq29hCC.js";import"./buttons.print-BML1l2ev.js";import{P as k,D as A}from"./dataTables-CYoR-ngT.js";import{E as H}from"./exceljs.min-Bz6n0dRn.js";import"./RetailGroup-afsdHTlZ.js";import"./Logout-B5n2G0rZ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                             */import"./Modal-k3aPgSoE.js";import"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-B6Xc1nH0.js";import"./RetailItems-BzVTUMDz.js";import"./Attendance-D3nGk9-s.js";import"./PartyCake143-DUp1Stp_.js";const W={class:"mb-4 flex flex-wrap gap-4 p-4 bg-white rounded-lg shadow"},J={key:0,class:"flex-1 min-w-[200px]"},X={class:"flex-1 min-w-[200px]"},Y={class:"flex-1 min-w-[200px]"},z={class:"flex items-end"},ft={__name:"Sales copy 2",props:{ar:{type:Array,required:!0,default:()=>[]},auth:{type:Object,required:!0,default:()=>({})},stores:{type:Array,required:!0,default:()=>[]},userRole:{type:String,required:!0,validator:i=>["ADMIN","SUPERADMIN","STORE"].includes(i.toUpperCase())},filters:{type:Object,required:!0,default:()=>({startDate:"",endDate:"",selectedStores:[]})}},setup(i){k.use(A);const n=b([]),a=b(""),r=b(""),m=i,l=e=>new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(e),S=w(()=>m.userRole.toUpperCase()==="STORE"?L:j);U(()=>{n.value=m.filters.selectedStores||[],a.value=m.filters.startDate||"",r.value=m.filters.endDate||""});const f=w(()=>{let e=[...m.ar];return n.value.length>0&&(e=e.filter(t=>n.value.includes(t.storename))),a.value&&r.value&&(e=e.filter(t=>{const o=new Date(t.createddate),d=new Date(a.value),c=new Date(r.value);return o>=d&&o<=c})),e}),u=w(()=>f.value.reduce((e,t)=>({total_netamount:e.total_netamount+(Number(t.total_netamount)||0),total_discamount:e.total_discamount+(Number(t.total_discamount)||0),total_grossamount:e.total_grossamount+(Number(t.total_grossamount)||0)}),{total_netamount:0,total_discamount:0,total_grossamount:0})),E=[{data:"store",title:"Store",footer:"Grand Total"},{data:"total_netamount",title:"Net Amount",render:e=>l(Number(e)||0),footer:()=>l(u.value.total_netamount)},{data:"total_discamount",title:"Discount Amount",render:e=>l(Number(e)||0),footer:()=>l(u.value.total_discamount)},{data:"total_grossamount",title:"Gross Amount",render:e=>l(Number(e)||0),footer:()=>l(u.value.total_grossamount)}],N={responsive:!0,pageLength:25,dom:"Bfrtip",scrollX:!0,scrollY:"50vh",buttons:["copy",{text:"Export Excel",action:T},"pdf","print"],order:[[0,"asc"]],drawCallback:function(e){const t=new A.Api(e);R(t)}};function R(e){const t=e.table().footer().querySelectorAll("td, th");["total_grossamount","total_discamount","total_netamount"].forEach((d,c)=>{const p=u.value[d],y=t[c+1];y&&typeof p=="number"&&(y.textContent=l(p))})}async function T(){const e=new H.Workbook,t=e.addWorksheet("Sales Report");t.columns=[{header:"Store",key:"store",width:20},{header:"Net Amount",key:"netAmount",width:20,style:{numFmt:'₱"#,##0.00'}},{header:"Discount Amount",key:"discountAmount",width:20,style:{numFmt:'"₱"#,##0.00'}},{header:"Gross Amount",key:"grossAmount",width:20,style:{numFmt:'"₱"#,##0.00'}}],f.value.forEach(o=>{t.addRow({store:o.store,netAmount:Number(o.total_netamount)||0,discountAmount:Number(o.total_discamount)||0,grossAmount:Number(o.total_grossamount)||0})}),t.addRow({store:"Grand Total",netAmount:u.value.total_netamount,discountAmount:u.value.total_discamount,grossAmount:u.value.total_grossamount}),t.getRow(1).font={bold:!0};try{const o=await e.xlsx.writeBuffer(),d=new Blob([o],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),c=window.URL.createObjectURL(d),p=document.createElement("a");p.href=c,p.download=`sales_report_${new Date().toISOString().split("T")[0]}.xlsx`,p.click(),window.URL.revokeObjectURL(c)}catch(o){console.error("Error exporting to Excel:",o),alert("Failed to export Excel file. Please try again.")}}const C=()=>{if(a.value&&r.value&&new Date(a.value)>new Date(r.value)){alert("Start date cannot be later than end date"),a.value="",r.value="";return}const e=n.value.map(t=>{const o=m.stores.find(d=>d.NAME===t);return o?o.STOREID:t});M.get(route("reports.sales"),{startDate:a.value,endDate:r.value,stores:e},{preserveState:!0,preserveScroll:!0})};let v;return O([n,a,r],()=>{clearTimeout(v),v=setTimeout(C,500)},{deep:!0}),B(()=>{clearTimeout(v)}),(e,t)=>(x(),F(I(S.value),{"active-tab":"REPORTS"},{main:_(()=>[s("div",W,[i.userRole.toUpperCase()==="ADMIN"||i.userRole.toUpperCase()==="SUPERADMIN"?(x(),P("div",J,[g(G,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=o=>n.value=o),options:i.stores,label:"Stores"},null,8,["modelValue","options"])])):V("",!0),s("div",X,[t[4]||(t[4]=s("label",{class:"block text-sm font-medium text-gray-700"},"Start Date",-1)),D(s("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=o=>a.value=o),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[h,a.value]])]),s("div",Y,[t[5]||(t[5]=s("label",{class:"block text-sm font-medium text-gray-700"},"End Date",-1)),D(s("input",{type:"date","onUpdate:modelValue":t[2]||(t[2]=o=>r.value=o),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[h,r.value]])]),s("div",z,[s("button",{onClick:t[3]||(t[3]=()=>{n.value.value=[],a.value="",r.value=""}),class:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-md transition-colors"}," Clear Filters ")])]),g($,null,{default:_(()=>[g(q(k),{data:f.value,columns:E,class:"w-full relative display",options:N},null,8,["data"])]),_:1})]),_:1}))}};export{ft as default};
