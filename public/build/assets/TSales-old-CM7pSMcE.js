import{d as _,s as h,k as A,c as g,w as b,C as N,o as y,a as s,e as x,b as F,f as M,j as k,v as T,u as O}from"./app-Do8mhcc_.js";import{_ as q}from"./AdminPanel-B-hw9tyY.js";import{_ as U}from"./Main-DJMaGw9E.js";import{_ as I}from"./MultiSelectDropdown-DUxBUClO.js";import{T as V}from"./TableContainer-Ca6fkh91.js";import"./buttons.print-CuH7Nngl.js";import{P as E,D}from"./dataTables-B9agFZ0L.js";import{E as P}from"./exceljs.min-BfCykR8N.js";import"./RetailGroup-D_6SfRWw.js";import"./Logout-MAsyIaFu.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                             */import"./Modal-BufSFMTr.js";import"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-Cw8u42Sx.js";import"./RetailItems-SitUjnLk.js";import"./Attendance-Bi3B0c_5.js";import"./PartyCake143-Bf8C3VD0.js";const L={class:"mb-4 flex flex-wrap gap-4 p-4 bg-white rounded-lg shadow z-[999]"},B={key:0,class:"flex-1 min-w-[200px]"},G={class:"flex-1 min-w-[200px]"},j={class:"flex-1 min-w-[200px]"},$={class:"flex items-end"},Q={key:1},it={__name:"TSales-old",props:{ec:{type:Array,required:!0},auth:{type:Object,required:!0},stores:{type:Array,required:!0},userRole:{type:String,required:!0},filters:{type:Object,required:!0,default:()=>({startDate:"",endDate:"",selectedStores:[]})}},setup(f){E.use(D);const d=_([]),i=_(""),u=_(""),m=f,w=h(()=>m.userRole.toUpperCase()==="STORE"?U:q);A(()=>{d.value=m.filters.selectedStores||[],i.value=m.filters.startDate||"",u.value=m.filters.endDate||""});const v=h(()=>{let e=[...m.ec];return d.value.length>0&&(e=e.filter(t=>d.value.includes(t.storename))),i.value&&u.value&&(e=e.filter(t=>{const l=new Date(t.createddate),c=new Date(i.value),a=new Date(u.value);return l>=c&&l<=a})),e}),o=h(()=>v.value.reduce((e,t)=>(e.total_discamount+=parseFloat(t.total_discamount)||0,e.total_costprice+=parseFloat(t.total_costprice)||0,e.total_netamount+=parseFloat(t.total_netamount)||0,e.vatablesales+=parseFloat(t.vatablesales)||0,e.vat+=parseFloat(t.vat)||0,e.total_grossamount+=parseFloat(t.total_grossamount)||0,e.total_costamount+=parseFloat(t.total_costamount)||0,e.total_qty+=Math.round(t.qty||0),e),{total_qty:0,total_discamount:0,total_costprice:0,total_netamount:0,vatablesales:0,vat:0,total_grossamount:0,total_costamount:0})),C=[{data:"storename",title:"Store",footer:"Grand Total"},{data:"staff",title:"Staff"},{data:"createddate",title:"Date"},{data:"timeonly",title:"Time"},{data:"transactionid",title:"Transaction ID"},{data:"receiptid",title:"Receipt ID"},{data:"paymentmethod",title:"Payment Method"},{data:"custaccount",title:"Customer"},{data:"itemname",title:"Item Name"},{data:"itemgroup",title:"Item Group"},{data:"qty",title:"Qty",render:e=>Math.round(e),footer:()=>Math.round(o.value.total_qty)},{data:"total_costprice",title:"Cost Price",render:e=>(parseFloat(e)||0).toFixed(2),footer:()=>o.value.total_costprice.toFixed(2)},{data:"total_grossamount",title:"Gross Amount",render:e=>(parseFloat(e)||0).toFixed(2),footer:()=>o.value.total_grossamount.toFixed(2)},{data:"total_costamount",title:"Cost Amount",render:e=>(parseFloat(e)||0).toFixed(2),footer:()=>o.value.total_costamount.toFixed(2)},{data:"total_discamount",title:"Discount Amount",render:e=>(parseFloat(e)||0).toFixed(2),footer:()=>o.value.total_discamount.toFixed(2)},{data:"total_netamount",title:"Net Amount",render:e=>(parseFloat(e)||0).toFixed(2),footer:()=>o.value.total_netamount.toFixed(2)},{data:"vatablesales",title:"Vatable Sales",render:e=>(parseFloat(e)||0).toFixed(2),footer:()=>o.value.vatablesales.toFixed(2)},{data:"vat",title:"VAT",render:e=>(parseFloat(e)||0).toFixed(2),footer:()=>o.value.vat.toFixed(2)}],R={responsive:!0,order:[[0,"asc"]],pageLength:25,dom:"Bfrtip",scrollX:!0,scrollY:"50vh",buttons:["copy",{text:"Export Excel",action:function(e,t,l,c){S()}},"pdf","print"],drawCallback:function(e){const l=new D.Api(e).table().footer().querySelectorAll("td, th");["total_qty","total_costprice","total_grossamount","total_costamount","total_discamount","total_netamount","vatablesales","vat"].forEach((a,p)=>{const n=o.value[a],r=l[p+10];r&&typeof n=="number"&&(r.textContent=n.toFixed(2))})}},S=()=>{const e=new P.Workbook,t=e.addWorksheet("Sales Data");t.columns=[{header:"STORE",key:"storename",width:20},{header:"STAFF",key:"staff",width:15},{header:"DATE",key:"createddate",width:12},{header:"TIME",key:"timeonly",width:10},{header:"TRANSACTION ID",key:"transactionid",width:15},{header:"RECEIPT ID",key:"receiptid",width:15},{header:"PAYMENT METHOD",key:"paymentmethod",width:15},{header:"CUSTOMER",key:"custaccount",width:20},{header:"ITEM NAME",key:"itemname",width:25},{header:"ITEM GROUP",key:"itemgroup",width:15},{header:"QTY",key:"qty",width:10},{header:"COST PRICE",key:"total_costprice",width:12},{header:"GROSS AMOUNT",key:"total_grossamount",width:15},{header:"COST AMOUNT",key:"total_costamount",width:15},{header:"DISCOUNT",key:"total_discamount",width:12},{header:"NET AMOUNT",key:"total_netamount",width:15},{header:"VATABLE SALES",key:"vatablesales",width:15},{header:"VAT",key:"vat",width:12}],t.getRow(1).font={bold:!0},t.getRow(1).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF333F4F"}},t.getRow(1).font={color:{argb:"FFFFFFFF"},bold:!0},v.value.forEach(a=>{t.addRow({storename:a.storename||"",staff:a.staff||"",createddate:a.createddate?new Date(a.createddate).toLocaleDateString():"",timeonly:a.timeonly||"",transactionid:a.transactionid||"",receiptid:a.receiptid||"",paymentmethod:a.paymentmethod||"",custaccount:a.custaccount||"",itemname:a.itemname||"",itemgroup:a.itemgroup||"",qty:Math.round(a.qty)||0,total_costprice:Number(a.total_costprice)||0,total_grossamount:Number(a.total_grossamount)||0,total_costamount:Number(a.total_costamount)||0,total_discamount:Number(a.total_discamount)||0,total_netamount:Number(a.total_netamount)||0,vatablesales:Number(a.vatablesales)||0,vat:Number(a.vat)||0})});const l=t.addRow({storename:"GRAND TOTAL",staff:"",createddate:"",timeonly:"",transactionid:"",receiptid:"",paymentmethod:"",custaccount:"",itemname:"",itemgroup:"",qty:Math.round(o.value.total_qty),total_costprice:o.value.total_costprice,total_grossamount:o.value.total_grossamount,total_costamount:o.value.total_costamount,total_discamount:o.value.total_discamount,total_netamount:o.value.total_netamount,vatablesales:o.value.vatablesales,vat:o.value.vat});l.font={bold:!0},l.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE9ECEF"}};const c=["K","L","M","N","O","P","Q","R"];t.eachRow((a,p)=>{p>1&&c.forEach(n=>{const r=a.getCell(n);r.numFmt="#,##0.00"})}),t.autoFilter={from:{row:1,column:1},to:{row:1,column:t.columns.length}},e.xlsx.writeBuffer().then(a=>{const p=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),n=URL.createObjectURL(p),r=document.createElement("a");r.href=n,r.download=`Sales_Report_${new Date().toISOString().split("T")[0]}.xlsx`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}).catch(a=>{console.error("Error exporting to Excel:",a),alert("Error exporting to Excel. Please try again.")})};return(e,t)=>(y(),g(N(w.value),{"active-tab":"REPORTS"},{main:b(()=>[s("div",L,[f.userRole.toUpperCase()==="ADMIN"||f.userRole.toUpperCase()==="SUPERADMIN"?(y(),x("div",B,[F(I,{modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=l=>d.value=l),options:f.stores,label:"Stores"},null,8,["modelValue","options"])])):M("",!0),s("div",G,[t[4]||(t[4]=s("label",{class:"block text-sm font-medium text-gray-700"},"Start Date",-1)),k(s("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=l=>i.value=l),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[T,i.value]])]),s("div",j,[t[5]||(t[5]=s("label",{class:"block text-sm font-medium text-gray-700"},"End Date",-1)),k(s("input",{type:"date","onUpdate:modelValue":t[2]||(t[2]=l=>u.value=l),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[T,u.value]])]),s("div",$,[s("button",{onClick:t[3]||(t[3]=()=>{d.value=[],i.value="",u.value=""}),class:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-md"}," Clear Filters ")])]),F(V,{class:"overflow-auto"},{default:b(()=>[v.value.length>0?(y(),g(O(E),{key:0,data:v.value,columns:C,class:"w-full relative display",options:R},{action:b(l=>t[6]||(t[6]=[])),_:1},8,["data"])):(y(),x("p",Q,"No data available for the selected filters."))]),_:1})]),_:1}))}};export{it as default};
