import{o as g,e as y,a,g as I,d as p,H as $,k as ee,S as te,c as se,w as f,b as u,f as A,t as V,n as ne,F as oe,h as ae,u as ie,D}from"./app-DfIvzsOQ.js";import{P as j,D as re}from"./dataTables-BsbRCurN.js";import{C as le,G as ce,_ as ue}from"./CopyFrom-BJU6xKQk.js";import{_ as C}from"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-C388c1rV.js";import{T as de}from"./TableContainer-B_NZ86Qn.js";import{_ as pe}from"./Main-CwvSfYt3.js";import{S as fe}from"./Save-DuiXAOXZ.js";import{B as me}from"./Back-CYBxpPPh.js";import{C as ve}from"./Cart-CyCcG2n-.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Modal-CysVaCy0.js";import"./InputError-CglVpcef.js";import"./Logout-3bWQyGlF.js";/* empty css                                                             */import"./PartyCake143-LtAgi0Q7.js";import"./Attendance-DnkoFQCQ.js";const ge={},be={fill:"#ffffff",viewBox:"-6.5 0 32 32",version:"1.1",xmlns:"http://www.w3.org/2000/svg",stroke:"#ffffff"};function he(b,h){return g(),y("svg",be,h[0]||(h[0]=[a("g",{id:"SVGRepo_bgCarrier","stroke-width":"0"},null,-1),a("g",{id:"SVGRepo_tracerCarrier","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),a("g",{id:"SVGRepo_iconCarrier"},[a("title",null,"save"),I(),a("path",{d:"M12.188 4.469v4.656h2.438l-4.875 5.875-4.875-5.875h2.563v-4.656h4.75zM16.313 12l2.844 4.5c0.156 0.375 0.344 1.094 0.344 1.531v8.656c0 0.469-0.375 0.813-0.813 0.813h-17.844c-0.469 0-0.844-0.344-0.844-0.813v-8.656c0-0.438 0.156-1.156 0.313-1.531l2.844-4.5c0.156-0.406 0.719-0.75 1.125-0.75h1.281l1.313 1.594h-2.625l-2.531 4.625c-0.031 0-0.031 0.031-0.031 0.063 0 0.063 0 0.094-0.031 0.125h16.156v-0.125c0-0.031-0.031-0.063-0.031-0.094l-2.531-4.594h-2.625l1.313-1.594h1.25c0.438 0 0.969 0.344 1.125 0.75zM7.469 21.031h4.594c0.406 0 0.781-0.375 0.781-0.813 0-0.406-0.375-0.781-0.781-0.781h-4.594c-0.438 0-0.813 0.375-0.813 0.781 0 0.438 0.375 0.813 0.813 0.813z"})],-1)]))}const ye=F(ge,[["render",he]]),we={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50 backdrop-filter backdrop-blur-sm"},Te={class:"mb-4 flex justify-between items-center px-10"},Ce={class:"flex space-x-2"},Ee={class:"relative column-visibility-dropdown"},xe={key:0,class:"absolute z-50 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5"},ke={class:"py-1",role:"menu"},Ne=["checked","onChange"],Se={class:"flex space-x-2"},Ae={class:"inline-flex items-center"},De=["checked","onChange"],Ie={__name:"index",props:{stockcountingtrans:{type:Array,required:!0},journalid:{type:[String,Number],required:!0},items:{type:Array,required:!0},isPosted:{type:Number,required:!0}},setup(b){j.use(re);const h=b,E=p(""),w=p(!1),T=p(!1),_=p(!1),S=p(!1),R=p(!1),O=p([]),m=$({}),r=$({text:"",type:"",timeout:null}),x=p(!1),l=p({ITEMID:!0,itemname:!0,itemgroup:!0,ADJUSTMENT:!0,RECEIVEDCOUNT:!0,VARIANCE:!0,TRANSFERCOUNT:!0,WASTECOUNT:!0,WASTETYPE:!0,COUNTED:!0}),d=p(null),v=(e,s,t=3e3)=>{r.timeout&&clearTimeout(r.timeout),r.text=e,r.type=s,r.timeout=setTimeout(()=>{r.text="",r.type="",r.timeout=null},t)},k=p([{data:"ITEMID",title:"ITEMID",width:"120px",visible:l.value.ITEMID},{data:"itemname",title:"ITEMNAME",width:"200px",visible:l.value.itemname},{data:"itemgroup",title:"CATEGORY",width:"150px",visible:l.value.itemgroup},{data:"ADJUSTMENT",title:"ORDER",width:"100px",visible:l.value.ADJUSTMENT,render:function(e,s,t){return s==="display"?`
                    <input type="number" 
                        class="counted-input form-input w-full rounded-md"
                        value="${Number(e).toFixed(0)}"
                        min="0"
                        data-field="ADJUSTMENT"
                        disabled
                        style="opacity: 0.6;"
                    >
                `:e}},{data:"RECEIVEDCOUNT",title:"ACTUAL RECEIVED",width:"120px",visible:l.value.RECEIVEDCOUNT,render:function(e,s,t){if(s==="display"){const n=Number(e),o=new Date,i=o.getHours(),c=t.TRANSDATE===o.toISOString().split("T")[0],N=i>=12||i===0,M=t.posted===1||!c||N;return`
                    <input type="number" 
                        class="counted-input form-input w-full rounded-md"
                        value="${n.toFixed(0)}"
                        min="0"
                        data-field="RECEIVEDCOUNT"
                        ${M?"disabled":""}
                        style="${M?"opacity: 0.6;":""}"
                        title="${N?"Receiving is disabled between 12 PM and 12 AM":""}"
                    >
                `}return e}},{data:null,title:"VARIANCE",width:"100px",render:function(e,s,t){if(s==="display"){const n=Number(t.ADJUSTMENT),o=Number(t.RECEIVEDCOUNT),i=n-o;return`
                    <div class="text-center p-2" 
                         style="background-color: ${i===0?"#f3f3f3":i<0?"#ffebee":"#e8f5e9"}">
                        ${i}
                    </div>
                `}return""}},{data:"TRANSFERCOUNT",title:"TRANSFER",width:"120px",visible:l.value.TRANSFERCOUNT,render:function(e,s,t){if(s==="display"){const n=Number(e),o=new Date().toISOString().split("T")[0],i=t.TRANSDATE===o,c=t.posted===1||!i;return`
                    <input type="number" 
                        class="counted-input form-input w-full rounded-md"
                        value="${n.toFixed(0)}"
                        min="0"
                        data-field="TRANSFERCOUNT"
                        ${c?"disabled":""}
                        style="${c?"opacity: 0.6;":""}"
                    >
                `}return e}},{data:"WASTECOUNT",title:"WASTE COUNT",width:"120px",visible:l.value.WASTECOUNT,render:function(e,s,t){if(s==="display"){const n=Number(e),o=t.posted===1||t.WASTETYPE!==null;return`
                    <input type="number"
                        class="counted-input form-input w-full rounded-md"
                        value="${n.toFixed(0)}"
                        min="0"
                        data-field="WASTECOUNT"
                        ${o?"disabled":""}
                        style="${o?"opacity: 0.6;":""}"
                    >
                `}return e}},{data:"WASTETYPE",title:"WASTE TYPE",width:"150px",visible:l.value.WASTETYPE,render:function(e,s,t){if(s==="display"){const n=t.posted===1||e!==null,o=["throw_away","early_molds","pull_out","rat_bites","ant_bites"],i=e||"";return`
                    <select 
                        class="waste-type-select form-select w-full rounded-md"
                        data-field="WASTETYPE"
                        ${n?"disabled":""}>
                        <option value="">Select type</option>
                        ${o.map(c=>`
                            <option value="${c}" ${i===c?"selected":""}>
                                ${c.replace(/_/g," ")}
                            </option>
                        `).join("")}
                    </select>
                `}return e}},{data:"COUNTED",title:"ACTUAL COUNT",width:"120px",visible:l.value.COUNTED,render:function(e,s,t){if(s==="display"){const n=Number(e),o=t.TRANSDATE===new Date().toISOString().split("T")[0],i=t.posted===1||!o;return`
                    <input type="number"
                        class="counted-input form-input w-full rounded-md"
                        value="${n.toFixed(0)}"
                        min="0"
                        data-field="COUNTED"
                        ${i?"disabled":""}
                        style="${i?"opacity: 0.6;":""}"
                    >
                `}return e}}]),L={paging:!1,scrollX:!0,scrollY:"70vh",scrollCollapse:!0,responsive:!0,processing:!0,stateSave:!0,columns:k.value,language:{processing:"Loading..."},initComplete:function(e,s){d.value&&(d.value.dtInstance=this.api())},drawCallback:function(e){this.api().rows().every(function(){const t=this.data();this.node().querySelectorAll(".counted-input, .waste-type-select").forEach(i=>{t.posted||i.addEventListener("change",c=>B(c,t))})})}},W=e=>{l.value[e]=!l.value[e];const s=k.value.find(t=>t.data===e);if(s&&(s.visible=l.value[e]),d.value)try{const t=d.value.dt;if(t){const n=k.value.findIndex(o=>o.data===e);n!==-1&&t.column(n).visible(l.value[e])}}catch(t){console.error("Error updating column visibility:",t)}},z=()=>{x.value=!x.value},U=e=>{const s=document.querySelector(".column-visibility-dropdown");s&&!s.contains(e.target)&&(x.value=!1)},B=(e,s)=>{const t=e.target.dataset.field;if(!t||s.posted)return;m[s.ITEMID]||(m[s.ITEMID]={});const n=e.target.type==="number"?parseFloat(e.target.value)||0:e.target.value;if(m[s.ITEMID][t]=n,e.target.type==="number"){const o=n===0?"#f3f3f3":"white";e.target.style.backgroundColor=o}},P=async()=>{var e,s,t;try{if(Object.keys(m).length===0){v("No changes to update","info");return}w.value=!0,v("Updating values...","info");const n=await D.post("/stock-counting-line/update-all-counted-values",{journalId:h.journalid,updatedValues:m},{headers:{"X-CSRF-TOKEN":(e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.content,Accept:"application/json","Content-Type":"application/json"},withCredentials:!0});n.data.success&&(v(n.data.message,"success"),Object.entries(m).forEach(([o,i])=>{const c=O.value.find(N=>N.ITEMID===o);c&&Object.assign(c,i)}),Object.keys(m).forEach(o=>delete m[o]),d.value&&d.value.dt&&d.value.dt.search("").draw(),window.location.reload())}catch(n){console.error("Update error:",n);const o=((t=(s=n.response)==null?void 0:s.data)==null?void 0:t.message)||n.message||"Update failed";v(o,"error")}finally{w.value=!1}},G=()=>{window.location.href="/StockCounting"},J=async()=>{var s,t;if(window.confirm("Are you sure you want to sync the posted records?"))try{w.value=!0,v("Syncing data...","info");const n=await D.post("/postbatch");if(n.data.success){if(v(`${n.data.message}. ${n.data.count} records synced.`,"success"),d.value&&d.value.dtInstance){const o=d.value.dtInstance,i=await D.get(`/StockCountingLine/${h.journalid}`);i.data.stockcountingtrans&&(o.clear(),o.rows.add(i.data.stockcountingtrans),o.draw())}}else v(n.data.message||"Sync completed with warnings","info")}catch(n){console.error("Sync error:",n);let o="Sync failed";(t=(s=n.response)==null?void 0:s.data)!=null&&t.message?o+=`: ${n.response.data.message}`:n.message&&(o+=`: ${n.message}`),v(o,"error")}finally{w.value=!1}},H=e=>{window.location.href=`/ViewStockCountingLine/${e}`},Y=e=>{E.value=e,S.value=!0},q=()=>{R.value=!1},X=()=>{S.value=!1},Q=()=>{_.value=!1},Z=e=>{console.log("Selected Item:",e)},K=()=>{if(!(!d.value||T.value))try{const e=d.value.dt;e&&(window.dataTableInstance=e,T.value=!0)}catch(e){console.error("DataTable initialization error:",e),T.value=!1}};return ee(()=>{O.value=h.stockcountingtrans,document.addEventListener("click",U);let e=0;const s=3,t=()=>{if(e>=s){console.error("Failed to initialize DataTable after maximum retries");return}setTimeout(()=>{T.value||(K(),e++,T.value||t())},500*Math.pow(2,e))};t()}),te(()=>{document.removeEventListener("click",U),r.timeout&&clearTimeout(r.timeout)}),(e,s)=>(g(),se(pe,{"active-tab":"STOCK"},{modals:f(()=>[u(le,{"show-modal":R.value,JOURNALID:E.value,items:b.items,onToggleActive:q,onSelectItem:Z},null,8,["show-modal","JOURNALID","items"]),u(ce,{"show-modal":S.value,JOURNALID:E.value,onToggleActive:X},null,8,["show-modal","JOURNALID"]),u(ue,{"show-modal":_.value,JOURNALID:E.value,onToggleActive:Q},null,8,["show-modal","JOURNALID"])]),main:f(()=>[u(de,null,{default:f(()=>[w.value?(g(),y("div",we,s[2]||(s[2]=[a("div",{class:"bg-white p-4 rounded-lg shadow-lg flex items-center space-x-3"},[a("svg",{class:"animate-spin h-5 w-5 text-navy",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[a("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),a("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),a("span",{class:"text-gray-700"},"Processing...")],-1)]))):A("",!0),r.text?(g(),y("div",{key:1,class:ne(["fixed top-4 right-4 z-50 px-4 py-2 rounded-lg shadow-lg transition-all duration-300",r.type==="success"?"bg-green-100 text-green-800 border border-green-300":r.type==="error"?"bg-red-100 text-red-800 border border-red-300":"bg-blue-100 text-blue-800 border border-blue-300"])},V(r.text),3)):A("",!0),a("div",Te,[a("div",Ce,[a("div",Ee,[a("button",{onClick:z,class:"bg-navy px-4 py-2 rounded-md text-white flex items-center space-x-2"},s[3]||(s[3]=[a("span",null,"Show/Hide Columns",-1),a("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1)])),x.value?(g(),y("div",xe,[a("div",ke,[(g(!0),y(oe,null,ae(l.value,(t,n)=>(g(),y("label",{key:n,class:"flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer"},[a("input",{type:"checkbox",checked:t,onChange:o=>W(n),class:"mr-2 rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,40,Ne),I(" "+V(n),1)]))),128))])])):A("",!0)]),u(C,{onClick:G,class:"bg-navy px-4 py-2"},{default:f(()=>[u(me,{class:"h-5 w-5"})]),_:1}),u(C,{onClick:s[0]||(s[0]=t=>Y(b.journalid)),class:"bg-navy px-4 py-2"},{default:f(()=>s[4]||(s[4]=[I(" GENERATE ")])),_:1}),u(C,{onClick:s[1]||(s[1]=t=>H(b.journalid)),class:"bg-navy px-4 py-2"},{default:f(()=>[u(ve,{class:"h-5 w-5"})]),_:1}),u(C,{onClick:J,class:"bg-green-500 px-4 py-2"},{default:f(()=>[u(ye,{class:"h-5 w-5"})]),_:1})]),a("div",Se,[u(C,{onClick:P,class:"bg-navy px-4 py-2"},{default:f(()=>[u(fe,{class:"h-5 w-5"})]),_:1})])]),u(ie(j),{ref_key:"dataTableRef",ref:d,data:b.stockcountingtrans,columns:k.value,class:"w-full display nowrap",options:L},{action:f(t=>[a("label",Ae,[a("input",{type:"checkbox",class:"form-checkbox h-5 w-5 text-blue-600 rounded",checked:t.selected,onChange:n=>e.toggleRowSelection(t)},null,40,De)])]),_:1},8,["data","columns"])]),_:1})]),_:1}))}},He=F(Ie,[["__scopeId","data-v-1b24cc6e"]]);export{He as default};
