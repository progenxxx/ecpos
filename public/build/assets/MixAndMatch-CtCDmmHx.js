import{d as f,s as w,k as K,e as n,a as t,F as v,h as k,t as i,f as _,g as p,n as F,j as U,y as W,D as z,o as a}from"./app-D4KRJyko.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Z={class:"p-4"},ee={key:0,class:"fixed inset-0 z-50"},te={class:"relative min-h-screen flex items-center justify-center p-4 max-h-[50vh] overflow-auto"},se={class:"bg-white w-full max-w-4xl rounded-2xl shadow-2xl overflow-hidden"},oe={class:"bg-gradient-to-r from-purple-600 to-blue-500 p-6"},le={class:"flex justify-between items-center"},re={class:"flex items-center justify-center space-x-4 mt-6"},ne={key:0,class:"p-12 text-center"},ae={key:1,class:"p-8 text-center"},ie={class:"text-red-600 font-medium"},ue={key:2,class:"p-6 max-h-[60vh] overflow-y-auto"},de={key:0,class:"space-y-6 max-h-[60vh] overflow-y-auto"},ce={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ve=["onClick"],pe={class:"font-bold text-gray-800 group-hover:text-purple-600 transition-colors"},xe={key:1,class:"space-y-8 max-h-[60vh] overflow-y-auto"},me={class:"flex items-center justify-between"},ge={class:"px-4 py-2 bg-purple-100 rounded-full"},fe={class:"text-purple-600 font-medium"},ye={class:"flex items-center space-x-2"},he={class:"text-lg font-semibold text-gray-800"},be={class:"px-3 py-1 bg-gray-100 rounded-full text-sm text-gray-600"},we={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},ke=["onClick"],_e={class:"font-medium text-gray-800"},Se={class:"mt-2 inline-flex items-center space-x-1"},Fe={class:"text-2xl font-bold text-purple-600"},Ie={class:"text-2xl font-bold text-purple-600"},Ce={key:2,class:"space-y-6 max-h-[60vh] overflow-y-auto"},Oe={class:"space-y-6"},je={class:"font-semibold text-gray-800"},Me={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ee={class:"font-medium text-gray-800"},Le={class:"mt-2 inline-flex items-center space-x-1"},Te={class:"text-2xl font-bold text-purple-600"},De={class:"text-2xl font-bold text-purple-600"},Pe={class:"text-2xl font-bold text-purple-600"},Ne={class:"p-4 bg-gray-100 rounded-lg"},$e={class:"space-y-2"},Ae={class:"text-gray-600"},Be={class:"text-red-900"},qe={class:"text-2xl font-bold text-purple-600"},ze={key:0,class:"text-green-600 font-medium"},Ge={class:"border-t bg-gray-50 p-6"},Ve={class:"flex justify-between items-center"},Qe={class:"flex space-x-4"},Ye=["disabled"],He={__name:"MixAndMatch",setup(Re){const L=f([]),l=f(null),d=f({}),u=f(1),y=f(!1),S=f(!1),x=f(null),G=o=>{l.value=o,d.value={},u.value=2},T=w(()=>l.value?l.value.line_groups.map(o=>({...o,items:o.discount_lines||[],selected:d.value[o.linegroup]||[]})):[]),V=async()=>{S.value=!0,x.value=null;try{const o=await z.get("/mix-match/discounts");console.log(o.data),L.value=o.data.map(e=>({...e,dealpricevalue:Number(e.dealpricevalue),discountamountvalue:Number(e.discountamountvalue),discountpctvalue:Number(e.discountpctvalue)}))}catch{x.value="Failed to load discounts. Please try again."}finally{S.value=!1}},Q=(o,e)=>{d.value[e.linegroup]||(d.value[e.linegroup]=[]);const s=d.value[e.linegroup],r=s.findIndex(c=>c.id===o.id);r>-1?s.splice(r,1):s.length<e.noofitemsneeded&&s.push(o),j.value&&(u.value=3)},Y=(o,e)=>{var s;return((s=d.value[e])==null?void 0:s.some(r=>r.id===o.id))||!1},D=o=>{var s;return(((s=d.value[o.linegroup])==null?void 0:s.length)||0)===o.noofitemsneeded},j=w(()=>l.value?l.value.line_groups.every(o=>D(o)):!1),P=w(()=>Object.values(d.value).reduce((o,e)=>o+e.length,0)),H=w(()=>l.value?l.value.line_groups.reduce((o,e)=>o+e.noofitemsneeded,0):0),M=()=>{l.value=null,d.value={},u.value=1},N=(o,e)=>{document.querySelectorAll(".toast-message").forEach(h=>h.remove());const r=document.createElement("div");r.className=`toast-message fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 flex items-center space-x-2 ${o==="success"?"bg-green-500":"bg-red-500"} text-white`;const c=o==="success"?'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>':'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>';r.innerHTML=`
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            ${c}
        </svg>
        <span>${e}</span>
    `,document.body.appendChild(r),setTimeout(()=>{r.remove()},3e3)},R=async()=>{var o,e,s,r,c,h,I,A;S.value=!0,x.value=null;try{const C=(b,g)=>{if(!g)return b;switch(g.discounttype){case 0:return g.dealpricevalue??b;case 1:return b*(1-(g.discountpctvalue??0)/100);case 2:return b-(g.discountamountvalue??0);default:return b}};if(!l.value)throw new Error("No discount selected");if(!d.value||typeof d.value!="object")throw new Error("Invalid items selected");const E=Object.entries(d.value).flatMap(([b,g])=>g.map(O=>{const q=parseFloat(O.dealpriceordiscpct);if(isNaN(q))throw new Error(`Invalid price for item ID ${O.itemid}`);return{itemid:O.itemid,qty:O.qty,price:q||0}}));if(console.log("Constructed cartItems:",E),E.length===0)throw new Error("Cart cannot be empty");const J={cart:E,metadata:{discountInfo:{id:(o=l.value)==null?void 0:o.id,description:(e=l.value)==null?void 0:e.description,discounttype:(s=l.value)==null?void 0:s.discounttype,dealpricevalue:(r=l.value)==null?void 0:r.dealpricevalue,discountpctvalue:(c=l.value)==null?void 0:c.discountpctvalue,discountamountvalue:(h=l.value)==null?void 0:h.discountamountvalue},totals:{originalTotal:m.value,savings:$.value,finalTotal:C(m.value,l.value)},timestamp:new Date().toISOString(),totalItems:P.value,totalGroups:Object.keys(d.value).length}},B=await z.post("/mix-match/submit-order",J);if(B.data.status==="success")y.value=!1,M(),N("success","Order completed successfully!"),location.reload();else throw new Error(B.data.message||"Failed to submit order")}catch(C){x.value=((A=(I=C.response)==null?void 0:I.data)==null?void 0:A.message)||C.message||"Failed to submit order. Please try again.",N("error",x.value)}finally{S.value=!1}},m=w(()=>l.value?Object.entries(d.value).reduce((o,[e,s])=>o+s.reduce((r,c)=>{console.log(`Item ID: ${c.id}, Price: ${c.dealpriceordiscpct}, Quantity: ${c.qty}`);const h=parseFloat(c.dealpriceordiscpct)||0,I=parseInt(c.qty)||0;return r+h*I},0),0):0),$=w(()=>{try{if(!l.value)return 0;const{discounttype:o,dealpricevalue:e,discountpctvalue:s,discountamountvalue:r}=l.value,c=typeof r=="number"?r:0;switch(o){case 0:return(m.value-(e||0)).toFixed(2);case 1:return(m.value*((s||0)/100)).toFixed(2);case 2:return c.toFixed(2);default:return 0}}catch(o){return console.error("Error calculating savings:",o),0}});return K(V),(o,e)=>(a(),n("div",Z,[t("button",{onClick:e[0]||(e[0]=s=>y.value=!0),class:"group relative inline-flex items-center justify-center px-6 py-3 overflow-hidden font-bold text-white rounded-lg shadow-2xl bg-gradient-to-br from-purple-600 to-blue-500 hover:from-purple-500 hover:to-blue-400 transition-all duration-300 ease-out hover:scale-105"},e[4]||(e[4]=[t("span",{class:"absolute right-0 w-8 h-32 -mt-12 transition-all duration-1000 transform translate-x-12 bg-white opacity-10 rotate-12 group-hover:-translate-x-40 ease"},null,-1),t("span",{class:"relative"},"Mix&Match",-1)])),y.value?(a(),n("div",ee,[e[24]||(e[24]=t("div",{class:"absolute inset-0 bg-gray-900 bg-opacity-50 backdrop-blur-sm"},null,-1)),t("div",te,[t("div",se,[t("div",oe,[t("div",le,[e[6]||(e[6]=t("h2",{class:"text-2xl font-bold text-white"},"Mix & Match Menu",-1)),t("button",{onClick:e[1]||(e[1]=s=>{y.value=!1,M()}),class:"text-white hover:text-gray-200 transition-colors"},e[5]||(e[5]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),t("div",re,[(a(),n(v,null,k(3,s=>t("div",{key:s,class:"flex items-center"},[t("div",{class:F(["w-8 h-8 rounded-full flex items-center justify-center border-2 font-bold",u.value>=s?"bg-white text-purple-600 border-white":"border-white/50 text-white/50"])},i(s),3),s<3?(a(),n("div",{key:0,class:F(["w-16 h-0.5 mx-2",u.value>s?"bg-white":"bg-white/30"])},null,2)):_("",!0)])),64))])]),S.value?(a(),n("div",ne,e[7]||(e[7]=[t("div",{class:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto"},null,-1),t("p",{class:"mt-4 text-gray-600"},"Loading available offers...",-1)]))):x.value?(a(),n("div",ae,[e[8]||(e[8]=t("div",{class:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-red-100 mb-4"},[t("svg",{class:"w-8 h-8 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),t("p",ie,i(x.value),1)])):(a(),n("div",ue,[u.value===1?(a(),n("div",de,[e[10]||(e[10]=t("h3",{class:"text-xl font-bold text-gray-800"},"Select an Offer",-1)),t("div",ce,[(a(!0),n(v,null,k(L.value,s=>(a(),n("div",{key:s.id,onClick:r=>G(s),class:"group relative overflow-hidden p-6 rounded-xl border-2 border-gray-100 cursor-pointer transition-all duration-300 hover:border-purple-500 hover:shadow-lg"},[e[9]||(e[9]=t("div",{class:"absolute inset-0 bg-gradient-to-r from-purple-500/0 to-blue-500/0 group-hover:from-purple-500/5 group-hover:to-blue-500/5 transition-colors duration-300"},null,-1)),t("h4",pe,i(s.description),1)],8,ve))),128))])])):_("",!0),u.value===2&&l.value?(a(),n("div",xe,[t("div",me,[e[11]||(e[11]=t("h3",{class:"text-xl font-bold text-gray-800"},"Select Your Items",-1)),t("div",ge,[t("span",fe,i(P.value)+" of "+i(H.value)+" selected ",1)])]),(a(!0),n(v,null,k(T.value,s=>(a(),n("div",{key:s.linegroup,class:"space-y-4"},[t("div",ye,[t("h4",he,i(s.description||`Group ${s.linegroup}`),1),t("span",be," Select "+i(s.noofitemsneeded),1)]),t("div",we,[(a(!0),n(v,null,k(s.items,r=>(a(),n("div",{key:r.id,onClick:c=>Q(r,s),class:F(["relative p-4 rounded-xl transition-all duration-300",Y(r,s.linegroup)?"bg-gradient-to-r from-purple-500/10 to-blue-500/10 border-2 border-purple-500":D(s)?"opacity-50 cursor-not-allowed bg-gray-50 border-2 border-gray-100":"hover:shadow-md border-2 border-gray-100 cursor-pointer"])},[t("div",_e,"Item: "+i(r.itemname),1),t("div",Se,[t("span",Fe,i(r.dealpriceordiscpct.toFixed(2)),1),e[12]||(e[12]=t("span",{class:"text-sm text-gray-500"},"PESOS x ",-1)),t("span",Ie,i(r.qty),1),e[13]||(e[13]=t("span",{class:"text-sm text-gray-500"},"Qty ",-1))])],10,ke))),128))])]))),128))])):_("",!0),u.value===3?(a(),n("div",Ce,[e[22]||(e[22]=t("h3",{class:"text-xl font-bold text-gray-800"},"Review Your Selection",-1)),t("div",Oe,[(a(!0),n(v,null,k(T.value,s=>(a(),n("div",{key:s.linegroup,class:"p-6 rounded-xl bg-gray-50 space-y-4"},[t("h4",je,i(s.description),1),t("div",Me,[(a(!0),n(v,null,k(d.value[s.linegroup],r=>(a(),n("div",{key:r.id,class:"p-4 bg-white rounded-lg shadow-sm border border-gray-100"},[t("div",Ee,i(r.itemid),1),t("div",Le,[t("span",Te,i(r.dealpriceordiscpct.toFixed(2)),1),e[14]||(e[14]=t("span",{class:"text-sm text-gray-500"},"PESOS x ",-1)),t("span",De,i(r.qty),1),e[15]||(e[15]=t("span",{class:"text-sm text-gray-500"},"Qty ",-1)),e[16]||(e[16]=t("span",{class:"text-sm text-gray-500"},"=",-1)),t("span",Pe,i((r.dealpriceordiscpct*r.qty).toFixed(2))+" PESOS ",1)])]))),128))])]))),128)),t("div",Ne,[e[21]||(e[21]=t("h4",{class:"font-semibold text-gray-800"},"Total Amount:",-1)),t("div",$e,[t("div",Ae,[t("a",Be,i(l.value.description),1),p(" Original Total: "+i(m.value.toFixed(2))+" PESOS ",1)]),t("div",qe,[l.value.discounttype===0?(a(),n(v,{key:0},[e[17]||(e[17]=p(" Discounttype: (Deal Price): ")),e[18]||(e[18]=t("br",null,null,-1)),p("FINAL TOTAL: "+i(l.value.dealpricevalue.toFixed(2))+" PESOS ",1)],64)):l.value.discounttype===1?(a(),n(v,{key:1},[p(" Final Price (Perc. Discount) ("+i(l.value.discountpctvalue.toFixed(2))+"% OFF): ",1),e[19]||(e[19]=t("br",null,null,-1)),p("FINAL TOTAL: "+i((m.value*(1-l.value.discountpctvalue/100)).toFixed(2))+" PESOS ",1)],64)):l.value.discounttype===2?(a(),n(v,{key:2},[p(" Discounttype: Amount Discount ("+i(l.value.discountamountvalue.toFixed(2))+" PESOS OFF): ",1),e[20]||(e[20]=t("br",null,null,-1)),p("FINAL TOTAL: "+i((m.value-l.value.discountamountvalue).toFixed(2))+" PESOS ",1)],64)):(a(),n(v,{key:3},[p(i(l.value.discounttype.toFixed(2)),1)],64))]),l.value.discounttype!==3?(a(),n("div",ze," You Save: "+i($.value)+" PESOS ",1)):_("",!0)])])])])):_("",!0)])),t("div",Ge,[t("div",Ve,[t("button",{onClick:e[2]||(e[2]=s=>u.value>1?u.value--:M()),class:"px-6 py-2 border-2 border-gray-300 rounded-lg font-medium text-gray-600 hover:bg-gray-100 transition-colors"},i(u.value>1?"Back":"Cancel"),1),t("div",Qe,[u.value<3?(a(),n("button",{key:0,onClick:e[3]||(e[3]=s=>u.value++),disabled:!l.value||u.value===2&&!j.value,class:F(["px-6 py-2 rounded-lg font-medium transition-all duration-300",!l.value||u.value===2&&!j.value?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-gradient-to-r from-purple-600 to-blue-500 text-white hover:from-purple-500 hover:to-blue-400"])}," Continue ",10,Ye)):(a(),n("button",{key:1,onClick:R,class:"px-6 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg font-medium hover:from-green-400 hover:to-emerald-500 transition-all duration-300"},e[23]||(e[23]=[t("span",{class:"relative inline-flex items-center"},[t("span",null,"Complete Order"),t("svg",{class:"w-5 h-5 ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})])],-1)])))])])])])])])):_("",!0),U(t("div",{class:F(["fixed bottom-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg transform transition-all duration-500 ease-in-out",y.value?"translate-y-20 opacity-0":"translate-y-0 opacity-100"])},e[25]||(e[25]=[t("div",{class:"flex items-center space-x-2"},[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})]),t("span",null,"Order completed successfully!")],-1)]),2),[[W,y.value===!1&&u.value===1]])]))}},Ue=X(He,[["__scopeId","data-v-15cd5660"]]);export{Ue as default};
