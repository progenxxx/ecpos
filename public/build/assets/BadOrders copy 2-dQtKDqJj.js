import{d as _,s as f,k as E,l as R,G as C,c as B,w as v,C as A,o as w,a as s,e as U,b as y,f as L,j as x,v as h,u as O,N as I}from"./app-BNibTCyr.js";import{_ as V}from"./AdminPanel-mtITC6Fj.js";import{_ as j}from"./Main-P_HY-ap9.js";import{_ as M}from"./MultiSelectDropdown-DL4nKWpb.js";import{T as W}from"./TableContainer-CuVhNmKS.js";import{j as q,P as F,D}from"./dataTables-Re_5fNvq.js";import"./buttons.print-DoiKEMkH.js";import{E as P}from"./exceljs.min-cUCnwqRh.js";import"./RetailGroup-aZWFSXoe.js";import"./Logout-CW2hOaSD.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                             */import"./Modal-BIe7acJJ.js";import"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-BwnXT4mO.js";import"./RetailItems-B7IK_33H.js";import"./Attendance-CU-uXiMC.js";import"./PartyCake143-BDE_MQ95.js";const $={class:"mb-4 flex flex-wrap gap-4 p-4 bg-white rounded-lg shadow z-[999]"},Y={key:0,class:"flex-1 min-w-[200px]"},G={class:"flex-1 min-w-[200px]"},Q={class:"flex-1 min-w-[200px]"},z={class:"flex items-end"},ce={__name:"BadOrders copy 2",props:{bo:{type:Array,required:!0},stores:{type:Array,required:!0},userRole:{type:String,required:!0},filters:{type:Object,required:!0,default:()=>({startDate:"",endDate:"",selectedStores:[]})}},setup(m){window.$=window.jQuery=q,F.use(D);const n=_([]),r=_(""),l=_(""),i=m,g=f(()=>i.userRole.toUpperCase()==="STORE"?j:V);E(()=>{n.value=i.filters.selectedStores||[],r.value=i.filters.startDate||"",l.value=i.filters.endDate||""});const c=f(()=>{let e=[...i.bo];return n.value.length>0&&(e=e.filter(t=>n.value.includes(t.storename))),e}),o=f(()=>c.value.reduce((e,t)=>({throw_away:(e.throw_away||0)+parseFloat(t.throw_away||0),early_molds:(e.early_molds||0)+parseFloat(t.early_molds||0),pull_out:(e.pull_out||0)+parseFloat(t.pull_out||0),rat_bites:(e.rat_bites||0)+parseFloat(t.rat_bites||0),ant_bites:(e.ant_bites||0)+parseFloat(t.ant_bites||0)}),{throw_away:0,early_molds:0,pull_out:0,rat_bites:0,ant_bites:0})),k=[{data:"itemid",title:"Item ID",footer:"Grand Total"},{data:"itemname",title:"Item Name",footer:""},{data:"category",title:"Category",footer:""},{data:"storename",title:"Store Name",footer:""},{data:"batchdate",title:"Batch Date",render:e=>e?new Date(e).toLocaleDateString():"",footer:""},{data:"waste_declaration_date",title:"Waste Declaration Date",render:e=>e?new Date(e).toLocaleDateString():"",footer:""},{data:"throw_away",title:"THROW AWAY",render:e=>{const t=parseFloat(e||0);return isNaN(t)?"0.00":t.toFixed(2)},footer:function(){const e=o.value.throw_away||0;return parseFloat(e).toFixed(2)}},{data:"early_molds",title:"EARLY MOLDS",render:e=>{const t=parseFloat(e||0);return isNaN(t)?"0.00":t.toFixed(2)},footer:function(){const e=o.value.early_molds||0;return parseFloat(e).toFixed(2)}},{data:"pull_out",title:"PULL OUT",render:e=>{const t=parseFloat(e||0);return isNaN(t)?"0.00":t.toFixed(2)},footer:function(){const e=o.value.pull_out||0;return parseFloat(e).toFixed(2)}},{data:"rat_bites",title:"RAT BITES",render:e=>{const t=parseFloat(e||0);return isNaN(t)?"0.00":t.toFixed(2)},footer:function(){const e=o.value.rat_bites||0;return parseFloat(e).toFixed(2)}},{data:"ant_bites",title:"ANT BITES",render:e=>{const t=parseFloat(e||0);return isNaN(t)?"0.00":t.toFixed(2)},footer:function(){const e=o.value.ant_bites||0;return parseFloat(e).toFixed(2)}}],S={responsive:!0,order:[[3,"asc"]],pageLength:25,dom:"Bfrtip",scrollX:!0,scrollY:"50vh",buttons:["copy",{text:"Export Excel",action:function(e,t,a,d){N()}},"pdf","print"],drawCallback:function(e){const a=new D.Api(e).table().footer().querySelectorAll("td, th");[6,7,8,9,10].forEach((d,u)=>{const T=o.value[["throw_away","early_molds","pull_out","rat_bites","ant_bites"][u]];a[d]&&(a[d].textContent=T.toFixed(2))})}},N=()=>{const e=new P.Workbook,t=e.addWorksheet("BO Data");t.columns=[{header:"Item ID",key:"itemid"},{header:"Item Name",key:"itemname"},{header:"Category",key:"category"},{header:"Store Name",key:"storename"},{header:"Batch Date",key:"batchdate"},{header:"Waste Declaration Date",key:"waste_declaration_date"},{header:"Throw Away",key:"throw_away"},{header:"Early Molds",key:"early_molds"},{header:"Pull Out",key:"pull_out"},{header:"Rat Bites",key:"rat_bites"},{header:"Ant Bites",key:"ant_bites"}],c.value.forEach(a=>{t.addRow({itemid:a.itemid,itemname:a.itemname,category:a.category,storename:a.storename,batchdate:a.batchdate?new Date(a.batchdate).toLocaleDateString():"",waste_declaration_date:a.waste_declaration_date?new Date(a.waste_declaration_date).toLocaleDateString():"",throw_away:(a.throw_away||0).toFixed(2),early_molds:(a.early_molds||0).toFixed(2),pull_out:(a.pull_out||0).toFixed(2),rat_bites:(a.rat_bites||0).toFixed(2),ant_bites:(a.ant_bites||0).toFixed(2)})}),t.addRow({itemid:"Total",itemname:"",category:"",storename:"",batchdate:"",waste_declaration_date:"",throw_away:o.value.throw_away.toFixed(2),early_molds:o.value.early_molds.toFixed(2),pull_out:o.value.pull_out.toFixed(2),rat_bites:o.value.rat_bites.toFixed(2),ant_bites:o.value.ant_bites.toFixed(2)}),e.xlsx.writeBuffer().then(a=>{const d=new Blob([a],{type:"application/octet-stream"}),u=document.createElement("a");u.href=URL.createObjectURL(d),u.download="bo_data.xlsx",u.click()})},b=()=>{if(r.value&&l.value&&new Date(r.value)>new Date(l.value)){alert("Start date cannot be later than end date"),r.value="",l.value="";return}I.get(route("reports.bo"),{startDate:r.value,endDate:l.value,stores:n.value},{preserveState:!0,preserveScroll:!0})};let p;return R([n,r,l],()=>{clearTimeout(p),p=setTimeout(b,500)},{deep:!0}),C(()=>{clearTimeout(p)}),(e,t)=>(w(),B(A(g.value),{"active-tab":"REPORTS"},{main:v(()=>[s("div",$,[m.userRole.toUpperCase()==="ADMIN"||m.userRole.toUpperCase()==="SUPERADMIN"?(w(),U("div",Y,[y(M,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=a=>n.value=a),options:m.stores,label:"Stores"},null,8,["modelValue","options"])])):L("",!0),s("div",G,[t[4]||(t[4]=s("label",{class:"block text-sm font-medium text-gray-700"},"Start Date",-1)),x(s("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=a=>r.value=a),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[h,r.value]])]),s("div",Q,[t[5]||(t[5]=s("label",{class:"block text-sm font-medium text-gray-700"},"End Date",-1)),x(s("input",{type:"date","onUpdate:modelValue":t[2]||(t[2]=a=>l.value=a),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[h,l.value]])]),s("div",z,[s("button",{onClick:t[3]||(t[3]=()=>{n.value=[],r.value="",l.value="",b()}),class:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-md"}," Clear Filters ")])]),y(W,null,{default:v(()=>[y(O(F),{data:c.value,columns:k,class:"w-full relative display",options:S},null,8,["data"])]),_:1})]),_:1}))}};export{ce as default};
