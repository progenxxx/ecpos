import{d as _,s as f,k as E,l as N,G as C,c as A,w as v,C as B,o as x,a as s,e as U,b,f as O,j as w,v as h,u as I,N as V}from"./app-PtKpDxL3.js";import{_ as L}from"./AdminPanel-Dy3tTlJm.js";import{_ as j}from"./Main-DKSZb6a-.js";import{_ as M}from"./MultiSelectDropdown-DdO8fiAS.js";import{T as q}from"./TableContainer-C1Xzxe5W.js";import{j as P,P as g,D as k}from"./dataTables-CPDq8Nfz.js";import"./buttons.print-BS6wUDff.js";import{E as W}from"./exceljs.min-B_5GxFvE.js";import"./RetailGroup-C1sh5lal.js";import"./Logout-ho77fkiB.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                             */import"./Modal-B0NwKHOQ.js";import"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-DMiA-fcE.js";import"./RetailItems-ozaKlTSo.js";import"./Attendance-CnJEetSN.js";import"./PartyCake143-BMnD1COm.js";const $={class:"mb-4 flex flex-wrap gap-4 p-4 bg-white rounded-lg shadow z-[999]"},Y={key:0,class:"flex-1 min-w-[200px]"},G={class:"flex-1 min-w-[200px]"},Q={class:"flex-1 min-w-[200px]"},z={class:"flex items-end"},pe={__name:"BadOrders copy",props:{bo:{type:Array,required:!0},stores:{type:Array,required:!0},userRole:{type:String,required:!0},filters:{type:Object,required:!0,default:()=>({startDate:"",endDate:"",selectedStores:[]})}},setup(m){window.$=window.jQuery=P,g.use(k);const i=_([]),r=_(""),l=_(""),n=m,D=f(()=>(console.log("userRole value:",n.userRole),console.log("Is Store?:",n.userRole.toUpperCase()==="STORE"),n.userRole.toUpperCase()==="STORE"?j:L));E(()=>{i.value=n.filters.selectedStores||[],r.value=n.filters.startDate||"",l.value=n.filters.endDate||""});const p=f(()=>{let e=[...n.bo];return i.value.length>0&&(e=e.filter(t=>i.value.includes(t.storename))),e}),o=f(()=>p.value.reduce((e,t)=>({throw_away:e.throw_away+Number(t.throw_away||0),early_molds:e.early_molds+Number(t.early_molds||0),pull_out:e.pull_out+Number(t.pull_out||0),rat_bites:e.rat_bites+Number(t.rat_bites||0),ant_bites:e.ant_bites+Number(t.ant_bites||0)}),{throw_away:0,early_molds:0,pull_out:0,rat_bites:0,ant_bites:0})),F=[{data:"itemid",title:"Item ID",footer:"Grand Total"},{data:"itemname",title:"Item Name",footer:""},{data:"storename",title:"Store Name",footer:""},{data:"throw_away",title:"THROW AWAY",render:e=>(e||0).toFixed(2),footer:function(){return o.value.throw_away.toFixed(2)}},{data:"early_molds",title:"EARLY MOLDS",render:e=>(e||0).toFixed(2),footer:function(){return o.value.early_molds.toFixed(2)}},{data:"pull_out",title:"PULL OUT",render:e=>(e||0).toFixed(2),footer:function(){return o.value.pull_out.toFixed(2)}},{data:"rat_bites",title:"RAT BITES",render:e=>(e||0).toFixed(2),footer:function(){return o.value.rat_bites.toFixed(2)}},{data:"ant_bites",title:"ANT BITES",render:e=>(e||0).toFixed(2),footer:function(){return o.value.ant_bites.toFixed(2)}}],T={responsive:!0,order:[[0,"asc"]],pageLength:25,dom:"Bfrtip",scrollX:!0,scrollY:"50vh",buttons:["copy",{text:"Export Excel",action:function(e,t,a,u){R()}},"pdf","print"],order:[[2,"asc"]],drawCallback:function(e){const a=new k.Api(e).table().footer().querySelectorAll("td, th");[3,4,5,6,7].forEach((u,d)=>{const S=o.value[["throw_away","early_molds","pull_out","rat_bites","ant_bites"][d]];a[u]&&(a[u].textContent=S.toFixed(2))})}},R=()=>{const e=new W.Workbook,t=e.addWorksheet("BO Data");t.columns=[{header:"Item ID",key:"itemid"},{header:"Item Name",key:"itemname"},{header:"Store Name",key:"storename"},{header:"Throw Away",key:"throw_away"},{header:"Early Molds",key:"early_molds"},{header:"Pull Out",key:"pull_out"},{header:"Rat Bites",key:"rat_bites"},{header:"Ant Bites",key:"ant_bites"}],p.value.forEach(a=>{t.addRow({itemid:a.itemid,itemname:a.itemname,storename:a.storename,throw_away:(a.throw_away||0).toFixed(2),early_molds:(a.early_molds||0).toFixed(2),pull_out:(a.pull_out||0).toFixed(2),rat_bites:(a.rat_bites||0).toFixed(2),ant_bites:(a.ant_bites||0).toFixed(2)})}),t.addRow({itemid:"Total",itemname:"",storename:"",throw_away:o.value.throw_away.toFixed(2),early_molds:o.value.early_molds.toFixed(2),pull_out:o.value.pull_out.toFixed(2),rat_bites:o.value.rat_bites.toFixed(2),ant_bites:o.value.ant_bites.toFixed(2)}),e.xlsx.writeBuffer().then(a=>{const u=new Blob([a],{type:"application/octet-stream"}),d=document.createElement("a");d.href=URL.createObjectURL(u),d.download="bo_data.xlsx",d.click()})},y=()=>{if(r.value&&l.value&&new Date(r.value)>new Date(l.value)){alert("Start date cannot be later than end date"),r.value="",l.value="";return}V.get(route("reports.bo"),{startDate:r.value,endDate:l.value,stores:i.value},{preserveState:!0,preserveScroll:!0})};let c;return N([i,r,l],()=>{clearTimeout(c),c=setTimeout(y,500)},{deep:!0}),C(()=>{clearTimeout(c)}),(e,t)=>(x(),A(B(D.value),{"active-tab":"REPORTS"},{main:v(()=>[s("div",$,[m.userRole.toUpperCase()==="ADMIN"||m.userRole.toUpperCase()==="SUPERADMIN"?(x(),U("div",Y,[b(M,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=a=>i.value=a),options:m.stores,label:"Stores"},null,8,["modelValue","options"])])):O("",!0),s("div",G,[t[4]||(t[4]=s("label",{class:"block text-sm font-medium text-gray-700"},"Start Date",-1)),w(s("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=a=>r.value=a),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[h,r.value]])]),s("div",Q,[t[5]||(t[5]=s("label",{class:"block text-sm font-medium text-gray-700"},"End Date",-1)),w(s("input",{type:"date","onUpdate:modelValue":t[2]||(t[2]=a=>l.value=a),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[h,l.value]])]),s("div",z,[s("button",{onClick:t[3]||(t[3]=()=>{i.value=[],r.value="",l.value="",y()}),class:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-md"}," Clear Filters ")])]),b(q,null,{default:v(()=>[b(I(g),{data:p.value,columns:F,class:"w-full relative display",options:T},null,8,["data"])]),_:1})]),_:1}))}};export{pe as default};
