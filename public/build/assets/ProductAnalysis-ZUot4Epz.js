import{C as P,r as R}from"./chart-8SaNzrGi.js";import{d as f,G as D,l as N,k as M,e as n,a as e,t as C,f as A,D as I,o as d}from"./app-Do8mhcc_.js";/* empty css                                                                        */import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";const z={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},B={class:"bg-white/80 rounded-3xl shadow-xl border border-blue-100/50 p-6 relative overflow-hidden hover:scale-[1.02] transition-all duration-300"},q={class:"relative z-10"},E={key:0,class:"text-red-500 text-sm mb-4"},F={key:1,class:"flex items-center justify-center h-[500px]"},V={key:2,class:"h-[500px] relative z-10"},H={class:"bg-white/80 rounded-3xl shadow-xl border border-blue-100/50 p-6 relative overflow-hidden hover:scale-[1.02] transition-all duration-300"},L={class:"relative z-10"},O={key:0,class:"text-red-500 text-sm mb-4"},Q={key:1,class:"flex items-center justify-center h-[500px]"},W={key:2,class:"h-[500px] relative z-10"},Z={__name:"ProductAnalysis",props:{selectedDateRange:{type:Object,required:!0},selectedStores:{type:Array,required:!0}},setup(S){P.register(...R);const c=S,v=f(null),y=f(null),g=f(!1),i=f(null);let u=null,b=null;const h=r=>{const t=Number(r);return new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(isNaN(t)?0:t)},x=(r,t=20)=>r.length>t?r.substring(0,t)+"...":r,w=(r,t,a,s=!0)=>{if(!r)return console.error("Canvas context not available"),null;(!Array.isArray(t)||!t.length)&&(console.warn(`No data available for ${a}`),t=[]);const l=[...t].sort((o,p)=>s?p.total_sales-o.total_sales:o.total_sales-p.total_sales),m={labels:l.map(o=>x(o.itemname)),datasets:[{label:"Quantity Sold",data:l.map(o=>Math.abs(Number(o.total_quantity)||0)),backgroundColor:s?"rgba(34, 197, 94, 0.6)":"rgba(239, 68, 68, 0.6)",borderColor:s?"rgb(34, 197, 94)":"rgb(239, 68, 68)",borderWidth:1,barPercentage:.7,yAxisID:"quantity"},{label:"Sales Amount",data:l.map(o=>Math.abs(Number(o.total_sales)||0)),backgroundColor:s?"rgba(59, 130, 246, 0.6)":"rgba(249, 115, 22, 0.6)",borderColor:s?"rgb(59, 130, 246)":"rgb(249, 115, 22)",borderWidth:1,barPercentage:.7,yAxisID:"sales"}]};return new P(r,{type:"bar",data:m,options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{title:{display:!0,text:a,font:{size:16,weight:"bold"}},legend:{position:"top",labels:{boxWidth:20,padding:15}},tooltip:{callbacks:{label:o=>{const p=o.raw;return o.datasetIndex===0?`Quantity: ${Math.round(p).toLocaleString()} units`:`Sales: ${h(p)}`}}}},scales:{y:{beginAtZero:!0,ticks:{maxRotation:0,autoSkip:!1,callback:o=>x(o)}},quantity:{position:"bottom",beginAtZero:!0,ticks:{callback:o=>Math.round(o).toLocaleString()},grid:{drawOnChartArea:!1},title:{display:!0,text:"Quantity Sold"}},sales:{position:"top",beginAtZero:!0,ticks:{callback:o=>h(o)},grid:{drawOnChartArea:!1},title:{display:!0,text:"Sales Amount (PHP)"}}}}})},_=async()=>{var r,t;try{g.value=!0,i.value=null;const a={start_date:c.selectedDateRange.start_date,end_date:c.selectedDateRange.end_date,stores:c.selectedStores.map(l=>typeof l=="object"?l.NAME:l)};console.log("Fetching product data with payload:",a);const s=await I.post(route("get.top.bottom.products"),a);if(s.data&&!s.data.error){const l=((r=s.data.topProducts)==null?void 0:r["Illuminate\\Support\\Collection"])||[],m=((t=s.data.bottomProducts)==null?void 0:t["Illuminate\\Support\\Collection"])||[];console.log("Received top products:",l),console.log("Received bottom products:",m),k(l,m)}else throw new Error(s.data.error||"Failed to fetch product data")}catch(a){console.error("Error fetching product data:",a),i.value="Failed to load product data. Please try again.",k([],[])}finally{g.value=!1}},k=(r,t)=>{if(u&&u.destroy(),b&&b.destroy(),v.value){const a=v.value.getContext("2d");u=w(a,r,"Top 10 Products by Sales",!0)}if(y.value){const a=y.value.getContext("2d");b=w(a,t,"Bottom 10 Products by Sales",!1)}};return D(()=>{u&&u.destroy(),b&&b.destroy()}),N([()=>c.selectedDateRange,()=>c.selectedStores],()=>{_()},{deep:!0}),M(()=>{_()}),(r,t)=>(d(),n("div",z,[e("div",B,[t[2]||(t[2]=e("div",{class:"absolute inset-0 opacity-10 bg-green-100"},null,-1)),e("div",q,[t[1]||(t[1]=e("div",{class:"flex items-center mb-4"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 mr-3 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})]),e("h3",{class:"text-xl font-bold text-gray-800"},"Top Performing Products")],-1)),i.value?(d(),n("div",E,C(i.value),1)):A("",!0),g.value?(d(),n("div",F,t[0]||(t[0]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"},null,-1)]))):(d(),n("div",V,[e("canvas",{ref_key:"topProductsRef",ref:v},null,512)]))])]),e("div",H,[t[5]||(t[5]=e("div",{class:"absolute inset-0 opacity-10 bg-red-100"},null,-1)),e("div",L,[t[4]||(t[4]=e("div",{class:"flex items-center mb-4"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 mr-3 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"})]),e("h3",{class:"text-xl font-bold text-gray-800"},"Products Under Monitoring")],-1)),i.value?(d(),n("div",O,C(i.value),1)):A("",!0),g.value?(d(),n("div",Q,t[3]||(t[3]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-600"},null,-1)]))):(d(),n("div",W,[e("canvas",{ref_key:"bottomProductsRef",ref:y},null,512)]))])])]))}},K=j(Z,[["__scopeId","data-v-51fb212a"]]);export{K as default};
