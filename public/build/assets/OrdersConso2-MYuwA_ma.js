import{T as Y,s as b,d as x,p as L,c as j,w,C as G,o as U,b as v,a as r,i as F,j as C,v as N,u as g,n as z}from"./app-C8JQCepG.js";import{_ as V}from"./AdminPanel-C83M-2eE.js";import{_ as B}from"./Main-BsYVFM_n.js";import{T as H}from"./TableContainer-BxS68fI9.js";import{P as R,D as q}from"./dataTables-BLyeFFVl.js";import{_ as W}from"./TransparentButton-CNYk9D0u.js";import{_ as P}from"./SuccessButton-qfxsNTmK.js";import{S as J}from"./SearchColored-BsZ3adef.js";import{E as X}from"./Excel-D_H_MM39.js";import"./dataTables.fixedColumns-BdH3ZcDY.js";import{E as K}from"./exceljs.min-7N9mhf2L.js";import"./RetailGroup-DlwVVYvp.js";import"./Logout-aL1qiQHO.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                             */import"./Modal-BiiQ0EAt.js";import"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-KuC_yowt.js";import"./RetailItems-BPv8Qi4G.js";import"./Attendance-C9B-DZaj.js";import"./PartyCake143-_oRfmhRI.js";const Q={class:"absolute adjust"},Z={class:"flex justify-start items-center"},tt=["value"],et={"date-rangepicker":"",class:"flex items-center"},rt={class:"relative ml-5"},ot=["placeholder"],st={class:"relative"},at=["placeholder"],nt={props:{orders:{type:Array,required:!0,default:()=>[]}},computed:{flattenedOrders(){return this.calculateFlattenedOrders(this.orders)},grandTotal(){return this.flattenedOrders.reduce((c,I)=>c+(I.TOTAL||0),0)}},methods:{calculateFlattenedOrders(c){if(console.log("Calculating flattenedOrders"),console.log("Input orders:",c),!c||!Array.isArray(c))return console.error("Invalid orders data"),[];function I(i,l){if(!i.STOREID||!l.STOREID)return console.warn("Missing STOREID:",i,l),0;const E=i.STOREID.toString(),s=l.STOREID.toString();return!isNaN(E)&&!isNaN(s)?parseInt(E)-parseInt(s):E.localeCompare(s,void 0,{numeric:!0,sensitivity:"base"})}c.sort(I);const T=c.reduce((i,l)=>{if(l&&typeof l=="object"){const E=`${l.STOREID} - ${l.STORENAME}`,s=l.ITEMNAME||"",n=l.ITEMID||"",d=l.CATEGORY||"",f=l.COUNTED&&parseInt(l.COUNTED.trim())||0;i[s]||(i[s]={ITEMID:n,ITEMNAME:s,CATEGORY:d}),i[s][E]||(i[s][E]=0),i[s][E]+=f}return i},{}),u=Object.values(T).map(i=>{let l=0;const E={};return Object.keys(i).sort((s,n)=>{if(s==="ITEMID"||s==="ITEMNAME"||s==="CATEGORY")return-1;if(n==="ITEMID"||n==="ITEMNAME"||n==="CATEGORY")return 1;const d=s.split(" - ")[0],f=n.split(" - ")[0];return!isNaN(d)&&!isNaN(f)?parseInt(d)-parseInt(f):d.localeCompare(f,void 0,{numeric:!0,sensitivity:"base"})}).forEach(s=>{s!=="ITEMID"&&s!=="ITEMNAME"&&s!=="CATEGORY"&&(l+=i[s]),E[s]=i[s]}),{...E,TOTAL:l}});return console.log("Calculated flattenedOrders:",u),u},async exportToExcel(){console.log("Starting exportToExcel"),console.log("flattenedOrders:",this.flattenedOrders);try{if(!this.flattenedOrders||!Array.isArray(this.flattenedOrders)||this.flattenedOrders.length===0){console.error("No data to export");return}const c=new K.Workbook,I=c.addWorksheet("Flattened Orders"),T=[{header:"ITEMID",key:"ITEMID",width:20},{header:"ITEMNAME",key:"ITEMNAME",width:25},{header:"CATEGORY",key:"CATEGORY",width:20},{header:"TOTAL",key:"TOTAL",width:15}],u=new Set;this.flattenedOrders.forEach(n=>{n&&typeof n=="object"&&Object.keys(n).forEach(d=>{d!=="ITEMID"&&d!=="ITEMNAME"&&d!=="CATEGORY"&&d!=="TOTAL"&&u.add(d)})});const i=Array.from(u).sort((n,d)=>{const f=n.split(" - ")[0],y=d.split(" - ")[0];return!isNaN(f)&&!isNaN(y)?parseInt(f)-parseInt(y):f.localeCompare(y,void 0,{numeric:!0,sensitivity:"base"})});i.forEach(n=>{T.push({header:n,key:n,width:25})}),I.columns=T,this.flattenedOrders.forEach(n=>{if(n&&typeof n=="object"){const d={ITEMID:n.ITEMID||"",ITEMNAME:n.ITEMNAME||"",CATEGORY:n.CATEGORY||"",TOTAL:n.TOTAL||0};i.forEach(f=>{d[f]=n[f]||0}),I.addRow(d)}});const l=new Date,E=`FlattenedOrders_${l.getFullYear()}-${l.getMonth()+1}-${l.getDate()}.xlsx`,s=await c.xlsx.writeBuffer();this.saveExcelFile(s,E)}catch(c){console.error("Error exporting to Excel:",c)}},saveExcelFile(c,I){const T=new Blob([c],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),u=document.createElement("a");u.href=URL.createObjectURL(T),u.download=I,u.click()}}},At=Object.assign(nt,{__name:"OrdersConso2",props:{orders:{type:Array,required:!0},startDate:String,endDate:String,userRole:{type:String,required:!0}},setup(c,{emit:I}){R.use(q);const T=c,u=Y({StartDate:"",EndDate:""}),i=()=>{u.get(route("orderingconso.getrange"),{preserveScroll:!0})},l=b(()=>{var e,t;return console.log("userRole value:",T.userRole),console.log("Is Store?:",(((e=T.userRole)==null?void 0:e.toUpperCase())||"").toUpperCase()==="STORE"),(((t=T.userRole)==null?void 0:t.toUpperCase())||"")==="STORE"?B:V}),E=b(()=>T.orders.reduce((e,t)=>{const{STORENAME:a,ITEMID:o,ITEMNAME:p,CATEGORY:h,COUNTED:m,STOREID:O,stocks:A,movementstocks:$}=t,M=parseInt((m??"").trim(),10)||0;return e[o]||(e[o]={ITEMID:o,ITEMNAME:p,CATEGORY:h,stocks:parseInt(A)||0,movementstocks:parseInt($)||0,TOTAL:0}),e[o][a]||(e[o][a]={count:0,STOREID:O}),e[o][a].count+=M,e[o].TOTAL+=M,e},{})),s=b(()=>Object.values(E.value)),n=b(()=>{const e=new Set;return s.value.forEach(t=>{Object.keys(t).forEach(a=>{typeof t[a]=="object"&&t[a]!==null&&"count"in t[a]&&e.add(a)})}),Array.from(e).sort((t,a)=>{const o=t.split(" - ")[0],p=a.split(" - ")[0];return o.localeCompare(p,void 0,{numeric:!0,sensitivity:"base"})})}),d=b(()=>{const e={ITEMID:"Grand Total",ITEMNAME:"",CATEGORY:"",TOTAL:0};return n.value.forEach(t=>{e[t]=0}),s.value.forEach(t=>{e.TOTAL+=t.TOTAL,n.value.forEach(a=>{var o;e[a]+=((o=t[a])==null?void 0:o.count)||0})}),e}),f=b(()=>{const e=[{title:"ITEMID",data:"ITEMID",className:"frozen-column",footer:()=>d.value.ITEMID,width:"120px"},{title:"ITEMS",data:"ITEMNAME",className:"frozen-column",footer:()=>"",orderable:!0,width:"200px"},{title:"CATEGORY",data:"CATEGORY",className:"frozen-column",footer:()=>"",width:"120px"},{title:"TOTAL",data:"TOTAL",footer:()=>d.value.TOTAL}],t=[],a=new Set;return s.value.forEach(o=>{Object.entries(o).forEach(([p,h])=>{typeof h=="object"&&h!==null&&"count"in h&&"STOREID"in h&&(a.has(p)||(a.add(p),t.push({title:`${h.STOREID}<br>${p}`,data:p,render:(m,O)=>O==="sort"||O==="type"?(m==null?void 0:m.count)||0:O==="display"?`${(m==null?void 0:m.count)||0}`:(m==null?void 0:m.count)||0,footer:()=>d.value[p]})))})}),t.sort((o,p)=>{const h=o.title.split("<br>")[0],m=p.title.split("<br>")[0];return h.localeCompare(m,void 0,{numeric:!0,sensitivity:"base"})}),[...e,...t]}),y={paging:!1,scrollX:!0,scrollY:"60vh",scrollCollapse:!0,fixedColumns:{start:4},error:function(e,t,a){console.error("DataTables error:",t)},footerCallback:function(e,t,a,o,p){const m=this.api().table().footer().querySelectorAll("th");f.value.forEach((O,A)=>{O.footer&&(m[A].textContent=O.footer())})}},k=x(null),D=b(()=>{const e=g(k);if(e){const t=new Date(e),a=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),p=String(t.getDate()).padStart(2,"0");return`${a}-${o}-${p}`}return""}),_=x(null),S=b(()=>{const e=g(_);if(e){const t=new Date(e),a=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),p=String(t.getDate()).padStart(2,"0");return`${a}-${o}-${p}`}return""});return b(()=>{const e=new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}${a}${o}`}),(e,t)=>{const a=L("InputError");return U(),j(G(l.value),{"active-tab":"REPORTS"},{main:w(()=>[v(H,null,{default:w(()=>[r("div",Q,[r("div",Z,[r("form",{onSubmit:F(i,["prevent"]),class:"px-2 py-3 max-h-[50vh] lg:max-h-[70vh] overflow-y-auto"},[r("input",{type:"hidden",name:"_token",value:e.$page.props.csrf_token},null,8,tt),r("div",et,[r("div",rt,[t[4]||(t[4]=r("div",{class:"flex absolute inset-y-0 left-0 items-center pl-3 pointer-events-none"},[r("svg",{class:"w-5 h-5 text-gray-500 dark:text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[r("path",{"fill-rule":"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z","clip-rule":"evenodd"})])],-1)),C(r("input",{id:"StartDate",type:"date","onUpdate:modelValue":t[0]||(t[0]=o=>g(u).StartDate=o),onInput:t[1]||(t[1]=(...o)=>D.value&&D.value(...o)),placeholder:D.value,class:"bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",required:""},null,40,ot),[[N,g(u).StartDate]]),v(a,{message:g(u).errors.StartDate,class:"mt-2"},null,8,["message"])]),t[6]||(t[6]=r("span",{class:"mx-4 text-gray-500"},"to",-1)),r("div",st,[t[5]||(t[5]=r("div",{class:"flex absolute inset-y-0 left-0 items-center pl-3 pointer-events-none"},[r("svg",{class:"w-5 h-5 text-gray-500 dark:text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[r("path",{"fill-rule":"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z","clip-rule":"evenodd"})])],-1)),C(r("input",{id:"EndDate",type:"date","onUpdate:modelValue":t[2]||(t[2]=o=>g(u).EndDate=o),onInput:t[3]||(t[3]=(...o)=>S.value&&S.value(...o)),placeholder:S.value,class:"bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",required:""},null,40,at),[[N,g(u).EndDate]]),v(a,{message:g(u).errors.EndDate,class:"mt-2"},null,8,["message"])])])],32),v(W,{type:"submit",onClick:i,disabled:g(u).processing,class:z({"opacity-25":g(u).processing})},{default:w(()=>[v(J,{class:"h-8"})]),_:1},8,["disabled","class"]),t[7]||(t[7]=r("details",{className:"dropdown"},[r("summary",{className:"btn m-1 !bg-navy !text-white"},"TYPES"),r("ul",{className:"menu dropdown-content !bg-gray-100 rounded-box z-[1] w-52 p-2 shadow"},[r("li",null,[r("a",{href:"/orderingconso2"},"BW PRODUCTS")]),r("li",null,[r("a",{href:"/warehouse-daterange"},"WAREHOUSE")])])],-1)),t[8]||(t[8]=r("details",{className:"dropdown"},[r("summary",{className:"btn m-1 !bg-navy !text-white"},"RECENT"),r("ul",{className:"menu dropdown-content !bg-gray-100 rounded-box z-[1] w-52 p-2 shadow"},[r("li",null,[r("a",{href:"/lastmonth"},"Last Month")]),r("li",null,[r("a",{href:"/lastweek"},"Last Week")]),r("li",null,[r("a",{href:"/yesterday"},"Yesterday")])])],-1)),v(P,{type:"button",onClick:e.exportToExcel,class:"m-6 bg-green"},{default:w(()=>[v(X,{class:"h-4"})]),_:1},8,["onClick"])])]),v(g(R),{data:s.value,columns:f.value,class:"w-full relative display",options:y},{action:w(o=>t[9]||(t[9]=[r("div",{class:"flex justify-start"},null,-1)])),_:1},8,["data","columns"])]),_:1})]),_:1})}}});export{At as default};
