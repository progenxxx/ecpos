import{s as I,T as X,d as S,B as Q,p as Z,c as Y,w as y,C as ee,o as M,b as v,a as o,i as te,j as L,v as j,u as O,n as oe,e as N,F as re,h as se,t as ae,f as B,g as ne}from"./app-DwAHA_Mt.js";import{_ as le}from"./reset-BNxJkkNh.js";import{_ as ie}from"./AdminPanel-1DfNN1pO.js";import{_ as ue}from"./Main-CQ_whzxT.js";import{T as ce}from"./TableContainer-PwYTmfDA.js";import{P as G,D as de}from"./dataTables-7Vvj0GSY.js";import{_ as me}from"./SuccessButton-BWQ5NcUW.js";import{_ as pe}from"./TransparentButton-okQ3IpTB.js";import{_ as F}from"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-DsXaYi2t.js";import{E as fe}from"./Excel-Ccvbr3BQ.js";import{S as Ee}from"./SearchColored-Dh4Vn65K.js";import{R as Te}from"./Refresh-CodFNKVg.js";import{E as ge}from"./exceljs.min-Z3crVyW7.js";import"./DaisyModal-W0NxAgyd.js";import"./Modal-DosvBnh2.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                                   */import"./InputError-DMqsnpds.js";import"./FormComponent-DsXdn04S.js";import"./RetailGroup-ClNQ_vXI.js";import"./Logout-96D5XcFa.js";/* empty css                                                             */import"./RetailItems-i_spRMW5.js";import"./Attendance-CVSU-1NF.js";import"./PartyCake143-DpGG8J3p.js";const he={class:"absolute adjust"},ve={class:"flex justify-start items-center"},Ie=["value"],be={"date-rangepicker":"",class:"flex items-center"},Oe={class:"relative ml-5"},ye=["placeholder"],we={class:"relative"},Ae=["placeholder"],Me={class:"dropdown"},Se={key:0,class:"menu dropdown-content bg-gray-100 rounded-box z-[1] w-52 p-2 shadow overflow-y-auto max-h-[50vh]"},Ce=["value"],De={class:"custom-datatable"},xe={props:{orders:{type:Array,required:!0,default:()=>[]}},computed:{flattenedOrders(){return this.calculateFlattenedOrders(this.orders)},grandTotal(){return this.flattenedOrders.reduce((d,b)=>d+(b.TOTAL||0),0)}},methods:{calculateFlattenedOrders(d){if(console.log("Calculating flattenedOrders"),console.log("Input orders:",d),!d||!Array.isArray(d))return console.error("Invalid orders data"),[];function b(n,u){if(!n.STOREID||!u.STOREID)return console.warn("Missing STOREID:",n,u),0;const f=n.STOREID.toString(),s=u.STOREID.toString();return!isNaN(f)&&!isNaN(s)?parseInt(f)-parseInt(s):f.localeCompare(s,void 0,{numeric:!0,sensitivity:"base"})}d.sort(b);const T=d.reduce((n,u)=>{if(u&&typeof u=="object"){const f=`${u.STOREID} - ${u.STORENAME}`,s=u.ITEMNAME||"",l=u.ITEMID||"",c=u.CATEGORY||"",p=u.COUNTED&&parseInt(u.COUNTED.trim())||0;n[s]||(n[s]={ITEMID:l,ITEMNAME:s,CATEGORY:c}),n[s][f]||(n[s][f]=0),n[s][f]+=p}return n},{}),h=Object.values(T).map(n=>{let u=0;const f={};return Object.keys(n).sort((s,l)=>{if(s==="ITEMID"||s==="ITEMNAME"||s==="CATEGORY")return-1;if(l==="ITEMID"||l==="ITEMNAME"||l==="CATEGORY")return 1;const c=s.split(" - ")[0],p=l.split(" - ")[0];return!isNaN(c)&&!isNaN(p)?parseInt(c)-parseInt(p):c.localeCompare(p,void 0,{numeric:!0,sensitivity:"base"})}).forEach(s=>{s!=="ITEMID"&&s!=="ITEMNAME"&&s!=="CATEGORY"&&(u+=n[s]),f[s]=n[s]}),{...f,TOTAL:u}});return console.log("Calculated flattenedOrders:",h),h},async exportToExcel(){console.log("Starting exportToExcel"),console.log("flattenedOrders:",this.flattenedOrders);try{if(!this.flattenedOrders||!Array.isArray(this.flattenedOrders)||this.flattenedOrders.length===0){console.error("No data to export");return}const d=new ge.Workbook,b=d.addWorksheet("Flattened Orders"),T=[{header:"ITEMID",key:"ITEMID",width:20},{header:"ITEMNAME",key:"ITEMNAME",width:25},{header:"CATEGORY",key:"CATEGORY",width:20},{header:"TOTAL",key:"TOTAL",width:15}],h=new Set;this.flattenedOrders.forEach(l=>{l&&typeof l=="object"&&Object.keys(l).forEach(c=>{c!=="ITEMID"&&c!=="ITEMNAME"&&c!=="CATEGORY"&&c!=="TOTAL"&&h.add(c)})});const n=Array.from(h).sort((l,c)=>{const p=l.split(" - ")[0],A=c.split(" - ")[0];return!isNaN(p)&&!isNaN(A)?parseInt(p)-parseInt(A):p.localeCompare(A,void 0,{numeric:!0,sensitivity:"base"})});n.forEach(l=>{T.push({header:l,key:l,width:25})}),b.columns=T,this.flattenedOrders.forEach(l=>{if(l&&typeof l=="object"){const c={ITEMID:l.ITEMID||"",ITEMNAME:l.ITEMNAME||"",CATEGORY:l.CATEGORY||"",TOTAL:l.TOTAL||0};n.forEach(p=>{c[p]=l[p]||0}),b.addRow(c)}});const u=new Date,f=`FlattenedOrders_${u.getFullYear()}-${u.getMonth()+1}-${u.getDate()}.xlsx`,s=await d.xlsx.writeBuffer();this.saveExcelFile(s,f)}catch(d){console.error("Error exporting to Excel:",d)}},saveExcelFile(d,b){const T=new Blob([d],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),h=document.createElement("a");h.href=URL.createObjectURL(T),h.download=b,h.click()}}},ot=Object.assign(xe,{__name:"OrdersConso",props:{orders:{type:Array,required:!0},auth:{type:Object,required:!0},noorders:{type:Array,required:!0},userRole:{type:String,required:!0}},setup(d,{emit:b}){G.use(de);const T=d,h=I(()=>(console.log("userRole value:",T.userRole),console.log("Is Store?:",T.userRole.toUpperCase()==="STORE"),T.userRole.toUpperCase()==="STORE"?ue:ie)),n=X({StartDate:"",EndDate:""}),u=()=>{n.get(route("orderingconso.getrange"),{preserveScroll:!0})},f=I(()=>{const r=T.orders.reduce((t,E)=>{const{STORENAME:m,ITEMID:a,ITEMNAME:g,CATEGORY:w,COUNTED:H,STOREID:P,stocks:K,movementstocks:J}=E,$=parseInt((H??"").trim(),10)||0;return a==null||(t[a]||(t[a]={ITEMID:a,ITEMNAME:g,CATEGORY:w,stocks:parseInt(K)||0,movementstocks:parseInt(J)||0,TOTAL:0}),t[a][m]||(t[a][m]={count:0,STOREID:P}),t[a][m].count+=$,t[a].TOTAL+=$,t[a].BalanceCount=t[a].stocks-t[a].TOTAL),t},{}),e=Object.values(r),i=(t,E)=>{const m=t.ITEMID||"",a=E.ITEMID||"";if(m.startsWith("BW")&&a.startsWith("BW")){const g=parseInt(m.slice(2)),w=parseInt(a.slice(2));if(g<=10&&w<=10)return g-w;if(g<=10)return-1;if(w<=10)return 1}return m.localeCompare(a)};return e.sort(i)}),s=I(()=>Object.values(f.value)),l=I(()=>{const r=new Set;return s.value.forEach(e=>{Object.keys(e).forEach(i=>{typeof e[i]=="object"&&e[i]!==null&&"count"in e[i]&&r.add(i)})}),Array.from(r).sort((e,i)=>{const t=e.split(" - ")[0],E=i.split(" - ")[0];return t.localeCompare(E,void 0,{numeric:!0,sensitivity:"base"})})}),c=I(()=>{const r={ITEMID:"Grand Total",ITEMNAME:"",CATEGORY:"",movementstocks:0,stocks:0,BalanceCount:0,TOTAL:0};return l.value.forEach(e=>{r[e]=0}),s.value.forEach(e=>{r.TOTAL+=e.TOTAL,r.movementstocks+=e.movementstocks,r.stocks+=e.stocks,r.BalanceCount+=e.BalanceCount,l.value.forEach(i=>{var t;r[i]+=((t=e[i])==null?void 0:t.count)||0})}),r}),p=I(()=>{const r=[{title:"ITEMID",data:"ITEMID",className:"frozen-column",footer:()=>c.value.ITEMID,width:"120px"},{title:"ITEMS",data:"ITEMNAME",className:"frozen-column",footer:()=>"",orderable:!0,width:"200px"},{title:"CATEGORY",data:"CATEGORY",className:"frozen-column",footer:()=>"",width:"120px"},{title:"STOCKS(SYNC)",data:"stocks",className:"frozen-column",footer:()=>c.value.stocks,width:"100px"},{title:"REMAINING STOCKS",data:"BalanceCount",className:"frozen-column",footer:()=>c.value.BalanceCount,width:"150px"},{title:"TOTAL",data:"TOTAL",footer:()=>c.value.TOTAL}],e=[],i=new Set;return s.value.forEach(t=>{Object.entries(t).forEach(([E,m])=>{typeof m=="object"&&m!==null&&"count"in m&&"STOREID"in m&&(i.has(E)||(i.add(E),e.push({title:`${m.STOREID}<br>${E}`,data:E,render:(a,g)=>g==="sort"||g==="type"?(a==null?void 0:a.count)||0:g==="display"?`${(a==null?void 0:a.count)||0}`:(a==null?void 0:a.count)||0,footer:()=>c.value[E]})))})}),e.sort((t,E)=>{const m=t.title.split("<br>")[0],a=E.title.split("<br>")[0];return m.localeCompare(a,void 0,{numeric:!0,sensitivity:"base"})}),[...r,...e]}),A={paging:!1,scrollX:!0,scrollY:"60vh",scrollCollapse:!0,fixedColumns:{start:4},error:function(r,e,i){console.error("DataTables error:",e)},footerCallback:function(r,e,i,t,E){const a=this.api().table().footer().querySelectorAll("th");p.value.forEach((g,w)=>{g.footer&&(a[w].textContent=g.footer())})}},R=S(null),C=I(()=>{if(R.value){const r=new Date(R.value),e=r.getFullYear(),i=String(r.getMonth()+1).padStart(2,"0"),t=String(r.getDate()).padStart(2,"0");return`${e}-${i}-${t}`}return""}),k=S(null),D=I(()=>{if(k.value){const r=new Date(k.value),e=r.getFullYear(),i=String(r.getMonth()+1).padStart(2,"0"),t=String(r.getDate()).padStart(2,"0");return`${e}-${i}-${t}`}return""});I(()=>{const r=new Date,e=r.getFullYear(),i=String(r.getMonth()+1).padStart(2,"0"),t=String(r.getDate()).padStart(2,"0");return`${e}${i}${t}`});const x=S(!1),z=()=>{x.value=!0},U=()=>{x.value=!1},{user:V}=Q(T.auth),W=S(V.value.role),_=I(()=>W.value==="ADMIN"),q=()=>{window.confirm("Reset Stocks")?window.location.href="/getcurrentstocks":console.log("User cancelled the post operation.")};return(r,e)=>{const i=Z("InputError");return M(),Y(ee(h.value),{"active-tab":"REPORTS"},{modals:y(()=>[v(le,{"show-modal":x.value,onToggleActive:U},null,8,["show-modal"])]),main:y(()=>[v(ce,null,{default:y(()=>[o("div",he,[o("div",ve,[o("form",{onSubmit:te(u,["prevent"]),class:"px-2 py-3 max-h-[50vh] lg:max-h-[70vh] overflow-y-auto"},[o("input",{type:"hidden",name:"_token",value:r.$page.props.csrf_token},null,8,Ie),o("div",be,[o("div",Oe,[e[4]||(e[4]=o("div",{class:"flex absolute inset-y-0 left-0 items-center pl-3 pointer-events-none"},[o("svg",{class:"w-5 h-5 text-gray-500 dark:text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[o("path",{"fill-rule":"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z","clip-rule":"evenodd"})])],-1)),L(o("input",{id:"StartDate",type:"date","onUpdate:modelValue":e[0]||(e[0]=t=>O(n).StartDate=t),onInput:e[1]||(e[1]=(...t)=>C.value&&C.value(...t)),placeholder:C.value,class:"bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",required:""},null,40,ye),[[j,O(n).StartDate]]),v(i,{message:O(n).errors.StartDate,class:"mt-2"},null,8,["message"])]),e[6]||(e[6]=o("span",{class:"mx-4 text-gray-500"},"to",-1)),o("div",we,[e[5]||(e[5]=o("div",{class:"flex absolute inset-y-0 left-0 items-center pl-3 pointer-events-none"},[o("svg",{class:"w-5 h-5 text-gray-500 dark:text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[o("path",{"fill-rule":"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z","clip-rule":"evenodd"})])],-1)),L(o("input",{id:"EndDate",type:"date","onUpdate:modelValue":e[2]||(e[2]=t=>O(n).EndDate=t),onInput:e[3]||(e[3]=(...t)=>D.value&&D.value(...t)),placeholder:D.value,class:"bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",required:""},null,40,Ae),[[j,O(n).EndDate]]),v(i,{message:O(n).errors.EndDate,class:"mt-2"},null,8,["message"])])])],32),v(pe,{type:"submit",onClick:u,disabled:O(n).processing,class:oe({"opacity-25":O(n).processing})},{default:y(()=>[v(Ee,{class:"h-8"})]),_:1},8,["disabled","class"]),e[9]||(e[9]=o("details",{className:"dropdown"},[o("summary",{className:"btn m-1 !bg-navy !text-white"},"TYPES"),o("ul",{className:"menu dropdown-content !bg-gray-100 rounded-box z-[1] w-52 p-2 shadow"},[o("li",null,[o("a",{href:"/orderingconso"},"BW PRODUCTS")]),o("li",null,[o("a",{href:"/warehouse-reports"},"WAREHOUSE")])])],-1)),e[10]||(e[10]=o("details",{className:"dropdown"},[o("summary",{className:"btn m-1 !bg-navy !text-white"},"RECENT"),o("ul",{className:"menu dropdown-content !bg-gray-100 rounded-box z-[1] w-52 p-2 shadow"},[o("li",null,[o("a",{href:"/lastmonth"},"Last Month")]),o("li",null,[o("a",{href:"/lastweek"},"Last Week")]),o("li",null,[o("a",{href:"/yesterday"},"Yesterday")])])],-1)),o("details",Me,[e[7]||(e[7]=o("summary",{class:"btn m-1 bg-navy text-white"},"-",-1)),_.value?(M(),N("ul",Se,[(M(!0),N(re,null,se(d.noorders,t=>(M(),N("li",{key:t.NAME,value:t.NAME},[o("a",null,ae(t.NAME),1)],8,Ce))),128))])):B("",!0)]),v(me,{type:"button",onClick:r.exportToExcel,class:"m-6 bg-green"},{default:y(()=>[v(fe,{class:"h-4"})]),_:1},8,["onClick"]),v(F,{type:"button",onClick:z,class:"m-1 ml-2 !bg-navy p-10"},{default:y(()=>e[8]||(e[8]=[ne(" RESET ")])),_:1}),_.value?(M(),Y(F,{key:0,type:"button",onClick:q,class:"bg-red-900"},{default:y(()=>[v(Te,{class:"h-4"})]),_:1})):B("",!0)])]),o("div",De,[v(O(G),{data:s.value,columns:p.value,class:"w-full relative display",options:A},{action:y(t=>e[11]||(e[11]=[o("div",{class:"flex justify-start"},null,-1)])),_:1},8,["data","columns"])])]),_:1})]),_:1})}}});export{ot as default};
