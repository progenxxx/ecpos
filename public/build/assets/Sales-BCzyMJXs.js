import{d as v,q as b,k as S,l as _,c as B,w as V,B as G,o as R,a as m,e as q,b as F,f as L,j as T,v as h,u as M,N as j}from"./app-CacuESpm.js";import{_ as I}from"./AdminPanel-_h8KsVxO.js";import{_ as P}from"./Main-2jZhlWuC.js";import{_ as $}from"./MultiSelectDropdown-DQa9I4Ez.js";import{T as W}from"./TableContainer-D6l808Wc.js";import"./buttons.print-Tx47sh3R.js";import{P as w,D}from"./dataTables-BnFpA0RH.js";import{E as z}from"./exceljs.min-BdicTKAv.js";import"./RetailGroup-CN0qeRLj.js";import"./Logout-CqgzcP31.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                             */import"./Modal-CTDQd9c8.js";import"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-Oe7tEmQB.js";import"./RetailItems-CjOIxooj.js";import"./Attendance-B0jvDPeG.js";import"./PartyCake143-Di4gRlu7.js";const J={class:"mb-4 flex flex-wrap gap-4 p-4 bg-white rounded-lg shadow z-[999]"},X={key:0,class:"flex-1 min-w-[200px]"},Y={class:"flex-1 min-w-[200px]"},H={class:"flex-1 min-w-[200px]"},K={class:"flex items-end"},gt={__name:"Sales",props:{ec:{type:Array,required:!0},auth:{type:Object,required:!0},stores:{type:Array,required:!0},userRole:{type:String,required:!0},filters:{type:Object,required:!0,default:()=>({startDate:"",endDate:"",selectedStores:[]})}},setup(f){w.use(D);const r=v([]),s=v(""),n=v(""),l=f,k=b(()=>(console.log("userRole value:",l.userRole),console.log("Is Store?:",l.userRole.toUpperCase()==="STORE"),l.userRole.toUpperCase()==="STORE"?P:I));S(()=>{r.value=l.filters.selectedStores||[],s.value=l.filters.startDate||"",n.value=l.filters.endDate||""});const x=b(()=>{let e=[...l.ec];return r.value.length>0&&(e=e.filter(t=>r.value.includes(t.storename))),s.value&&n.value&&(e=e.filter(t=>{const a=new Date(t.createddate),d=new Date(s.value),p=new Date(n.value);return a>=d&&a<=p})),e}),i=v({grossamount:0,discamount:0,netamount:0,Vat:0,Vatablesales:0}),g=b(()=>r.value.length===0&&!s.value&&!n.value?{storename:"Grand Total",grossamount:i.value.grossamount,discamount:i.value.discamount,netamount:i.value.netamount,Vat:i.value.Vat,Vatablesales:i.value.Vatablesales}:x.value.reduce((e,t)=>({storename:"Grand Total",grossamount:e.grossamount+(parseFloat(t.grossamount)||0),discamount:e.discamount+(parseFloat(t.discamount)||0),netamount:e.netamount+(parseFloat(t.netamount)||0),Vat:e.Vat+(parseFloat(t.Vat)||0),Vatablesales:e.Vatablesales+(parseFloat(t.Vatablesales)||0)}),{storename:"Grand Total",grossamount:0,discamount:0,netamount:0,Vat:0,Vatablesales:0})),E=[{data:"storename",title:"STORE",footer:()=>"Grand Total"},{data:"grossamount",title:"GROSSAMOUNT",render:function(e){return(parseFloat(e)||0).toFixed(2)},footer:function(){return g.value.grossamount.toFixed(2)}},{data:"discamount",title:"DISCOUNT",render:function(e){return(parseFloat(e)||0).toFixed(2)},footer:function(){return g.value.discamount.toFixed(2)}},{data:"netamount",title:"NETSALES",render:function(e){return(parseFloat(e)||0).toFixed(2)},footer:function(){return g.value.netamount.toFixed(2)}}];b(()=>x.value.reduce((e,t)=>({grossamount:e.grossamount+(parseFloat(t.grossamount)||0),discamount:e.discamount+(parseFloat(t.discamount)||0),netamount:e.netamount+(parseFloat(t.netamount)||0),Vat:e.Vat+(parseFloat(t.Vat)||0),Vatablesales:e.Vatablesales+(parseFloat(t.Vatablesales)||0)}),{grossamount:0,discamount:0,netamount:0,Vat:0,Vatablesales:0}));const C={responsive:!0,order:[[0,"asc"]],pageLength:25,dom:"Bfrtip",scrollX:!0,scrollY:"50vh",buttons:["copy",{text:"Export Excel",action:function(e,t,a,d){N()}},"pdf","print"],order:[[2,"asc"]],drawCallback:function(e){const a=new D.Api(e).table().footer().querySelectorAll("td, th");a[0]&&(a[0].textContent="Grand Total"),["grossamount","discamount","netamount"].forEach((p,o)=>{const c=g.value[p],u=a[o+1];u&&typeof c=="number"&&(u.textContent=c.toFixed(2))})}},N=()=>{const e=new z.Workbook,t=e.addWorksheet("Sales Data");t.columns=[{header:"STORE",key:"storename",width:15},{header:"GROSSAMOUNT",key:"grossamount",width:15},{header:"DISCOUNT",key:"discamount",width:15},{header:"NETSALES",key:"netamount",width:15}],t.getRow(1).font={bold:!0},t.getRow(1).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE0E0E0"}};const a={grossamount:0,discamount:0,netamount:0};x.value.forEach(o=>{t.addRow({storename:o.storename,grossamount:Number(o.grossamount||0),discamount:Number(o.discamount||0),netamount:Number(o.netamount||0)}),a.grossamount+=Number(o.grossamount||0),a.discamount+=Number(o.discamount||0),a.netamount+=Number(o.netamount||0)}),t.addRow([]);const d=t.addRow({storename:"Total",grossamount:a.grossamount,discamount:a.discamount,netamount:a.netamount});d.font={bold:!0},d.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF0F0F0"}};const p=["grossamount","discamount","netamount"];t.eachRow((o,c)=>{p.forEach(u=>{const O=t.getColumn(u),A=o.getCell(O.number);c>1&&(A.numFmt="#,##0.00")})}),e.xlsx.writeBuffer().then(o=>{const c=new Blob([o],{type:"application/octet-stream"}),u=document.createElement("a");u.href=URL.createObjectURL(c),u.download="sales_data.xlsx",u.click(),URL.revokeObjectURL(u.href)})},U=()=>{if(s.value&&n.value&&new Date(s.value)>new Date(n.value)){alert("Start date cannot be later than end date"),s.value="",n.value="";return}j.get(route("reports.sales"),{startDate:s.value,endDate:n.value,stores:r.value},{preserveState:!0,preserveScroll:!0})};let y;return _([r,s,n],()=>{clearTimeout(y),y=setTimeout(U,500)},{deep:!0}),S(()=>{i.value=l.ec.reduce((e,t)=>({grossamount:e.grossamount+(parseFloat(t.grossamount)||0),discamount:e.discamount+(parseFloat(t.discamount)||0),netamount:e.netamount+(parseFloat(t.netamount)||0),Vat:e.Vat+(parseFloat(t.Vat)||0),Vatablesales:e.Vatablesales+(parseFloat(t.Vatablesales)||0)}),{grossamount:0,discamount:0,netamount:0,Vat:0,Vatablesales:0})}),(e,t)=>(R(),B(G(k.value),{"active-tab":"REPORTS"},{main:V(()=>[m("div",J,[f.userRole.toUpperCase()==="ADMIN"||f.userRole.toUpperCase()==="SUPERADMIN"?(R(),q("div",X,[F($,{modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=a=>r.value=a),options:f.stores,label:"Stores"},null,8,["modelValue","options"])])):L("",!0),m("div",Y,[t[4]||(t[4]=m("label",{class:"block text-sm font-medium text-gray-700"},"Start Date",-1)),T(m("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=a=>s.value=a),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[h,s.value]])]),m("div",H,[t[5]||(t[5]=m("label",{class:"block text-sm font-medium text-gray-700"},"End Date",-1)),T(m("input",{type:"date","onUpdate:modelValue":t[2]||(t[2]=a=>n.value=a),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[h,n.value]])]),m("div",K,[m("button",{onClick:t[3]||(t[3]=()=>{r.value=[],s.value="",n.value=""}),class:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-md"}," Clear Filters ")])]),F(W,null,{default:V(()=>[F(M(w),{data:l.ec,columns:E,class:"w-full relative display",options:C},{action:V(a=>t[6]||(t[6]=[])),_:1},8,["data"])]),_:1})]),_:1}))}};export{gt as default};
