import{T as R,q as O,d as M,p as k,c as _,w as v,o as $,b as I,a as r,i as Y,j as x,v as S,u as E,n as j,t as A}from"./app-CacuESpm.js";import{_ as L}from"./AdminPanel-_h8KsVxO.js";import{T as G}from"./TableContainer-D6l808Wc.js";import{P as N,D as F}from"./dataTables-BnFpA0RH.js";import{_ as V}from"./TransparentButton-FiwfEw6H.js";import{_ as B}from"./SuccessButton-DPuuu4Kg.js";import{S as U}from"./SearchColored-ChHcvZS4.js";import{E as z}from"./Excel-BKQtxvYB.js";import{E as H}from"./exceljs.min-BdicTKAv.js";import"./RetailGroup-CN0qeRLj.js";import"./Logout-CqgzcP31.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                             */import"./Modal-CTDQd9c8.js";import"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-Oe7tEmQB.js";import"./RetailItems-CjOIxooj.js";import"./Attendance-B0jvDPeG.js";const q={class:"absolute adjust"},W={class:"flex justify-start items-center"},P=["value"],J={"date-rangepicker":"",class:"flex items-center"},X={class:"relative ml-5"},K=["placeholder"],Q={class:"relative"},Z=["placeholder"],tt={class:"font-bold text:navy font-xs"},et={props:{orders:{type:Array,required:!0,default:()=>[]}},computed:{flattenedOrders(){return this.calculateFlattenedOrders(this.orders)},grandTotal(){return this.flattenedOrders.reduce((d,g)=>d+(g.TOTAL||0),0)}},methods:{calculateFlattenedOrders(d){if(console.log("Calculating flattenedOrders"),console.log("Input orders:",d),!d||!Array.isArray(d))return console.error("Invalid orders data"),[];function g(l,n){if(!l.STOREID||!n.STOREID)return console.warn("Missing STOREID:",l,n),0;const f=l.STOREID.toString(),e=n.STOREID.toString();return!isNaN(f)&&!isNaN(e)?parseInt(f)-parseInt(e):f.localeCompare(e,void 0,{numeric:!0,sensitivity:"base"})}d.sort(g);const h=d.reduce((l,n)=>{if(n&&typeof n=="object"){const f=`${n.STOREID} - ${n.STORENAME}`,e=n.ITEMNAME||"",a=n.ITEMID||"",c=n.CATEGORY||"",u=n.COUNTED&&parseInt(n.COUNTED.trim())||0;l[e]||(l[e]={ITEMID:a,ITEMNAME:e,CATEGORY:c}),l[e][f]||(l[e][f]=0),l[e][f]+=u}return l},{}),i=Object.values(h).map(l=>{let n=0;const f={};return Object.keys(l).sort((e,a)=>{if(e==="ITEMID"||e==="ITEMNAME"||e==="CATEGORY")return-1;if(a==="ITEMID"||a==="ITEMNAME"||a==="CATEGORY")return 1;const c=e.split(" - ")[0],u=a.split(" - ")[0];return!isNaN(c)&&!isNaN(u)?parseInt(c)-parseInt(u):c.localeCompare(u,void 0,{numeric:!0,sensitivity:"base"})}).forEach(e=>{e!=="ITEMID"&&e!=="ITEMNAME"&&e!=="CATEGORY"&&(n+=l[e]),f[e]=l[e]}),{...f,TOTAL:n}});return console.log("Calculated flattenedOrders:",i),i},async exportToExcel(){console.log("Starting exportToExcel"),console.log("flattenedOrders:",this.flattenedOrders);try{if(!this.flattenedOrders||!Array.isArray(this.flattenedOrders)||this.flattenedOrders.length===0){console.error("No data to export");return}const d=new H.Workbook,g=d.addWorksheet("Flattened Orders"),h=[{header:"ITEMID",key:"ITEMID",width:20},{header:"ITEMNAME",key:"ITEMNAME",width:25},{header:"CATEGORY",key:"CATEGORY",width:20},{header:"TOTAL",key:"TOTAL",width:15}],i=new Set;this.flattenedOrders.forEach(a=>{a&&typeof a=="object"&&Object.keys(a).forEach(c=>{c!=="ITEMID"&&c!=="ITEMNAME"&&c!=="CATEGORY"&&c!=="TOTAL"&&i.add(c)})});const l=Array.from(i).sort((a,c)=>{const u=a.split(" - ")[0],y=c.split(" - ")[0];return!isNaN(u)&&!isNaN(y)?parseInt(u)-parseInt(y):u.localeCompare(y,void 0,{numeric:!0,sensitivity:"base"})});l.forEach(a=>{h.push({header:a,key:a,width:25})}),g.columns=h,this.flattenedOrders.forEach(a=>{if(a&&typeof a=="object"){const c={ITEMID:a.ITEMID||"",ITEMNAME:a.ITEMNAME||"",CATEGORY:a.CATEGORY||"",TOTAL:a.TOTAL||0};l.forEach(u=>{c[u]=a[u]||0}),g.addRow(c)}});const n=new Date,f=`FlattenedOrders_${n.getFullYear()}-${n.getMonth()+1}-${n.getDate()}.xlsx`,e=await d.xlsx.writeBuffer();this.saveExcelFile(e,f)}catch(d){console.error("Error exporting to Excel:",d)}},saveExcelFile(d,g){const h=new Blob([d],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),i=document.createElement("a");i.href=URL.createObjectURL(h),i.download=g,i.click()}}},It=Object.assign(et,{__name:"OrdersConso2 copy 4",props:{orders:{type:Array,required:!0},startDate:String,endDate:String},setup(d,{emit:g}){N.use(F);const h=d,i=R({StartDate:"",EndDate:""}),l=()=>{i.get(route("orderingconso.getrange"),{preserveScroll:!0})},n={paging:!1,scrollX:!0,scrollY:"60vh",scrollCollapse:!0,error:function(o,t,p){console.error("DataTables error:",t)}},f=O(()=>h.orders.reduce((o,t)=>{const{STORENAME:p,ITEMID:s,ITEMNAME:m,CATEGORY:T,COUNTED:b,STOREID:C}=t,w=parseInt((b??"").trim(),10)||0;return o[s]||(o[s]={ITEMID:s,ITEMNAME:m,CATEGORY:T,TOTAL:0}),o[s][p]||(o[s][p]={count:0,STOREID:C}),o[s][p].count+=w,o[s].TOTAL+=w,o},{})),e=O(()=>Object.values(f.value)),a=O(()=>{const o=[{title:"ITEMID",data:"ITEMID"},{title:"ITEMS",data:"ITEMNAME"},{title:"CATEGORY",data:"CATEGORY"},{title:"TOTAL",data:"TOTAL"}],t=[],p=new Set;return e.value.forEach(s=>{Object.entries(s).forEach(([m,T])=>{typeof T=="object"&&T!==null&&"count"in T&&"STOREID"in T&&(p.has(m)||(p.add(m),t.push({title:`${T.STOREID}<br>${m}`,data:m,render:b=>(b==null?void 0:b.count)||0})))})}),t.sort((s,m)=>{const T=s.title.split("<br>")[0],b=m.title.split("<br>")[0];return T.localeCompare(b,void 0,{numeric:!0,sensitivity:"base"})}),[...o,...t]}),c=M(null),u=O(()=>{const o=E(c);if(o){const t=new Date(o),p=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),m=String(t.getDate()).padStart(2,"0");return`${p}-${s}-${m}`}return""}),y=M(null),D=O(()=>{const o=E(y);if(o){const t=new Date(o),p=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),m=String(t.getDate()).padStart(2,"0");return`${p}-${s}-${m}`}return""});return O(()=>{const o=new Date,t=o.getFullYear(),p=String(o.getMonth()+1).padStart(2,"0"),s=String(o.getDate()).padStart(2,"0");return`${t}${p}${s}`}),(o,t)=>{const p=k("InputError");return $(),_(L,{"active-tab":"REPORTS"},{main:v(()=>[I(G,null,{default:v(()=>[r("div",q,[r("div",W,[r("form",{onSubmit:Y(l,["prevent"]),class:"px-2 py-3 max-h-[50vh] lg:max-h-[70vh] overflow-y-auto"},[r("input",{type:"hidden",name:"_token",value:o.$page.props.csrf_token},null,8,P),r("div",J,[r("div",X,[t[4]||(t[4]=r("div",{class:"flex absolute inset-y-0 left-0 items-center pl-3 pointer-events-none"},[r("svg",{class:"w-5 h-5 text-gray-500 dark:text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[r("path",{"fill-rule":"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z","clip-rule":"evenodd"})])],-1)),x(r("input",{id:"StartDate",type:"date","onUpdate:modelValue":t[0]||(t[0]=s=>E(i).StartDate=s),onInput:t[1]||(t[1]=(...s)=>u.value&&u.value(...s)),placeholder:u.value,class:"bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",required:""},null,40,K),[[S,E(i).StartDate]]),I(p,{message:E(i).errors.StartDate,class:"mt-2"},null,8,["message"])]),t[6]||(t[6]=r("span",{class:"mx-4 text-gray-500"},"to",-1)),r("div",Q,[t[5]||(t[5]=r("div",{class:"flex absolute inset-y-0 left-0 items-center pl-3 pointer-events-none"},[r("svg",{class:"w-5 h-5 text-gray-500 dark:text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[r("path",{"fill-rule":"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z","clip-rule":"evenodd"})])],-1)),x(r("input",{id:"EndDate",type:"date","onUpdate:modelValue":t[2]||(t[2]=s=>E(i).EndDate=s),onInput:t[3]||(t[3]=(...s)=>D.value&&D.value(...s)),placeholder:D.value,class:"bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",required:""},null,40,Z),[[S,E(i).EndDate]]),I(p,{message:E(i).errors.EndDate,class:"mt-2"},null,8,["message"])])])],32),I(V,{type:"submit",onClick:l,disabled:E(i).processing,class:j({"opacity-25":E(i).processing})},{default:v(()=>[I(U,{class:"h-8"})]),_:1},8,["disabled","class"]),t[7]||(t[7]=r("details",{className:"dropdown"},[r("summary",{className:"btn m-1 !bg-navy !text-white"},"RECENT"),r("ul",{className:"menu dropdown-content !bg-gray-100 rounded-box z-[1] w-52 p-2 shadow"},[r("li",null,[r("a",{href:"/lastmonth"},"Last Month")]),r("li",null,[r("a",{href:"/lastweek"},"Last Week")]),r("li",null,[r("a",{href:"/yesterday"},"Yesterday")])])],-1)),I(B,{type:"button",onClick:o.exportToExcel,class:"m-6 bg-green"},{default:v(()=>[I(z,{class:"h-4"})]),_:1},8,["onClick"]),r("p",tt,A(d.startDate)+" | "+A(d.endDate),1)])]),I(E(N),{data:e.value,columns:a.value,class:"w-full relative display",options:n},{action:v(s=>t[8]||(t[8]=[r("div",{class:"flex justify-start"},null,-1)])),_:1},8,["data","columns"])]),_:1})]),_:1})}}});export{It as default};
