import{d as c,s as g,k as N,e as n,a as l,t as a,F as p,h as b,f,n as I,D as M,o as i}from"./app-DwAHA_Mt.js";const G={class:"p-4"},L={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},P={class:"bg-white w-11/12 max-w-4xl max-h-[90vh] overflow-y-auto rounded-lg shadow-xl"},z={class:"flex justify-between items-center p-4 border-b"},V={key:0,class:"p-6 text-center"},A={key:1,class:"p-6 text-center text-red-600"},E={key:2,class:"p-6"},R={key:0},q={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},H=["onClick"],J={class:"font-bold"},K={key:1,class:"space-y-6"},Q={class:"text-xl font-bold mb-4"},T={class:"text-lg font-semibold mb-2"},U={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},W=["onClick"],X={class:"font-medium"},Y={class:"text-sm text-gray-600"},Z={key:2,class:"space-y-6"},ee={class:"font-semibold mb-2"},te={class:"space-y-2"},se={class:"border-t p-4 flex justify-between items-center"},le={class:"flex space-x-4"},oe=["disabled"],ae={__name:"MixAndMatch copy",setup(ne){const _=c([]),r=c(null),u=c({}),d=c(1),m=c(!1),y=c(!1),v=c(null),S=s=>{r.value=s,u.value={},d.value=2},k=g(()=>r.value?r.value.line_groups.map(s=>({...s,items:s.discount_lines||[],selected:u.value[s.linegroup]||[]})):[]),$=async()=>{y.value=!0,v.value=null;try{const s=await M.get("/mix-match/discounts");_.value=s.data}catch{v.value="Failed to load discounts. Please try again."}finally{y.value=!1}},j=(s,t)=>{u.value[t.linegroup]||(u.value[t.linegroup]=[]);const e=u.value[t.linegroup],o=e.findIndex(C=>C.id===s.id);o>-1?e.splice(o,1):e.length<t.noofitemsneeded&&e.push(s),x.value&&(d.value=3)},B=(s,t)=>{var e;return((e=u.value[t])==null?void 0:e.some(o=>o.id===s.id))||!1},w=s=>{var e;return(((e=u.value[s.linegroup])==null?void 0:e.length)||0)===s.noofitemsneeded},x=g(()=>r.value?r.value.line_groups.every(s=>w(s)):!1),D=g(()=>Object.values(u.value).reduce((s,t)=>s+t.length,0)),O=g(()=>r.value?r.value.line_groups.reduce((s,t)=>s+t.noofitemsneeded,0):0),h=()=>{r.value=null,u.value={},d.value=1},F=async()=>{try{const s={discountId:r.value.id,items:Object.entries(u.value).map(([t,e])=>({groupId:t,items:e.map(o=>({id:o.id,itemid:o.itemid,linegroup:o.linegroup,dealpriceordiscpct:o.dealpriceordiscpct}))}))};await M.post("/api/mix-match/submit-order",s),m.value=!1,h()}catch{v.value="Failed to submit order. Please try again."}};return N($),(s,t)=>(i(),n("div",G,[l("button",{onClick:t[0]||(t[0]=e=>m.value=!0),class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md"}," Mix & Match Menu "),m.value?(i(),n("div",L,[l("div",P,[l("div",z,[t[5]||(t[5]=l("h2",{class:"text-2xl font-bold"},"Mix & Match Menu",-1)),l("button",{onClick:t[1]||(t[1]=e=>{m.value=!1,h()}),class:"text-gray-500 hover:text-gray-700"},t[4]||(t[4]=[l("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),y.value?(i(),n("div",V,t[6]||(t[6]=[l("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"},null,-1),l("p",{class:"mt-4"},"Loading discounts...",-1)]))):v.value?(i(),n("div",A,a(v.value),1)):(i(),n("div",E,[d.value===1?(i(),n("div",R,[t[7]||(t[7]=l("h3",{class:"text-xl font-bold mb-4"},"Select an Offer",-1)),l("div",q,[(i(!0),n(p,null,b(_.value,e=>(i(),n("div",{key:e.id,onClick:o=>S(e),class:"p-4 border rounded-lg cursor-pointer hover:bg-gray-50"},[l("h4",J,a(e.description),1)],8,H))),128))])])):f("",!0),d.value===2&&r.value?(i(),n("div",K,[l("h3",Q," Selected "+a(D.value)+" of "+a(O.value)+" items ",1),(i(!0),n(p,null,b(k.value,e=>(i(),n("div",{key:e.linegroup,class:"mb-8"},[l("h4",T,a(e.description||`Group ${e.linegroup}`)+" (Select "+a(e.noofitemsneeded)+") ",1),l("div",U,[(i(!0),n(p,null,b(e.items,o=>(i(),n("div",{key:o.id,onClick:C=>j(o,e),class:I(["border rounded-lg p-4 cursor-pointer",B(o,e.linegroup)?"bg-green-100 border-green-500":w(e)?"opacity-50 cursor-not-allowed":"hover:border-blue-500"])},[l("div",X,"Item: "+a(o.itemid),1),l("div",Y,a(o.dealpriceordiscpct)+" "+a(o.disctype===1?"%":"$"),1)],10,W))),128))])]))),128))])):f("",!0),d.value===3?(i(),n("div",Z,[t[8]||(t[8]=l("h3",{class:"text-xl font-bold mb-4"},"Review Selection",-1)),(i(!0),n(p,null,b(k.value,e=>(i(),n("div",{key:e.linegroup,class:"mb-4"},[l("h4",ee,a(e.description),1),l("div",te,[(i(!0),n(p,null,b(u.value[e.linegroup],o=>(i(),n("div",{key:o.id,class:"p-2 bg-gray-50 rounded"},a(o.itemid)+" - "+a(o.dealpriceordiscpct)+" "+a(o.disctype===1?"%":"P"),1))),128))])]))),128))])):f("",!0)])),l("div",se,[l("button",{onClick:t[2]||(t[2]=e=>d.value>1?d.value--:h()),class:"px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-md"},a(d.value>1?"Back":"Cancel"),1),l("div",le,[d.value<3?(i(),n("button",{key:0,onClick:t[3]||(t[3]=e=>d.value++),disabled:!r.value||d.value===2&&!x.value,class:I(["px-4 py-2 rounded-md",!r.value||d.value===2&&!x.value?"bg-gray-300 cursor-not-allowed":"bg-blue-500 text-white hover:bg-blue-600"])}," Next ",10,oe)):(i(),n("button",{key:1,onClick:F,class:"px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600"}," Complete Order "))])])])])):f("",!0)]))}};export{ae as default};
