import{q as ue,T as N,o as _,c as R,w as s,b as e,i as F,a as r,u as n,n as P,g as y,k as V,l as I,t as K,d as v,E as me,p as $,e as z,f as pe,F as ge}from"./app-CzESy9Lv.js";import{M as X}from"./DaisyModal-CeDlPpTN.js";import{_ as T}from"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-tx95LcV3.js";import{_ as O,a as x,b as j}from"./InputError-B0SuAqe_.js";import{F as Q}from"./FormComponent-CsOP5KWL.js";import{M as fe}from"./Modal-Cu8sf7v_.js";import{_ as ve}from"./SuccessButton-DKBnfmW3.js";import{_ as he}from"./Main-B2ZCzBDe.js";import{S as be}from"./Send-iKd2MbX1.js";import{A as we}from"./Add-CMD31NGK.js";import{T as G}from"./TableContainer-hEj8mAd2.js";import{P as A,D as Te}from"./dataTables-QNd6wg6V.js";/* empty css                                                                   */import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Logout-D0Up-vhm.js";/* empty css                                                             */import"./PartyCake143-CJZ7IykR.js";import"./Attendance-BoQw81K6.js";const Se={class:"grid grid-cols-1"},ye={class:"col-span-1"},Ee={class:"grid grid-cols-1 gap-4"},_e={__name:"Create",props:{showModal:{type:Boolean,default:!1}},setup(u,{emit:p}){ue(()=>$page.props.auth.user.storeid);const l=N({storeid:"",description:""}),t=()=>{l.post("/Received",{preserveScroll:!0,onSuccess:()=>l.reset()})},m=p,h=()=>{m("toggleActive")};return(g,i)=>(_(),R(X,{title:"GENERATE ORDER RECEIVED",onToggleActive:h,"show-modal":u.showModal},{content:s(()=>[e(Q,{onSubmit:F(t,["prevent"])},{default:s(()=>[r("div",Se,[r("div",ye,[r("div",Ee,[r("div",null,[e(O,{for:"STORE",value:"The system has been automatically generated with transfer order #"}),e(x,{id:"storeid",modelValue:n(l).storeid,"onUpdate:modelValue":i[0]||(i[0]=d=>n(l).storeid=d),type:"text",class:"mt-1 block w-full hidden","is-error":!!n(l).errors.storeid,value:g.$page.props.auth.user.storeid,autofocus:"",disabled:""},null,8,["modelValue","is-error","value"]),e(j,{message:n(l).errors.storeid,class:"mt-2"},null,8,["message"])])])])])]),_:1})]),buttons:s(()=>[e(T,{type:"submit",onClick:t,disabled:n(l).processing,class:P({"opacity-25":n(l).processing})},{default:s(()=>i[1]||(i[1]=[y(" Generate ")])),_:1},8,["disabled","class"])]),_:1},8,["show-modal"]))}},je={class:"col-span-6 sm:col-span-4"},De={class:"col-span-6 sm:col-span-4"},Ce={__name:"Update",props:{journalid:{type:[String,Number],required:!0},description:{type:[String,Number],required:!0},showModal:{type:Boolean,default:!1}},setup(u,{emit:p}){const l=u,t=N({journalid:"",description:""}),m=()=>{t.patch("/order/patch",{preserveScroll:!0})},h=p,g=()=>{h("toggleActive")};return V(()=>{t.journalid=l.journalid,t.description=l.description,I(()=>l.journalid,i=>{t.journalid=i}),I(()=>l.description,i=>{t.description=i})}),(i,d)=>(_(),R(X,{title:"Update Form",onToggleActive:g,"show-modal":u.showModal},{content:s(()=>[e(Q,{onSubmit:F(m,["prevent"])},{default:s(()=>[r("div",je,[e(O,{for:"journalid",value:"journalid"}),e(x,{id:"journalid",modelValue:n(t).journalid,"onUpdate:modelValue":d[0]||(d[0]=E=>n(t).journalid=E),type:"text",class:"mt-1 block w-full bg-blue-50","is-error":!!n(t).errors.journalid,disabled:""},null,8,["modelValue","is-error"]),e(j,{message:n(t).errors.journalid,class:"mt-2"},null,8,["message"])]),r("div",De,[e(O,{for:"description",value:"DESCRIPTION",class:"pt-4"}),e(x,{id:"description",modelValue:n(t).description,"onUpdate:modelValue":d[1]||(d[1]=E=>n(t).description=E),"is-error":!!n(t).errors.description,type:"text",class:"mt-1 block w-full"},null,8,["modelValue","is-error"]),e(j,{message:n(t).errors.description,class:"mt-2"},null,8,["message"])])]),_:1})]),buttons:s(()=>[e(T,{type:"submit",onClick:m,disabled:n(t).processing,class:P({"opacity-25":n(t).processing})},{default:s(()=>d[2]||(d[2]=[y(" UPDATE ")])),_:1},8,["disabled","class"])]),_:1},8,["show-modal"]))}},Me={class:"col-span-6 sm:col-span-4 font-thin text-sm px-1"},ke={__name:"Post",props:{journalid:{type:[String,Number],required:!0}},setup(u,{emit:p}){const l=u,t=N({journalid:l.journalid}),m=()=>{console.log("Submitting form..."),t.patch("/ItemOrders/post",{preserveScroll:!0,onSuccess:()=>{console.log("Form submission successful."),g()},onError:i=>{console.error("Form submission error:",i)}})},h=p,g=()=>{h("toggleActive")};return V(()=>{t.journalid=l.journalid,I(()=>l.journalid,i=>{t.journalid=i})}),(i,d)=>(_(),R(fe,{title:"Post all lines",onToggleActive:g,"show-modal":i.showModal},{content:s(()=>[r("form",{onSubmit:F(m,["prevent"]),class:"mt-3",method:"DELETE"},[r("div",Me," Are you sure you want to post all entries associated with data ID "+K(u.journalid)+"? ",1),e(j,{message:n(t).errors.ID,class:"mt-2"},null,8,["message"])],32)]),buttons:s(()=>[e(T,{type:"submit",onClick:m,disabled:n(t).processing,class:P({"opacity-25":n(t).processing})},{default:s(()=>d[0]||(d[0]=[y(" CONFIRM ")])),_:1},8,["disabled","class"])]),_:1},8,["show-modal"]))}},$e={key:0,class:"fixed inset-0 flex items-center justify-center z-50"},Ae={class:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded shadow-lg"},Ie={class:"absolute adjust"},Oe={class:"flex justify-start items-center"},xe={class:"flex justify-start"},Ne={class:"absolute adjust"},Re={class:"flex justify-start items-center"},oo={__name:"Index",props:{receivedordertables:{type:Array,required:!0},orders:{type:Array,required:!0}},setup(u){A.use(Te);const p=v(""),l=v(""),t=v(!1),m=v(!1),h=v(!1),g=v(!1),i=v(!1),d=u,E=[{data:"STOREID",title:"STOREID"},{data:"POSTEDDATETIME",title:"POSTEDDATETIME",render:function(a,o,c){return new Date(a).toLocaleDateString()}},{data:"ITEMID",title:"ITEMID"},{data:"COUNTED",title:"COUNTED"}],Z=[{data:"posted",title:"POSTED"},{data:"description",title:"TO #"},{data:"qty",title:"QTY"},{data:"createddatetime",title:"DATE"},{data:null,render:"#action",title:"ACTIONS"}],U={paging:!1,scrollX:!0,scrollY:"60vh",scrollCollapse:!0},ee=()=>{m.value=!0},oe=()=>{t.value=!1},te=()=>{m.value=!1},se=()=>{h.value=!1},re=()=>{g.value=!1},ne=()=>{i.value=!1},ae=a=>{console.log("Redirecting to Item Order Entries for account:",a),window.location.href=`/ReceivedItems/${a}`},le=async a=>{console.log("Starting post operation for journalId:",a);try{const o=document.querySelector('meta[name="csrf-token"]');if(console.log("CSRF Token found:",!!o),!o)throw new Error("CSRF token not found");console.log("Sending POST request to /post-receivedorder");const c=await fetch("/post-receivedorder",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":o.getAttribute("content")},body:JSON.stringify({journalid:a})}),w=await c.json();if(console.log("Server response:",w),!c.ok)throw new Error(`Server responded with status: ${c.status}, message: ${w.message||"Unknown error"}`);alert("Receive Order has been successfully posted!"),console.log("Reloading page after successful post"),location.reload()}catch(o){console.error("Post operation failed:",{error:o.message,stack:o.stack}),alert("Error posting and sending order: "+o.message)}};async function q(){if(!d.orders||d.orders.length===0){alert("No orders available to generate file.");return}const a=d.orders[0].STOREID;if(!a){alert("Store ID is missing from the order data.");return}const o=new Date(d.orders[0].POSTEDDATETIME);if(isNaN(o.getTime())){alert("Invalid posted date in the order data.");return}const c=`${o.getFullYear()}${(o.getMonth()+1).toString().padStart(2,"0")}${o.getDate().toString().padStart(2,"0")}`,w=`${a}${c}.txt`,C=`${a}|${o.toLocaleDateString()}`,S=d.orders.filter(b=>b.COUNTED>0).map(b=>`${b.ITEMID}|${Math.floor(b.COUNTED)}`);if(S.length===0){alert("No items with non-zero counts to report.");return}const M=[C,...S].join(`
`),de=c;try{const Y=await(await fetch("/save-file",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({content:M,filename:w,folderName:de})})).text();console.log("Full server response:",Y);let k;try{k=JSON.parse(Y)}catch(ce){console.error("Error parsing JSON:",ce),alert("Error: Server returned an invalid response. Please clear your cache!");return}k.success?(alert("Your order has been successfully sent to the head office!"),location.reload()):alert("Error saving file: "+(k.message||"Unknown error"))}catch(b){console.error("Error:",b),alert("Error saving file: "+b.message)}}const D=v(!1),W=v("");let f;const B=()=>{console.log("Starting warning sound"),f||(f=new Audio("/audio/warning.ogg"),f.loop=!0),f.play().then(()=>{console.log("Audio started playing")}).catch(a=>{console.error("Error playing audio:",a)})},H=()=>{f&&(f.pause(),f.currentTime=0)},J=()=>{const a=new Date,o=a.getHours(),c=a.getMinutes();console.log(`Checking time: ${o}:${c}`),(o===13&&c===32||o===16&&c===40)&&(console.log("Warning condition met!"),D.value=!0,W.value=a.toLocaleTimeString(),B())},ie=()=>{D.value=!1,H()};let L;return V(()=>{f=new Audio("/audio/warning.ogg"),f.loop=!0,L=setInterval(J,6e4),J()}),me(()=>{clearInterval(L),H()}),(a,o)=>{const c=$("SendModal"),w=$("More"),C=$("ExcelIcon");return _(),z(ge,null,[D.value?(_(),z("div",$e,[r("div",Ae,[o[0]||(o[0]=r("p",{class:"font-bold"},"Warning",-1)),r("p",null,"It's "+K(W.value)+"!",1),r("button",{onClick:ie,class:"mt-2 bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded"}," Close ")])])):pe("",!0),e(he,{"active-tab":"RECEIVE"},{modals:s(()=>[e(_e,{"show-modal":m.value,onToggleActive:te},null,8,["show-modal"]),e(Ce,{"show-modal":t.value,journalid:p.value,description:l.value,onToggleActive:oe},null,8,["show-modal","journalid","description"]),e(c,{"show-modal":h.value,"item-name":"inventjournaltables",journalid:p.value,onToggleActive:se},null,8,["show-modal","journalid"]),e(ke,{"show-modal":i.value,"item-name":"inventjournaltrans",journalid:p.value,onToggleActive:ne},null,8,["show-modal","journalid"]),e(w,{"show-modal":g.value,accountnum:a.accountnum,onToggleActive:re},null,8,["show-modal","accountnum"])]),main:s(()=>[e(G,null,{default:s(()=>[r("div",Ie,[r("div",Oe,[e(T,{type:"button",onClick:ee,class:"m-6 bg-navy"},{default:s(()=>[e(we,{class:"h-4"})]),_:1}),e(T,{class:"ml-5 cursor-pointer bg-navy hidden",onClick:q},{default:s(()=>[e(be,{class:"h-4"})]),_:1}),o[1]||(o[1]=r("label",{class:"inline-flex items-center font-bold"}," STOCK TRANSFER ",-1)),r("button",{onClick:B,hidden:""},"Start Warning Sound")])]),e(n(A),{data:u.receivedordertables,columns:Z,class:"w-full relative display",options:U},{action:s(S=>[r("div",xe,[e(T,{class:"cursor-pointer bg-navy",onClick:M=>ae(S.cellData.journalid)},{default:s(()=>o[2]||(o[2]=[y(" Received Items ")])),_:2},1032,["onClick"]),e(T,{class:"ml-5 cursor-pointer bg-red-900",onClick:M=>le(S.cellData.journalid)},{default:s(()=>o[3]||(o[3]=[y(" POST ")])),_:2},1032,["onClick"])])]),_:1},8,["data"])]),_:1}),e(G,{class:"hidden"},{default:s(()=>[r("div",Ne,[r("div",Re,[o[4]||(o[4]=y("           ")),r("button",{onClick:q},"Generate and Download Text File"),e(ve,{type:"button",onClick:a.exportToExcel,class:"m-6 bg-green"},{default:s(()=>[e(C,{class:"h-4"})]),_:1},8,["onClick"])])]),e(n(A),{data:u.orders,columns:E,class:"w-full relative display",options:U},{action:s(S=>o[5]||(o[5]=[r("div",{class:"flex justify-start"},null,-1)])),_:1},8,["data"])]),_:1})]),_:1})],64)}}};export{oo as default};
