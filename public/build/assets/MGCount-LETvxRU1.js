import{d as b,T as H,H as V,s as d,D as S,e as G,t as x,f as P,b as l,w as c,F as q,o as L,a as n,g as w,n as W,u as K}from"./app-C52hVfJY.js";import{_ as J}from"./AdminPanel-Lz0a11Ng.js";import{T as X}from"./TableContainer-DDO88sOS.js";import{P as _,D as Q}from"./dataTables-QVPD_hK-.js";import{_ as Z}from"./SuccessButton-B3gHjBgO.js";import{_ as O}from"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-B_t0RILE.js";import{_ as tt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{E as et}from"./Excel-BL63RD-V.js";import"./dataTables.fixedColumns-DO7uAJMq.js";import{E as ot}from"./exceljs.min-DNiw8cyP.js";import"./RetailGroup-B-ZKk-7u.js";import"./Logout-DjX50YFP.js";/* empty css                                                             */import"./Modal-Bw9dwv6a.js";import"./RetailItems-sFnzHpqc.js";import"./Attendance-DKYwb2tw.js";const at={key:0,class:"fixed top-5 right-5 bg-green-900 text-white border border-gray-300 rounded-lg shadow-lg p-4 z-50"},nt={class:"absolute adjust"},rt={class:"flex justify-start items-center"},st={class:"ml-2"},lt={class:"custom-datatable"},ut={__name:"MGCount",props:{orders:{type:Array,required:!0},routes:{type:String,required:!0}},setup(y,{emit:it}){_.use(Q);const R=b(!1),$=y;H({StartDate:"",EndDate:""});const k={paging:!1,scrollX:!0,scrollY:"60vh",scrollCollapse:!0,error:function(t,e,o){console.error("DataTables error:",e)},footerCallback:function(t,e,o,a,s){const E=this.api().table().footer().querySelectorAll("th");u.value.forEach((p,m)=>{p.footer&&(E[m].textContent=p.footer())})}},M=V($.orders.reduce((t,e)=>{const{STORENAME:o,ITEMID:a,ITEMNAME:s,CATEGORY:i,COUNTED:E,MGCOUNT:p}=e,m=parseInt(E)||0,h=parseInt(p)||0;return t[a]||(t[a]={ITEMID:a,ITEMNAME:s,CATEGORY:i,TOTAL:0,MGCount:h,BalanceCount:0}),t[a][o]||(t[a][o]=0),t[a][o]+=m,t[a].TOTAL+=m,t[a].BalanceCount=t[a].MGCount-t[a].TOTAL,t},{})),D=d(()=>Object.values(M)),C=d(()=>{const t=new Set;return D.value.forEach(e=>{Object.keys(e).forEach(o=>{o!=="ITEMID"&&o!=="ITEMNAME"&&o!=="CATEGORY"&&o!=="TOTAL"&&o!=="MGCount"&&o!=="BalanceCount"&&t.add(o)})}),t}),g=d(()=>{const t={ITEMID:"Grand Total",ITEMNAME:"",CATEGORY:"",MGCount:0,BalanceCount:0,TOTAL:0};return C.value.forEach(e=>{t[e]=0}),A.value.forEach(e=>{t.MGCount+=Number(e.MGCount)||0,t.BalanceCount+=Number(e.BalanceCount)||0,t.TOTAL+=Number(e.TOTAL)||0,C.value.forEach(o=>{t[o]+=Number(e[o])||0})}),t}),u=d(()=>[{title:"ITEMID",data:"ITEMID",className:"frozen-column",footer:()=>g.value.ITEMID},{title:"ITEMS",data:"ITEMNAME",className:"frozen-column",footer:()=>""},{title:"CATEGORY",data:"CATEGORY",className:"frozen-column",footer:()=>""},{title:"ACTUAL INV COUNT",data:"MGCount",className:"frozen-column",render:(t,e,o)=>e==="display"?`<input type="number" value="${t}" onchange="window.updateMGCount('${o.ITEMID}', this.value)" disabled/>`:t,footer:()=>g.value.MGCount},{title:"REMAINING STOCKS",data:"BalanceCount",className:"frozen-column",footer:()=>g.value.BalanceCount},{title:"TOTAL ALLOCATION",data:"TOTAL",className:"frozen-column",footer:()=>g.value.TOTAL},...Array.from(C.value).map(t=>({title:t,data:t,render:(e,o,a)=>o==="display"?`<input type="number" value="${e}" onchange="window.updateCounted('${a.ITEMID}', '${t}', this.value)" disabled/>`:e,footer:()=>g.value[t]}))]),F=b(!1),B=b("");window.updateMGCount=function(t,e){const o=M[t];o&&(o.MGCount=parseInt(e,10)||0,o.BalanceCount=o.MGCount-o.TOTAL,S.post("/api/update-mgcount",{itemId:t,mgCount:o.MGCount}).then(a=>{console.log("MGCount updated successfully")}).catch(a=>{console.error("Error updating MGCount:",a)}))},window.updateCounted=function(t,e,o){const a=M[t];a&&(a[e]=parseInt(o,10)||0,a.TOTAL=Array.from(C.value).reduce((s,i)=>s+(a[i]||0),0),a.BalanceCount=a.TOTAL-a.MGCount,S.post("/api/update-counted",{itemId:t,storeName:e,counted:a[e],total:a.TOTAL,balanceCount:a.BalanceCount}).then(s=>{console.log("Counted updated successfully")}).catch(s=>{console.error("Error updating Counted:",s)}))};const A=d(()=>D.value.map(t=>{const e={...t};return u.value.forEach(o=>{e.hasOwnProperty(o.data)||(e[o.data]="0")}),e})),I=b(null);d(()=>{if(I.value){const t=new Date(I.value),e=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${e}-${o}-${a}`}return""});const N=b(null);d(()=>{if(N.value){const t=new Date(N.value),e=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${e}-${o}-${a}`}return""}),d(()=>{const t=new Date,e=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${e}${o}${a}`});async function Y(){try{const t=new ot.Workbook,e=t.addWorksheet("Flattened Orders");e.columns=u.value.map(r=>({header:r.title,key:r.data,width:15})),e.addRow(u.value.map(r=>r.title));const o=A.value.filter(r=>Array.from(C.value).map(f=>r[f]||0).some(f=>f>0));o.forEach(r=>{const T=u.value.map(f=>{const v=r[f.data];return v??0});e.addRow(T)});const a=u.value.reduce((r,T)=>(T.footer&&(r[T.data]=o.reduce((f,v)=>f+(Number(v[T.data])||0),0)),r),{}),s=e.addRow(u.value.map(r=>r.footer?a[r.data]||0:""));s.font={bold:!0},s.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF7C0000"}},s.font={color:{argb:"FFDDDDDD"}},e.getRow(1).font={bold:!0},e.getRow(1).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}};const i=new Date,E=`FlattenedOrders_${i.getFullYear()}-${i.getMonth()+1}-${i.getDate()}.xlsx`,p=await t.xlsx.writeBuffer(),m=new Blob([p],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),h=document.createElement("a");h.href=URL.createObjectURL(m),h.download=E,h.click()}catch(t){console.error("Error exporting to Excel:",t)}}const z=()=>{window.location.href="/f-picklist"},U=()=>{window.location.href="/f-cakepicklist"},j=()=>{window.location.href="/special-orders"};return(t,e)=>(L(),G(q,null,[F.value?(L(),G("div",at,x(B.value),1)):P("",!0),l(J,{"active-tab":"INVENTORY"},{main:c(()=>[l(X,null,{default:c(()=>[n("div",nt,[n("div",rt,[l(Z,{type:"button",onClick:Y,class:"ml-6 bg-green"},{default:c(()=>[l(et,{class:"h-4"})]),_:1}),l(O,{type:"button",onClick:z,class:"m-1 bg-navy"},{default:c(()=>e[1]||(e[1]=[w(" NEWCOM ")])),_:1}),l(O,{type:"button",onClick:U,class:"m-1 bg-navy"},{default:c(()=>e[2]||(e[2]=[w(" OLDCOM ")])),_:1}),l(O,{type:"button",onClick:j,class:"ml-2 bg-navy"},{default:c(()=>e[3]||(e[3]=[w(" SPECIAL ORDER ")])),_:1}),l(O,{type:"button",onClick:e[0]||(e[0]=()=>{}),class:"ml-2 bg-navy"},{default:c(()=>e[4]||(e[4]=[w(" PARTYCAKES ")])),_:1}),e[5]||(e[5]=n("details",{className:"dropdown"},[n("summary",{className:"btn m-1"},"Select Route"),n("ul",{className:"menu dropdown-content bg-base-100 rounded-box z-[1] w-52 p-2 shadow"},[n("li",null,[n("a",{href:"/f-mgcount"},"ALL")]),n("li",null,[n("a",{href:"/f-south1"},"SOUTH 1")]),n("li",null,[n("a",{href:"/f-south2"},"SOUTH 2")]),n("li",null,[n("a",{href:"/f-south3"},"SOUTH 3")]),n("li",null,[n("a",{href:"/f-north1"},"NORTH 1")]),n("li",null,[n("a",{href:"/f-north2"},"NORTH 2")]),n("li",null,[n("a",{href:"/f-central"},"CENTRAL")]),n("li",null,[n("a",{href:"/f-east"},"EAST")])])],-1)),n("h6",st,x(y.routes),1)])]),n("div",lt,[n("div",{class:W({"blur-overlay":R.value})},[l(K(_),{data:A.value,columns:u.value,class:"w-full relative display",options:k},{action:c(o=>e[6]||(e[6]=[n("div",{class:"flex justify-start"},null,-1)])),_:1},8,["data","columns"])],2)])]),_:1})]),_:1})],64))}},yt=tt(ut,[["__scopeId","data-v-a044a4a6"]]);export{yt as default};
