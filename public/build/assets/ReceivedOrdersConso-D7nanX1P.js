import{s as I,T as H,d as D,B as P,p as J,c as _,w,C as X,o as k,b as v,a as r,i as K,j as $,v as Y,u as O,n as Q,f as Z}from"./app-CfytZ6uy.js";import{_ as ee}from"./reset-BDt9GNfx.js";import{_ as te}from"./AdminPanel-CL6jLfvg.js";import{_ as re}from"./Main-O7zX48KL.js";import{T as oe}from"./TableContainer-C_tye70S.js";import{P as L,D as se}from"./dataTables-BGy9-Y2a.js";import{_ as ae}from"./SuccessButton-6z4b7x98.js";import{_ as ne}from"./TransparentButton-DjGif6T8.js";import{_ as le}from"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-B1wW2mpq.js";import{E as ie}from"./Excel-PuI2PjVP.js";import{S as ue}from"./SearchColored-BpFv9lev.js";import{R as ce}from"./Refresh-CgrMiIcO.js";import{E as de}from"./exceljs.min-CpKGb2AC.js";import"./DaisyModal-B_tDraEE.js";import"./Modal-BPjbBi2X.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                                   */import"./InputError-CfJQ6Cin.js";import"./FormComponent-DKrwhaRF.js";import"./RetailGroup-2HMR2ftQ.js";import"./Logout-z3St95b0.js";/* empty css                                                             */import"./RetailItems-DVr2J4Jb.js";/* empty css                                                                */import"./Attendance-DXy5Tht_.js";import"./PartyCake143-CbFWaXlu.js";const pe={class:"absolute adjust"},fe={class:"flex justify-start items-center"},me=["value"],Ee={"date-rangepicker":"",class:"flex items-center"},Te={class:"relative ml-5"},he=["placeholder"],ge={class:"relative"},Ie=["placeholder"],ve={class:"custom-datatable"},be={props:{orders:{type:Array,required:!0,default:()=>[]}},computed:{flattenedOrders(){return this.calculateFlattenedOrders(this.orders)},grandTotal(){return this.flattenedOrders.reduce((d,b)=>d+(b.TOTAL||0),0)}},methods:{calculateFlattenedOrders(d){if(console.log("Calculating flattenedOrders"),console.log("Input orders:",d),!d||!Array.isArray(d))return console.error("Invalid orders data"),[];function b(n,u){if(!n.STOREID||!u.STOREID)return console.warn("Missing STOREID:",n,u),0;const m=n.STOREID.toString(),o=u.STOREID.toString();return!isNaN(m)&&!isNaN(o)?parseInt(m)-parseInt(o):m.localeCompare(o,void 0,{numeric:!0,sensitivity:"base"})}d.sort(b);const T=d.reduce((n,u)=>{if(u&&typeof u=="object"){const m=`${u.STOREID} - ${u.STORENAME}`,o=u.ITEMNAME||"",l=u.ITEMID||"",c=u.CATEGORY||"",f=u.COUNTED&&parseInt(u.COUNTED.trim())||0;n[o]||(n[o]={ITEMID:l,ITEMNAME:o,CATEGORY:c}),n[o][m]||(n[o][m]=0),n[o][m]+=f}return n},{}),g=Object.values(T).map(n=>{let u=0;const m={};return Object.keys(n).sort((o,l)=>{if(o==="ITEMID"||o==="ITEMNAME"||o==="CATEGORY")return-1;if(l==="ITEMID"||l==="ITEMNAME"||l==="CATEGORY")return 1;const c=o.split(" - ")[0],f=l.split(" - ")[0];return!isNaN(c)&&!isNaN(f)?parseInt(c)-parseInt(f):c.localeCompare(f,void 0,{numeric:!0,sensitivity:"base"})}).forEach(o=>{o!=="ITEMID"&&o!=="ITEMNAME"&&o!=="CATEGORY"&&(u+=n[o]),m[o]=n[o]}),{...m,TOTAL:u}});return console.log("Calculated flattenedOrders:",g),g},async exportToExcel(){console.log("Starting exportToExcel"),console.log("flattenedOrders:",this.flattenedOrders);try{if(!this.flattenedOrders||!Array.isArray(this.flattenedOrders)||this.flattenedOrders.length===0){console.error("No data to export");return}const d=new de.Workbook,b=d.addWorksheet("Flattened Orders"),T=[{header:"ITEMID",key:"ITEMID",width:20},{header:"ITEMNAME",key:"ITEMNAME",width:25},{header:"CATEGORY",key:"CATEGORY",width:20},{header:"TOTAL",key:"TOTAL",width:15}],g=new Set;this.flattenedOrders.forEach(l=>{l&&typeof l=="object"&&Object.keys(l).forEach(c=>{c!=="ITEMID"&&c!=="ITEMNAME"&&c!=="CATEGORY"&&c!=="TOTAL"&&g.add(c)})});const n=Array.from(g).sort((l,c)=>{const f=l.split(" - ")[0],A=c.split(" - ")[0];return!isNaN(f)&&!isNaN(A)?parseInt(f)-parseInt(A):f.localeCompare(A,void 0,{numeric:!0,sensitivity:"base"})});n.forEach(l=>{T.push({header:l,key:l,width:25})}),b.columns=T,this.flattenedOrders.forEach(l=>{if(l&&typeof l=="object"){const c={ITEMID:l.ITEMID||"",ITEMNAME:l.ITEMNAME||"",CATEGORY:l.CATEGORY||"",TOTAL:l.TOTAL||0};n.forEach(f=>{c[f]=l[f]||0}),b.addRow(c)}});const u=new Date,m=`FlattenedOrders_${u.getFullYear()}-${u.getMonth()+1}-${u.getDate()}.xlsx`,o=await d.xlsx.writeBuffer();this.saveExcelFile(o,m)}catch(d){console.error("Error exporting to Excel:",d)}},saveExcelFile(d,b){const T=new Blob([d],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),g=document.createElement("a");g.href=URL.createObjectURL(T),g.download=b,g.click()}}},Pe=Object.assign(be,{__name:"ReceivedOrdersConso",props:{orders:{type:Array,required:!0},auth:{type:Object,required:!0},noorders:{type:Array,required:!0},userRole:{type:String,required:!0}},setup(d,{emit:b}){L.use(se);const T=d,g=I(()=>(console.log("userRole value:",T.userRole),console.log("Is Store?:",T.userRole.toUpperCase()==="STORE"),T.userRole.toUpperCase()==="STORE"?re:te)),n=H({StartDate:"",EndDate:""}),u=()=>{n.get(route("receivedorderconso.getrange"),{preserveScroll:!0})},m=I(()=>{const s=T.orders.reduce((t,E)=>{const{STORENAME:p,ITEMID:a,ITEMNAME:h,CATEGORY:y,COUNTED:V,STOREID:z,stocks:W,movementstocks:q}=E,R=parseInt((V??"").trim(),10)||0;return a==null||(t[a]||(t[a]={ITEMID:a,ITEMNAME:h,CATEGORY:y,stocks:parseInt(W)||0,movementstocks:parseInt(q)||0,TOTAL:0}),t[a][p]||(t[a][p]={count:0,STOREID:z}),t[a][p].count+=R,t[a].TOTAL+=R,t[a].BalanceCount=t[a].stocks-t[a].TOTAL),t},{}),e=Object.values(s),i=(t,E)=>{const p=t.ITEMID||"",a=E.ITEMID||"";if(p.startsWith("BW")&&a.startsWith("BW")){const h=parseInt(p.slice(2)),y=parseInt(a.slice(2));if(h<=10&&y<=10)return h-y;if(h<=10)return-1;if(y<=10)return 1}return p.localeCompare(a)};return e.sort(i)}),o=I(()=>Object.values(m.value)),l=I(()=>{const s=new Set;return o.value.forEach(e=>{Object.keys(e).forEach(i=>{typeof e[i]=="object"&&e[i]!==null&&"count"in e[i]&&s.add(i)})}),Array.from(s).sort((e,i)=>{const t=e.split(" - ")[0],E=i.split(" - ")[0];return t.localeCompare(E,void 0,{numeric:!0,sensitivity:"base"})})}),c=I(()=>{const s={ITEMID:"Grand Total",ITEMNAME:"",CATEGORY:"",TOTAL:0};return l.value.forEach(e=>{s[e]=0}),o.value.forEach(e=>{s.TOTAL+=e.TOTAL,l.value.forEach(i=>{var t;s[i]+=((t=e[i])==null?void 0:t.count)||0})}),s}),f=I(()=>{const s=[{title:"ITEMID",data:"ITEMID",className:"frozen-column",footer:()=>c.value.ITEMID,width:"120px"},{title:"ITEMS",data:"ITEMNAME",className:"frozen-column",footer:()=>"",orderable:!0,width:"200px"},{title:"CATEGORY",data:"CATEGORY",className:"frozen-column",footer:()=>"",width:"120px"},{title:"TOTAL",data:"TOTAL",footer:()=>c.value.TOTAL}],e=[],i=new Set;return o.value.forEach(t=>{Object.entries(t).forEach(([E,p])=>{typeof p=="object"&&p!==null&&"count"in p&&"STOREID"in p&&(i.has(E)||(i.add(E),e.push({title:`${p.STOREID}<br>${E}`,data:E,render:(a,h)=>h==="sort"||h==="type"?(a==null?void 0:a.count)||0:h==="display"?`${(a==null?void 0:a.count)||0}`:(a==null?void 0:a.count)||0,footer:()=>c.value[E]})))})}),e.sort((t,E)=>{const p=t.title.split("<br>")[0],a=E.title.split("<br>")[0];return p.localeCompare(a,void 0,{numeric:!0,sensitivity:"base"})}),[...s,...e]}),A={paging:!1,scrollX:!0,scrollY:"60vh",scrollCollapse:!0,fixedColumns:{start:3},error:function(s,e,i){console.error("DataTables error:",e)},footerCallback:function(s,e,i,t,E){const a=this.api().table().footer().querySelectorAll("th");f.value.forEach((h,y)=>{h.footer&&(a[y].textContent=h.footer())})}},x=D(null),M=I(()=>{if(x.value){const s=new Date(x.value),e=s.getFullYear(),i=String(s.getMonth()+1).padStart(2,"0"),t=String(s.getDate()).padStart(2,"0");return`${e}-${i}-${t}`}return""}),C=D(null),S=I(()=>{if(C.value){const s=new Date(C.value),e=s.getFullYear(),i=String(s.getMonth()+1).padStart(2,"0"),t=String(s.getDate()).padStart(2,"0");return`${e}-${i}-${t}`}return""});I(()=>{const s=new Date,e=s.getFullYear(),i=String(s.getMonth()+1).padStart(2,"0"),t=String(s.getDate()).padStart(2,"0");return`${e}${i}${t}`});const N=D(!1),j=()=>{N.value=!1},{user:G}=P(T.auth),B=D(G.value.role),F=I(()=>B.value==="ADMIN"),U=()=>{window.confirm("Reset Stocks")?window.location.href="/getcurrentstocks":console.log("User cancelled the post operation.")};return(s,e)=>{const i=J("InputError");return k(),_(X(g.value),{"active-tab":"REPORTS"},{modals:w(()=>[v(ee,{"show-modal":N.value,onToggleActive:j},null,8,["show-modal"])]),main:w(()=>[v(oe,null,{default:w(()=>[r("div",pe,[r("div",fe,[r("form",{onSubmit:K(u,["prevent"]),class:"px-2 py-3 max-h-[50vh] lg:max-h-[70vh] overflow-y-auto"},[r("input",{type:"hidden",name:"_token",value:s.$page.props.csrf_token},null,8,me),r("div",Ee,[r("div",Te,[e[4]||(e[4]=r("div",{class:"flex absolute inset-y-0 left-0 items-center pl-3 pointer-events-none"},[r("svg",{class:"w-5 h-5 text-gray-500 dark:text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[r("path",{"fill-rule":"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z","clip-rule":"evenodd"})])],-1)),$(r("input",{id:"StartDate",type:"date","onUpdate:modelValue":e[0]||(e[0]=t=>O(n).StartDate=t),onInput:e[1]||(e[1]=(...t)=>M.value&&M.value(...t)),placeholder:M.value,class:"bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",required:""},null,40,he),[[Y,O(n).StartDate]]),v(i,{message:O(n).errors.StartDate,class:"mt-2"},null,8,["message"])]),e[6]||(e[6]=r("span",{class:"mx-4 text-gray-500"},"to",-1)),r("div",ge,[e[5]||(e[5]=r("div",{class:"flex absolute inset-y-0 left-0 items-center pl-3 pointer-events-none"},[r("svg",{class:"w-5 h-5 text-gray-500 dark:text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[r("path",{"fill-rule":"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z","clip-rule":"evenodd"})])],-1)),$(r("input",{id:"EndDate",type:"date","onUpdate:modelValue":e[2]||(e[2]=t=>O(n).EndDate=t),onInput:e[3]||(e[3]=(...t)=>S.value&&S.value(...t)),placeholder:S.value,class:"bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",required:""},null,40,Ie),[[Y,O(n).EndDate]]),v(i,{message:O(n).errors.EndDate,class:"mt-2"},null,8,["message"])])])],32),v(ne,{type:"submit",onClick:u,disabled:O(n).processing,class:Q({"opacity-25":O(n).processing})},{default:w(()=>[v(ue,{class:"h-8"})]),_:1},8,["disabled","class"]),e[7]||(e[7]=r("details",{className:"dropdown"},[r("summary",{className:"btn m-1 !bg-navy !text-white"},"TYPES"),r("ul",{className:"menu dropdown-content !bg-gray-100 rounded-box z-[1] w-52 p-2 shadow"},[r("li",null,[r("a",{href:"/orderingconso"},"BW PRODUCTS")]),r("li",null,[r("a",{href:"/receivedwarehouseconso"},"WAREHOUSE")])])],-1)),e[8]||(e[8]=r("details",{className:"dropdown"},[r("summary",{className:"btn m-1 !bg-navy !text-white"},"RECENT"),r("ul",{className:"menu dropdown-content !bg-gray-100 rounded-box z-[1] w-52 p-2 shadow"},[r("li",null,[r("a",{href:"/lastmonth"},"Last Month")]),r("li",null,[r("a",{href:"/lastweek"},"Last Week")]),r("li",null,[r("a",{href:"/yesterday"},"Yesterday")])])],-1)),v(ae,{type:"button",onClick:s.exportToExcel,class:"m-6 bg-green"},{default:w(()=>[v(ie,{class:"h-4"})]),_:1},8,["onClick"]),F.value?(k(),_(le,{key:0,type:"button",onClick:U,class:"bg-red-900"},{default:w(()=>[v(ce,{class:"h-4"})]),_:1})):Z("",!0)])]),r("div",ve,[v(O(L),{data:o.value,columns:f.value,class:"w-full relative display",options:A},{action:w(t=>e[9]||(e[9]=[r("div",{class:"flex justify-start"},null,-1)])),_:1},8,["data","columns"])])]),_:1})]),_:1})}}});export{Pe as default};
