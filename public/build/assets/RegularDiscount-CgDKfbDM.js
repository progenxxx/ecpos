import{d as w,q as D,k as H,l as W,E as G,c as j,w as E,B as Q,o as v,e as F,a as t,f as _,b as A,j as O,v as U,t as k,u as Y,N as J}from"./app-DIsI2h6N.js";import{_ as X}from"./AdminPanel-4mme3aov.js";import{_ as K}from"./Main-BuhnLEuc.js";import{_ as Z}from"./MultiSelectDropdown-B9XsDNK4.js";import{T as ee}from"./TableContainer-BvhjGUIg.js";import{j as te,P as V,D as M}from"./dataTables-CYg83-KT.js";import"./buttons.print-0974EdRm.js";import"./buttons.colVis-ntoAnsIC.js";import{E as oe}from"./exceljs.min-BCSGA5zn.js";import"./RetailGroup-g15s03XT.js";import"./Logout-CSswU4gJ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                             */import"./Modal-DKCN2m9N.js";import"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-BHRlHpU4.js";import"./RetailItems-BxtVv693.js";import"./PartyCake143-D_7hneaj.js";const re={key:0,class:"fixed inset-0 bg-black bg-opacity-30 z-50 flex items-center justify-center"},ae={class:"mb-4 flex flex-wrap gap-4 p-4 bg-white rounded-lg shadow z-[999] sticky top-0"},se={key:0,class:"flex-1 min-w-[200px]"},le={class:"flex-1 min-w-[200px]"},ne={class:"flex-1 min-w-[200px]"},ie={class:"flex justify-between items-center mb-4"},de={key:0,class:"text-sm text-gray-600"},ue={key:0,class:"p-8 text-center bg-gray-50 rounded-lg"},Re={__name:"RegularDiscount",props:{rd:{type:Array,required:!0},stores:{type:Array,required:!0},userRole:{type:String,required:!0},totals:{type:Object,required:!0},filters:{type:Object,required:!0,default:()=>({startDate:"",endDate:"",selectedStores:[]})}},setup(x){window.$=window.jQuery=te,V.use(M);const u=w([]),n=w(""),i=w(""),c=w(!1),N=w(0),y=x,s=o=>{const e=parseFloat(o||0);return isNaN(e)?"0.00":e.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")},$=D(()=>y.userRole.toUpperCase()==="STORE"?K:X);H(()=>{u.value=y.filters.selectedStores||[],n.value=y.filters.startDate||"",i.value=y.filters.endDate||""});const b=D(()=>{let o=[...y.rd];return u.value.length>0&&(o=o.filter(e=>u.value.includes(e.storename))),o}),C=D(()=>b.value&&b.value.length>0),g=D(()=>b.value.reduce((o,e)=>({senior_discount:(o.senior_discount||0)+parseFloat(e.senior_discount||0),pwd_discount:(o.pwd_discount||0)+parseFloat(e.pwd_discount||0),one_day_before_discount:(o.one_day_before_discount||0)+parseFloat(e.one_day_before_discount||0)}),{senior_discount:0,pwd_discount:0,one_day_before_discount:0})),q=[{data:"storename",title:"Store Name",footer:"Grand Total"},{data:"receiptid",title:"Receipt ID",footer:""},{data:"itemname",title:"Item Name",footer:""},{data:"createddate",title:"Created Date",render:o=>o?new Date(o).toLocaleDateString():"",footer:""},{data:"senior_discount",title:"Senior Discount",render:o=>s(o),footer:function(){return s(g.value.senior_discount)},className:"text-right"},{data:"pwd_discount",title:"PWD Discount",render:o=>s(o),footer:function(){return s(g.value.pwd_discount)},className:"text-right"},{data:"one_day_before_discount",title:"25% One Day Before",render:o=>s(o),footer:function(){return s(g.value.one_day_before_discount)},className:"text-right"}],I=o=>{try{c.value=!0;const e=new oe.Workbook,a=e.addWorksheet("Regular Discount Data");a.columns=[{header:"Store Name",key:"storename",width:20},{header:"Receipt ID",key:"receiptid",width:15},{header:"Item Name",key:"itemname",width:25},{header:"Created Date",key:"createddate",width:15},{header:"Senior Discount",key:"senior_discount",width:15},{header:"PWD Discount",key:"pwd_discount",width:15},{header:"25% One Day Before",key:"one_day_before_discount",width:18}],a.getRow(1).font={bold:!0},a.getRow(1).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF343A40"}},a.getRow(1).font={color:{argb:"FFFFFFFF"}};const p=o.rows({search:"applied"}).data().toArray();p.forEach(r=>{const l=a.addRow({storename:r.storename,receiptid:r.receiptid,itemname:r.itemname,createddate:r.createddate?new Date(r.createddate):null,senior_discount:parseFloat(r.senior_discount||0),pwd_discount:parseFloat(r.pwd_discount||0),one_day_before_discount:parseFloat(r.one_day_before_discount||0)});for(let f=5;f<=7;f++)l.getCell(f).value!==null&&(l.getCell(f).numFmt="#,##0.00");l.getCell(4).value&&(l.getCell(4).numFmt="yyyy-mm-dd")});const h=p.reduce((r,l)=>r+parseFloat(l.senior_discount||0),0),m=p.reduce((r,l)=>r+parseFloat(l.pwd_discount||0),0),B=p.reduce((r,l)=>r+parseFloat(l.one_day_before_discount||0),0),d=a.addRow({storename:"Total",receiptid:"",itemname:"",createddate:"",senior_discount:h,pwd_discount:m,one_day_before_discount:B});d.font={bold:!0},d.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF007BFF"}},d.font={color:{argb:"FFFFFFFF"}};for(let r=5;r<=7;r++)d.getCell(r).value!==null&&(d.getCell(r).numFmt="#,##0.00");e.xlsx.writeBuffer().then(r=>{const l=new Blob([r],{type:"application/octet-stream"}),f=document.createElement("a");f.href=URL.createObjectURL(l);const R=new Date,z=`${R.getFullYear()}-${(R.getMonth()+1).toString().padStart(2,"0")}-${R.getDate().toString().padStart(2,"0")}`;f.download=`Regular_Discount_Report_${z}.xlsx`,f.click(),c.value=!1,alert("Export completed successfully!")}).catch(r=>{console.error("Excel export error:",r),c.value=!1,alert("Error exporting to Excel: "+r.message)})}catch(e){console.error("Error in Excel export:",e),c.value=!1,alert("Error preparing Excel export: "+e.message)}},P={responsive:!0,order:[[0,"asc"],[1,"asc"]],pageLength:25,lengthMenu:[[10,25,50,100,-1],[10,25,50,100,"All"]],dom:"Blfrtip",scrollX:!0,scrollY:"50vh",buttons:["copy",{text:"Export Excel",action:function(o,e,a,p){I(e)}},"pdf","print"],drawCallback:function(o){const e=new M.Api(o);N.value=e.rows({search:"applied"}).count();let a=0,p=0,h=0;e.rows({search:"applied"}).every(function(B){const d=this.data();a+=parseFloat(d.senior_discount||0),p+=parseFloat(d.pwd_discount||0),h+=parseFloat(d.one_day_before_discount||0)});const m=e.table().footer().querySelectorAll("td, th");m[4]&&(m[4].textContent=s(a)),m[5]&&(m[5].textContent=s(p)),m[6]&&(m[6].textContent=s(h))}},T=()=>{if(n.value&&i.value&&new Date(n.value)>new Date(i.value)){alert("Start date cannot be later than end date"),n.value="",i.value="";return}c.value=!0,setTimeout(()=>{J.get(route("reports.rd"),{startDate:n.value,endDate:i.value,stores:u.value},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{c.value=!1},onError:o=>{c.value=!1,alert("Error loading data: "+Object.values(o).join(", "))}})},100)},L=()=>{u.value=[],n.value="",i.value="",T()};let S;return W([u,n,i],()=>{clearTimeout(S),S=setTimeout(T,500)},{deep:!0}),G(()=>{clearTimeout(S)}),(o,e)=>(v(),j(Q($.value),{"active-tab":"REPORTS"},{main:E(()=>[c.value?(v(),F("div",re,e[3]||(e[3]=[t("div",{class:"bg-white p-4 rounded-lg shadow-lg"},[t("div",{class:"flex items-center"},[t("svg",{class:"animate-spin h-6 w-6 mr-3 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),t("span",null,"Loading...")])],-1)]))):_("",!0),t("div",ae,[x.userRole.toUpperCase()==="ADMIN"||x.userRole.toUpperCase()==="SUPERADMIN"?(v(),F("div",se,[A(Z,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=a=>u.value=a),options:x.stores,label:"Stores"},null,8,["modelValue","options"])])):_("",!0),t("div",le,[e[4]||(e[4]=t("label",{class:"block text-sm font-medium text-gray-700"},"Start Date",-1)),O(t("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=a=>n.value=a),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[U,n.value]])]),t("div",ne,[e[5]||(e[5]=t("label",{class:"block text-sm font-medium text-gray-700"},"End Date",-1)),O(t("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=a=>i.value=a),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[U,i.value]])]),t("div",{class:"flex items-end"},[t("button",{onClick:L,class:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-md"}," Clear Filters ")])]),A(ee,null,{default:E(()=>[t("div",ie,[e[6]||(e[6]=t("div",{class:"text-xl font-semibold"},"Regular Discount Report",-1)),C.value?(v(),F("div",de," Showing "+k(N.value)+" record(s) ",1)):_("",!0)]),C.value?_("",!0):(v(),F("div",ue,e[7]||(e[7]=[t("div",{class:"text-gray-500 mb-4"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 mx-auto mb-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})]),t("p",{class:"text-lg font-medium"},"No discount records found")],-1),t("p",{class:"text-gray-600"}," Try adjusting your search filters or select a different date range. ",-1)]))),C.value?(v(),j(Y(V),{key:1,data:b.value,columns:q,class:"w-full relative display",options:P},{default:E(()=>[t("tfoot",null,[t("tr",null,[e[8]||(e[8]=t("th",null,"Grand Total",-1)),e[9]||(e[9]=t("th",null,null,-1)),e[10]||(e[10]=t("th",null,null,-1)),e[11]||(e[11]=t("th",null,null,-1)),t("th",null,k(s(g.value.senior_discount)),1),t("th",null,k(s(g.value.pwd_discount)),1),t("th",null,k(s(g.value.one_day_before_discount)),1)])])]),_:1},8,["data"])):_("",!0)]),_:1})]),_:1}))}};export{Re as default};
