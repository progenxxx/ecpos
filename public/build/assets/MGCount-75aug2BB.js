import{d as C,T as H,H as K,s as c,D as x,e as N,t as W,f as J,b as l,w as u,F as X,o as _,a as M,g as h,n as Q,u as Z}from"./app-DwAHA_Mt.js";import{_ as tt}from"./CopyFrom-CL-lTU8k.js";import{_ as et}from"./AdminPanel-1DfNN1pO.js";import{T as ot}from"./TableContainer-PwYTmfDA.js";import{P as S,D as at}from"./dataTables-7Vvj0GSY.js";import{_ as nt}from"./SuccessButton-BWQ5NcUW.js";import{_ as A}from"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-DsXaYi2t.js";import{_ as rt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{E as st}from"./Excel-Ccvbr3BQ.js";import"./dataTables.fixedColumns-HOZudcR9.js";import{E as lt}from"./exceljs.min-Z3crVyW7.js";import"./Modal-DosvBnh2.js";import"./InputError-DMqsnpds.js";import"./RetailGroup-ClNQ_vXI.js";import"./Logout-96D5XcFa.js";/* empty css                                                             */import"./RetailItems-i_spRMW5.js";import"./Attendance-CVSU-1NF.js";const ut={key:0,class:"fixed top-5 right-5 bg-green-900 text-white border border-gray-300 rounded-lg shadow-lg p-4 z-50"},dt={class:"absolute adjust"},it={class:"flex justify-start items-center"},ct={class:"custom-datatable"},ft={__name:"MGCount",props:{orders:{type:Array,required:!0},routes:{type:String,required:!0}},setup(F,{emit:pt}){S.use(at);const R=C(!1),L=F;H({StartDate:"",EndDate:""});const k={paging:!1,scrollX:!0,scrollY:"60vh",scrollCollapse:!0,order:[[1,"asc"]],fixedColumns:{start:6},error:function(t,e,o){console.error("DataTables error:",e)},footerCallback:function(t,e,o,a,r){const g=this.api().table().footer().querySelectorAll("th");d.value.forEach((p,m)=>{p.footer&&(g[m].textContent=p.footer())})}},b=K(L.orders.reduce((t,e)=>{const{STORENAME:o,ITEMID:a,ITEMNAME:r,CATEGORY:i,COUNTED:g,MGCOUNT:p}=e,m=parseInt(g)||0,w=parseInt(p)||0;return t[a]||(t[a]={ITEMID:a,ITEMNAME:r,CATEGORY:i,TOTAL:0,MGCount:w,BalanceCount:0}),t[a][o]||(t[a][o]=0),t[a][o]+=m,t[a].TOTAL+=m,t[a].BalanceCount=t[a].MGCount-t[a].TOTAL,t},{})),G=c(()=>Object.values(b)),T=c(()=>{const t=new Set;return G.value.forEach(e=>{Object.keys(e).forEach(o=>{o!=="ITEMID"&&o!=="ITEMNAME"&&o!=="CATEGORY"&&o!=="TOTAL"&&o!=="MGCount"&&o!=="BalanceCount"&&t.add(o)})}),t}),E=c(()=>{const t={ITEMID:"Grand Total",ITEMNAME:"",CATEGORY:"",MGCount:0,BalanceCount:0,TOTAL:0};return T.value.forEach(e=>{t[e]=0}),O.value.forEach(e=>{t.MGCount+=Number(e.MGCount)||0,t.BalanceCount+=Number(e.BalanceCount)||0,t.TOTAL+=Number(e.TOTAL)||0,T.value.forEach(o=>{t[o]+=Number(e[o])||0})}),t}),d=c(()=>[{title:"ITEMID",data:"ITEMID",className:"frozen-column",footer:()=>E.value.ITEMID,width:"120px"},{title:"ITEMS",data:"ITEMNAME",className:"frozen-column",footer:()=>"",orderable:!0,width:"200px"},{title:"CATEGORY",data:"CATEGORY",className:"frozen-column",footer:()=>"",width:"120px"},{title:"ACTUAL INV COUNT",data:"MGCount",className:"frozen-column",footer:()=>E.value.MGCount,width:"180px"},{title:"REMAINING STOCKS",data:"BalanceCount",className:"frozen-column",footer:()=>E.value.BalanceCount,width:"120px"},{title:"TOTAL ALLOCATION",data:"TOTAL",className:"frozen-column",footer:()=>E.value.TOTAL,width:"130px"},...Array.from(T.value).map(t=>({title:t,data:t,render:(e,o,a)=>o==="sort"||o==="type"?e:o==="display"?`<input type="number" value="${e}" onchange="window.updateCounted('${a.ITEMID}', '${t}', this.value)" />`:e,footer:()=>E.value[t]}))]),$=C(!1),B=C("");window.updateMGCount=function(t,e){const o=b[t];o&&(o.MGCount=parseInt(e,10)||0,o.BalanceCount=o.MGCount-o.TOTAL,x.post("/api/update-mgcount",{itemId:t,mgCount:o.MGCount}).then(a=>{console.log("MGCount update response:",a.data),a.data.success?console.log("MGCount updated successfully"):console.error("Failed to update MGCount:",a.data.message)}).catch(a=>{console.error("Error updating MGCount:",a.response?a.response.data:a)}))},window.updateCounted=function(t,e,o){const a=b[t];a&&(a[e]=parseInt(o,10)||0,a.TOTAL=Array.from(T.value).reduce((r,i)=>r+(a[i]||0),0),a.BalanceCount=a.MGCount-a.TOTAL,x.post("/api/update-counted",{itemId:t,storeName:e,counted:a[e],total:a.TOTAL,balanceCount:a.BalanceCount}).then(r=>{console.log("Counted updated successfully")}).catch(r=>{console.error("Error updating Counted:",r)}))};const O=c(()=>G.value.map(t=>{const e={...t};return d.value.forEach(o=>{e.hasOwnProperty(o.data)||(e[o.data]="0")}),e})),y=C(null);c(()=>{if(y.value){const t=new Date(y.value),e=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${e}-${o}-${a}`}return""});const I=C(null);c(()=>{if(I.value){const t=new Date(I.value),e=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${e}-${o}-${a}`}return""}),c(()=>{const t=new Date,e=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${e}${o}${a}`});async function Y(){try{const t=new lt.Workbook,e=t.addWorksheet("Flattened Orders");e.columns=d.value.map(n=>({header:n.title,key:n.data,width:15})),e.addRow(d.value.map(n=>n.title));const o=O.value.filter(n=>Array.from(T.value).map(f=>n[f]||0).some(f=>f>0)).sort((n,s)=>n.CATEGORY<s.CATEGORY?-1:n.CATEGORY>s.CATEGORY?1:n.ITEMNAME<s.ITEMNAME?-1:n.ITEMNAME>s.ITEMNAME?1:0);o.forEach(n=>{const s=d.value.map(f=>{const v=n[f.data];return v??0});e.addRow(s)});const a=d.value.reduce((n,s)=>(s.footer&&(n[s.data]=o.reduce((f,v)=>f+(Number(v[s.data])||0),0)),n),{}),r=e.addRow(d.value.map(n=>n.footer?a[n.data]||0:""));r.font={bold:!0},r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF7C0000"}},r.font={color:{argb:"FFDDDDDD"}},e.getRow(1).font={bold:!0},e.getRow(1).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}};const i=new Date,g=`FlattenedOrders_${i.getFullYear()}-${i.getMonth()+1}-${i.getDate()}.xlsx`,p=await t.xlsx.writeBuffer(),m=new Blob([p],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),w=document.createElement("a");w.href=URL.createObjectURL(m),w.download=g,w.click()}catch(t){console.error("Error exporting to Excel:",t)}}const z=()=>{window.location.href="/picklist"},U=()=>{window.location.href="/cakepicklist"},j=()=>{window.location.href="/special-orders"},V=()=>{window.location.href="/dispatch/add-details"},D=C(!1),P=()=>{D.value=!1},q=()=>{window.confirm("Get Finish Goods!")?window.location.href="/finish-goods/sync":console.log("User cancelled the post operation.")};return(t,e)=>(_(),N(X,null,[$.value?(_(),N("div",ut,W(B.value),1)):J("",!0),l(et,{"active-tab":"FGCOUNT"},{modals:u(()=>[l(tt,{"show-modal":D.value,onToggleActive:P},null,8,["show-modal"])]),main:u(()=>[l(ot,null,{default:u(()=>[M("div",dt,[M("div",it,[l(nt,{type:"button",onClick:Y,class:"ml-6 bg-green"},{default:u(()=>[l(st,{class:"h-4"})]),_:1}),l(A,{type:"button",onClick:z,class:"m-1 bg-navy"},{default:u(()=>e[0]||(e[0]=[h(" BREAD&PASTRIES ")])),_:1}),l(A,{type:"button",onClick:U,class:"m-1 bg-navy"},{default:u(()=>e[1]||(e[1]=[h(" CAKELAB ")])),_:1}),l(A,{type:"button",onClick:j,class:"ml-2 bg-navy"},{default:u(()=>e[2]||(e[2]=[h(" SPECIAL ORDER ")])),_:1}),l(A,{type:"button",onClick:V,class:"m-2 sm:bg-red-900"},{default:u(()=>e[3]||(e[3]=[h(" DETAILS ")])),_:1}),l(A,{type:"button",onClick:q,class:"sm:bg-red-900"},{default:u(()=>e[4]||(e[4]=[h(" SYNC FG ")])),_:1})])]),M("div",ct,[M("div",{class:Q({"blur-overlay":R.value})},[l(Z(S),{data:O.value,columns:d.value,class:"w-full relative display",options:k},{action:u(o=>e[5]||(e[5]=[M("div",{class:"flex justify-start"},null,-1)])),_:1},8,["data","columns"])],2)])]),_:1})]),_:1})],64))}},_t=rt(ft,[["__scopeId","data-v-39253951"]]);export{_t as default};
