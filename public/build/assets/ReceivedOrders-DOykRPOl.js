import{d as x,q as _,k as M,l as Q,E as $,c as N,w as D,B as z,o as g,e as k,a as t,f as w,b as T,j as I,v as A,t as S,u as H,N as G}from"./app-DIsI2h6N.js";import{_ as W}from"./AdminPanel-4mme3aov.js";import{_ as X}from"./Main-BuhnLEuc.js";import{_ as Y}from"./MultiSelectDropdown-B9XsDNK4.js";import{T as J}from"./TableContainer-BvhjGUIg.js";import{j as K,P as j,D as P}from"./dataTables-CYg83-KT.js";import"./buttons.print-0974EdRm.js";import"./buttons.colVis-ntoAnsIC.js";import{E as Z}from"./exceljs.min-BCSGA5zn.js";import"./RetailGroup-g15s03XT.js";import"./Logout-CSswU4gJ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                             */import"./Modal-DKCN2m9N.js";import"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-BHRlHpU4.js";import"./RetailItems-BxtVv693.js";import"./PartyCake143-D_7hneaj.js";const ee={key:0,class:"fixed inset-0 bg-black bg-opacity-30 z-50 flex items-center justify-center"},te={class:"mb-4 flex flex-wrap gap-4 p-4 bg-white rounded-lg shadow z-[999] sticky top-0"},re={key:0,class:"flex-1 min-w-[200px]"},ae={class:"flex-1 min-w-[200px]"},oe={class:"flex-1 min-w-[200px]"},le={class:"flex justify-between items-center mb-4"},se={key:0,class:"text-sm text-gray-600"},ie={key:0,class:"p-8 text-center bg-gray-50 rounded-lg"},Ce={__name:"ReceivedOrders",props:{ro:{type:Array,required:!0},stores:{type:Array,required:!0},userRole:{type:String,required:!0},filters:{type:Object,required:!0,default:()=>({startDate:"",endDate:"",selectedStores:[]})}},setup(h){window.$=window.jQuery=K,j.use(P);const u=x([]),d=x(""),c=x(""),p=x(!1),q=x(0),y=h,B=_(()=>y.userRole.toUpperCase()==="STORE"?X:W);M(()=>{u.value=y.filters.selectedStores||[],d.value=y.filters.startDate||"",c.value=y.filters.endDate||""});const F=_(()=>{let r=[...y.ro];return u.value.length>0&&(r=r.filter(e=>u.value.includes(e.storename))),r}),C=_(()=>F.value&&F.value.length>0),b=_(()=>F.value.reduce((r,e)=>{const a=parseFloat(e.price||0)*parseFloat(e.received_qty||0);return{received_qty:(r.received_qty||0)+parseFloat(e.received_qty||0),total_price:(r.total_price||0)+a}},{received_qty:0,total_price:0})),O=[{data:"itemid",title:"Item ID",footer:"Grand Total"},{data:"itemname",title:"Item Name",footer:""},{data:"category",title:"Category",footer:""},{data:"storename",title:"Store Name",footer:""},{data:"received_date",title:"Received Date",render:r=>r?new Date(r).toLocaleDateString():"",footer:""},{data:"price",title:"PRICE (INCL. TAX)",render:r=>{const e=parseFloat(r||0);return isNaN(e)?"0.00":e.toFixed(2)},footer:"",className:"text-right"},{data:"received_qty",title:"Received Quantity",render:r=>{const e=parseFloat(r||0);return isNaN(e)?"0":parseInt(e,10).toString()},footer:function(){const r=b.value.received_qty||0;return parseInt(r,10).toString()},className:"text-right"},{data:null,title:"TOTAL PRICE",render:(r,e,a)=>{const m=parseFloat(a.received_qty||0),s=parseFloat(a.price||0)*m;return isNaN(s)?"0.00":s.toFixed(2)},footer:function(){const r=b.value.total_price||0;return isNaN(r)?"0.00":r.toFixed(2)},className:"text-right font-bold"}],U=r=>{try{p.value=!0;const e=new Z.Workbook,a=e.addWorksheet("Received Orders Data");a.columns=[{header:"Item ID",key:"itemid",width:15},{header:"Item Name",key:"itemname",width:30},{header:"Category",key:"category",width:15},{header:"Store Name",key:"storename",width:20},{header:"Received Date",key:"received_date",width:15},{header:"Price (Incl. Tax)",key:"price",width:15},{header:"Received Quantity",key:"received_qty",width:15},{header:"Total Price",key:"total_price",width:15}],a.getRow(1).font={bold:!0},a.getRow(1).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF343A40"}},a.getRow(1).font={color:{argb:"FFFFFFFF"}};const m=r.rows({search:"applied"}).data().toArray();m.forEach(o=>{const n=parseFloat(o.price||0),i=parseFloat(o.received_qty||0),f=n*i,l=a.addRow({itemid:o.itemid,itemname:o.itemname,category:o.category,storename:o.storename,received_date:o.received_date?new Date(o.received_date):null,price:n,received_qty:parseInt(i,10),total_price:f});l.getCell(6).value!==null&&(l.getCell(6).numFmt="#,##0.00"),l.getCell(7).value!==null&&(l.getCell(7).numFmt="0"),l.getCell(8).value!==null&&(l.getCell(8).numFmt="#,##0.00"),l.getCell(5).value&&(l.getCell(5).numFmt="yyyy-mm-dd")});const v=m.reduce((o,n)=>{const i=parseFloat(n.received_qty||0),l=parseFloat(n.price||0)*i;return{received_qty:o.received_qty+i,total_price:o.total_price+l}},{received_qty:0,total_price:0}),s=a.addRow({itemid:"Total",itemname:"",category:"",storename:"",received_date:"",price:"",received_qty:parseInt(v.received_qty,10),total_price:v.total_price});s.font={bold:!0},s.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF007BFF"}},s.font={color:{argb:"FFFFFFFF"}},s.getCell(7).value!==null&&(s.getCell(7).numFmt="0"),s.getCell(8).value!==null&&(s.getCell(8).numFmt="#,##0.00"),e.xlsx.writeBuffer().then(o=>{const n=new Blob([o],{type:"application/octet-stream"}),i=document.createElement("a");i.href=URL.createObjectURL(n);const f=new Date,l=`${f.getFullYear()}-${(f.getMonth()+1).toString().padStart(2,"0")}-${f.getDate().toString().padStart(2,"0")}`;i.download=`Received_Orders_Report_${l}.xlsx`,i.click(),p.value=!1,alert("Export completed successfully!")}).catch(o=>{console.error("Excel export error:",o),p.value=!1,alert("Error exporting to Excel: "+o.message)})}catch(e){console.error("Error in Excel export:",e),p.value=!1,alert("Error preparing Excel export: "+e.message)}},V={responsive:!0,order:[[3,"asc"],[0,"asc"]],pageLength:25,lengthMenu:[[10,25,50,100,-1],[10,25,50,100,"All"]],dom:"Blfrtip",scrollX:!0,scrollY:"50vh",buttons:["copy",{text:"Export Excel",action:function(r,e,a,m){U(e)}},"pdf","print"],drawCallback:function(r){const e=new P.Api(r);q.value=e.rows({search:"applied"}).count();let a=0,m=0;e.rows({search:"applied"}).every(function(s){const o=this.data(),n=parseFloat(o.received_qty||0),i=parseFloat(o.price||0);a+=n,m+=i*n});const v=e.table().footer().querySelectorAll("td, th");v[6]&&(v[6].textContent=parseInt(a,10).toString()),v[7]&&(v[7].textContent=m.toFixed(2))}},E=()=>{if(d.value&&c.value&&new Date(d.value)>new Date(c.value)){alert("Start date cannot be later than end date"),d.value="",c.value="";return}p.value=!0,setTimeout(()=>{G.get(route("receivedorderconso.ro"),{startDate:d.value,endDate:c.value,stores:u.value},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{p.value=!1},onError:r=>{p.value=!1,alert("Error loading data: "+Object.values(r).join(", "))}})},100)},L=()=>{u.value=[],d.value="",c.value="",E()};let R;return Q([u,d,c],()=>{clearTimeout(R),R=setTimeout(E,500)},{deep:!0}),$(()=>{clearTimeout(R)}),(r,e)=>(g(),N(z(B.value),{"active-tab":"REPORTS"},{main:D(()=>[p.value?(g(),k("div",ee,e[3]||(e[3]=[t("div",{class:"bg-white p-4 rounded-lg shadow-lg"},[t("div",{class:"flex items-center"},[t("svg",{class:"animate-spin h-6 w-6 mr-3 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),t("span",null,"Loading...")])],-1)]))):w("",!0),t("div",te,[h.userRole.toUpperCase()==="ADMIN"||h.userRole.toUpperCase()==="SUPERADMIN"?(g(),k("div",re,[T(Y,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=a=>u.value=a),options:h.stores,label:"Stores"},null,8,["modelValue","options"])])):w("",!0),t("div",ae,[e[4]||(e[4]=t("label",{class:"block text-sm font-medium text-gray-700"},"Start Date",-1)),I(t("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=a=>d.value=a),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[A,d.value]])]),t("div",oe,[e[5]||(e[5]=t("label",{class:"block text-sm font-medium text-gray-700"},"End Date",-1)),I(t("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=a=>c.value=a),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[A,c.value]])]),t("div",{class:"flex items-end"},[t("button",{onClick:L,class:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-md"}," Clear Filters ")])]),T(J,null,{default:D(()=>[t("div",le,[e[6]||(e[6]=t("div",{class:"text-xl font-semibold"},"Received Orders Report",-1)),C.value?(g(),k("div",se," Showing "+S(q.value)+" record(s) ",1)):w("",!0)]),C.value?w("",!0):(g(),k("div",ie,e[7]||(e[7]=[t("div",{class:"text-gray-500 mb-4"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 mx-auto mb-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})]),t("p",{class:"text-lg font-medium"},"No received orders found")],-1),t("p",{class:"text-gray-600"}," Try adjusting your search filters or select a different date range. ",-1)]))),C.value?(g(),N(H(j),{key:1,data:F.value,columns:O,class:"w-full relative display",options:V},{default:D(()=>[t("tfoot",null,[t("tr",null,[e[8]||(e[8]=t("th",null,"Grand Total",-1)),e[9]||(e[9]=t("th",null,null,-1)),e[10]||(e[10]=t("th",null,null,-1)),e[11]||(e[11]=t("th",null,null,-1)),e[12]||(e[12]=t("th",null,null,-1)),e[13]||(e[13]=t("th",null,null,-1)),t("th",null,S(parseInt(b.value.received_qty,10)),1),t("th",null,S(parseFloat(b.value.total_price).toFixed(2)),1)])])]),_:1},8,["data"])):w("",!0)]),_:1})]),_:1}))}};export{Ce as default};
