import{T as w,q as c,d as g,k as M,c as I,w as D,o as b,b as S,a as f}from"./app-DJ_ZTFbI.js";import{_ as x}from"./AdminPanel-DorjMUAR.js";import{T as k}from"./TableContainer-CTCvRGFw.js";import{P as v,D as L}from"./dataTables-Dqt6QQHC.js";import{E as R}from"./exceljs.min-DuakHjXl.js";import"./RetailGroup-ReiPV-Rs.js";import"./Logout-CqZ_wKbj.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                             */import"./Modal-CKYSH-Ul.js";import"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-B7C873nC.js";import"./RetailItems-BqM3fhIp.js";const Y={props:{orders:{type:Array,required:!0,default:()=>[]}},computed:{flattenedOrders(){return this.calculateFlattenedOrders(this.orders)},grandTotal(){return this.flattenedOrders.reduce((n,a)=>n+(a.TOTAL||0),0)},uniqueDates(){const n=new Set;return this.flattenedOrders.forEach(a=>{a.dates&&Object.keys(a.dates).forEach(l=>n.add(l))}),Array.from(n).sort()}},methods:{calculateFlattenedOrders(n){return n.map(a=>({ITEMID:a.ITEMID,ITEMNAME:a.ITEMNAME,CATEGORY:a.CATEGORY,TOTAL:a.TOTAL,dates:a.dates||{}}))},async exportToExcel(){console.log("Starting exportToExcel"),console.log("flattenedOrders:",this.flattenedOrders);try{if(!this.flattenedOrders||!Array.isArray(this.flattenedOrders)||this.flattenedOrders.length===0){console.error("No data to export");return}const n=new R.Workbook,a=n.addWorksheet("Orders"),l=[{header:"ITEMID",key:"ITEMID",width:15},{header:"ITEMNAME",key:"ITEMNAME",width:30},{header:"CATEGORY",key:"CATEGORY",width:20},{header:"TOTAL",key:"TOTAL",width:15}];this.uniqueDates.forEach(s=>{l.push({header:s,key:s,width:15})}),a.columns=l,this.flattenedOrders.forEach(s=>{const h={ITEMID:s.ITEMID,ITEMNAME:s.ITEMNAME,CATEGORY:s.CATEGORY,TOTAL:s.TOTAL};this.uniqueDates.forEach(T=>{h[T]=s.dates[T]||0}),a.addRow(h)}),a.getRow(1).font={bold:!0},a.getRow(1).alignment={vertical:"middle",horizontal:"center"};const d=new Date,E=`Orders_${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}.xlsx`,u=await n.xlsx.writeBuffer();this.saveExcelFile(u,E)}catch(n){console.error("Error exporting to Excel:",n)}},saveExcelFile(n,a){const l=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),d=document.createElement("a");d.href=URL.createObjectURL(l),d.download=a,d.click(),URL.revokeObjectURL(d.href)}}},z=Object.assign(Y,{__name:"Inventory",props:{orders:{type:Array,required:!0},sheetData:{type:Array,default:()=>[]}},setup(n,{emit:a}){v.use(L);const l=n;w({StartDate:"",EndDate:""});const d=c(()=>l.orders.reduce((e,o)=>{const{ITEMID:t,ITEMNAME:r,CATEGORY:i,COUNTED:m,createddatetime:p}=o,O=new Date(p).toLocaleDateString("en-US",{month:"numeric",day:"numeric",year:"numeric"}),y=parseInt(m,10)||0;return e[t]||(e[t]={ITEMID:t,ITEMNAME:r,CATEGORY:i,TOTAL:0,dates:Object.fromEntries(u.value.map(A=>[A,0]))}),e[t].dates[O]=(e[t].dates[O]||0)+y,e[t].TOTAL+=y,e},{})),E=c(()=>{const e=Object.values(d.value),o={ITEMID:"TOTAL",ITEMNAME:"",CATEGORY:"",TOTAL:e.reduce((t,r)=>t+r.TOTAL,0),dates:Object.fromEntries(u.value.map(t=>[t,e.reduce((r,i)=>r+(i.dates[t]||0),0)]))};return e.push(o),e}),u=c(()=>{const e=new Date,o=e.getFullYear(),t=e.getMonth(),r=new Date(o,t+1,0).getDate(),i=[];for(let m=1;m<=r;m++){const p=new Date(o,t,m);i.push(p.toLocaleDateString("en-US",{month:"numeric",day:"numeric",year:"numeric"}))}return i});c(()=>[{title:"ITEMID",data:"ITEMID"},{title:"ITEMNAME",data:"ITEMNAME"},{title:"CATEGORY",data:"CATEGORY"},{title:"TOTAL",data:"TOTAL"},...u.value.map(e=>({title:e,data:null,render:(o,t,r)=>r.dates[e]||0}))]);const s=g(null);c(()=>{if(s.value){const e=new Date(s.value),o=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${o}-${t}-${r}`}return""});const h=g(null);c(()=>{if(h.value){const e=new Date(h.value),o=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${o}-${t}-${r}`}return""}),c(()=>{const e=new Date,o=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${o}${t}${r}`}),c(()=>E.value.reduce((e,o)=>e+Object.values(o).reduce((t,r)=>typeof r=="object"&&r!==null&&"count"in r?t+r.count:t,0),0));const T=g([]);return M(async()=>{try{const e=await axios.get("/api/google-sheet-data");T.value=e.data}catch(e){console.error("Error fetching sheet data:",e)}}),(e,o)=>(b(),I(x,{"active-tab":"FG"},{main:D(()=>[S(k,null,{default:D(()=>o[0]||(o[0]=[f("div",{class:"absolute adjust"},[f("div",{class:"flex justify-start items-center"},[f("a",{href:"#",class:"w-full flex flex-col items-center bg-white border border-gray-200 rounded-lg shadow md:flex-row md:max-w-xl hover:bg-gray-100 dark:border-gray-700 dark:bg-gray-800 dark:hover:bg-gray-700"})])],-1),f("iframe",{src:"https://docs.google.com/spreadsheets/d/1qPRNb5MK135DogIi7QlunasYYa_hkYEe50wWCB18yWE/edit?usp=sharing&rm=minimal#gid=951114160",class:"w-full",style:{height:"90vh"}},null,-1)])),_:1})]),_:1}))}});export{z as default};
