import{d as g,q as w,k as q,l as N,E as C,c as E,w as b,B as U,o as h,a as n,e as M,b as y,f as F,j as x,v as A,u as B,N as V}from"./app-CacuESpm.js";import{_ as I}from"./AdminPanel-_h8KsVxO.js";import{_ as L}from"./Main-2jZhlWuC.js";import{_ as O}from"./MultiSelectDropdown-DQa9I4Ez.js";import{T as $}from"./TableContainer-D6l808Wc.js";import{P as k,D as G}from"./dataTables-BnFpA0RH.js";import"./buttons.print-Tx47sh3R.js";import{E as j}from"./exceljs.min-BdicTKAv.js";import"./RetailGroup-CN0qeRLj.js";import"./Logout-CqgzcP31.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                             */import"./Modal-CTDQd9c8.js";import"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-Oe7tEmQB.js";import"./RetailItems-CjOIxooj.js";import"./Attendance-B0jvDPeG.js";import"./PartyCake143-Di4gRlu7.js";const Y={class:"mb-4 flex flex-wrap gap-4 p-4 bg-white rounded-lg shadow z-[999]"},P={key:0,class:"flex-1 min-w-[200px]"},Q={class:"flex-1 min-w-[200px]"},W={class:"flex-1 min-w-[200px]"},z={class:"flex items-end"},ct={__name:"ItemSales copy",props:{ar:{type:Array,required:!0},stores:{type:Array,required:!0},userRole:{type:String,required:!0},filters:{type:Object,required:!0,default:()=>({startDate:"",endDate:"",selectedStores:[]})}},setup(d){k.use(G);const m=g([]),r=g(""),l=g(""),s=d,D=w(()=>(console.log("userRole value:",s.userRole),console.log("Is Store?:",s.userRole.toUpperCase()==="STORE"),s.userRole.toUpperCase()==="STORE"?L:I)),u=w(()=>s.ar.reduce((e,t)=>{const a=Number(t.total_netamount||0),o=Number(t.total_discamount||0),f=Number(t.total_grossamount||0),c=Number(t.total_qty||0);return{total_netamount:(e.total_netamount*100+a*100)/100,total_discamount:(e.total_discamount*100+o*100)/100,total_grossamount:(e.total_grossamount*100+f*100)/100,total_qty:e.total_qty+c}},{total_netamount:0,total_discamount:0,total_grossamount:0,total_qty:0}));q(()=>{m.value=s.filters.selectedStores||[],r.value=s.filters.startDate||"",l.value=s.filters.endDate||""});const _=()=>{if(r.value&&l.value&&new Date(r.value)>new Date(l.value)){alert("Start date cannot be later than end date"),r.value="",l.value="";return}const e={startDate:r.value||null,endDate:l.value||null,stores:m.value.length>0?m.value:null};V.get(route("reports.itemsales"),e,{preserveState:!0,preserveScroll:!0})};let p;N([m,r,l],()=>{clearTimeout(p),p=setTimeout(_,500)},{deep:!0}),C(()=>{clearTimeout(p)});const i=e=>`â‚±${parseFloat(e).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`,R=[{data:"itemname",title:"ITEMNAME",footer:"Grand Total"},{data:"itemgroup",title:"Category",footer:""},{data:"total_qty",title:"QTY",render:e=>`${Math.floor(e)}`,footer:`${Math.floor(u.value.total_qty)}`},{data:"total_netamount",title:"Net Amount",render:e=>i(e),footer:i(u.value.total_netamount)},{data:"total_discamount",title:"Discount Amount",render:e=>i(e),footer:i(u.value.total_discamount)},{data:"total_grossamount",title:"Gross Amount",render:e=>i(e),footer:i(u.value.total_grossamount)}],T={responsive:!0,pageLength:25,dom:"Bfrtip",scrollX:!0,scrollY:"50vh",buttons:["copy",{text:"Export Excel",action:function(e,t,a,o){S()}},"pdf","print"],order:[[0,"asc"]]},S=()=>{const e=new j.Workbook,t=e.addWorksheet("Sales Report");t.addRow(["Item Name","Category","QTY","Net Amount","Discount Amount","Gross Amount"]),t.columns=[{header:"Item Name",key:"itemname",width:30},{header:"Category",key:"itemgroup",width:20},{header:"QTY",key:"total_qty",width:15,style:{numFmt:"#,##0"}},{header:"Net Amount",key:"netAmount",width:20,style:{numFmt:"#,##0.00"}},{header:"Discount Amount",key:"discountAmount",width:20,style:{numFmt:"#,##0.00"}},{header:"Gross Amount",key:"grossAmount",width:20,style:{numFmt:"#,##0.00"}}],s.ar.forEach(o=>{t.addRow({itemname:o.itemname,itemgroup:o.itemgroup,total_qty:Math.floor(o.total_qty||0),netAmount:o.total_netamount,discountAmount:o.total_discamount,grossAmount:o.total_grossamount})}),t.addRow({itemname:"Grand Total",itemgroup:"",total_qty:Math.floor(u.value.total_qty),netAmount:u.value.total_netamount,discountAmount:u.value.total_discamount,grossAmount:u.value.total_grossamount});const a=t.lastRow;a.font={bold:!0},e.xlsx.writeBuffer().then(o=>{const f=new Blob([o],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),c=window.URL.createObjectURL(f),v=document.createElement("a");v.href=c,v.download="itemsales.xlsx",v.click(),window.URL.revokeObjectURL(c)})};return(e,t)=>(h(),E(U(D.value),{"active-tab":"REPORTS"},{main:b(()=>[n("div",Y,[d.userRole.toUpperCase()==="ADMIN"||d.userRole.toUpperCase()==="SUPERADMIN"?(h(),M("div",P,[y(O,{modelValue:m.value,"onUpdate:modelValue":t[0]||(t[0]=a=>m.value=a),options:d.stores,label:"Stores"},null,8,["modelValue","options"])])):F("",!0),n("div",Q,[t[4]||(t[4]=n("label",{class:"block text-sm font-medium text-gray-700"},"Start Date",-1)),x(n("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=a=>r.value=a),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[A,r.value]])]),n("div",W,[t[5]||(t[5]=n("label",{class:"block text-sm font-medium text-gray-700"},"End Date",-1)),x(n("input",{type:"date","onUpdate:modelValue":t[2]||(t[2]=a=>l.value=a),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[A,l.value]])]),n("div",z,[n("button",{onClick:t[3]||(t[3]=()=>{m.value.value=[],r.value.value="",l.value.value="",_()}),class:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-md"}," Clear Filters ")])]),y($,null,{default:b(()=>[y(B(k),{data:s.ar,columns:R,class:"w-full relative display",options:T},null,8,["data"])]),_:1})]),_:1}))}};export{ct as default};
