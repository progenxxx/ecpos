import{T as w,s as c,d as g,k as M,c as I,w as D,o as b,b as S,a as f}from"./app-CfytZ6uy.js";import{_ as x}from"./AdminPanel-CL6jLfvg.js";import{T as k}from"./TableContainer-C_tye70S.js";import{P as v,D as L}from"./dataTables-BGy9-Y2a.js";import{E as R}from"./exceljs.min-CpKGb2AC.js";import"./RetailGroup-2HMR2ftQ.js";import"./Logout-z3St95b0.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                             */import"./Modal-BPjbBi2X.js";import"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-B1wW2mpq.js";import"./RetailItems-DVr2J4Jb.js";/* empty css                                                                */import"./Attendance-DXy5Tht_.js";const Y={props:{orders:{type:Array,required:!0,default:()=>[]}},computed:{flattenedOrders(){return this.calculateFlattenedOrders(this.orders)},grandTotal(){return this.flattenedOrders.reduce((n,a)=>n+(a.TOTAL||0),0)},uniqueDates(){const n=new Set;return this.flattenedOrders.forEach(a=>{a.dates&&Object.keys(a.dates).forEach(l=>n.add(l))}),Array.from(n).sort()}},methods:{calculateFlattenedOrders(n){return n.map(a=>({ITEMID:a.ITEMID,ITEMNAME:a.ITEMNAME,CATEGORY:a.CATEGORY,TOTAL:a.TOTAL,dates:a.dates||{}}))},async exportToExcel(){console.log("Starting exportToExcel"),console.log("flattenedOrders:",this.flattenedOrders);try{if(!this.flattenedOrders||!Array.isArray(this.flattenedOrders)||this.flattenedOrders.length===0){console.error("No data to export");return}const n=new R.Workbook,a=n.addWorksheet("Orders"),l=[{header:"ITEMID",key:"ITEMID",width:15},{header:"ITEMNAME",key:"ITEMNAME",width:30},{header:"CATEGORY",key:"CATEGORY",width:20},{header:"TOTAL",key:"TOTAL",width:15}];this.uniqueDates.forEach(s=>{l.push({header:s,key:s,width:15})}),a.columns=l,this.flattenedOrders.forEach(s=>{const h={ITEMID:s.ITEMID,ITEMNAME:s.ITEMNAME,CATEGORY:s.CATEGORY,TOTAL:s.TOTAL};this.uniqueDates.forEach(T=>{h[T]=s.dates[T]||0}),a.addRow(h)}),a.getRow(1).font={bold:!0},a.getRow(1).alignment={vertical:"middle",horizontal:"center"};const d=new Date,E=`Orders_${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}.xlsx`,u=await n.xlsx.writeBuffer();this.saveExcelFile(u,E)}catch(n){console.error("Error exporting to Excel:",n)}},saveExcelFile(n,a){const l=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),d=document.createElement("a");d.href=URL.createObjectURL(l),d.download=a,d.click(),URL.revokeObjectURL(d.href)}}},K=Object.assign(Y,{__name:"Inventory",props:{orders:{type:Array,required:!0},sheetData:{type:Array,default:()=>[]}},setup(n,{emit:a}){v.use(L);const l=n;w({StartDate:"",EndDate:""});const d=c(()=>l.orders.reduce((t,o)=>{const{ITEMID:e,ITEMNAME:r,CATEGORY:i,COUNTED:m,createddatetime:p}=o,O=new Date(p).toLocaleDateString("en-US",{month:"numeric",day:"numeric",year:"numeric"}),y=parseInt(m,10)||0;return t[e]||(t[e]={ITEMID:e,ITEMNAME:r,CATEGORY:i,TOTAL:0,dates:Object.fromEntries(u.value.map(A=>[A,0]))}),t[e].dates[O]=(t[e].dates[O]||0)+y,t[e].TOTAL+=y,t},{})),E=c(()=>{const t=Object.values(d.value),o={ITEMID:"TOTAL",ITEMNAME:"",CATEGORY:"",TOTAL:t.reduce((e,r)=>e+r.TOTAL,0),dates:Object.fromEntries(u.value.map(e=>[e,t.reduce((r,i)=>r+(i.dates[e]||0),0)]))};return t.push(o),t}),u=c(()=>{const t=new Date,o=t.getFullYear(),e=t.getMonth(),r=new Date(o,e+1,0).getDate(),i=[];for(let m=1;m<=r;m++){const p=new Date(o,e,m);i.push(p.toLocaleDateString("en-US",{month:"numeric",day:"numeric",year:"numeric"}))}return i});c(()=>[{title:"ITEMID",data:"ITEMID"},{title:"ITEMNAME",data:"ITEMNAME"},{title:"CATEGORY",data:"CATEGORY"},{title:"TOTAL",data:"TOTAL"},...u.value.map(t=>({title:t,data:null,render:(o,e,r)=>r.dates[t]||0}))]);const s=g(null);c(()=>{if(s.value){const t=new Date(s.value),o=t.getFullYear(),e=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${o}-${e}-${r}`}return""});const h=g(null);c(()=>{if(h.value){const t=new Date(h.value),o=t.getFullYear(),e=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${o}-${e}-${r}`}return""}),c(()=>{const t=new Date,o=t.getFullYear(),e=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${o}${e}${r}`}),c(()=>E.value.reduce((t,o)=>t+Object.values(o).reduce((e,r)=>typeof r=="object"&&r!==null&&"count"in r?e+r.count:e,0),0));const T=g([]);return M(async()=>{try{const t=await axios.get("/api/google-sheet-data");T.value=t.data}catch(t){console.error("Error fetching sheet data:",t)}}),(t,o)=>(b(),I(x,{"active-tab":"FG"},{main:D(()=>[S(k,null,{default:D(()=>o[0]||(o[0]=[f("div",{class:"absolute adjust"},[f("div",{class:"flex justify-start items-center"},[f("a",{href:"#",class:"w-full flex flex-col items-center bg-white border border-gray-200 rounded-lg shadow md:flex-row md:max-w-xl hover:bg-gray-100 dark:border-gray-700 dark:bg-gray-800 dark:hover:bg-gray-700"})])],-1),f("iframe",{src:"https://docs.google.com/spreadsheets/d/1qPRNb5MK135DogIi7QlunasYYa_hkYEe50wWCB18yWE/edit?usp=sharing&rm=minimal#gid=951114160",class:"w-full",style:{height:"90vh"}},null,-1)])),_:1})]),_:1}))}});export{K as default};
