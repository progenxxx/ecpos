import{d as h,q as D,k as Q,l as W,E as Y,c as U,w as N,B as J,o as v,e as S,a as t,f as y,b as M,j as $,v as _,t as x,u as X,N as K}from"./app-DIsI2h6N.js";import{_ as Z}from"./AdminPanel-4mme3aov.js";import{_ as ee}from"./Main-BuhnLEuc.js";import{_ as te}from"./MultiSelectDropdown-B9XsDNK4.js";import{T as ae}from"./TableContainer-BvhjGUIg.js";import{j as oe,P as q,D as G}from"./dataTables-CYg83-KT.js";import"./buttons.print-0974EdRm.js";import"./buttons.colVis-ntoAnsIC.js";import{E as le}from"./exceljs.min-BCSGA5zn.js";import"./RetailGroup-g15s03XT.js";import"./Logout-CSswU4gJ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                             */import"./Modal-DKCN2m9N.js";import"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-BHRlHpU4.js";import"./RetailItems-BxtVv693.js";import"./PartyCake143-D_7hneaj.js";const re={key:0,class:"fixed inset-0 bg-black bg-opacity-30 z-50 flex items-center justify-center"},se={class:"mb-4 flex flex-wrap gap-4 p-4 bg-white rounded-lg shadow z-[999] sticky top-0"},ne={key:0,class:"flex-1 min-w-[200px]"},ue={class:"flex-1 min-w-[200px]"},ie={class:"flex-1 min-w-[200px]"},de={class:"flex justify-between items-center mb-4"},ce={key:0,class:"text-sm text-gray-600"},me={key:0,class:"p-8 text-center bg-gray-50 rounded-lg"},Re={__name:"EmployeeCharge",props:{ec:{type:Array,required:!0},stores:{type:Array,required:!0},userRole:{type:String,required:!0},filters:{type:Object,required:!0,default:()=>({startDate:"",endDate:"",selectedStores:[]})}},setup(w){window.$=window.jQuery=oe,q.use(G);const p=h([]),c=h(""),m=h(""),f=h(!1),T=h(0),b=w,l=a=>{const e=parseFloat(a||0);return isNaN(e)?"0.00":e.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")},L=D(()=>b.userRole.toUpperCase()==="STORE"?ee:Z);Q(()=>{p.value=b.filters.selectedStores||[],c.value=b.filters.startDate||"",m.value=b.filters.endDate||""});const F=D(()=>{let a=[...b.ec];return p.value.length>0&&(a=a.filter(e=>p.value.includes(e.storename))),a}),E=D(()=>F.value&&F.value.length>0),i=D(()=>F.value.reduce((a,e)=>({grossamount:(a.grossamount||0)+parseFloat(e.grossamount||0),discamount:(a.discamount||0)+parseFloat(e.discamount||0),netamount:(a.netamount||0)+parseFloat(e.netamount||0),Vat:(a.Vat||0)+parseFloat(e.Vat||0),Vatablesales:(a.Vatablesales||0)+parseFloat(e.Vatablesales||0)}),{grossamount:0,discamount:0,netamount:0,Vat:0,Vatablesales:0})),I=[{data:"receiptid",title:"Receipt ID",footer:"Grand Total"},{data:"storename",title:"Store Name",footer:""},{data:"custaccount",title:"Customer",footer:""},{data:"createddate",title:"Created Date",render:a=>a?new Date(a).toLocaleDateString():"",footer:""},{data:"grossamount",title:"Gross Amount",render:a=>l(a),footer:function(){return l(i.value.grossamount)},className:"text-right"},{data:"discamount",title:"Discount",render:a=>l(a),footer:function(){return l(i.value.discamount)},className:"text-right"},{data:"netamount",title:"Net Amount",render:a=>l(a),footer:function(){return l(i.value.netamount)},className:"text-right"},{data:"Vat",title:"VAT",render:a=>l(a),footer:function(){return l(i.value.Vat)},className:"text-right"},{data:"Vatablesales",title:"VATable Sales",render:a=>l(a),footer:function(){return l(i.value.Vatablesales)},className:"text-right"}],O=a=>{try{f.value=!0;const e=new le.Workbook,r=e.addWorksheet("Employee Charge Data");r.columns=[{header:"Receipt ID",key:"receiptid",width:15},{header:"Store Name",key:"storename",width:20},{header:"Customer",key:"custaccount",width:20},{header:"Created Date",key:"createddate",width:15},{header:"Gross Amount",key:"grossamount",width:15},{header:"Discount",key:"discamount",width:15},{header:"Net Amount",key:"netamount",width:15},{header:"VAT",key:"Vat",width:12},{header:"VATable Sales",key:"Vatablesales",width:15}],r.getRow(1).font={bold:!0},r.getRow(1).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF343A40"}},r.getRow(1).font={color:{argb:"FFFFFFFF"}};const d=a.rows({search:"applied"}).data().toArray();d.forEach(o=>{const s=r.addRow({receiptid:o.receiptid,storename:o.storename,custaccount:o.custaccount,createddate:o.createddate?new Date(o.createddate):null,grossamount:parseFloat(o.grossamount||0),discamount:parseFloat(o.discamount||0),netamount:parseFloat(o.netamount||0),Vat:parseFloat(o.Vat||0),Vatablesales:parseFloat(o.Vatablesales||0)});for(let g=5;g<=9;g++)s.getCell(g).value!==null&&(s.getCell(g).numFmt="#,##0.00");s.getCell(4).value&&(s.getCell(4).numFmt="yyyy-mm-dd")});const V=d.reduce((o,s)=>o+parseFloat(s.grossamount||0),0),k=d.reduce((o,s)=>o+parseFloat(s.discamount||0),0),C=d.reduce((o,s)=>o+parseFloat(s.netamount||0),0),n=d.reduce((o,s)=>o+parseFloat(s.Vat||0),0),B=d.reduce((o,s)=>o+parseFloat(s.Vatablesales||0),0),u=r.addRow({receiptid:"Total",storename:"",custaccount:"",createddate:"",grossamount:V,discamount:k,netamount:C,Vat:n,Vatablesales:B});u.font={bold:!0},u.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF007BFF"}},u.font={color:{argb:"FFFFFFFF"}};for(let o=5;o<=9;o++)u.getCell(o).value!==null&&(u.getCell(o).numFmt="#,##0.00");e.xlsx.writeBuffer().then(o=>{const s=new Blob([o],{type:"application/octet-stream"}),g=document.createElement("a");g.href=URL.createObjectURL(s);const R=new Date,P=`${R.getFullYear()}-${(R.getMonth()+1).toString().padStart(2,"0")}-${R.getDate().toString().padStart(2,"0")}`;g.download=`Employee_Charge_Report_${P}.xlsx`,g.click(),f.value=!1,alert("Export completed successfully!")}).catch(o=>{console.error("Excel export error:",o),f.value=!1,alert("Error exporting to Excel: "+o.message)})}catch(e){console.error("Error in Excel export:",e),f.value=!1,alert("Error preparing Excel export: "+e.message)}},z={responsive:!0,order:[[1,"asc"],[0,"asc"]],pageLength:25,lengthMenu:[[10,25,50,100,-1],[10,25,50,100,"All"]],dom:"Blfrtip",scrollX:!0,scrollY:"50vh",buttons:["copy",{text:"Export Excel",action:function(a,e,r,d){O(e)}},"pdf","print"],drawCallback:function(a){const e=new G.Api(a);T.value=e.rows({search:"applied"}).count();let r=0,d=0,V=0,k=0,C=0;e.rows({search:"applied"}).every(function(B){const u=this.data();r+=parseFloat(u.grossamount||0),d+=parseFloat(u.discamount||0),V+=parseFloat(u.netamount||0),k+=parseFloat(u.Vat||0),C+=parseFloat(u.Vatablesales||0)});const n=e.table().footer().querySelectorAll("td, th");n[4]&&(n[4].textContent=l(r)),n[5]&&(n[5].textContent=l(d)),n[6]&&(n[6].textContent=l(V)),n[7]&&(n[7].textContent=l(k)),n[8]&&(n[8].textContent=l(C))}},j=()=>{if(c.value&&m.value&&new Date(c.value)>new Date(m.value)){alert("Start date cannot be later than end date"),c.value="",m.value="";return}f.value=!0,setTimeout(()=>{K.get(route("reports.ec"),{startDate:c.value,endDate:m.value,stores:p.value},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{f.value=!1},onError:a=>{f.value=!1,alert("Error loading data: "+Object.values(a).join(", "))}})},100)},H=()=>{p.value=[],c.value="",m.value="",j()};let A;return W([p,c,m],()=>{clearTimeout(A),A=setTimeout(j,500)},{deep:!0}),Y(()=>{clearTimeout(A)}),(a,e)=>(v(),U(J(L.value),{"active-tab":"REPORTS"},{main:N(()=>[f.value?(v(),S("div",re,e[3]||(e[3]=[t("div",{class:"bg-white p-4 rounded-lg shadow-lg"},[t("div",{class:"flex items-center"},[t("svg",{class:"animate-spin h-6 w-6 mr-3 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),t("span",null,"Loading...")])],-1)]))):y("",!0),t("div",se,[w.userRole.toUpperCase()==="ADMIN"||w.userRole.toUpperCase()==="SUPERADMIN"?(v(),S("div",ne,[M(te,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=r=>p.value=r),options:w.stores,label:"Stores"},null,8,["modelValue","options"])])):y("",!0),t("div",ue,[e[4]||(e[4]=t("label",{class:"block text-sm font-medium text-gray-700"},"Start Date",-1)),$(t("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=r=>c.value=r),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[_,c.value]])]),t("div",ie,[e[5]||(e[5]=t("label",{class:"block text-sm font-medium text-gray-700"},"End Date",-1)),$(t("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=r=>m.value=r),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[_,m.value]])]),t("div",{class:"flex items-end"},[t("button",{onClick:H,class:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-md"}," Clear Filters ")])]),M(ae,null,{default:N(()=>[t("div",de,[e[6]||(e[6]=t("div",{class:"text-xl font-semibold"},"Employee Charge Report",-1)),E.value?(v(),S("div",ce," Showing "+x(T.value)+" record(s) ",1)):y("",!0)]),E.value?y("",!0):(v(),S("div",me,e[7]||(e[7]=[t("div",{class:"text-gray-500 mb-4"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 mx-auto mb-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})]),t("p",{class:"text-lg font-medium"},"No employee charges found")],-1),t("p",{class:"text-gray-600"}," Try adjusting your search filters or select a different date range. ",-1)]))),E.value?(v(),U(X(q),{key:1,data:F.value,columns:I,class:"w-full relative display",options:z},{default:N(()=>[t("tfoot",null,[t("tr",null,[e[8]||(e[8]=t("th",null,"Grand Total",-1)),e[9]||(e[9]=t("th",null,null,-1)),e[10]||(e[10]=t("th",null,null,-1)),e[11]||(e[11]=t("th",null,null,-1)),t("th",null,x(l(i.value.grossamount)),1),t("th",null,x(l(i.value.discamount)),1),t("th",null,x(l(i.value.netamount)),1),t("th",null,x(l(i.value.Vat)),1),t("th",null,x(l(i.value.Vatablesales)),1)])])]),_:1},8,["data"])):y("",!0)]),_:1})]),_:1}))}};export{Re as default};
