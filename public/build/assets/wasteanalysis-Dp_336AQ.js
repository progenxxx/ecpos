import{C as g}from"./chart-8SaNzrGi.js";import{d as m,l as h,k as v,e as _,a as e,g as w,t as u,D as C,o as W}from"./app-yW5Rpkbn.js";const k={class:"bg-white/80 rounded-3xl shadow-xl border border-blue-100/50 p-6 relative overflow-hidden hover:scale-[1.02] transition-all duration-300"},S={class:"relative z-10 space-y-6"},q={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},A={class:"bg-red-50 rounded-xl p-4 border border-red-100 transform transition-all duration-300 hover:scale-105"},N={class:"text-2xl font-bold text-red-700"},D={class:"bg-blue-50 rounded-xl p-4 border border-blue-100 transform transition-all duration-300 hover:scale-105"},M={class:"text-2xl font-bold text-blue-700"},Q={class:"bg-purple-50 rounded-xl p-4 border border-purple-100 transform transition-all duration-300 hover:scale-105"},R={class:"text-2xl font-bold text-purple-700"},P={class:"h-[400px] relative z-10"},B={__name:"wasteanalysis",props:{selectedDateRange:{type:Object,required:!0},selectedStores:{type:Array,required:!0}},setup(y){const r=y,l=m(null);let i=null;const n=m({totalWasteCost:0,totalWasteQuantity:0,uniqueStores:0}),d=s=>{const t=Number(s);return new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(isNaN(t)?0:t)},c=s=>{if(!l.value)return;const t=l.value.getContext("2d");i&&i.destroy();const o=s.map(a=>a.itemname),f=s.map(a=>Math.abs(Number(a.total_waste_quantity))),x=s.map(a=>Math.abs(Number(a.total_waste_cost)));i=new g(t,{type:"bar",data:{labels:o,datasets:[{label:"Waste Quantity",data:f,backgroundColor:"rgba(239, 68, 68, 0.5)",borderColor:"rgba(239, 68, 68, 1)",borderWidth:1,yAxisID:"quantity"},{label:"Waste Cost (PHP)",data:x,backgroundColor:"rgba(59, 130, 246, 0.5)",borderColor:"rgba(59, 130, 246, 1)",borderWidth:1,yAxisID:"cost"}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{position:"top"},tooltip:{callbacks:{label:function(a){const b=a.raw;return a.datasetIndex===1?`Cost: ${d(b)}`:`Quantity: ${Math.round(b).toLocaleString()} units`}}}},scales:{quantity:{type:"linear",position:"left",title:{display:!0,text:"Waste Quantity (Units)"},ticks:{callback:a=>Math.round(a).toLocaleString()},grid:{drawOnChartArea:!0}},cost:{type:"linear",position:"right",title:{display:!0,text:"Waste Cost (PHP)"},ticks:{callback:a=>d(a)},grid:{drawOnChartArea:!1}}}}})},p=async()=>{try{const s={start_date:r.selectedDateRange.start_date,end_date:r.selectedDateRange.end_date,stores:r.selectedStores.map(o=>typeof o=="object"?o.NAME:o)},t=await C.post(route("get.top.wastes"),s);if(t.data&&t.data.data){const o=t.data.data;n.value={totalWasteCost:t.data.summary.totalWasteCost||0,totalWasteQuantity:t.data.summary.totalWasteQuantity||0,uniqueStores:t.data.summary.uniqueStores||0},c(o)}}catch(s){console.error("Error fetching waste data:",s),n.value={totalWasteCost:0,totalWasteQuantity:0,uniqueStores:0},c([])}};return h([()=>r.selectedDateRange.start_date,()=>r.selectedDateRange.end_date,()=>JSON.stringify(r.selectedStores)],()=>{p()}),v(()=>{p()}),(s,t)=>(W(),_("div",k,[t[4]||(t[4]=e("div",{class:"absolute inset-0 opacity-10 bg-red-100"},null,-1)),e("div",S,[t[3]||(t[3]=e("div",{class:"flex items-center justify-between"},[e("h3",{class:"text-xl font-bold text-gray-800 flex items-center"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 mr-3 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})]),w(" Top Waste Analysis ")])],-1)),e("div",q,[e("div",A,[t[0]||(t[0]=e("p",{class:"text-sm text-red-600 font-medium"},"Total Waste Cost",-1)),e("p",N,u(d(n.value.totalWasteCost)),1)]),e("div",D,[t[1]||(t[1]=e("p",{class:"text-sm text-blue-600 font-medium"},"Total Waste Quantity",-1)),e("p",M,u(Math.round(n.value.totalWasteQuantity).toLocaleString()),1)]),e("div",Q,[t[2]||(t[2]=e("p",{class:"text-sm text-purple-600 font-medium"},"Affected Stores",-1)),e("p",R,u(n.value.uniqueStores),1)])]),e("div",P,[e("canvas",{ref_key:"wasteChartRef",ref:l},null,512)])])]))}};export{B as default};
