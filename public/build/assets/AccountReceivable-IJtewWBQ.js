import{d as F,q as N,k as J,l as X,E as K,c as V,w as G,B as Z,o as h,e as T,a as r,f as x,b as _,j as $,v as P,t as f,u as ee,N as te}from"./app-DIsI2h6N.js";import{_ as ae}from"./AdminPanel-4mme3aov.js";import{_ as re}from"./Main-BuhnLEuc.js";import{_ as oe}from"./MultiSelectDropdown-B9XsDNK4.js";import{T as le}from"./TableContainer-BvhjGUIg.js";import{j as se,P as q,D as I}from"./dataTables-CYg83-KT.js";import"./buttons.print-0974EdRm.js";import"./buttons.colVis-ntoAnsIC.js";import{E as ne}from"./exceljs.min-BCSGA5zn.js";import"./RetailGroup-g15s03XT.js";import"./Logout-CSswU4gJ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                             */import"./Modal-DKCN2m9N.js";import"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-BHRlHpU4.js";import"./RetailItems-BxtVv693.js";import"./PartyCake143-D_7hneaj.js";const de={key:0,class:"fixed inset-0 bg-black bg-opacity-30 z-50 flex items-center justify-center"},ie={class:"mb-4 flex flex-wrap gap-4 p-4 bg-white rounded-lg shadow z-[999] sticky top-0"},ue={key:0,class:"flex-1 min-w-[200px]"},ce={class:"flex-1 min-w-[200px]"},pe={class:"flex-1 min-w-[200px]"},fe={class:"flex justify-between items-center mb-4"},me={key:0,class:"text-sm text-gray-600"},ye={key:0,class:"p-8 text-center bg-gray-50 rounded-lg"},Be={__name:"AccountReceivable",props:{ar:{type:Array,required:!0},stores:{type:Array,required:!0},userRole:{type:String,required:!0},filters:{type:Object,required:!0,default:()=>({startDate:"",endDate:"",selectedStores:[]})}},setup(b){window.$=window.jQuery=se,q.use(I);const m=F([]),c=F(""),p=F(""),y=F(!1),L=F(0),v=b,o=t=>{const e=parseFloat(t||0);return isNaN(e)?"0.00":e.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")},O=N(()=>v.userRole.toUpperCase()==="STORE"?re:ae);J(()=>{m.value=v.filters.selectedStores||[],c.value=v.filters.startDate||"",p.value=v.filters.endDate||""});const w=N(()=>{let t=[...v.ar];return m.value.length>0&&(t=t.filter(e=>m.value.includes(e.storename))),t}),A=N(()=>w.value&&w.value.length>0),n=N(()=>w.value.reduce((t,e)=>({charge:(t.charge||0)+parseFloat(e.charge||0),gcash:(t.gcash||0)+parseFloat(e.gcash||0),paymaya:(t.paymaya||0)+parseFloat(e.paymaya||0),card:(t.card||0)+parseFloat(e.card||0),loyaltycard:(t.loyaltycard||0)+parseFloat(e.loyaltycard||0),foodpanda:(t.foodpanda||0)+parseFloat(e.foodpanda||0),grabfood:(t.grabfood||0)+parseFloat(e.grabfood||0),representation:(t.representation||0)+parseFloat(e.representation||0)}),{charge:0,gcash:0,paymaya:0,card:0,loyaltycard:0,foodpanda:0,grabfood:0,representation:0})),z=[{data:"receiptid",title:"Receipt ID",footer:"Grand Total"},{data:"storename",title:"Store Name",footer:""},{data:"createddate",title:"Created Date",render:t=>t?new Date(t).toLocaleDateString():"",footer:""},{data:"charge",title:"Charge",render:t=>o(t),footer:function(){return o(n.value.charge)},className:"text-right"},{data:"gcash",title:"GCash",render:t=>o(t),footer:function(){return o(n.value.gcash)},className:"text-right"},{data:"paymaya",title:"PayMaya",render:t=>o(t),footer:function(){return o(n.value.paymaya)},className:"text-right"},{data:"card",title:"Card",render:t=>o(t),footer:function(){return o(n.value.card)},className:"text-right"},{data:"loyaltycard",title:"Loyalty Card",render:t=>o(t),footer:function(){return o(n.value.loyaltycard)},className:"text-right"},{data:"foodpanda",title:"Foodpanda",render:t=>o(t),footer:function(){return o(n.value.foodpanda)},className:"text-right"},{data:"grabfood",title:"GrabFood",render:t=>o(t),footer:function(){return o(n.value.grabfood)},className:"text-right"},{data:"representation",title:"Representation",render:t=>o(t),footer:function(){return o(n.value.representation)},className:"text-right"}],H=t=>{try{y.value=!0;const e=new ne.Workbook,d=e.addWorksheet("Account Receivable Data");d.columns=[{header:"Receipt ID",key:"receiptid",width:15},{header:"Store Name",key:"storename",width:20},{header:"Created Date",key:"createddate",width:15},{header:"Charge",key:"charge",width:12},{header:"GCash",key:"gcash",width:12},{header:"PayMaya",key:"paymaya",width:12},{header:"Card",key:"card",width:12},{header:"Loyalty Card",key:"loyaltycard",width:15},{header:"Foodpanda",key:"foodpanda",width:12},{header:"GrabFood",key:"grabfood",width:12},{header:"Representation",key:"representation",width:15}],d.getRow(1).font={bold:!0},d.getRow(1).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF343A40"}},d.getRow(1).font={color:{argb:"FFFFFFFF"}};const u=t.rows({search:"applied"}).data().toArray();u.forEach(a=>{const l=d.addRow({receiptid:a.receiptid,storename:a.storename,createddate:a.createddate?new Date(a.createddate):null,charge:parseFloat(a.charge||0),gcash:parseFloat(a.gcash||0),paymaya:parseFloat(a.paymaya||0),card:parseFloat(a.card||0),loyaltycard:parseFloat(a.loyaltycard||0),foodpanda:parseFloat(a.foodpanda||0),grabfood:parseFloat(a.grabfood||0),representation:parseFloat(a.representation||0)});for(let g=4;g<=11;g++)l.getCell(g).value!==null&&(l.getCell(g).numFmt="#,##0.00");l.getCell(3).value&&(l.getCell(3).numFmt="yyyy-mm-dd")});const C=u.reduce((a,l)=>a+parseFloat(l.charge||0),0),k=u.reduce((a,l)=>a+parseFloat(l.gcash||0),0),D=u.reduce((a,l)=>a+parseFloat(l.paymaya||0),0),R=u.reduce((a,l)=>a+parseFloat(l.card||0),0),S=u.reduce((a,l)=>a+parseFloat(l.loyaltycard||0),0),E=u.reduce((a,l)=>a+parseFloat(l.foodpanda||0),0),s=u.reduce((a,l)=>a+parseFloat(l.grabfood||0),0),U=u.reduce((a,l)=>a+parseFloat(l.representation||0),0),i=d.addRow({receiptid:"Total",storename:"",createddate:"",charge:C,gcash:k,paymaya:D,card:R,loyaltycard:S,foodpanda:E,grabfood:s,representation:U});i.font={bold:!0},i.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF007BFF"}},i.font={color:{argb:"FFFFFFFF"}};for(let a=4;a<=11;a++)i.getCell(a).value!==null&&(i.getCell(a).numFmt="#,##0.00");e.xlsx.writeBuffer().then(a=>{const l=new Blob([a],{type:"application/octet-stream"}),g=document.createElement("a");g.href=URL.createObjectURL(l);const B=new Date,Y=`${B.getFullYear()}-${(B.getMonth()+1).toString().padStart(2,"0")}-${B.getDate().toString().padStart(2,"0")}`;g.download=`Account_Receivable_Report_${Y}.xlsx`,g.click(),y.value=!1,alert("Export completed successfully!")}).catch(a=>{console.error("Excel export error:",a),y.value=!1,alert("Error exporting to Excel: "+a.message)})}catch(e){console.error("Error in Excel export:",e),y.value=!1,alert("Error preparing Excel export: "+e.message)}},Q={responsive:!0,order:[[1,"asc"],[0,"asc"]],pageLength:25,lengthMenu:[[10,25,50,100,-1],[10,25,50,100,"All"]],dom:"Blfrtip",scrollX:!0,scrollY:"50vh",buttons:["copy",{text:"Export Excel",action:function(t,e,d,u){H(e)}},"pdf","print"],drawCallback:function(t){const e=new I.Api(t);L.value=e.rows({search:"applied"}).count();let d=0,u=0,C=0,k=0,D=0,R=0,S=0,E=0;e.rows({search:"applied"}).every(function(U){const i=this.data();d+=parseFloat(i.charge||0),u+=parseFloat(i.gcash||0),C+=parseFloat(i.paymaya||0),k+=parseFloat(i.card||0),D+=parseFloat(i.loyaltycard||0),R+=parseFloat(i.foodpanda||0),S+=parseFloat(i.grabfood||0),E+=parseFloat(i.representation||0)});const s=e.table().footer().querySelectorAll("td, th");s[3]&&(s[3].textContent=o(d)),s[4]&&(s[4].textContent=o(u)),s[5]&&(s[5].textContent=o(C)),s[6]&&(s[6].textContent=o(k)),s[7]&&(s[7].textContent=o(D)),s[8]&&(s[8].textContent=o(R)),s[9]&&(s[9].textContent=o(S)),s[10]&&(s[10].textContent=o(E))}},M=()=>{if(c.value&&p.value&&new Date(c.value)>new Date(p.value)){alert("Start date cannot be later than end date"),c.value="",p.value="";return}y.value=!0,setTimeout(()=>{te.get(route("reports.ar"),{startDate:c.value,endDate:p.value,stores:m.value},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{y.value=!1},onError:t=>{y.value=!1,alert("Error loading data: "+Object.values(t).join(", "))}})},100)},W=()=>{m.value=[],c.value="",p.value="",M()};let j;return X([m,c,p],()=>{clearTimeout(j),j=setTimeout(M,500)},{deep:!0}),K(()=>{clearTimeout(j)}),(t,e)=>(h(),V(Z(O.value),{"active-tab":"REPORTS"},{main:G(()=>[y.value?(h(),T("div",de,e[3]||(e[3]=[r("div",{class:"bg-white p-4 rounded-lg shadow-lg"},[r("div",{class:"flex items-center"},[r("svg",{class:"animate-spin h-6 w-6 mr-3 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[r("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),r("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),r("span",null,"Loading...")])],-1)]))):x("",!0),r("div",ie,[b.userRole.toUpperCase()==="ADMIN"||b.userRole.toUpperCase()==="SUPERADMIN"?(h(),T("div",ue,[_(oe,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=d=>m.value=d),options:b.stores,label:"Stores"},null,8,["modelValue","options"])])):x("",!0),r("div",ce,[e[4]||(e[4]=r("label",{class:"block text-sm font-medium text-gray-700"},"Start Date",-1)),$(r("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=d=>c.value=d),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[P,c.value]])]),r("div",pe,[e[5]||(e[5]=r("label",{class:"block text-sm font-medium text-gray-700"},"End Date",-1)),$(r("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=d=>p.value=d),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[P,p.value]])]),r("div",{class:"flex items-end"},[r("button",{onClick:W,class:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-md"}," Clear Filters ")])]),_(le,null,{default:G(()=>[r("div",fe,[e[6]||(e[6]=r("div",{class:"text-xl font-semibold"},"Account Receivable Report",-1)),A.value?(h(),T("div",me," Showing "+f(L.value)+" record(s) ",1)):x("",!0)]),A.value?x("",!0):(h(),T("div",ye,e[7]||(e[7]=[r("div",{class:"text-gray-500 mb-4"},[r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 mx-auto mb-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})]),r("p",{class:"text-lg font-medium"},"No receivables found")],-1),r("p",{class:"text-gray-600"}," Try adjusting your search filters or select a different date range. ",-1)]))),A.value?(h(),V(ee(q),{key:1,data:w.value,columns:z,class:"w-full relative display",options:Q},{default:G(()=>[r("tfoot",null,[r("tr",null,[e[8]||(e[8]=r("th",null,"Grand Total",-1)),e[9]||(e[9]=r("th",null,null,-1)),e[10]||(e[10]=r("th",null,null,-1)),r("th",null,f(parseFloat(n.value.charge).toFixed(2)),1),r("th",null,f(parseFloat(n.value.gcash).toFixed(2)),1),r("th",null,f(parseFloat(n.value.paymaya).toFixed(2)),1),r("th",null,f(parseFloat(n.value.card).toFixed(2)),1),r("th",null,f(parseFloat(n.value.loyaltycard).toFixed(2)),1),r("th",null,f(parseFloat(n.value.foodpanda).toFixed(2)),1),r("th",null,f(parseFloat(n.value.grabfood).toFixed(2)),1),r("th",null,f(parseFloat(n.value.representation).toFixed(2)),1)])])]),_:1},8,["data"])):x("",!0)]),_:1})]),_:1}))}};export{Be as default};
