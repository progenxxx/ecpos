import{q as oe,T as A,o as D,c as $,w as a,b as e,i as L,a as s,u as t,n as k,g as w,k as P,l as _,t as q,d as T,p as C,e as V,f as te,F as se}from"./app-DIsI2h6N.js";import{M as re}from"./DaisyModal-BYmrtLkj.js";import{_ as b}from"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-BHRlHpU4.js";import{_ as y,a as M,b as E}from"./InputError-CQ9k2kyq.js";import{F as ae}from"./FormComponent-C5C7769U.js";import{M as B}from"./Modal-DKCN2m9N.js";import{_ as le}from"./SuccessButton-C3nHCW3W.js";import{_ as ne}from"./Main-BuhnLEuc.js";import{S as ie}from"./Send-QmWLaeA6.js";import{A as de}from"./Add-DQTJFhMd.js";import{T as F}from"./TableContainer-BvhjGUIg.js";import{P as O,D as ce}from"./dataTables-CYg83-KT.js";/* empty css                                                                   */import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Logout-CSswU4gJ.js";/* empty css                                                             */import"./PartyCake143-D_7hneaj.js";const ue={class:"grid grid-cols-1"},me={class:"col-span-1"},pe={class:"grid grid-cols-1 gap-4"},fe={__name:"Create",props:{showModal:{type:Boolean,default:!1}},setup(c,{emit:m}){oe(()=>$page.props.auth.user.storeid);const l=A({storeid:"",description:""}),o=()=>{l.post("/StockCounting",{preserveScroll:!0,onSuccess:()=>l.reset()})},u=m,g=()=>{u("toggleActive")};return(p,i)=>(D(),$(re,{title:"GENERATE STOCK COUNTING",onToggleActive:g,"show-modal":c.showModal},{content:a(()=>[e(ae,{onSubmit:L(o,["prevent"])},{default:a(()=>[s("div",ue,[s("div",me,[s("div",pe,[s("div",null,[e(y,{for:"STORE",value:"The system has been automatically generated with reference #"}),e(M,{id:"storeid",modelValue:t(l).storeid,"onUpdate:modelValue":i[0]||(i[0]=n=>t(l).storeid=n),type:"text",class:"mt-1 block w-full hidden","is-error":!!t(l).errors.storeid,value:p.$page.props.auth.user.storeid,autofocus:"",disabled:""},null,8,["modelValue","is-error","value"]),e(E,{message:t(l).errors.storeid,class:"mt-2"},null,8,["message"])])])])])]),_:1})]),buttons:a(()=>[e(b,{type:"submit",onClick:o,disabled:t(l).processing,class:k({"opacity-25":t(l).processing})},{default:a(()=>i[1]||(i[1]=[w(" Generate ")])),_:1},8,["disabled","class"])]),_:1},8,["show-modal"]))}},ge={class:"grid grid-cols-3"},ve={class:"col-span-3"},Ne={class:"col-span-3"},Te={class:"col-span-3 mt-4"},be={__name:"Update",props:{JOURNALID:{type:[String,Number],required:!0},LINENUM:{type:[String,Number],required:!0},COUNTED:{type:[String,Number],required:!0},showModal:{type:Boolean,default:!1}},setup(c,{emit:m}){const l=c,o=A({JOURNALID:"",LINENUM:"",COUNTED:""}),u=()=>{o.patch("/ItemOrders/patch",{preserveScroll:!0}),location.reload()},g=m,p=()=>{g("toggleActive")};return P(()=>{o.JOURNALID=l.JOURNALID,o.LINENUM=l.LINENUM,_(()=>l.JOURNALID,i=>{o.JOURNALID=i}),_(()=>l.LINENUM,i=>{o.LINENUM=i})}),(i,n)=>(D(),$(B,{title:"UPDATE QTY",onToggleActive:p,"show-modal":c.showModal},{content:a(()=>[s("form",{onSubmit:L(u,["prevent"]),class:"px-2 py-3 max-h-[50vh] lg:max-h-[70vh] overflow-y-auto"},[s("div",ge,[s("div",ve,[e(y,{for:"JOURNALID",value:"JOURNALID"}),e(M,{id:"JOURNALID",modelValue:t(o).JOURNALID,"onUpdate:modelValue":n[0]||(n[0]=N=>t(o).JOURNALID=N),type:"text",class:"mt-1 block w-full input","is-error":!!t(o).errors.JOURNALID,autofocus:"",disabled:""},null,8,["modelValue","is-error"]),e(E,{message:t(o).errors.JOURNALID,class:"mt-2"},null,8,["message"])]),s("div",Ne,[e(y,{for:"LINENUM",value:"LINENUM"}),e(M,{id:"LINENUM",modelValue:t(o).LINENUM,"onUpdate:modelValue":n[1]||(n[1]=N=>t(o).LINENUM=N),type:"number",class:"mt-1 block w-full","is-error":!!t(o).errors.LINENUM,autofocus:"",disabled:""},null,8,["modelValue","is-error"]),e(E,{message:t(o).errors.LINENUM,class:"mt-2"},null,8,["message"])]),s("div",Te,[e(y,{for:"COUNTED",value:"QTY"}),e(M,{id:"COUNTED",modelValue:t(o).COUNTED,"onUpdate:modelValue":n[2]||(n[2]=N=>t(o).COUNTED=N),"is-error":!!t(o).errors.COUNTED,type:"text",class:"mt-1 block w-full"},null,8,["modelValue","is-error"]),e(E,{message:t(o).errors.COUNTED,class:"mt-2"},null,8,["message"])])])],32)]),buttons:a(()=>[e(b,{type:"submit",onClick:u,disabled:t(o).processing,class:k({"opacity-25":t(o).processing})},{default:a(()=>n[3]||(n[3]=[w(" SUBMIT ")])),_:1},8,["disabled","class"])]),_:1},8,["show-modal"]))}},he={class:"col-span-6 sm:col-span-4 font-thin text-sm px-1"},Ee={__name:"Post",props:{journalid:{type:[String,Number],required:!0}},setup(c,{emit:m}){const l=c,o=A({journalid:l.journalid}),u=()=>{console.log("Submitting form..."),o.patch("/ItemOrders/post",{preserveScroll:!0,onSuccess:()=>{console.log("Form submission successful."),p()},onError:i=>{console.error("Form submission error:",i)}})},g=m,p=()=>{g("toggleActive")};return P(()=>{o.journalid=l.journalid,_(()=>l.journalid,i=>{o.journalid=i})}),(i,n)=>(D(),$(B,{title:"Post all lines",onToggleActive:p,"show-modal":i.showModal},{content:a(()=>[s("form",{onSubmit:L(u,["prevent"]),class:"mt-3",method:"DELETE"},[s("div",he," Are you sure you want to post all entries associated with data ID "+q(c.journalid)+"? ",1),e(E,{message:t(o).errors.ID,class:"mt-2"},null,8,["message"])],32)]),buttons:a(()=>[e(b,{type:"submit",onClick:u,disabled:t(o).processing,class:k({"opacity-25":t(o).processing})},{default:a(()=>n[0]||(n[0]=[w(" CONFIRM ")])),_:1},8,["disabled","class"])]),_:1},8,["show-modal"]))}},De={key:0,class:"fixed inset-0 flex items-center justify-center z-50"},we={class:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded shadow-lg"},Ie={class:"absolute adjust"},ye={class:"flex justify-start items-center"},Me={class:"flex justify-start"},Se={class:"absolute adjust"},Ue={class:"flex justify-start items-center"},We={__name:"Index",props:{stockcountingtables:{type:Array,required:!0},orders:{type:Array,required:!0}},setup(c){O.use(ce);const m=T(""),l=T(""),o=T(!1),u=T(!1),g=T(!1),p=T(!1),i=T(!1),n=c,N=[{data:"STOREID",title:"STOREID"},{data:"POSTEDDATETIME",title:"POSTEDDATETIME",render:function(d,r,h){return new Date(d).toLocaleDateString()}},{data:"ITEMID",title:"ITEMID"},{data:"COUNTED",title:"COUNTED"}],H=[{data:"description",title:"BATCH #"},{data:"qty",title:"QTY"},{data:"createddatetime",title:"DATE"},{data:null,render:"#action",title:"ACTIONS"}],j={paging:!1,scrollX:!0,scrollY:"60vh",scrollCollapse:!0,order:[[2,"desc"]]},W=()=>{u.value=!0},Y=()=>{o.value=!1},G=()=>{u.value=!1},z=()=>{g.value=!1},K=()=>{p.value=!1},Q=()=>{i.value=!1},X=d=>{console.log("Redirecting to Item Order Entries for account:",d),window.location.href=`/StockCountingLine/${d}`};async function x(){if(!n.orders||n.orders.length===0){alert("No orders available to generate file.");return}const d=n.orders[0].STOREID;if(!d){alert("Store ID is missing from the order data.");return}const r=new Date(n.orders[0].POSTEDDATETIME);if(isNaN(r.getTime())){alert("Invalid posted date in the order data.");return}const h=`${r.getFullYear()}${(r.getMonth()+1).toString().padStart(2,"0")}${r.getDate().toString().padStart(2,"0")}`,I=`${d}${h}.txt`,S=`${d}|${r.toLocaleDateString()}`,f=n.orders.filter(v=>v.COUNTED>0).map(v=>`${v.ITEMID}|${Math.floor(v.COUNTED)}`);if(f.length===0){alert("No items with non-zero counts to report.");return}const R=[S,...f].join(`
`),Z=h;try{const J=await(await fetch("/save-file",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({content:R,filename:I,folderName:Z})})).text();console.log("Full server response:",J);let U;try{U=JSON.parse(J)}catch(ee){console.error("Error parsing JSON:",ee),alert("Error: Server returned an invalid response. Please clear your cache!");return}U.success?(alert("Your order has been successfully sent to the head office!"),location.reload()):alert("Error saving file: "+(U.message||"Unknown error"))}catch(v){console.error("Error:",v),alert("Error saving file: "+v.message)}}return(d,r)=>{const h=C("SendModal"),I=C("More"),S=C("ExcelIcon");return D(),V(se,null,[d.showWarning?(D(),V("div",De,[s("div",we,[r[2]||(r[2]=s("p",{class:"font-bold"},"Warning",-1)),s("p",null,"It's "+q(d.currentTime)+"!",1),s("button",{onClick:r[0]||(r[0]=(...f)=>d.closeWarning&&d.closeWarning(...f)),class:"mt-2 bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded"}," Close ")])])):te("",!0),e(ne,{"active-tab":"STOCK"},{modals:a(()=>[e(fe,{"show-modal":u.value,onToggleActive:G},null,8,["show-modal"]),e(be,{"show-modal":o.value,journalid:m.value,description:l.value,onToggleActive:Y},null,8,["show-modal","journalid","description"]),e(h,{"show-modal":g.value,"item-name":"inventjournaltables",journalid:m.value,onToggleActive:z},null,8,["show-modal","journalid"]),e(Ee,{"show-modal":i.value,"item-name":"inventjournaltrans",journalid:m.value,onToggleActive:Q},null,8,["show-modal","journalid"]),e(I,{"show-modal":p.value,accountnum:d.accountnum,onToggleActive:K},null,8,["show-modal","accountnum"])]),main:a(()=>[e(F,null,{default:a(()=>[s("div",Ie,[s("div",ye,[e(b,{type:"button",onClick:W,class:"m-6 bg-navy"},{default:a(()=>[e(de,{class:"h-4"})]),_:1}),e(b,{class:"ml-5 cursor-pointer bg-navy hidden",onClick:x},{default:a(()=>[e(ie,{class:"h-4"})]),_:1}),r[3]||(r[3]=s("label",{class:"inline-flex items-center font-bold"}," BATCH COUNTING ",-1)),s("button",{onClick:r[1]||(r[1]=(...f)=>d.startWarningSound&&d.startWarningSound(...f)),hidden:""},"Start Warning Sound")])]),e(t(O),{data:c.stockcountingtables,columns:H,class:"w-full relative display",options:j},{action:a(f=>[s("div",Me,[e(b,{class:"cursor-pointer bg-navy",onClick:R=>X(f.cellData.journalid)},{default:a(()=>r[4]||(r[4]=[w(" Count ")])),_:2},1032,["onClick"])])]),_:1},8,["data"])]),_:1}),e(F,{class:"hidden"},{default:a(()=>[s("div",Se,[s("div",Ue,[r[5]||(r[5]=w("           ")),s("button",{onClick:x},"Generate and Download Text File"),e(le,{type:"button",onClick:d.exportToExcel,class:"m-6 bg-green"},{default:a(()=>[e(S,{class:"h-4"})]),_:1},8,["onClick"])])]),e(t(O),{data:c.orders,columns:N,class:"w-full relative display",options:j},{action:a(f=>r[6]||(r[6]=[s("div",{class:"flex justify-start"},null,-1)])),_:1},8,["data"])]),_:1})]),_:1})],64)}}};export{We as default};
