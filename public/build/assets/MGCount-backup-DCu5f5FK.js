import{T as j,H as z,s as i,d as g,D as E,p as P,e as O,t as q,f as J,b as s,w as d,F as W,o as _,a as r,i as K,j as A,v as $,u as l,n as X,g as G}from"./app-NPxLYQzb.js";import{_ as Q}from"./AdminPanel-wIY7u0qA.js";import{T as Z}from"./TableContainer-fwPJTGzy.js";import{P as B,D as tt}from"./dataTables-B8uMeSpA.js";import{_ as et}from"./SuccessButton-BNUgJNAf.js";import{_ as at}from"./TransparentButton-9Q4xnQTP.js";import{_ as x}from"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-COOUSa13.js";import{E as ot}from"./Excel-Bqkg731v.js";import{S as rt}from"./Save-Dp3M99SR.js";import{S as st}from"./SearchColored-89nj1I8r.js";import"./dataTables.fixedColumns-599d1fBV.js";import{E as nt}from"./exceljs.min-DeYFmjAR.js";import"./RetailGroup-v8sjJEH1.js";import"./Logout-CsEENbA9.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                             */import"./Modal-LJRun7uo.js";import"./RetailItems-DeQMtUxX.js";import"./Attendance-BB-OHPzQ.js";const lt={key:0,class:"fixed top-5 right-5 bg-navy text-white border border-gray-300 rounded-lg shadow-lg p-4 z-50"},ut={class:"absolute adjust"},dt={class:"flex justify-start items-center"},it=["value"],ct={"date-rangepicker":"",class:"flex items-center"},pt={class:"relative ml-5"},mt=["placeholder"],ft={class:"relative"},gt=["placeholder"],Lt={__name:"MGCount-backup",props:{orders:{type:Array,required:!0}},setup(L,{emit:vt}){B.use(tt);const V=L,n=j({StartDate:"",EndDate:""}),D=()=>{n.get(route("orderingconso.getrange"),{preserveScroll:!0})},N={paging:!1,scrollX:!0,scrollY:"60vh",scrollCollapse:!0,error:function(e,t,o){console.error("DataTables error:",t)}},v=z(V.orders.reduce((e,t)=>{const{STORENAME:o,ITEMID:a,ITEMNAME:u,CATEGORY:m,COUNTED:f,MGCOUNT:c}=t,I=parseInt(f)||0,U=parseInt(c)||0;return e[a]||(e[a]={ITEMID:a,ITEMNAME:u,CATEGORY:m,TOTAL:0,MGCount:U,BalanceCount:0}),e[a][o]||(e[a][o]=0),e[a][o]+=I,e[a].TOTAL+=I,e[a].BalanceCount=e[a].MGCount-e[a].TOTAL,e},{})),h=i(()=>Object.values(v)),b=i(()=>{const e=new Set;return h.value.forEach(t=>{Object.keys(t).forEach(o=>{o!=="ITEMID"&&o!=="ITEMNAME"&&o!=="CATEGORY"&&o!=="TOTAL"&&o!=="MGCount"&&o!=="BalanceCount"&&e.add(o)})}),e}),y=i(()=>[{title:"ITEMID",data:"ITEMID"},{title:"ITEMS",data:"ITEMNAME"},{title:"CATEGORY",data:"CATEGORY"},{title:"ACTUAL INV COUNT",data:"MGCount",render:(e,t,o)=>t==="display"?`<input type="number" value="${e}" onchange="window.updateMGCount('${o.ITEMID}', this.value)" />`:e},{title:"REMAINING STOCKS",data:"BalanceCount"},{title:"TOTAL DISPATCH",data:"TOTAL"},...Array.from(b.value).map(e=>({title:e,data:e,render:(t,o,a)=>o==="display"?`<input type="number" value="${t}" onchange="window.updateCounted('${a.ITEMID}', '${e}', this.value)" />`:t}))]),p=g(!1),C=g(""),R=()=>{const e=h.value.map(t=>{const o={};return Array.from(b.value).forEach(a=>{o[a]=t[a]||0}),{itemId:t.ITEMID,mgCount:t.MGCount,balanceCount:t.BalanceCount,counted:o}});console.log("Data to save:",JSON.stringify(e,null,2)),E.post(route("save.all.data"),{data:e}).then(t=>{console.log("All data saved successfully:",t.data),C.value="Data saved successfully!",p.value=!0,setTimeout(()=>{p.value=!1},3e3)}).catch(t=>{console.error("Error saving data:",t),t.response&&console.error("Error response:",t.response.data),C.value="Error saving data. Please try again.",p.value=!0,setTimeout(()=>{p.value=!1},3e3)})};window.updateMGCount=function(e,t){const o=v[e];o&&(o.MGCount=parseInt(t,10)||0,o.BalanceCount=o.MGCount-o.TOTAL,E.post("/api/update-mgcount",{itemId:e,mgCount:o.MGCount}).then(a=>{console.log("MGCount updated successfully")}).catch(a=>{console.error("Error updating MGCount:",a)}))},window.updateCounted=function(e,t,o){const a=v[e];a&&(a[t]=parseInt(o,10)||0,a.TOTAL=Array.from(b.value).reduce((u,m)=>u+(a[m]||0),0),a.BalanceCount=a.TOTAL-a.MGCount,E.post("/api/update-counted",{itemId:e,storeName:t,counted:a[t],total:a.TOTAL,balanceCount:a.BalanceCount}).then(u=>{console.log("Counted updated successfully")}).catch(u=>{console.error("Error updating Counted:",u)}))};const M=i(()=>h.value.map(e=>{const t={...e};return y.value.forEach(o=>{t.hasOwnProperty(o.data)||(t[o.data]="0")}),t})),k=g(null),T=i(()=>{if(k.value){const e=new Date(k.value),t=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}-${o}-${a}`}return""}),S=g(null),w=i(()=>{if(S.value){const e=new Date(S.value),t=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}-${o}-${a}`}return""});i(()=>{const e=new Date,t=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}${o}${a}`});async function F(){try{const e=new nt.Workbook,t=e.addWorksheet("Flattened Orders");t.columns=y.value.map(c=>({header:c.title,key:c.data,width:15})),M.value.forEach(c=>{t.addRow(c)});const o=new Date,a=`FlattenedOrders_${o.getFullYear()}-${o.getMonth()+1}-${o.getDate()}.xlsx`,u=await e.xlsx.writeBuffer(),m=new Blob([u],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),f=document.createElement("a");f.href=URL.createObjectURL(m),f.download=a,f.click()}catch(e){console.error("Error exporting to Excel:",e)}}const Y=()=>{window.location.href="/picklist"},H=()=>{window.location.href="/cakepicklist"};return(e,t)=>{const o=P("InputError");return _(),O(W,null,[p.value?(_(),O("div",lt,q(C.value),1)):J("",!0),s(Q,{"active-tab":"REPORTS"},{main:d(()=>[s(Z,null,{default:d(()=>[r("div",ut,[r("div",dt,[r("form",{onSubmit:K(D,["prevent"]),class:"px-2 py-3 max-h-[50vh] lg:max-h-[70vh] overflow-y-auto"},[r("input",{type:"hidden",name:"_token",value:e.$page.props.csrf_token},null,8,it),r("div",ct,[r("div",pt,[t[4]||(t[4]=r("div",{class:"flex absolute inset-y-0 left-0 items-center pl-3 pointer-events-none"},[r("svg",{class:"w-5 h-5 text-gray-500 dark:text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[r("path",{"fill-rule":"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z","clip-rule":"evenodd"})])],-1)),A(r("input",{id:"StartDate",type:"date","onUpdate:modelValue":t[0]||(t[0]=a=>l(n).StartDate=a),onInput:t[1]||(t[1]=(...a)=>T.value&&T.value(...a)),placeholder:T.value,class:"bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",required:""},null,40,mt),[[$,l(n).StartDate]]),s(o,{message:l(n).errors.StartDate,class:"mt-2"},null,8,["message"])]),t[6]||(t[6]=r("span",{class:"mx-4 text-gray-500"},"to",-1)),r("div",ft,[t[5]||(t[5]=r("div",{class:"flex absolute inset-y-0 left-0 items-center pl-3 pointer-events-none"},[r("svg",{class:"w-5 h-5 text-gray-500 dark:text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[r("path",{"fill-rule":"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z","clip-rule":"evenodd"})])],-1)),A(r("input",{id:"EndDate",type:"date","onUpdate:modelValue":t[2]||(t[2]=a=>l(n).EndDate=a),onInput:t[3]||(t[3]=(...a)=>w.value&&w.value(...a)),placeholder:w.value,class:"bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",required:""},null,40,gt),[[$,l(n).EndDate]]),s(o,{message:l(n).errors.EndDate,class:"mt-2"},null,8,["message"])])])],32),s(at,{type:"submit",onClick:D,disabled:l(n).processing,class:X({"opacity-25":l(n).processing})},{default:d(()=>[s(st,{class:"h-8"})]),_:1},8,["disabled","class"]),s(et,{type:"button",onClick:F,class:"m-6 bg-green"},{default:d(()=>[s(ot,{class:"h-4"})]),_:1}),s(x,{type:"button",onClick:R,class:"m-6"},{default:d(()=>[s(rt,{class:"h-4"})]),_:1}),s(x,{type:"button",onClick:Y,class:"m-1 bg-green"},{default:d(()=>t[7]||(t[7]=[G(" Breads ")])),_:1}),s(x,{type:"button",onClick:H,class:"m-1 bg-green"},{default:d(()=>t[8]||(t[8]=[G(" Cakes ")])),_:1})])]),s(l(B),{data:M.value,columns:y.value,class:"w-full relative display",options:N},{action:d(a=>t[9]||(t[9]=[r("div",{class:"flex justify-start"},null,-1)])),_:1},8,["data","columns"])]),_:1})]),_:1})],64)}}};export{Lt as default};
