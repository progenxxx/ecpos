import{d as m,T as R,H as Y,s as l,D as E,e as g,t as F,f as j,b as n,w as u,n as U,o as v,a as s,F as V,g as b,u as z}from"./app-DwAHA_Mt.js";import{_ as P}from"./AdminPanel-1DfNN1pO.js";import{T as H}from"./TableContainer-PwYTmfDA.js";import{P as I,D as J}from"./dataTables-7Vvj0GSY.js";import{_ as W}from"./SuccessButton-BWQ5NcUW.js";import{_ as M}from"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-DsXaYi2t.js";import{E as q}from"./Excel-Ccvbr3BQ.js";import{S as K}from"./Save-CyUTnkDp.js";import"./dataTables.fixedColumns-HOZudcR9.js";import{E as X}from"./exceljs.min-Z3crVyW7.js";import"./RetailGroup-ClNQ_vXI.js";import"./Logout-96D5XcFa.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                             */import"./Modal-DosvBnh2.js";import"./RetailItems-i_spRMW5.js";import"./Attendance-CVSU-1NF.js";const Q={key:0,class:"fixed top-5 right-5 bg-green-900 text-white border border-gray-300 rounded-lg shadow-lg p-4 z-50"},Z={class:"absolute adjust"},tt={class:"flex justify-start items-center"},et={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50"},wt={__name:"MGCount copy 2",props:{orders:{type:Array,required:!0}},setup(S,{emit:at}){I.use(J);const c=m(!1),$=S;R({StartDate:"",EndDate:""});const _={paging:!1,scrollX:!0,scrollY:"60vh",scrollCollapse:!0,error:function(t,e,a){console.error("DataTables error:",e)}},C=Y($.orders.reduce((t,e)=>{const{STORENAME:a,ITEMID:o,ITEMNAME:r,CATEGORY:p,COUNTED:f,MGCOUNT:i}=e,D=parseInt(f)||0,N=parseInt(i)||0;return t[o]||(t[o]={ITEMID:o,ITEMNAME:r,CATEGORY:p,TOTAL:0,MGCount:N,BalanceCount:0}),t[o][a]||(t[o][a]=0),t[o][a]+=D,t[o].TOTAL+=D,t[o].BalanceCount=t[o].MGCount-t[o].TOTAL,t},{})),T=l(()=>Object.values(C)),y=l(()=>{const t=new Set;return T.value.forEach(e=>{Object.keys(e).forEach(a=>{a!=="ITEMID"&&a!=="ITEMNAME"&&a!=="CATEGORY"&&a!=="TOTAL"&&a!=="MGCount"&&a!=="BalanceCount"&&t.add(a)})}),t}),w=l(()=>[{title:"ITEMID",data:"ITEMID",render:(t,e,a)=>e==="display"?`<span>${t}</span>`:t},{title:"ITEMS",data:"ITEMNAME",render:(t,e,a)=>e==="display"?`<span>${t}</span>`:t},{title:"CATEGORY",data:"CATEGORY",render:(t,e,a)=>e==="display"?`<span>${t}</span>`:t},{title:"ACTUAL INV COUNT",data:"MGCount",render:(t,e,a)=>e==="display"?`<input type="number" value="${t}" onchange="window.updateMGCount('${a.ITEMID}', this.value)" />`:t},{title:"REMAINING STOCKS",data:"BalanceCount",render:(t,e,a)=>e==="display"?`<span>${t}</span>`:t},{title:"TOTAL ALLOCATION",data:"TOTAL",render:(t,e,a)=>e==="display"?`<span>${t}</span>`:t},...Array.from(y.value).map(t=>({title:t,data:t,render:(e,a,o)=>a==="display"?`<input type="number" value="${e}" onchange="window.updateCounted('${o.ITEMID}', '${t}', this.value)" />`:e}))]),d=m(!1),h=m(""),k=()=>{c.value=!0;const t=T.value.map(e=>{const a={};return Array.from(y.value).forEach(o=>{a[o]=e[o]||0}),{itemId:e.ITEMID,mgCount:e.MGCount,balanceCount:e.BalanceCount,counted:a}});console.log("Data to save:",JSON.stringify(t,null,2)),E.post(route("save.all.data"),{data:t}).then(e=>{console.log("All data saved successfully:",e.data),h.value="Data saved successfully!",d.value=!0,setTimeout(()=>{d.value=!1},3e3)}).catch(e=>{console.error("Error saving data:",e),e.response&&console.error("Error response:",e.response.data),h.value="Error saving data. Please try again.",d.value=!0,setTimeout(()=>{d.value=!1},3e3)}).finally(()=>{c.value=!1})};window.updateMGCount=function(t,e){const a=C[t];a&&(a.MGCount=parseInt(e,10)||0,a.BalanceCount=a.MGCount-a.TOTAL,E.post("/api/update-mgcount",{itemId:t,mgCount:a.MGCount}).then(o=>{console.log("MGCount updated successfully")}).catch(o=>{console.error("Error updating MGCount:",o)}))},window.updateCounted=function(t,e,a){const o=C[t];o&&(o[e]=parseInt(a,10)||0,o.TOTAL=Array.from(y.value).reduce((r,p)=>r+(o[p]||0),0),o.BalanceCount=o.TOTAL-o.MGCount,E.post("/api/update-counted",{itemId:t,storeName:e,counted:o[e],total:o.TOTAL,balanceCount:o.BalanceCount}).then(r=>{console.log("Counted updated successfully")}).catch(r=>{console.error("Error updating Counted:",r)}))};const O=l(()=>T.value.map(t=>{const e={...t};return w.value.forEach(a=>{e.hasOwnProperty(a.data)||(e[a.data]="0")}),e})),A=m(null);l(()=>{if(A.value){const t=new Date(A.value),e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0");return`${e}-${a}-${o}`}return""});const x=m(null);l(()=>{if(x.value){const t=new Date(x.value),e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0");return`${e}-${a}-${o}`}return""}),l(()=>{const t=new Date,e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0");return`${e}${a}${o}`});async function G(){try{const t=new X.Workbook,e=t.addWorksheet("Flattened Orders");e.columns=w.value.map(i=>({header:i.title,key:i.data,width:15})),O.value.forEach(i=>{e.addRow(i)});const a=new Date,o=`FlattenedOrders_${a.getFullYear()}-${a.getMonth()+1}-${a.getDate()}.xlsx`,r=await t.xlsx.writeBuffer(),p=new Blob([r],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),f=document.createElement("a");f.href=URL.createObjectURL(p),f.download=o,f.click()}catch(t){console.error("Error exporting to Excel:",t)}}const L=()=>{window.location.href="/picklist"},B=()=>{window.location.href="/cakepicklist"};return(t,e)=>(v(),g("div",{class:U({"blur-overlay":c.value})},[d.value?(v(),g("div",Q,F(h.value),1)):j("",!0),n(P,{"active-tab":"REPORTS"},{main:u(()=>[n(H,null,{default:u(()=>[s("div",Z,[s("div",tt,[n(W,{type:"button",onClick:G,class:"m-6 bg-green"},{default:u(()=>[n(q,{class:"h-4"})]),_:1}),n(M,{type:"button",onClick:k,class:"m-6",disabled:c.value},{default:u(()=>[c.value?(v(),g("div",et,e[0]||(e[0]=[s("div",{class:"bg-white p-5 rounded-lg flex items-center"},[s("svg",{class:"animate-spin h-5 w-5 mr-3 text-blue-500",viewBox:"0 0 24 24"},[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),s("span",{class:"text-blue-500"},"Saving data...")],-1)]))):(v(),g(V,{key:1},[n(K,{class:"h-4"}),e[1]||(e[1]=b(" Â  Save "))],64))]),_:1},8,["disabled"]),n(M,{type:"button",onClick:L,class:"m-1 bg-green"},{default:u(()=>e[2]||(e[2]=[b(" Breads ")])),_:1}),n(M,{type:"button",onClick:B,class:"m-1 bg-green"},{default:u(()=>e[3]||(e[3]=[b(" Cakes ")])),_:1})])]),n(z(I),{data:O.value,columns:w.value,class:"w-full relative display custom-datatable",options:_},{action:u(a=>e[4]||(e[4]=[s("div",{class:"flex justify-start"},null,-1)])),_:1},8,["data","columns"])]),_:1})]),_:1})],2))}};export{wt as default};
