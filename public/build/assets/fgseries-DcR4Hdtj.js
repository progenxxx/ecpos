import{u as ie}from"./vue-router-CK1RbHM7.js";import{q as B,T as H,o as y,c as Y,w as r,b as e,i as z,a,u as n,n as G,g as S,k as L,l as P,d as u,E as de,p as j,e as W,t as ce,f as ue,F as me}from"./app-BNPGhoL2.js";import{M as X}from"./DaisyModal-CYibNoIt.js";import{_ as D}from"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-B6Xc1nH0.js";import{_ as C,a as A,b as I}from"./InputError-AsoMIJ7j.js";import{F as J}from"./FormComponent-k5Mz26hM.js";import{_ as pe}from"./Post-BmKta6Oh.js";import{_ as ge}from"./SuccessButton-DyUAd238.js";import{_ as fe}from"./AdminPanel-C3by1daL.js";import"./FileSaver.min-BqHeZkLR.js";import"./exceljs.min-Bz6n0dRn.js";import{A as ve}from"./Add-BFYrmg51.js";import{T as q}from"./TableContainer-DOq29hCC.js";import{P as $,D as he}from"./dataTables-CYoR-ngT.js";import"./Modal-k3aPgSoE.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                                   */import"./RetailGroup-afsdHTlZ.js";import"./Logout-B5n2G0rZ.js";/* empty css                                                             */import"./RetailItems-BzVTUMDz.js";import"./Attendance-D3nGk9-s.js";const we={class:"grid grid-cols-1"},_e={class:"col-span-1"},Te={class:"grid grid-cols-1 gap-4"},be={__name:"Create",props:{showModal:{type:Boolean,default:!1}},setup(p,{emit:v}){B(()=>$page.props.auth.user.storeid);const l=H({storeid:"",description:""}),t=()=>{l.post("/d-inventory",{preserveScroll:!0,onSuccess:()=>l.reset()})},g=v,h=()=>{g("toggleActive")};return(w,d)=>(y(),Y(X,{title:"CREATE NEW ORDER",onToggleActive:h,"show-modal":p.showModal},{content:r(()=>[e(J,{onSubmit:z(t,["prevent"])},{default:r(()=>[a("div",we,[a("div",_e,[a("div",Te,[a("div",null,[e(C,{for:"STORE",value:"Your order has been automatically generated with FG Series #"}),e(A,{id:"storeid",modelValue:n(l).storeid,"onUpdate:modelValue":d[0]||(d[0]=i=>n(l).storeid=i),type:"text",class:"mt-1 block w-full hidden","is-error":!!n(l).errors.storeid,value:w.$page.props.auth.user.storeid,autofocus:"",disabled:""},null,8,["modelValue","is-error","value"]),e(I,{message:n(l).errors.storeid,class:"mt-2"},null,8,["message"])])])])])]),_:1})]),buttons:r(()=>[e(D,{type:"submit",onClick:t,disabled:n(l).processing,class:G({"opacity-25":n(l).processing})},{default:r(()=>d[1]||(d[1]=[S(" Generate ")])),_:1},8,["disabled","class"])]),_:1},8,["show-modal"]))}},ye={class:"col-span-6 sm:col-span-4"},Se={class:"col-span-6 sm:col-span-4"},De={__name:"Update",props:{journalid:{type:[String,Number],required:!0},description:{type:[String,Number],required:!0},showModal:{type:Boolean,default:!1}},setup(p,{emit:v}){const l=p,t=H({journalid:"",description:""}),g=()=>{t.patch("/order/patch",{preserveScroll:!0})},h=v,w=()=>{h("toggleActive")};return L(()=>{t.journalid=l.journalid,t.description=l.description,P(()=>l.journalid,d=>{t.journalid=d}),P(()=>l.description,d=>{t.description=d})}),(d,i)=>(y(),Y(X,{title:"Update Form",onToggleActive:w,"show-modal":p.showModal},{content:r(()=>[e(J,{onSubmit:z(g,["prevent"])},{default:r(()=>[a("div",ye,[e(C,{for:"journalid",value:"journalid"}),e(A,{id:"journalid",modelValue:n(t).journalid,"onUpdate:modelValue":i[0]||(i[0]=T=>n(t).journalid=T),type:"text",class:"mt-1 block w-full bg-blue-50","is-error":!!n(t).errors.journalid,disabled:""},null,8,["modelValue","is-error"]),e(I,{message:n(t).errors.journalid,class:"mt-2"},null,8,["message"])]),a("div",Se,[e(C,{for:"description",value:"DESCRIPTION",class:"pt-4"}),e(A,{id:"description",modelValue:n(t).description,"onUpdate:modelValue":i[1]||(i[1]=T=>n(t).description=T),"is-error":!!n(t).errors.description,type:"text",class:"mt-1 block w-full"},null,8,["modelValue","is-error"]),e(I,{message:n(t).errors.description,class:"mt-2"},null,8,["message"])])]),_:1})]),buttons:r(()=>[e(D,{type:"submit",onClick:g,disabled:n(t).processing,class:G({"opacity-25":n(t).processing})},{default:r(()=>i[2]||(i[2]=[S(" UPDATE ")])),_:1},8,["disabled","class"])]),_:1},8,["show-modal"]))}},Ee={key:0,class:"fixed inset-0 flex items-center justify-center z-50"},Me={class:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded shadow-lg"},je={class:"absolute adjust"},$e={class:"flex justify-start items-center"},Ce={class:"flex justify-start"},Ae={class:"absolute adjust"},Ie={class:"flex justify-start items-center"},et={__name:"fgseries",props:{inventjournaltables:{type:Array,required:!0},orders:{type:Array,required:!0}},setup(p){$.use(he);const v=u(""),l=u("");u(""),u("");const t=u(!1),g=u(!1),h=u(!1),w=u(!1),d=u(!1),i=p,T=[{data:"STOREID",title:"STOREID"},{data:"POSTEDDATETIME",title:"POSTEDDATETIME",render:function(o,s,c){return new Date(o).toLocaleDateString()}},{data:"ITEMID",title:"ITEMID"},{data:"COUNTED",title:"COUNTED"}],K=[{data:"posted",title:"POSTED"},{data:"description",title:"TR #"},{data:"qty",title:"QTY"},{data:"createddatetime",title:"DATE"},{data:null,render:"#action",title:"ACTIONS"}],x={paging:!1,scrollX:!0,scrollY:"60vh",scrollCollapse:!0},Q=()=>{g.value=!0},Z=()=>{t.value=!1},ee=()=>{g.value=!1},te=()=>{h.value=!1},oe=()=>{w.value=!1},se=()=>{d.value=!1};ie();const ae=o=>{console.log("Redirecting to Item Order Entries for account:",o),window.location.href=`Dispatch/Items/${o}`};B(()=>{const o=new Date,s=o.getFullYear(),c=String(o.getMonth()+1).padStart(2,"0"),_=String(o.getDate()).padStart(2,"0");return`${s}${c}${_}`});async function ne(){if(!i.orders||i.orders.length===0){alert("No orders available to generate file.");return}const o=i.orders[0].STOREID;if(!o){alert("Store ID is missing from the order data.");return}const s=new Date(i.orders[0].POSTEDDATETIME);if(isNaN(s.getTime())){alert("Invalid posted date in the order data.");return}const c=`${s.getFullYear()}${(s.getMonth()+1).toString().padStart(2,"0")}${s.getDate().toString().padStart(2,"0")}`,_=`${o}${c}.txt`,M=`${o}|${s.toLocaleDateString()}`,b=i.orders.filter(f=>f.COUNTED>0).map(f=>`${f.ITEMID}|${Math.floor(f.COUNTED)}`);if(b.length===0){alert("No items with non-zero counts to report.");return}const U=[M,...b].join(`
`),le=c;try{const V=await(await fetch("/save-file",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({content:U,filename:_,folderName:le})})).json();V.success?alert("Your order has been successfully sent to the head office!"):alert("Error saving file: "+(V.message||"Unknown error"))}catch(f){console.error("Error:",f),alert("Error saving file: "+f.message)}}const E=u(!1),k=u("");let m;const N=()=>{console.log("Starting warning sound"),m||(m=new Audio("/audio/warning.ogg"),m.loop=!0),m.play().then(()=>{console.log("Audio started playing")}).catch(o=>{console.error("Error playing audio:",o)})},O=()=>{m&&(m.pause(),m.currentTime=0)},F=()=>{const o=new Date,s=o.getHours(),c=o.getMinutes();console.log(`Checking time: ${s}:${c}`),(s===14&&c===40||s===16&&c===40)&&(console.log("Warning condition met!"),E.value=!0,k.value=o.toLocaleTimeString(),N())},re=()=>{E.value=!1,O()};let R;return L(()=>{m=new Audio("/audio/warning.ogg"),m.loop=!0,R=setInterval(F,6e4),F()}),de(()=>{clearInterval(R),O()}),(o,s)=>{const c=j("SendModal"),_=j("More"),M=j("ExcelIcon");return y(),W(me,null,[E.value?(y(),W("div",Ee,[a("div",Me,[s[0]||(s[0]=a("p",{class:"font-bold"},"Warning",-1)),a("p",null,"It's "+ce(k.value)+"!",1),a("button",{onClick:re,class:"mt-2 bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded"}," Close ")])])):ue("",!0),e(fe,{"active-tab":"Manage"},{modals:r(()=>[e(be,{"show-modal":g.value,onToggleActive:ee},null,8,["show-modal"]),e(De,{"show-modal":t.value,journalid:v.value,description:l.value,onToggleActive:Z},null,8,["show-modal","journalid","description"]),e(c,{"show-modal":h.value,"item-name":"inventjournaltables",journalid:v.value,onToggleActive:te},null,8,["show-modal","journalid"]),e(pe,{"show-modal":d.value,"item-name":"inventjournaltrans",journalid:v.value,onToggleActive:se},null,8,["show-modal","journalid"]),e(_,{"show-modal":w.value,accountnum:o.accountnum,onToggleActive:oe},null,8,["show-modal","accountnum"])]),main:r(()=>[e(q,null,{default:r(()=>[a("div",je,[a("div",$e,[e(D,{type:"button",onClick:Q,class:"m-6 bg-navy"},{default:r(()=>[e(ve,{class:"h-4"})]),_:1}),a("button",{onClick:N,hidden:""},"Start Warning Sound")])]),e(n($),{data:p.inventjournaltables,columns:K,class:"w-full relative display",options:x},{action:r(b=>[a("div",Ce,[e(D,{class:"cursor-pointer bg-navy",onClick:U=>ae(b.cellData.journalid)},{default:r(()=>s[1]||(s[1]=[S(" ITEMS ")])),_:2},1032,["onClick"])])]),_:1},8,["data"])]),_:1}),e(q,{class:"hidden"},{default:r(()=>[a("div",Ae,[a("div",Ie,[s[2]||(s[2]=S("           ")),a("button",{onClick:ne},"Generate and Download Text File"),e(ge,{type:"button",onClick:o.exportToExcel,class:"m-6 bg-green"},{default:r(()=>[e(M,{class:"h-4"})]),_:1},8,["onClick"])])]),e(n($),{data:p.orders,columns:T,class:"w-full relative display",options:x},{action:r(b=>s[3]||(s[3]=[a("div",{class:"flex justify-start"},null,-1)])),_:1},8,["data"])]),_:1})]),_:1})],64)}}};export{et as default};
