import{u as ue}from"./vue-router-C4YpWL0t.js";import{q as K,T as $,o as T,c as C,w as s,b as o,i as I,a as l,u as t,n as x,g as S,k,l as E,t as Q,d as f,E as me,p as J,e as G,f as pe,F as ge}from"./app-CacuESpm.js";import{M as U}from"./DaisyModal-BKXvMqmH.js";import{_}from"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-Oe7tEmQB.js";import{_ as D,a as M,b as j}from"./InputError-DlCP3Rcd.js";import{F as P}from"./FormComponent-DIApVv4D.js";import{M as fe}from"./Modal-CTDQd9c8.js";import{_ as ve}from"./SuccessButton-DPuuu4Kg.js";import{_ as he}from"./Main-2jZhlWuC.js";import"./FileSaver.min-Cn20wmfd.js";import"./exceljs.min-BdicTKAv.js";import{S as be}from"./Send-DtGT6c2Z.js";import{A as we}from"./Add-BAyeSVI0.js";import{T as X}from"./TableContainer-D6l808Wc.js";import{P as V,D as _e}from"./dataTables-BnFpA0RH.js";/* empty css                                                                   */import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Logout-CqgzcP31.js";/* empty css                                                             */import"./PartyCake143-Di4gRlu7.js";import"./Attendance-B0jvDPeG.js";const ye={class:"grid grid-cols-1"},Te={class:"col-span-1"},Se={class:"grid grid-cols-1 gap-4"},je={__name:"Create",props:{showModal:{type:Boolean,default:!1}},setup(c,{emit:m}){K(()=>$page.props.auth.user.storeid);const r=$({storeid:"",description:""}),e=()=>{r.post("/waste",{preserveScroll:!0,onSuccess:()=>r.reset()})},u=m,v=()=>{u("toggleActive")};return(p,n)=>(T(),C(U,{title:"CREATE NEW WASTE",onToggleActive:v,"show-modal":c.showModal},{content:s(()=>[o(P,{onSubmit:I(e,["prevent"])},{default:s(()=>[l("div",ye,[l("div",Te,[l("div",Se,[l("div",null,[o(D,{for:"STORE",value:"Your Waste Declaration has been automatically generated with BO #"}),o(M,{id:"storeid",modelValue:t(r).storeid,"onUpdate:modelValue":n[0]||(n[0]=a=>t(r).storeid=a),type:"text",class:"mt-1 block w-full hidden","is-error":!!t(r).errors.storeid,value:p.$page.props.auth.user.storeid,autofocus:"",disabled:""},null,8,["modelValue","is-error","value"]),o(j,{message:t(r).errors.storeid,class:"mt-2"},null,8,["message"])])])])])]),_:1})]),buttons:s(()=>[o(_,{type:"submit",onClick:e,disabled:t(r).processing,class:x({"opacity-25":t(r).processing})},{default:s(()=>n[1]||(n[1]=[S(" Generate ")])),_:1},8,["disabled","class"])]),_:1},8,["show-modal"]))}},Ee={class:"col-span-6 sm:col-span-4"},De={class:"col-span-6 sm:col-span-4"},Me={__name:"Update",props:{journalid:{type:[String,Number],required:!0},description:{type:[String,Number],required:!0},showModal:{type:Boolean,default:!1}},setup(c,{emit:m}){const r=c,e=$({journalid:"",description:""}),u=()=>{e.patch("/order/patch",{preserveScroll:!0})},v=m,p=()=>{v("toggleActive")};return k(()=>{e.journalid=r.journalid,e.description=r.description,E(()=>r.journalid,n=>{e.journalid=n}),E(()=>r.description,n=>{e.description=n})}),(n,a)=>(T(),C(U,{title:"Update Form",onToggleActive:p,"show-modal":c.showModal},{content:s(()=>[o(P,{onSubmit:I(u,["prevent"])},{default:s(()=>[l("div",Ee,[o(D,{for:"journalid",value:"journalid"}),o(M,{id:"journalid",modelValue:t(e).journalid,"onUpdate:modelValue":a[0]||(a[0]=h=>t(e).journalid=h),type:"text",class:"mt-1 block w-full bg-blue-50","is-error":!!t(e).errors.journalid,disabled:""},null,8,["modelValue","is-error"]),o(j,{message:t(e).errors.journalid,class:"mt-2"},null,8,["message"])]),l("div",De,[o(D,{for:"description",value:"DESCRIPTION",class:"pt-4"}),o(M,{id:"description",modelValue:t(e).description,"onUpdate:modelValue":a[1]||(a[1]=h=>t(e).description=h),"is-error":!!t(e).errors.description,type:"text",class:"mt-1 block w-full"},null,8,["modelValue","is-error"]),o(j,{message:t(e).errors.description,class:"mt-2"},null,8,["message"])])]),_:1})]),buttons:s(()=>[o(_,{type:"submit",onClick:u,disabled:t(e).processing,class:x({"opacity-25":t(e).processing})},{default:s(()=>a[2]||(a[2]=[S(" UPDATE ")])),_:1},8,["disabled","class"])]),_:1},8,["show-modal"]))}},Ae={class:"col-span-6 sm:col-span-4 font-thin text-sm px-1"},$e={__name:"Post",props:{journalid:{type:[String,Number],required:!0}},setup(c,{emit:m}){const r=c,e=$({journalid:r.journalid}),u=()=>{console.log("Submitting form..."),e.patch("/ItemOrders/post",{preserveScroll:!0,onSuccess:()=>{console.log("Form submission successful."),p()},onError:n=>{console.error("Form submission error:",n)}})},v=m,p=()=>{v("toggleActive")};return k(()=>{e.journalid=r.journalid,E(()=>r.journalid,n=>{e.journalid=n})}),(n,a)=>(T(),C(fe,{title:"Post all lines",onToggleActive:p,"show-modal":n.showModal},{content:s(()=>[l("form",{onSubmit:I(u,["prevent"]),class:"mt-3",method:"DELETE"},[l("div",Ae," Are you sure you want to post all entries associated with data ID "+Q(c.journalid)+"? ",1),o(j,{message:t(e).errors.ID,class:"mt-2"},null,8,["message"])],32)]),buttons:s(()=>[o(_,{type:"submit",onClick:u,disabled:t(e).processing,class:x({"opacity-25":t(e).processing})},{default:s(()=>a[0]||(a[0]=[S(" CONFIRM ")])),_:1},8,["disabled","class"])]),_:1},8,["show-modal"]))}},Ce={class:"col-span-6 sm:col-span-4"},Ie={class:"col-span-6 sm:col-span-4"},xe={__name:"Send",props:{journalid:{type:[String,Number],required:!0},description:{type:[String,Number],required:!0},showModal:{type:Boolean,default:!1}},setup(c,{emit:m}){const r=c,e=$({journalid:"",description:""}),u=()=>{e.patch("/order/patch",{preserveScroll:!0})},v=m,p=()=>{v("toggleActive")};return k(()=>{e.journalid=r.journalid,e.description=r.description,E(()=>r.journalid,n=>{e.journalid=n}),E(()=>r.description,n=>{e.description=n})}),(n,a)=>(T(),C(U,{title:"Update Form",onToggleActive:p,"show-modal":c.showModal},{content:s(()=>[o(P,{onSubmit:I(u,["prevent"])},{default:s(()=>[l("div",Ce,[o(D,{for:"journalid",value:"journalid"}),o(M,{id:"journalid",modelValue:t(e).journalid,"onUpdate:modelValue":a[0]||(a[0]=h=>t(e).journalid=h),type:"text",class:"mt-1 block w-full bg-blue-50","is-error":!!t(e).errors.journalid,disabled:""},null,8,["modelValue","is-error"]),o(j,{message:t(e).errors.journalid,class:"mt-2"},null,8,["message"])]),l("div",Ie,[o(D,{for:"description",value:"DESCRIPTION",class:"pt-4"}),o(M,{id:"description",modelValue:t(e).description,"onUpdate:modelValue":a[1]||(a[1]=h=>t(e).description=h),"is-error":!!t(e).errors.description,type:"text",class:"mt-1 block w-full"},null,8,["modelValue","is-error"]),o(j,{message:t(e).errors.description,class:"mt-2"},null,8,["message"])])]),_:1})]),buttons:s(()=>[o(_,{type:"submit",onClick:u,disabled:t(e).processing,class:x({"opacity-25":t(e).processing})},{default:s(()=>a[2]||(a[2]=[S(" UPDATE ")])),_:1},8,["disabled","class"])]),_:1},8,["show-modal"]))}},ke={key:0,class:"fixed inset-0 flex items-center justify-center z-50"},Ne={class:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded shadow-lg"},Oe={class:"absolute adjust"},Fe={class:"flex justify-start items-center"},Ve={class:"flex justify-start"},Ue={class:"absolute adjust"},Pe={class:"flex justify-start items-center"},lo={__name:"Index",props:{wastedeclarations:{type:Array,required:!0},waste:{type:Array,required:!0}},setup(c){V.use(_e);const m=f(""),r=f("");f(""),f("");const e=f(!1),u=f(!1),v=f(!1),p=f(!1),n=f(!1),a=c,h=[{data:"STOREID",title:"STOREID"},{data:"POSTEDDATETIME",title:"POSTEDDATETIME",render:function(i,d,g){return new Date(i).toLocaleDateString()}},{data:"ITEMID",title:"ITEMID"},{data:"COUNTED",title:"COUNTED"}],Z=[{data:"description",title:"WASTE #"},{data:"qty",title:"QTY"},{data:"createddatetime",title:"DATE"},{data:null,render:"#action",title:"ACTIONS"}],W={paging:!1,scrollX:!0,scrollY:"60vh",scrollCollapse:!0},ee=()=>{u.value=!0},oe=()=>{e.value=!1},te=()=>{u.value=!1},se=()=>{v.value=!1},re=()=>{p.value=!1},ae=()=>{n.value=!1};ue();const ne=i=>{console.log("Redirecting to Item Order Entries for account:",i),window.location.href=`/WasteItem/${i}`};K(()=>{const i=new Date,d=i.getFullYear(),g=String(i.getMonth()+1).padStart(2,"0"),y=String(i.getDate()).padStart(2,"0");return`${d}${g}${y}`});async function R(){if(!a.orders||a.orders.length===0){alert("No orders available to generate file.");return}const i=a.orders[0].STOREID;if(!i){alert("Store ID is missing from the order data.");return}const d=new Date(a.orders[0].POSTEDDATETIME);if(isNaN(d.getTime())){alert("Invalid posted date in the order data.");return}const g=`${d.getFullYear()}${(d.getMonth()+1).toString().padStart(2,"0")}${d.getDate().toString().padStart(2,"0")}`,y=`${i}${g}.txt`,A=`${i}|${d.toLocaleDateString()}`,O=a.orders.filter(w=>w.COUNTED>0).map(w=>`${w.ITEMID}|${Math.floor(w.COUNTED)}`);if(O.length===0){alert("No items with non-zero counts to report.");return}const ie=[A,...O].join(`
`),de=g;try{const z=await(await fetch("/save-file",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({content:ie,filename:y,folderName:de})})).text();console.log("Full server response:",z);let F;try{F=JSON.parse(z)}catch(ce){console.error("Error parsing JSON:",ce),alert("Error: Server returned an invalid response. Please clear your cache!");return}F.success?(alert("Your order has been successfully sent to the head office!"),location.reload()):alert("Error saving file: "+(F.message||"Unknown error"))}catch(w){console.error("Error:",w),alert("Error saving file: "+w.message)}}const N=f(!1),q=f("");let b;const B=()=>{console.log("Starting warning sound"),b||(b=new Audio("/audio/warning.ogg"),b.loop=!0),b.play().then(()=>{console.log("Audio started playing")}).catch(i=>{console.error("Error playing audio:",i)})},H=()=>{b&&(b.pause(),b.currentTime=0)},Y=()=>{const i=new Date,d=i.getHours(),g=i.getMinutes();console.log(`Checking time: ${d}:${g}`),(d===13&&g===32||d===16&&g===40)&&(console.log("Warning condition met!"),N.value=!0,q.value=i.toLocaleTimeString(),B())},le=()=>{N.value=!1,H()};let L;return k(()=>{b=new Audio("/audio/warning.ogg"),b.loop=!0,L=setInterval(Y,6e4),Y()}),me(()=>{clearInterval(L),H()}),(i,d)=>{const g=J("More"),y=J("ExcelIcon");return T(),G(ge,null,[N.value?(T(),G("div",ke,[l("div",Ne,[d[0]||(d[0]=l("p",{class:"font-bold"},"Warning",-1)),l("p",null,"It's "+Q(q.value)+"!",1),l("button",{onClick:le,class:"mt-2 bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded"}," Close ")])])):pe("",!0),o(he,{"active-tab":"BO"},{modals:s(()=>[o(je,{"show-modal":u.value,onToggleActive:te},null,8,["show-modal"]),o(Me,{"show-modal":e.value,journalid:m.value,description:r.value,onToggleActive:oe},null,8,["show-modal","journalid","description"]),o(xe,{"show-modal":v.value,"item-name":"inventjournaltables",journalid:m.value,onToggleActive:se},null,8,["show-modal","journalid"]),o($e,{"show-modal":n.value,"item-name":"inventjournaltrans",journalid:m.value,onToggleActive:ae},null,8,["show-modal","journalid"]),o(g,{"show-modal":p.value,accountnum:i.accountnum,onToggleActive:re},null,8,["show-modal","accountnum"])]),main:s(()=>[o(X,null,{default:s(()=>[l("div",Oe,[l("div",Fe,[o(_,{type:"button",onClick:ee,class:"m-6 bg-navy"},{default:s(()=>[o(we,{class:"h-4"})]),_:1}),o(_,{class:"ml-5 cursor-pointer bg-navy hidden",onClick:R},{default:s(()=>[o(be,{class:"h-4"})]),_:1}),l("button",{onClick:B,hidden:""},"Start Warning Sound")])]),o(t(V),{data:c.wastedeclarations,columns:Z,class:"w-full relative display",options:W},{action:s(A=>[l("div",Ve,[o(_,{class:"cursor-pointer bg-navy",onClick:O=>ne(A.cellData.journalid)},{default:s(()=>d[1]||(d[1]=[S(" WASTE ")])),_:2},1032,["onClick"])])]),_:1},8,["data"])]),_:1}),o(X,{class:"hidden"},{default:s(()=>[l("div",Ue,[l("div",Pe,[d[2]||(d[2]=S("           ")),l("button",{onClick:R},"Generate and Download Text File"),o(ve,{type:"button",onClick:i.exportToExcel,class:"m-6 bg-green"},{default:s(()=>[o(y,{class:"h-4"})]),_:1},8,["onClick"])])]),o(t(V),{data:c.waste,columns:h,class:"w-full relative display",options:W},{action:s(A=>d[3]||(d[3]=[l("div",{class:"flex justify-start"},null,-1)])),_:1},8,["data"])]),_:1})]),_:1})],64)}}};export{lo as default};
