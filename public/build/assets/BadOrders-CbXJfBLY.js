import{d as w,q as k,k as $,l as q,E as H,c as R,w as C,B as z,o as g,e as S,a as r,f as F,b as A,j as B,v as O,t as b,u as Y,N as G}from"./app-DJ_ZTFbI.js";import{_ as Q}from"./AdminPanel-DorjMUAR.js";import{_ as X}from"./Main-mJnHo3lV.js";import{_ as J}from"./MultiSelectDropdown-BGEH8HHf.js";import{T as K}from"./TableContainer-CTCvRGFw.js";import{j as Z,P as L,D as P}from"./dataTables-Dqt6QQHC.js";import"./buttons.print-BlFcwtqH.js";import"./buttons.colVis-BoiKEZF9.js";import{E as tt}from"./exceljs.min-DuakHjXl.js";import"./RetailGroup-ReiPV-Rs.js";import"./Logout-CqZ_wKbj.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                             */import"./Modal-CKYSH-Ul.js";import"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-B7C873nC.js";import"./RetailItems-BqM3fhIp.js";import"./PartyCake143-CS_JfOvx.js";const et={key:0,class:"fixed inset-0 bg-black bg-opacity-30 z-50 flex items-center justify-center"},at={class:"mb-4 flex flex-wrap gap-4 p-4 bg-white rounded-lg shadow z-[999] sticky top-0"},lt={key:0,class:"flex-1 min-w-[200px]"},rt={class:"flex-1 min-w-[200px]"},ot={class:"flex-1 min-w-[200px]"},st={class:"flex justify-between items-center mb-4"},nt={key:0,class:"text-sm text-gray-600"},it={key:0,class:"p-8 text-center bg-gray-50 rounded-lg"},St={__name:"BadOrders",props:{bo:{type:Array,required:!0},stores:{type:Array,required:!0},userRole:{type:String,required:!0},filters:{type:Object,required:!0,default:()=>({startDate:"",endDate:"",selectedStores:[]})}},setup(v){window.$=window.jQuery=Z,L.use(P);const _=w([]),c=w(""),m=w(""),y=w(!1),T=w(0),h=v,W=k(()=>h.userRole.toUpperCase()==="STORE"?X:Q);$(()=>{_.value=h.filters.selectedStores||[],c.value=h.filters.startDate||"",m.value=h.filters.endDate||""});const x=k(()=>{let e=[...h.bo];return _.value.length>0&&(e=e.filter(t=>_.value.includes(t.storename))),e}),D=k(()=>x.value&&x.value.length>0),s=k(()=>x.value.reduce((e,t)=>{const l=parseFloat(t.throw_away||0)+parseFloat(t.early_molds||0)+parseFloat(t.pull_out||0)+parseFloat(t.rat_bites||0)+parseFloat(t.ant_bites||0),d=parseFloat(t.price||0)*l;return{throw_away:(e.throw_away||0)+parseFloat(t.throw_away||0),early_molds:(e.early_molds||0)+parseFloat(t.early_molds||0),pull_out:(e.pull_out||0)+parseFloat(t.pull_out||0),rat_bites:(e.rat_bites||0)+parseFloat(t.rat_bites||0),ant_bites:(e.ant_bites||0)+parseFloat(t.ant_bites||0),total_waste:(e.total_waste||0)+l,total_price:(e.total_price||0)+d}},{throw_away:0,early_molds:0,pull_out:0,rat_bites:0,ant_bites:0,total_waste:0,total_price:0})),j=[{data:"itemid",title:"Item ID",footer:"Grand Total"},{data:"itemname",title:"Item Name",footer:""},{data:"category",title:"Category",footer:""},{data:"storename",title:"Store Name",footer:""},{data:"batchdate",title:"Batch Date",render:e=>e?new Date(e).toLocaleDateString():"",footer:""},{data:"waste_declaration_date",title:"Waste Declaration Date",render:e=>e?new Date(e).toLocaleDateString():"",footer:""},{data:"price",title:"PRICE (INCL. TAX)",render:e=>{const t=parseFloat(e||0);return isNaN(t)?"0.00":t.toFixed(2)},footer:"",className:"text-right"},{data:"throw_away",title:"THROW AWAY",render:e=>{const t=parseFloat(e||0);return isNaN(t)?"0":parseInt(t,10).toString()},footer:function(){const e=s.value.throw_away||0;return parseInt(e,10).toString()},className:"text-right"},{data:"early_molds",title:"EARLY MOLDS",render:e=>{const t=parseFloat(e||0);return isNaN(t)?"0":parseInt(t,10).toString()},footer:function(){const e=s.value.early_molds||0;return parseInt(e,10).toString()},className:"text-right"},{data:"pull_out",title:"PULL OUT",render:e=>{const t=parseFloat(e||0);return isNaN(t)?"0":parseInt(t,10).toString()},footer:function(){const e=s.value.pull_out||0;return parseInt(e,10).toString()},className:"text-right"},{data:"rat_bites",title:"RAT BITES",render:e=>{const t=parseFloat(e||0);return isNaN(t)?"0":parseInt(t,10).toString()},footer:function(){const e=s.value.rat_bites||0;return parseInt(e,10).toString()},className:"text-right"},{data:"ant_bites",title:"ANT BITES",render:e=>{const t=parseFloat(e||0);return isNaN(t)?"0":parseInt(t,10).toString()},footer:function(){const e=s.value.ant_bites||0;return parseInt(e,10).toString()},className:"text-right"},{data:null,title:"TOTAL WASTE",render:(e,t,l)=>{const i=parseFloat(l.throw_away||0)+parseFloat(l.early_molds||0)+parseFloat(l.pull_out||0)+parseFloat(l.rat_bites||0)+parseFloat(l.ant_bites||0);return parseInt(i,10).toString()},footer:function(){const e=s.value.total_waste||0;return parseInt(e,10).toString()},className:"text-right font-bold"},{data:null,title:"TOTAL PRICE",render:(e,t,l)=>{const i=parseFloat(l.throw_away||0)+parseFloat(l.early_molds||0)+parseFloat(l.pull_out||0)+parseFloat(l.rat_bites||0)+parseFloat(l.ant_bites||0),n=parseFloat(l.price||0)*i;return isNaN(n)?"0.00":n.toFixed(2)},footer:function(){const e=s.value.total_price||0;return isNaN(e)?"0.00":e.toFixed(2)},className:"text-right font-bold"}],U=e=>{try{y.value=!0;const t=new tt.Workbook,l=t.addWorksheet("BO Data");l.columns=[{header:"Item ID",key:"itemid",width:15},{header:"Item Name",key:"itemname",width:30},{header:"Category",key:"category",width:15},{header:"Store Name",key:"storename",width:20},{header:"Batch Date",key:"batchdate",width:15},{header:"Waste Declaration Date",key:"waste_declaration_date",width:20},{header:"Price (Incl. Tax)",key:"price",width:15},{header:"Throw Away",key:"throw_away",width:12},{header:"Early Molds",key:"early_molds",width:12},{header:"Pull Out",key:"pull_out",width:12},{header:"Rat Bites",key:"rat_bites",width:12},{header:"Ant Bites",key:"ant_bites",width:12},{header:"Total Waste",key:"total_waste",width:15},{header:"Total Price",key:"total_price",width:15}],l.getRow(1).font={bold:!0},l.getRow(1).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF343A40"}},l.getRow(1).font={color:{argb:"FFFFFFFF"}};const i=e.rows({search:"applied"}).data().toArray();i.forEach(a=>{const o=parseFloat(a.throw_away||0)+parseFloat(a.early_molds||0)+parseFloat(a.pull_out||0)+parseFloat(a.rat_bites||0)+parseFloat(a.ant_bites||0),p=parseFloat(a.price||0),f=p*o,u=l.addRow({itemid:a.itemid,itemname:a.itemname,category:a.category,storename:a.storename,batchdate:a.batchdate?new Date(a.batchdate):null,waste_declaration_date:a.waste_declaration_date?new Date(a.waste_declaration_date):null,price:p,throw_away:parseInt(parseFloat(a.throw_away||0),10),early_molds:parseInt(parseFloat(a.early_molds||0),10),pull_out:parseInt(parseFloat(a.pull_out||0),10),rat_bites:parseInt(parseFloat(a.rat_bites||0),10),ant_bites:parseInt(parseFloat(a.ant_bites||0),10),total_waste:parseInt(o,10),total_price:f});for(let I=8;I<=13;I++)u.getCell(I).value!==null&&(u.getCell(I).numFmt="0");u.getCell(7).numFmt="#,##0.00",u.getCell(14).numFmt="#,##0.00",u.getCell(5).value&&(u.getCell(5).numFmt="yyyy-mm-dd"),u.getCell(6).value&&(u.getCell(6).numFmt="yyyy-mm-dd")});const d=i.reduce((a,o)=>{const p=parseFloat(o.throw_away||0)+parseFloat(o.early_molds||0)+parseFloat(o.pull_out||0)+parseFloat(o.rat_bites||0)+parseFloat(o.ant_bites||0),u=parseFloat(o.price||0)*p;return{throw_away:a.throw_away+parseFloat(o.throw_away||0),early_molds:a.early_molds+parseFloat(o.early_molds||0),pull_out:a.pull_out+parseFloat(o.pull_out||0),rat_bites:a.rat_bites+parseFloat(o.rat_bites||0),ant_bites:a.ant_bites+parseFloat(o.ant_bites||0),total_waste:a.total_waste+p,total_price:a.total_price+u}},{throw_away:0,early_molds:0,pull_out:0,rat_bites:0,ant_bites:0,total_waste:0,total_price:0}),n=l.addRow({itemid:"Total",itemname:"",category:"",storename:"",batchdate:"",waste_declaration_date:"",price:"",throw_away:parseInt(d.throw_away,10),early_molds:parseInt(d.early_molds,10),pull_out:parseInt(d.pull_out,10),rat_bites:parseInt(d.rat_bites,10),ant_bites:parseInt(d.ant_bites,10),total_waste:parseInt(d.total_waste,10),total_price:d.total_price});n.font={bold:!0},n.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF007BFF"}},n.font={color:{argb:"FFFFFFFF"}};for(let a=8;a<=13;a++)n.getCell(a).value!==null&&(n.getCell(a).numFmt="0");n.getCell(14).numFmt="#,##0.00",t.xlsx.writeBuffer().then(a=>{const o=new Blob([a],{type:"application/octet-stream"}),p=document.createElement("a");p.href=URL.createObjectURL(o);const f=new Date,u=`${f.getFullYear()}-${(f.getMonth()+1).toString().padStart(2,"0")}-${f.getDate().toString().padStart(2,"0")}`;p.download=`Bad_Orders_Report_${u}.xlsx`,p.click(),y.value=!1,alert("Export completed successfully!")}).catch(a=>{console.error("Excel export error:",a),y.value=!1,alert("Error exporting to Excel: "+a.message)})}catch(t){console.error("Error in Excel export:",t),y.value=!1,alert("Error preparing Excel export: "+t.message)}},M={responsive:!0,order:[[3,"asc"],[0,"asc"]],pageLength:25,lengthMenu:[[10,25,50,100,-1],[10,25,50,100,"All"]],dom:"Blfrtip",scrollX:!0,scrollY:"50vh",buttons:["copy",{text:"Export Excel",action:function(e,t,l,i){U(t)}},"pdf","print"],drawCallback:function(e){const t=new P.Api(e);T.value=t.rows({search:"applied"}).count();const l={throw_away:0,early_molds:0,pull_out:0,rat_bites:0,ant_bites:0,total_waste:0,total_price:0};t.rows({search:"applied"}).every(function(n){const a=this.data(),o=parseFloat(a.throw_away||0)+parseFloat(a.early_molds||0)+parseFloat(a.pull_out||0)+parseFloat(a.rat_bites||0)+parseFloat(a.ant_bites||0),f=parseFloat(a.price||0)*o;l.throw_away+=parseFloat(a.throw_away||0),l.early_molds+=parseFloat(a.early_molds||0),l.pull_out+=parseFloat(a.pull_out||0),l.rat_bites+=parseFloat(a.rat_bites||0),l.ant_bites+=parseFloat(a.ant_bites||0),l.total_waste+=o,l.total_price+=f});const i=t.table().footer().querySelectorAll("td, th");["throw_away","early_molds","pull_out","rat_bites","ant_bites","total_waste","total_price"].forEach((n,a)=>{const o=a+7;i[o]&&(n==="total_price"?i[o].textContent=parseFloat(l[n]).toFixed(2):i[o].textContent=parseInt(l[n],10).toString())})}},E=()=>{if(c.value&&m.value&&new Date(c.value)>new Date(m.value)){alert("Start date cannot be later than end date"),c.value="",m.value="";return}y.value=!0,G.get(route("reports.bo"),{startDate:c.value,endDate:m.value,stores:_.value},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{y.value=!1},onError:e=>{y.value=!1,alert("Error loading data: "+Object.values(e).join(", "))}})},V=()=>{_.value=[],c.value="",m.value="",E()};let N;return q([_,c,m],()=>{clearTimeout(N),N=setTimeout(E,500)},{deep:!0}),H(()=>{clearTimeout(N)}),(e,t)=>(g(),R(z(W.value),{"active-tab":"REPORTS"},{main:C(()=>[y.value?(g(),S("div",et,t[3]||(t[3]=[r("div",{class:"bg-white p-4 rounded-lg shadow-lg"},[r("div",{class:"flex items-center"},[r("svg",{class:"animate-spin h-6 w-6 mr-3 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[r("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),r("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),r("span",null,"Loading...")])],-1)]))):F("",!0),r("div",at,[v.userRole.toUpperCase()==="ADMIN"||v.userRole.toUpperCase()==="SUPERADMIN"?(g(),S("div",lt,[A(J,{modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=l=>_.value=l),options:v.stores,label:"Stores"},null,8,["modelValue","options"])])):F("",!0),r("div",rt,[t[4]||(t[4]=r("label",{class:"block text-sm font-medium text-gray-700"},"Start Date",-1)),B(r("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=l=>c.value=l),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[O,c.value]])]),r("div",ot,[t[5]||(t[5]=r("label",{class:"block text-sm font-medium text-gray-700"},"End Date",-1)),B(r("input",{type:"date","onUpdate:modelValue":t[2]||(t[2]=l=>m.value=l),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[O,m.value]])]),r("div",{class:"flex items-end"},[r("button",{onClick:V,class:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-md"}," Clear Filters ")])]),A(K,null,{default:C(()=>[r("div",st,[t[6]||(t[6]=r("div",{class:"text-xl font-semibold"},"Bad Orders Report",-1)),D.value?(g(),S("div",nt," Showing "+b(T.value)+" record(s) ",1)):F("",!0)]),D.value?F("",!0):(g(),S("div",it,t[7]||(t[7]=[r("div",{class:"text-gray-500 mb-4"},[r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 mx-auto mb-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})]),r("p",{class:"text-lg font-medium"},"No waste records found")],-1),r("p",{class:"text-gray-600"}," Try adjusting your search filters or select a different date range. ",-1)]))),D.value?(g(),R(Y(L),{key:1,data:x.value,columns:j,class:"w-full relative display",options:M},{default:C(()=>[r("tfoot",null,[r("tr",null,[t[8]||(t[8]=r("th",null,"Grand Total",-1)),t[9]||(t[9]=r("th",null,null,-1)),t[10]||(t[10]=r("th",null,null,-1)),t[11]||(t[11]=r("th",null,null,-1)),t[12]||(t[12]=r("th",null,null,-1)),t[13]||(t[13]=r("th",null,null,-1)),t[14]||(t[14]=r("th",null,null,-1)),r("th",null,b(parseInt(s.value.throw_away,10)),1),r("th",null,b(parseInt(s.value.early_molds,10)),1),r("th",null,b(parseInt(s.value.pull_out,10)),1),r("th",null,b(parseInt(s.value.rat_bites,10)),1),r("th",null,b(parseInt(s.value.ant_bites,10)),1),r("th",null,b(parseInt(s.value.total_waste,10)),1),r("th",null,b(parseFloat(s.value.total_price).toFixed(2)),1)])])]),_:1},8,["data"])):F("",!0)]),_:1})]),_:1}))}};export{St as default};
