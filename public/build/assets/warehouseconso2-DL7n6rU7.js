import{T as F,q as b,d as M,A as V,p as W,c as z,w,o as H,b as v,a as e,i as q,j as C,v as k,u as O,n as P,g as J}from"./app-tcDoizJR.js";import{_ as X}from"./reset-Chzc-izE.js";import{_}from"./AdminPanel-O819wuuc.js";import{_ as K}from"./Main-Dtv15pGL.js";import{T as Q}from"./TableContainer-YM_KkEqb.js";import{P as $,D as Z}from"./dataTables-CvLdq1lI.js";import{_ as tt}from"./SuccessButton-D1h53LmK.js";import{_ as et}from"./TransparentButton-_ON478pE.js";import{_ as rt}from"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-yJWX9S4O.js";import{E as ot}from"./Excel-BZjl3vK6.js";import{S as st}from"./SearchColored-DnOWvde7.js";import{E as at}from"./exceljs.min-DHKwiMMl.js";import"./DaisyModal-CdsVZM9z.js";import"./Modal-CXwwTKO7.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                                   */import"./InputError-DzVTcW_j.js";import"./FormComponent-_uwYk_GY.js";import"./RetailGroup-CmLptvTZ.js";import"./Logout-yGTYNAB4.js";/* empty css                                                             */import"./RetailItems-D0FvWooD.js";import"./Attendance-BwOqMts8.js";import"./PartyCake143-BunxM3QJ.js";const nt={class:"absolute adjust"},lt={class:"flex justify-start items-center"},it=["value"],ut={"date-rangepicker":"",class:"flex items-center"},ct={class:"relative ml-5"},dt=["placeholder"],pt={class:"relative"},mt=["placeholder"],ft={class:"custom-datatable"},Et={props:{orders:{type:Array,required:!0,default:()=>[]}},computed:{flattenedOrders(){return this.calculateFlattenedOrders(this.orders)},grandTotal(){return this.flattenedOrders.reduce((m,I)=>m+(I.TOTAL||0),0)}},methods:{calculateFlattenedOrders(m){if(console.log("Calculating flattenedOrders"),console.log("Input orders:",m),!m||!Array.isArray(m))return console.error("Invalid orders data"),[];function I(u,i){if(!u.STOREID||!i.STOREID)return console.warn("Missing STOREID:",u,i),0;const p=u.STOREID.toString(),s=i.STOREID.toString();return!isNaN(p)&&!isNaN(s)?parseInt(p)-parseInt(s):p.localeCompare(s,void 0,{numeric:!0,sensitivity:"base"})}m.sort(I);const g=m.reduce((u,i)=>{if(i&&typeof i=="object"){const p=`${i.STOREID} - ${i.STORENAME}`,s=i.ITEMNAME||"",a=i.ITEMID||"",d=i.CATEGORY||"",E=i.COUNTED&&parseInt(i.COUNTED.trim())||0;u[s]||(u[s]={ITEMID:a,ITEMNAME:s,CATEGORY:d}),u[s][p]||(u[s][p]=0),u[s][p]+=E}return u},{}),c=Object.values(g).map(u=>{let i=0;const p={};return Object.keys(u).sort((s,a)=>{if(s==="ITEMID"||s==="ITEMNAME"||s==="CATEGORY")return-1;if(a==="ITEMID"||a==="ITEMNAME"||a==="CATEGORY")return 1;const d=s.split(" - ")[0],E=a.split(" - ")[0];return!isNaN(d)&&!isNaN(E)?parseInt(d)-parseInt(E):d.localeCompare(E,void 0,{numeric:!0,sensitivity:"base"})}).forEach(s=>{s!=="ITEMID"&&s!=="ITEMNAME"&&s!=="CATEGORY"&&(i+=u[s]),p[s]=u[s]}),{...p,TOTAL:i}});return console.log("Calculated flattenedOrders:",c),c},async exportToExcel(){console.log("Starting exportToExcel"),console.log("flattenedOrders:",this.flattenedOrders);try{if(!this.flattenedOrders||!Array.isArray(this.flattenedOrders)||this.flattenedOrders.length===0){console.error("No data to export");return}const m=new at.Workbook,I=m.addWorksheet("Flattened Orders"),g=[{header:"ITEMID",key:"ITEMID",width:20},{header:"ITEMNAME",key:"ITEMNAME",width:25},{header:"CATEGORY",key:"CATEGORY",width:20},{header:"TOTAL",key:"TOTAL",width:15}],c=new Set;this.flattenedOrders.forEach(a=>{a&&typeof a=="object"&&Object.keys(a).forEach(d=>{d!=="ITEMID"&&d!=="ITEMNAME"&&d!=="CATEGORY"&&d!=="TOTAL"&&c.add(d)})});const u=Array.from(c).sort((a,d)=>{const E=a.split(" - ")[0],A=d.split(" - ")[0];return!isNaN(E)&&!isNaN(A)?parseInt(E)-parseInt(A):E.localeCompare(A,void 0,{numeric:!0,sensitivity:"base"})});u.forEach(a=>{g.push({header:a,key:a,width:25})}),I.columns=g,this.flattenedOrders.forEach(a=>{if(a&&typeof a=="object"){const d={ITEMID:a.ITEMID||"",ITEMNAME:a.ITEMNAME||"",CATEGORY:a.CATEGORY||"",TOTAL:a.TOTAL||0};u.forEach(E=>{d[E]=a[E]||0}),I.addRow(d)}});const i=new Date,p=`FlattenedOrders_${i.getFullYear()}-${i.getMonth()+1}-${i.getDate()}.xlsx`,s=await m.xlsx.writeBuffer();this.saveExcelFile(s,p)}catch(m){console.error("Error exporting to Excel:",m)}},saveExcelFile(m,I){const g=new Blob([m],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),c=document.createElement("a");c.href=URL.createObjectURL(g),c.download=I,c.click()}}},Ft=Object.assign(Et,{__name:"warehouseconso2",props:{orders:{type:Array,required:!0},auth:{type:Object,required:!0},userRole:{type:String,required:!0}},setup(m,{emit:I}){$.use(Z);const g=m,c=F({StartDate:"",EndDate:""}),u=()=>{c.get(route("warehouse.getrange"),{preserveScroll:!0})};b(()=>(console.log("userRole value:",g.userRole),console.log("Is Store?:",g.userRole.toUpperCase()==="STORE"),g.userRole.toUpperCase()==="STORE"?K:_));const i=b(()=>{const o=g.orders.reduce((r,T)=>{const{STORENAME:f,ITEMID:l,ITEMNAME:h,CATEGORY:y,COUNTED:B,STOREID:U,stocks:Tt,movementstocks:gt}=T,N=parseInt((B??"").trim(),10)||0;return r[l]||(r[l]={ITEMID:l,ITEMNAME:h,CATEGORY:y,TOTAL:0}),r[l][f]||(r[l][f]={count:0,STOREID:U}),r[l][f].count+=N,r[l].TOTAL+=N,r},{}),t=Object.values(o),n=(r,T)=>{const f=r.ITEMID,l=T.ITEMID;if(f.startsWith("BW")&&l.startsWith("BW")){const h=parseInt(f.slice(2)),y=parseInt(l.slice(2));if(h<=10&&y<=10)return h-y;if(h<=10)return-1;if(y<=10)return 1}return f.localeCompare(l)};return t.sort(n)}),p=b(()=>Object.values(i.value)),s=b(()=>{const o=new Set;return p.value.forEach(t=>{Object.keys(t).forEach(n=>{typeof t[n]=="object"&&t[n]!==null&&"count"in t[n]&&o.add(n)})}),Array.from(o).sort((t,n)=>{const r=t.split(" - ")[0],T=n.split(" - ")[0];return r.localeCompare(T,void 0,{numeric:!0,sensitivity:"base"})})}),a=b(()=>{const o={ITEMID:"Grand Total",ITEMNAME:"Grand Total",CATEGORY:"",movementstocks:0,stocks:0,BalanceCount:0,TOTAL:0};return s.value.forEach(t=>{o[t]=0}),p.value.forEach(t=>{o.TOTAL+=t.TOTAL,o.movementstocks+=t.movementstocks,o.stocks+=t.stocks,o.BalanceCount+=t.BalanceCount,s.value.forEach(n=>{var r;o[n]+=((r=t[n])==null?void 0:r.count)||0})}),o}),d=b(()=>{const o=[{title:"ITEMS",data:"ITEMNAME",className:"frozen-column",footer:()=>"",orderable:!0,width:"200px"},{title:"CATEGORY",data:"CATEGORY",className:"frozen-column",footer:()=>"",width:"120px"},{title:"TOTAL",data:"TOTAL",footer:()=>a.value.TOTAL}],t=[],n=new Set;return p.value.forEach(r=>{Object.entries(r).forEach(([T,f])=>{typeof f=="object"&&f!==null&&"count"in f&&"STOREID"in f&&(n.has(T)||(n.add(T),t.push({title:`${f.STOREID}<br>${T}`,data:T,render:(l,h)=>h==="sort"||h==="type"?(l==null?void 0:l.count)||0:h==="display"?`${(l==null?void 0:l.count)||0}`:(l==null?void 0:l.count)||0,footer:()=>a.value[T]})))})}),t.sort((r,T)=>{const f=r.title.split("<br>")[0],l=T.title.split("<br>")[0];return f.localeCompare(l,void 0,{numeric:!0,sensitivity:"base"})}),[...o,...t]}),E={paging:!1,scrollX:!0,scrollY:"60vh",scrollCollapse:!0,fixedColumns:{start:3},error:function(o,t,n){console.error("DataTables error:",t)},footerCallback:function(o,t,n,r,T){const l=this.api().table().footer().querySelectorAll("th");d.value.forEach((h,y)=>{h.footer&&(l[y].textContent=h.footer())})}},A=M(null),D=b(()=>{if(A.value){const o=new Date(A.value),t=o.getFullYear(),n=String(o.getMonth()+1).padStart(2,"0"),r=String(o.getDate()).padStart(2,"0");return`${t}-${n}-${r}`}return""}),R=M(null),S=b(()=>{if(R.value){const o=new Date(R.value),t=o.getFullYear(),n=String(o.getMonth()+1).padStart(2,"0"),r=String(o.getDate()).padStart(2,"0");return`${t}-${n}-${r}`}return""});b(()=>{const o=new Date,t=o.getFullYear(),n=String(o.getMonth()+1).padStart(2,"0"),r=String(o.getDate()).padStart(2,"0");return`${t}${n}${r}`});const x=M(!1),Y=()=>{x.value=!0},j=()=>{x.value=!1},{user:L}=V(g.auth),G=M(L.value.role);return b(()=>G.value==="ADMIN"),(o,t)=>{const n=W("InputError");return H(),z(_,{"active-tab":"REPORTS"},{modals:w(()=>[v(X,{"show-modal":x.value,onToggleActive:j},null,8,["show-modal"])]),main:w(()=>[v(Q,null,{default:w(()=>[e("div",nt,[e("div",lt,[e("form",{onSubmit:q(u,["prevent"]),class:"px-2 py-3 max-h-[50vh] lg:max-h-[70vh] overflow-y-auto"},[e("input",{type:"hidden",name:"_token",value:o.$page.props.csrf_token},null,8,it),e("div",ut,[e("div",ct,[t[4]||(t[4]=e("div",{class:"flex absolute inset-y-0 left-0 items-center pl-3 pointer-events-none"},[e("svg",{class:"w-5 h-5 text-gray-500 dark:text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"fill-rule":"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z","clip-rule":"evenodd"})])],-1)),C(e("input",{id:"StartDate",type:"date","onUpdate:modelValue":t[0]||(t[0]=r=>O(c).StartDate=r),onInput:t[1]||(t[1]=(...r)=>D.value&&D.value(...r)),placeholder:D.value,class:"bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",required:""},null,40,dt),[[k,O(c).StartDate]]),v(n,{message:O(c).errors.StartDate,class:"mt-2"},null,8,["message"])]),t[6]||(t[6]=e("span",{class:"mx-4 text-gray-500"},"to",-1)),e("div",pt,[t[5]||(t[5]=e("div",{class:"flex absolute inset-y-0 left-0 items-center pl-3 pointer-events-none"},[e("svg",{class:"w-5 h-5 text-gray-500 dark:text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"fill-rule":"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z","clip-rule":"evenodd"})])],-1)),C(e("input",{id:"EndDate",type:"date","onUpdate:modelValue":t[2]||(t[2]=r=>O(c).EndDate=r),onInput:t[3]||(t[3]=(...r)=>S.value&&S.value(...r)),placeholder:S.value,class:"bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",required:""},null,40,mt),[[k,O(c).EndDate]]),v(n,{message:O(c).errors.EndDate,class:"mt-2"},null,8,["message"])])])],32),v(et,{type:"submit",onClick:u,disabled:O(c).processing,class:P({"opacity-25":O(c).processing})},{default:w(()=>[v(st,{class:"h-8"})]),_:1},8,["disabled","class"]),t[8]||(t[8]=e("details",{className:"dropdown"},[e("summary",{className:"btn m-1 !bg-navy !text-white"},"TYPES"),e("ul",{className:"menu dropdown-content !bg-gray-100 rounded-box z-[1] w-52 p-2 shadow"},[e("li",null,[e("a",{href:"/orderingconso"},"BW PRODUCTS")]),e("li",null,[e("a",{href:"/warehouse-reports"},"WAREHOUSE")])])],-1)),t[9]||(t[9]=e("details",{className:"dropdown"},[e("summary",{className:"btn m-1 !bg-navy !text-white"},"RECENT"),e("ul",{className:"menu dropdown-content !bg-gray-100 rounded-box z-[1] w-52 p-2 shadow"},[e("li",null,[e("a",{href:"/lastmonth"},"Last Month")]),e("li",null,[e("a",{href:"/lastweek"},"Last Week")]),e("li",null,[e("a",{href:"/yesterday"},"Yesterday")])])],-1)),v(tt,{type:"button",onClick:o.exportToExcel,class:"m-6 bg-green"},{default:w(()=>[v(ot,{class:"h-4"})]),_:1},8,["onClick"]),v(rt,{type:"button",onClick:Y,class:"m-1 ml-2 !bg-navy p-10"},{default:w(()=>t[7]||(t[7]=[J(" RESET ")])),_:1}),t[10]||(t[10]=e("h6",{class:"ml-2 font-bold"},"WAREHOUSE",-1))])]),e("div",ft,[v(O($),{data:p.value,columns:d.value,class:"w-full relative display",options:E},{action:w(r=>t[11]||(t[11]=[e("div",{class:"flex justify-start"},null,-1)])),_:1},8,["data","columns"])])]),_:1})]),_:1})}}});export{Ft as default};
