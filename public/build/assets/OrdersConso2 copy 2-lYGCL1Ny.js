import{T as _,s as T,d as x,p as R,c as N,w as v,o as $,b as E,a as r,i as Y,j as I,v as M,u as p,n as L,t as S}from"./app-Brw7jJEf.js";import{_ as j}from"./AdminPanel-gBVzbbkn.js";import{T as F}from"./TableContainer-Coscx9RQ.js";import{P as A,D as G}from"./dataTables-Jqqx4cQa.js";import{_ as V}from"./TransparentButton-C3Epfz9M.js";import{_ as B}from"./SuccessButton-DgsL3R_E.js";import{S as U}from"./SearchColored-Cf555PA_.js";import{E as z}from"./Excel-Fyr4eY0J.js";import{E as H}from"./exceljs.min-CfmGYqIU.js";import"./RetailGroup-CBJ5tnzv.js";import"./Logout-DCQOxVUr.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                             */import"./Modal-CtatsLVe.js";import"./Modal.vue_vue_type_style_index_0_scoped_fd08cd24_lang-DaotuncJ.js";import"./RetailItems-Bli-UwjH.js";import"./Attendance-DYGT2FcC.js";const q={class:"absolute adjust"},W={class:"flex justify-start items-center"},P=["value"],J={"date-rangepicker":"",class:"flex items-center"},X={class:"relative ml-5"},K=["placeholder"],Q={class:"relative"},Z=["placeholder"],tt={class:"font-bold text:navy font-xs"},et={props:{orders:{type:Array,required:!0}},computed:{flattenedOrders(){return this.calculateFlattenedOrders(this.orders)}},methods:{async exportToExcel(){try{const i=new H.Workbook,g=i.addWorksheet("Flattened Orders"),o=[{header:"ITEMID",key:"ITEMID",width:20},{header:"ITEMNAME",key:"ITEMNAME",width:25},{header:"CATEGORY",key:"CATEGORY",width:20},{header:"TOTAL",key:"TOTAL",width:15}],e=new Set;this.flattenedOrders.forEach(d=>{Object.keys(d).forEach(u=>{u!=="ITEMID"&&u!=="ITEMNAME"&&u!=="CATEGORY"&&u!=="TOTAL"&&e.add(u)})}),e.forEach(d=>{o.push({header:d,key:d,width:15})}),g.columns=o,this.flattenedOrders.forEach(d=>{const u={ITEMID:d.ITEMID,ITEMNAME:d.ITEMNAME,CATEGORY:d.CATEGORY,TOTAL:d.TOTAL};e.forEach(y=>{u[y]=d[y]||0}),g.addRow(u)});const l=new Date,m=`FlattenedOrders_${l.getFullYear()}-${l.getMonth()+1}-${l.getDate()}.xlsx`,b=await i.xlsx.writeBuffer();this.saveExcelFile(b,m)}catch(i){console.error("Error exporting to Excel:",i)}},saveExcelFile(i,g){const o=new Blob([i],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),e=document.createElement("a");e.href=URL.createObjectURL(o),e.download=g,e.click()},calculateFlattenedOrders(i){const g=i.reduce((o,e)=>{const l=e.STORENAME,m=e.ITEMNAME,b=e.ITEMID,d=e.CATEGORY,u=e.COUNTED&&parseInt(e.COUNTED.trim())||0;return o[m]||(o[m]={ITEMID:b,ITEMNAME:m,CATEGORY:d}),o[m][l]||(o[m][l]=0),o[m][l]+=u,o},{});return Object.values(g).map(o=>{let e=0;return Object.keys(o).forEach(l=>{l!=="ITEMID"&&l!=="ITEMNAME"&&l!=="CATEGORY"&&(e+=o[l])}),{...o,TOTAL:e}})}}},bt=Object.assign(et,{__name:"OrdersConso2 copy 2",props:{orders:{type:Array,required:!0},startDate:String,endDate:String},setup(i,{emit:g}){A.use(G);const o=i,e=_({StartDate:"",EndDate:""}),l=()=>{e.get(route("orderingconso.getrange"),{preserveScroll:!0})},m={paging:!1,scrollX:!0,scrollY:"60vh",scrollCollapse:!0,error:function(a,t,n){console.error("DataTables error:",t)}},b=T(()=>o.orders.reduce((a,t)=>{const{STORENAME:n,ITEMID:s,ITEMNAME:c,CATEGORY:f,COUNTED:h,STOREID:C}=t,O=parseInt((h??"").trim(),10)||0;return a[s]||(a[s]={ITEMID:s,ITEMNAME:c,CATEGORY:f,TOTAL:0}),a[s][n]||(a[s][n]={count:0,STOREID:C}),a[s][n].count+=O,a[s].TOTAL+=O,a},{})),d=T(()=>Object.values(b.value)),u=T(()=>{const a=[{title:"ITEMID",data:"ITEMID"},{title:"ITEMS",data:"ITEMNAME"},{title:"CATEGORY",data:"CATEGORY"},{title:"TOTAL",data:"TOTAL"}],t=[],n=new Set;return d.value.forEach(s=>{Object.entries(s).forEach(([c,f])=>{typeof f=="object"&&f!==null&&"count"in f&&"STOREID"in f&&(n.has(c)||(n.add(c),t.push({title:`${f.STOREID}<br>${c}`,data:c,render:h=>(h==null?void 0:h.count)||0})))})}),t.sort((s,c)=>{const f=s.title.split("<br>")[0],h=c.title.split("<br>")[0];return f.localeCompare(h,void 0,{numeric:!0,sensitivity:"base"})}),[...a,...t]}),y=x(null),D=T(()=>{const a=p(y);if(a){const t=new Date(a),n=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),c=String(t.getDate()).padStart(2,"0");return`${n}-${s}-${c}`}return""}),k=x(null),w=T(()=>{const a=p(k);if(a){const t=new Date(a),n=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),c=String(t.getDate()).padStart(2,"0");return`${n}-${s}-${c}`}return""});return T(()=>{const a=new Date,t=a.getFullYear(),n=String(a.getMonth()+1).padStart(2,"0"),s=String(a.getDate()).padStart(2,"0");return`${t}${n}${s}`}),(a,t)=>{const n=R("InputError");return $(),N(j,{"active-tab":"REPORTS"},{main:v(()=>[E(F,null,{default:v(()=>[r("div",q,[r("div",W,[r("form",{onSubmit:Y(l,["prevent"]),class:"px-2 py-3 max-h-[50vh] lg:max-h-[70vh] overflow-y-auto"},[r("input",{type:"hidden",name:"_token",value:a.$page.props.csrf_token},null,8,P),r("div",J,[r("div",X,[t[4]||(t[4]=r("div",{class:"flex absolute inset-y-0 left-0 items-center pl-3 pointer-events-none"},[r("svg",{class:"w-5 h-5 text-gray-500 dark:text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[r("path",{"fill-rule":"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z","clip-rule":"evenodd"})])],-1)),I(r("input",{id:"StartDate",type:"date","onUpdate:modelValue":t[0]||(t[0]=s=>p(e).StartDate=s),onInput:t[1]||(t[1]=(...s)=>D.value&&D.value(...s)),placeholder:D.value,class:"bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",required:""},null,40,K),[[M,p(e).StartDate]]),E(n,{message:p(e).errors.StartDate,class:"mt-2"},null,8,["message"])]),t[6]||(t[6]=r("span",{class:"mx-4 text-gray-500"},"to",-1)),r("div",Q,[t[5]||(t[5]=r("div",{class:"flex absolute inset-y-0 left-0 items-center pl-3 pointer-events-none"},[r("svg",{class:"w-5 h-5 text-gray-500 dark:text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[r("path",{"fill-rule":"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z","clip-rule":"evenodd"})])],-1)),I(r("input",{id:"EndDate",type:"date","onUpdate:modelValue":t[2]||(t[2]=s=>p(e).EndDate=s),onInput:t[3]||(t[3]=(...s)=>w.value&&w.value(...s)),placeholder:w.value,class:"bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",required:""},null,40,Z),[[M,p(e).EndDate]]),E(n,{message:p(e).errors.EndDate,class:"mt-2"},null,8,["message"])])])],32),E(V,{type:"submit",onClick:l,disabled:p(e).processing,class:L({"opacity-25":p(e).processing})},{default:v(()=>[E(U,{class:"h-8"})]),_:1},8,["disabled","class"]),t[7]||(t[7]=r("details",{className:"dropdown"},[r("summary",{className:"btn m-1"},"RECENT"),r("ul",{className:"menu dropdown-content bg-base-100 rounded-box z-[1] w-52 p-2 shadow"},[r("li",null,[r("a",{href:"/lastmonth"},"Last Month")]),r("li",null,[r("a",{href:"/lastweek"},"Last Week")]),r("li",null,[r("a",{href:"/yesterday"},"Yesterday")])])],-1)),E(B,{type:"button",onClick:a.exportToExcel,class:"m-6 bg-green"},{default:v(()=>[E(z,{class:"h-4"})]),_:1},8,["onClick"]),r("p",tt,S(i.startDate)+" | "+S(i.endDate),1)])]),E(p(A),{data:d.value,columns:u.value,class:"w-full relative display",options:m},{action:v(s=>t[8]||(t[8]=[r("div",{class:"flex justify-start"},null,-1)])),_:1},8,["data","columns"])]),_:1})]),_:1})}}});export{bt as default};
